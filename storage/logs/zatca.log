[2025-09-19 18:33:03] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:33:03] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:33:03] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:33:03] local.ERROR: TLV generation for XML failed {"error":"preg_match(): Argument #2 ($subject) must be of type string, DateTimeImmutable given"} 
[2025-09-19 18:33:03] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:33:03] local.INFO: Starting ZATCA invoice generation {"invoice_number":"000000129","uuid":"87e8ce47-1cb6-4953-a3ff-1609c3741e01","has_certificate":true,"branch_number":"0000"} 
[2025-09-19 18:33:03] local.DEBUG: Applying default values to invoice data  
[2025-09-19 18:33:03] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"000000129","uuid":"87e8ce47-1cb6-4953-a3ff-1609c3741e01","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"129","previous_invoice_hash":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","pricing_type":"inclusive","tlv_qr":""}} 
[2025-09-19 18:33:03] local.DEBUG: Default values applied {"result_data":{"uuid":"87e8ce47-1cb6-4953-a3ff-1609c3741e01","invoice_counter":"129","pih":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"000000129","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","pricing_type":"inclusive","tlv_qr":""}} 
[2025-09-19 18:33:03] local.ERROR: ZATCA generation process failed: Branch not found: 0000 {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3226): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0000')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-19 18:33:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:33:24] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:33:24] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:33:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:33:24] local.INFO: Starting ZATCA invoice generation {"invoice_number":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","has_certificate":true,"branch_number":null} 
[2025-09-19 18:33:24] local.DEBUG: Applying default values to invoice data  
[2025-09-19 18:33:24] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"129","previous_invoice_hash":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","pricing_type":"inclusive"}} 
[2025-09-19 18:33:24] local.DEBUG: Default values applied {"result_data":{"uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","invoice_counter":"129","pih":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"000000129","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","pricing_type":"inclusive"}} 
[2025-09-19 18:33:24] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Running ZATCA validation  
[2025-09-19 18:33:24] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 18:33:24] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 18:33:24] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:33:24] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 18:33:24] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 18:33:24] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 18:33:24] local.INFO: Generating unsigned XML  
[2025-09-19 18:33:24] local.INFO: Starting unsigned XML generation {"invoice_number":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341"} 
[2025-09-19 18:33:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:33:24] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000129"} 
[2025-09-19 18:33:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:33:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:33:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:33:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:33:24] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:33:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:33:24] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:33:24] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:33:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:33:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:33:24] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Building additional document references  
[2025-09-19 18:33:24] local.DEBUG: Added ICV reference {"icv":"129"} 
[2025-09-19 18:33:24] local.DEBUG: Added PIH reference {"pih":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE="} 
[2025-09-19 18:33:24] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 18:33:24] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:33:24] local.DEBUG: Invoice object created successfully {"id":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:33:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000129-unsigned.xml","file_size":5194} 
[2025-09-19 18:33:24] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000129-unsigned.xml"} 
[2025-09-19 18:33:24] local.INFO: Signing XML  
[2025-09-19 18:33:24] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758292404.xml"} 
[2025-09-19 18:33:24] local.DEBUG: Calculating invoice hash  
[2025-09-19 18:33:24] local.DEBUG: Invoice hash calculated {"hash":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0="} 
[2025-09-19 18:33:24] local.INFO: Generating QR code  
[2025-09-19 18:33:24] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"000000129"} 
[2025-09-19 18:33:24] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","invoice_counter":"129","pih":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"000000129","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 18:33:24] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"000000129"} 
[2025-09-19 18:33:24] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 18:33:24] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 18:33:24] local.INFO: Starting unsigned XML generation {"invoice_number":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341"} 
[2025-09-19 18:33:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:33:24] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000129"} 
[2025-09-19 18:33:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:33:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:33:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:33:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:33:24] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:33:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:33:24] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:33:24] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:33:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:33:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:33:24] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:33:24] local.DEBUG: Building additional document references  
[2025-09-19 18:33:24] local.DEBUG: Added ICV reference {"icv":"129"} 
[2025-09-19 18:33:24] local.DEBUG: Added PIH reference {"pih":"Dd3nBezqnP4NrYJEyAdWD5OtZBuIh83uBcCOmxHF3lE="} 
[2025-09-19 18:33:24] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 18:33:24] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:33:24] local.DEBUG: Invoice object created successfully {"id":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:33:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000129-unsigned.xml","file_size":5356} 
[2025-09-19 18:33:24] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"000000129","uuid":"976c1a7e-709e-4434-b223-3b9a6dc73341","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000129-unsigned.xml"} 
[2025-09-19 18:33:24] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":129,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 18:37:19] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:37:23] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:37:23] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:37:29] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:37:29] local.ERROR: ZATCA generation process failed: Undefined variable $branchNumber {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3222): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined varia...', 'C:\\\\xampp\\\\htdocs...', 3222)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-19 18:37:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:37:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:37:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:37:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:37:59] local.INFO: Starting ZATCA invoice generation {"invoice_number":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","has_certificate":true,"branch_number":null} 
[2025-09-19 18:37:59] local.DEBUG: Applying default values to invoice data  
[2025-09-19 18:37:59] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"130","previous_invoice_hash":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0=","pricing_type":"inclusive"}} 
[2025-09-19 18:37:59] local.DEBUG: Default values applied {"result_data":{"uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","invoice_counter":"130","pih":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"000000130","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0=","pricing_type":"inclusive"}} 
[2025-09-19 18:37:59] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 18:37:59] local.DEBUG: Running ZATCA validation  
[2025-09-19 18:37:59] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 18:37:59] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 18:37:59] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:37:59] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 18:37:59] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 18:37:59] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 18:37:59] local.INFO: Generating unsigned XML  
[2025-09-19 18:37:59] local.INFO: Starting unsigned XML generation {"invoice_number":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16"} 
[2025-09-19 18:37:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:37:59] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000130"} 
[2025-09-19 18:37:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:37:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:37:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:37:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:38:00] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:38:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:38:00] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:38:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:38:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:38:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:38:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:38:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:38:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:38:00] local.DEBUG: Building additional document references  
[2025-09-19 18:38:00] local.DEBUG: Added ICV reference {"icv":"130"} 
[2025-09-19 18:38:00] local.DEBUG: Added PIH reference {"pih":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0="} 
[2025-09-19 18:38:00] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 18:38:00] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:38:00] local.DEBUG: Invoice object created successfully {"id":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:38:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000130-unsigned.xml","file_size":5194} 
[2025-09-19 18:38:00] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000130-unsigned.xml"} 
[2025-09-19 18:38:00] local.INFO: Signing XML  
[2025-09-19 18:38:01] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758292681.xml"} 
[2025-09-19 18:38:01] local.DEBUG: Calculating invoice hash  
[2025-09-19 18:38:01] local.DEBUG: Invoice hash calculated {"hash":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM="} 
[2025-09-19 18:38:01] local.INFO: Generating QR code  
[2025-09-19 18:38:01] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"000000130"} 
[2025-09-19 18:38:01] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","invoice_counter":"130","pih":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"000000130","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 18:38:01] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"000000130"} 
[2025-09-19 18:38:01] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 18:38:01] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 18:38:01] local.INFO: Starting unsigned XML generation {"invoice_number":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16"} 
[2025-09-19 18:38:01] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:38:01] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000130"} 
[2025-09-19 18:38:01] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:38:01] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:38:01] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:38:01] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:38:01] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:38:01] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:38:01] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:38:01] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:38:01] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:38:01] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:38:01] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:38:01] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:38:01] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:38:01] local.DEBUG: Building additional document references  
[2025-09-19 18:38:01] local.DEBUG: Added ICV reference {"icv":"130"} 
[2025-09-19 18:38:01] local.DEBUG: Added PIH reference {"pih":"p1Djf0x5ddm+9+/MUsjirXR6dvNOdEBD+5oEHgYSZA0="} 
[2025-09-19 18:38:01] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 18:38:01] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:38:01] local.DEBUG: Invoice object created successfully {"id":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:38:01] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000130-unsigned.xml","file_size":5356} 
[2025-09-19 18:38:01] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"000000130","uuid":"c4771b04-ec89-4e33-95c9-09a626748c16","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000130-unsigned.xml"} 
[2025-09-19 18:38:01] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":130,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 18:45:04] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:45:04] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:45:04] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:45:05] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:45:05] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e","has_certificate":true,"branch_number":null} 
[2025-09-19 18:45:05] local.DEBUG: Applying default values to invoice data  
[2025-09-19 18:45:05] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"131","previous_invoice_hash":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM=","pricing_type":"inclusive"}} 
[2025-09-19 18:45:05] local.DEBUG: Default values applied {"result_data":{"uuid":"293027ed-98df-4d18-9bfe-076a4983706e","invoice_counter":"131","pih":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000131","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM=","pricing_type":"inclusive"}} 
[2025-09-19 18:45:05] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Running ZATCA validation  
[2025-09-19 18:45:05] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 18:45:05] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 18:45:05] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:45:05] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 18:45:05] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 18:45:05] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 18:45:05] local.INFO: Generating unsigned XML  
[2025-09-19 18:45:05] local.INFO: Starting unsigned XML generation {"invoice_number":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e"} 
[2025-09-19 18:45:05] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:45:05] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000131"} 
[2025-09-19 18:45:05] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:45:05] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:45:05] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:45:05] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:45:05] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:45:05] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:45:05] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:45:05] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:45:05] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:45:05] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:45:05] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Building additional document references  
[2025-09-19 18:45:05] local.DEBUG: Added ICV reference {"icv":"131"} 
[2025-09-19 18:45:05] local.DEBUG: Added PIH reference {"pih":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM="} 
[2025-09-19 18:45:05] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 18:45:05] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:45:05] local.DEBUG: Invoice object created successfully {"id":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:45:05] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000131-unsigned.xml","file_size":5194} 
[2025-09-19 18:45:05] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000131-unsigned.xml"} 
[2025-09-19 18:45:05] local.INFO: Signing XML  
[2025-09-19 18:45:05] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758293105.xml"} 
[2025-09-19 18:45:05] local.DEBUG: Calculating invoice hash  
[2025-09-19 18:45:05] local.DEBUG: Invoice hash calculated {"hash":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ="} 
[2025-09-19 18:45:05] local.INFO: Generating QR code  
[2025-09-19 18:45:05] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000131"} 
[2025-09-19 18:45:05] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"293027ed-98df-4d18-9bfe-076a4983706e","invoice_counter":"131","pih":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000131","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 18:45:05] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"001000131"} 
[2025-09-19 18:45:05] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 18:45:05] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 18:45:05] local.INFO: Starting unsigned XML generation {"invoice_number":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e"} 
[2025-09-19 18:45:05] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:45:05] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000131"} 
[2025-09-19 18:45:05] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:45:05] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:45:05] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:45:05] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:45:05] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:45:05] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:45:05] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:45:05] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:45:05] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:45:05] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:45:05] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:45:05] local.DEBUG: Building additional document references  
[2025-09-19 18:45:05] local.DEBUG: Added ICV reference {"icv":"131"} 
[2025-09-19 18:45:05] local.DEBUG: Added PIH reference {"pih":"njbe/pFhyBTTxlfA9swp3t4j40A+FO1bSGVwGCe3RiM="} 
[2025-09-19 18:45:05] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 18:45:05] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:45:05] local.DEBUG: Invoice object created successfully {"id":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:45:05] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000131-unsigned.xml","file_size":5356} 
[2025-09-19 18:45:05] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000131","uuid":"293027ed-98df-4d18-9bfe-076a4983706e","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000131-unsigned.xml"} 
[2025-09-19 18:45:05] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":131,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 18:45:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:45:27] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:45:27] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:45:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:45:27] local.ERROR: ZATCA generation process failed: Undefined variable $branchNumber {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3222): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined varia...', 'C:\\\\xampp\\\\htdocs...', 3222)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-19 18:46:21] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:46:22] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 18:46:22] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 18:46:22] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 18:46:22] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708","has_certificate":true,"branch_number":null} 
[2025-09-19 18:46:22] local.DEBUG: Applying default values to invoice data  
[2025-09-19 18:46:22] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"132","previous_invoice_hash":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ=","pricing_type":"inclusive"}} 
[2025-09-19 18:46:22] local.DEBUG: Default values applied {"result_data":{"uuid":"131e6e75-2817-46a7-98ea-43da244b2708","invoice_counter":"132","pih":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000132","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ=","pricing_type":"inclusive"}} 
[2025-09-19 18:46:22] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Running ZATCA validation  
[2025-09-19 18:46:22] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 18:46:22] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 18:46:22] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:46:22] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 18:46:22] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 18:46:22] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 18:46:22] local.INFO: Generating unsigned XML  
[2025-09-19 18:46:22] local.INFO: Starting unsigned XML generation {"invoice_number":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708"} 
[2025-09-19 18:46:22] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:46:22] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000132"} 
[2025-09-19 18:46:22] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:46:22] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:46:22] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:46:22] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:46:22] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:46:22] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:46:22] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:46:22] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:46:22] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:46:22] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:46:22] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Building additional document references  
[2025-09-19 18:46:22] local.DEBUG: Added ICV reference {"icv":"132"} 
[2025-09-19 18:46:22] local.DEBUG: Added PIH reference {"pih":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ="} 
[2025-09-19 18:46:22] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 18:46:22] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:46:22] local.DEBUG: Invoice object created successfully {"id":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:46:22] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000132-unsigned.xml","file_size":5194} 
[2025-09-19 18:46:22] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000132-unsigned.xml"} 
[2025-09-19 18:46:22] local.INFO: Signing XML  
[2025-09-19 18:46:22] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758293182.xml"} 
[2025-09-19 18:46:22] local.DEBUG: Calculating invoice hash  
[2025-09-19 18:46:22] local.DEBUG: Invoice hash calculated {"hash":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o="} 
[2025-09-19 18:46:22] local.INFO: Generating QR code  
[2025-09-19 18:46:22] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000132"} 
[2025-09-19 18:46:22] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"131e6e75-2817-46a7-98ea-43da244b2708","invoice_counter":"132","pih":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000132","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 18:46:22] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"001000132"} 
[2025-09-19 18:46:22] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 18:46:22] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 18:46:22] local.INFO: Starting unsigned XML generation {"invoice_number":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708"} 
[2025-09-19 18:46:22] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 18:46:22] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000132"} 
[2025-09-19 18:46:22] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 18:46:22] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 18:46:22] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 18:46:22] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 18:46:22] local.DEBUG: Supplier party built successfully  
[2025-09-19 18:46:22] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 18:46:22] local.DEBUG: Buyer party built successfully  
[2025-09-19 18:46:22] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 18:46:22] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 18:46:22] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 18:46:22] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 18:46:22] local.DEBUG: Building additional document references  
[2025-09-19 18:46:22] local.DEBUG: Added ICV reference {"icv":"132"} 
[2025-09-19 18:46:22] local.DEBUG: Added PIH reference {"pih":"irheULEePWau07jishWquq60wGouRQOGq9snhsw4XCQ="} 
[2025-09-19 18:46:22] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 18:46:22] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 18:46:22] local.DEBUG: Invoice object created successfully {"id":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 18:46:22] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000132-unsigned.xml","file_size":5356} 
[2025-09-19 18:46:22] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000132","uuid":"131e6e75-2817-46a7-98ea-43da244b2708","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000132-unsigned.xml"} 
[2025-09-19 18:46:22] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":132,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 19:04:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 19:04:07] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 19:04:07] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 19:04:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 19:04:07] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 19:04:07] local.DEBUG: Applying default values to invoice data  
[2025-09-19 19:04:07] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"133","previous_invoice_hash":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o=","pricing_type":"inclusive"}} 
[2025-09-19 19:04:07] local.DEBUG: Default values applied {"result_data":{"uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","invoice_counter":"133","pih":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000133","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o=","pricing_type":"inclusive"}} 
[2025-09-19 19:04:07] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Running ZATCA validation  
[2025-09-19 19:04:07] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 19:04:07] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 19:04:07] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 19:04:07] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 19:04:07] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 19:04:07] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 19:04:07] local.INFO: Generating unsigned XML  
[2025-09-19 19:04:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51"} 
[2025-09-19 19:04:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 19:04:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000133"} 
[2025-09-19 19:04:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 19:04:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 19:04:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 19:04:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 19:04:07] local.DEBUG: Supplier party built successfully  
[2025-09-19 19:04:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 19:04:07] local.DEBUG: Buyer party built successfully  
[2025-09-19 19:04:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 19:04:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 19:04:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 19:04:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Building additional document references  
[2025-09-19 19:04:07] local.DEBUG: Added ICV reference {"icv":"133"} 
[2025-09-19 19:04:07] local.DEBUG: Added PIH reference {"pih":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o="} 
[2025-09-19 19:04:07] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 19:04:07] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 19:04:07] local.DEBUG: Invoice object created successfully {"id":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 19:04:07] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000133-unsigned.xml","file_size":5194} 
[2025-09-19 19:04:07] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000133-unsigned.xml"} 
[2025-09-19 19:04:07] local.INFO: Signing XML  
[2025-09-19 19:04:07] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758294247.xml"} 
[2025-09-19 19:04:07] local.DEBUG: Calculating invoice hash  
[2025-09-19 19:04:07] local.DEBUG: Invoice hash calculated {"hash":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4="} 
[2025-09-19 19:04:07] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"133","invoice_hash":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4="} 
[2025-09-19 19:04:07] local.INFO: Generating QR code  
[2025-09-19 19:04:07] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000133"} 
[2025-09-19 19:04:07] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","invoice_counter":"133","pih":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000133","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 19:04:07] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"001000133"} 
[2025-09-19 19:04:07] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 19:04:07] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 19:04:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51"} 
[2025-09-19 19:04:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 19:04:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000133"} 
[2025-09-19 19:04:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 19:04:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 19:04:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 19:04:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 19:04:07] local.DEBUG: Supplier party built successfully  
[2025-09-19 19:04:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 19:04:07] local.DEBUG: Buyer party built successfully  
[2025-09-19 19:04:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 19:04:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 19:04:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 19:04:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 19:04:07] local.DEBUG: Building additional document references  
[2025-09-19 19:04:07] local.DEBUG: Added ICV reference {"icv":"133"} 
[2025-09-19 19:04:07] local.DEBUG: Added PIH reference {"pih":"m00AUVbNes5AL5uofHWkjwozDrGVrDtZM7ccq7Vrr8o="} 
[2025-09-19 19:04:07] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 19:04:07] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 19:04:07] local.DEBUG: Invoice object created successfully {"id":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 19:04:07] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000133-unsigned.xml","file_size":5356} 
[2025-09-19 19:04:07] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000133","uuid":"f3effb0b-3fa2-42a9-9195-f2301e37ba51","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000133-unsigned.xml"} 
[2025-09-19 19:04:07] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":133,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 19:28:00] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 19:28:00] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 19:28:00] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 19:28:00] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 19:28:00] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 19:28:00] local.DEBUG: Applying default values to invoice data  
[2025-09-19 19:28:00] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"134","previous_invoice_hash":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4=","pricing_type":"inclusive"}} 
[2025-09-19 19:28:00] local.DEBUG: Default values applied {"result_data":{"uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","invoice_counter":"134","pih":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000134","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4=","pricing_type":"inclusive"}} 
[2025-09-19 19:28:00] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Running ZATCA validation  
[2025-09-19 19:28:00] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 19:28:00] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 19:28:00] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 19:28:00] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 19:28:00] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 19:28:00] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 19:28:00] local.INFO: Generating unsigned XML  
[2025-09-19 19:28:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a"} 
[2025-09-19 19:28:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 19:28:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000134"} 
[2025-09-19 19:28:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 19:28:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 19:28:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 19:28:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 19:28:00] local.DEBUG: Supplier party built successfully  
[2025-09-19 19:28:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 19:28:00] local.DEBUG: Buyer party built successfully  
[2025-09-19 19:28:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 19:28:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 19:28:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 19:28:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Building additional document references  
[2025-09-19 19:28:00] local.DEBUG: Added ICV reference {"icv":"134"} 
[2025-09-19 19:28:00] local.DEBUG: Added PIH reference {"pih":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4="} 
[2025-09-19 19:28:00] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 19:28:00] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 19:28:00] local.DEBUG: Invoice object created successfully {"id":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 19:28:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000134-unsigned.xml","file_size":5194} 
[2025-09-19 19:28:00] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000134-unsigned.xml"} 
[2025-09-19 19:28:00] local.INFO: Signing XML  
[2025-09-19 19:28:00] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758295680.xml"} 
[2025-09-19 19:28:00] local.DEBUG: Calculating invoice hash  
[2025-09-19 19:28:00] local.DEBUG: Invoice hash calculated {"hash":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw="} 
[2025-09-19 19:28:00] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"134","invoice_hash":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw="} 
[2025-09-19 19:28:00] local.INFO: Generating QR code  
[2025-09-19 19:28:00] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000134"} 
[2025-09-19 19:28:00] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","invoice_counter":"134","pih":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000134","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 19:28:00] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"001000134"} 
[2025-09-19 19:28:00] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 19:28:00] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 19:28:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a"} 
[2025-09-19 19:28:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 19:28:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000134"} 
[2025-09-19 19:28:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 19:28:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 19:28:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 19:28:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 19:28:00] local.DEBUG: Supplier party built successfully  
[2025-09-19 19:28:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 19:28:00] local.DEBUG: Buyer party built successfully  
[2025-09-19 19:28:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 19:28:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 19:28:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 19:28:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 19:28:00] local.DEBUG: Building additional document references  
[2025-09-19 19:28:00] local.DEBUG: Added ICV reference {"icv":"134"} 
[2025-09-19 19:28:00] local.DEBUG: Added PIH reference {"pih":"UmhiKFBCa1omNnitFQTtwPiW/9XHW5Gdjbz6GeWeYC4="} 
[2025-09-19 19:28:00] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 19:28:00] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 19:28:00] local.DEBUG: Invoice object created successfully {"id":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 19:28:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000134-unsigned.xml","file_size":5356} 
[2025-09-19 19:28:00] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000134","uuid":"baeb0481-17c6-4bd7-b69f-e0620dd70b5a","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000134-unsigned.xml"} 
[2025-09-19 19:28:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":134,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:03:20] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:03:32] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:03:32] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:03:32] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:03:32] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:03:32] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:03:32] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:03:32] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"135","previous_invoice_hash":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw=","pricing_type":"inclusive"}} 
[2025-09-19 21:03:32] local.DEBUG: Default values applied {"result_data":{"uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","invoice_counter":"135","pih":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000135","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw=","pricing_type":"inclusive"}} 
[2025-09-19 21:03:32] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 21:03:32] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:03:32] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:03:32] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:03:32] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:03:32] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:03:32] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:03:32] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:03:32] local.INFO: Generating unsigned XML  
[2025-09-19 21:03:32] local.INFO: Starting unsigned XML generation {"invoice_number":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7"} 
[2025-09-19 21:03:32] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:03:32] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000135"} 
[2025-09-19 21:03:32] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:03:32] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:03:32] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:03:32] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:03:32] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:03:32] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:03:32] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:03:32] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:03:32] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:03:32] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:03:32] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:03:32] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:03:32] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:03:32] local.DEBUG: Building additional document references  
[2025-09-19 21:03:32] local.DEBUG: Added ICV reference {"icv":"135"} 
[2025-09-19 21:03:32] local.DEBUG: Added PIH reference {"pih":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw="} 
[2025-09-19 21:03:32] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"NULL"} 
[2025-09-19 21:03:32] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 21:03:32] local.DEBUG: Invoice object created successfully {"id":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:03:32] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000135-unsigned.xml","file_size":5194} 
[2025-09-19 21:03:32] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000135-unsigned.xml"} 
[2025-09-19 21:03:32] local.INFO: Signing XML  
[2025-09-19 21:03:33] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758301413.xml"} 
[2025-09-19 21:03:33] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:03:33] local.DEBUG: Invoice hash calculated {"hash":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y="} 
[2025-09-19 21:03:33] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"135","invoice_hash":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y="} 
[2025-09-19 21:03:33] local.INFO: Generating QR code  
[2025-09-19 21:03:33] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000135"} 
[2025-09-19 21:03:33] local.ERROR: Tecfinite library QR generation failed {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_data":{"uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","invoice_counter":"135","pih":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000135","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw=","pricing_type":"inclusive","line_items":[{"description":"Apple","quantity":1.0,"unit_price":15.0,"total":15.0,"vat_percent":5.0,"vat_amount":0.75,"unit_code":"PCE","vat_category_code":"S","id":"1"},{"description":"Orange","quantity":1.0,"unit_price":17.0,"total":17.0,"vat_percent":5.0,"vat_amount":0.85,"unit_code":"PCE","vat_category_code":"S","id":"2"},{"description":"Banana","quantity":1.0,"unit_price":13.0,"total":13.0,"vat_percent":5.0,"vat_amount":0.65,"unit_code":"PCE","vat_category_code":"S","id":"3"}]}} 
[2025-09-19 21:03:33] local.ERROR: QR generation failed completely {"error":"Undefined constant Endroid\\QrCode\\Encoding\\Encoding::UTF_8","invoice_number":"001000135"} 
[2025-09-19 21:03:33] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 21:03:33] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:03:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7"} 
[2025-09-19 21:03:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:03:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000135"} 
[2025-09-19 21:03:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:03:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:03:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:03:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:03:33] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:03:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:03:33] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:03:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:03:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:03:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:03:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:03:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:03:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:03:33] local.DEBUG: Building additional document references  
[2025-09-19 21:03:33] local.DEBUG: Added ICV reference {"icv":"135"} 
[2025-09-19 21:03:33] local.DEBUG: Added PIH reference {"pih":"qRyFUDH2WCW0UTC5+sZ5d68YUZMhqePjvmcSc0ISBqw="} 
[2025-09-19 21:03:33] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 21:03:33] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 21:03:33] local.DEBUG: Invoice object created successfully {"id":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:03:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000135-unsigned.xml","file_size":5356} 
[2025-09-19 21:03:33] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000135","uuid":"79216d21-15ce-4309-88fc-7dadbced0cf7","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000135-unsigned.xml"} 
[2025-09-19 21:03:33] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":135,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:20:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:20:30] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:20:30] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:20:30] local.ERROR: TLV generation for XML failed {"error":"preg_match(): Argument #2 ($subject) must be of type string, DateTimeImmutable given"} 
[2025-09-19 21:20:30] local.DEBUG: Generated TLV for XML embedding {"tlv_length":0,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:20:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:20:30] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:20:30] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:20:30] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"136","previous_invoice_hash":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y=","pricing_type":"inclusive","tlv_qr":""}} 
[2025-09-19 21:20:30] local.DEBUG: Default values applied {"result_data":{"uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","invoice_counter":"136","pih":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000136","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y=","pricing_type":"inclusive","tlv_qr":""}} 
[2025-09-19 21:20:30] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:20:30] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:20:30] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:20:30] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:20:30] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:20:30] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:20:30] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:20:30] local.INFO: Generating unsigned XML  
[2025-09-19 21:20:30] local.INFO: Starting unsigned XML generation {"invoice_number":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d"} 
[2025-09-19 21:20:30] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:20:30] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000136"} 
[2025-09-19 21:20:30] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:20:30] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:20:30] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:20:30] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:20:30] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:20:30] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:20:30] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:20:30] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:20:30] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:20:30] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:20:30] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Building additional document references  
[2025-09-19 21:20:30] local.DEBUG: Added ICV reference {"icv":"136"} 
[2025-09-19 21:20:30] local.DEBUG: Added PIH reference {"pih":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y="} 
[2025-09-19 21:20:30] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 21:20:30] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 21:20:30] local.DEBUG: Invoice object created successfully {"id":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:20:30] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000136-unsigned.xml","file_size":5194} 
[2025-09-19 21:20:30] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000136-unsigned.xml"} 
[2025-09-19 21:20:30] local.INFO: Signing XML  
[2025-09-19 21:20:30] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758302430.xml"} 
[2025-09-19 21:20:30] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:20:30] local.DEBUG: Invoice hash calculated {"hash":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50="} 
[2025-09-19 21:20:30] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"136","invoice_hash":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50="} 
[2025-09-19 21:20:30] local.INFO: Generating QR code  
[2025-09-19 21:20:30] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000136"} 
[2025-09-19 21:20:30] local.ERROR: Tecfinite library QR generation failed {"error":"Call to undefined method Endroid\\QrCode\\Color\\Color::fromRgb()","invoice_data":{"uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","invoice_counter":"136","pih":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000136","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y=","pricing_type":"inclusive","tlv_qr":""}} 
[2025-09-19 21:20:30] local.ERROR: QR generation failed completely {"error":"Call to undefined method Endroid\\QrCode\\Color\\Color::fromRgb()","invoice_number":"001000136"} 
[2025-09-19 21:20:30] local.DEBUG: QR code generated {"length":0} 
[2025-09-19 21:20:30] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:20:30] local.INFO: Starting unsigned XML generation {"invoice_number":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d"} 
[2025-09-19 21:20:30] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:20:30] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000136"} 
[2025-09-19 21:20:30] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:20:30] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:20:30] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:20:30] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:20:30] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:20:30] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:20:30] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:20:30] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:20:30] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:20:30] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:20:30] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:20:30] local.DEBUG: Building additional document references  
[2025-09-19 21:20:30] local.DEBUG: Added ICV reference {"icv":"136"} 
[2025-09-19 21:20:30] local.DEBUG: Added PIH reference {"pih":"ieHbggQEHcNCLgXsviPk3R75Dse/JY+HYzr7/qBCc/Y="} 
[2025-09-19 21:20:30] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 21:20:30] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 21:20:30] local.DEBUG: Invoice object created successfully {"id":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:20:30] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000136-unsigned.xml","file_size":5356} 
[2025-09-19 21:20:30] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000136","uuid":"181f26a5-17b4-40a5-bd2b-396646137e2d","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000136-unsigned.xml"} 
[2025-09-19 21:20:30] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":136,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:32:54] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:32:54] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:32:54] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:32:54] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:32:54] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:32:54] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:32:54] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:32:54] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"137","previous_invoice_hash":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 21:32:54] local.DEBUG: Default values applied {"result_data":{"uuid":"589764cd-67b4-4722-b883-f72266900ce8","invoice_counter":"137","pih":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000137","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 21:32:54] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:32:54] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:32:54] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:32:54] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:32:54] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:32:54] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:32:54] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:32:54] local.INFO: Generating unsigned XML  
[2025-09-19 21:32:54] local.INFO: Starting unsigned XML generation {"invoice_number":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8"} 
[2025-09-19 21:32:54] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:32:54] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000137"} 
[2025-09-19 21:32:54] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:32:54] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:32:54] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:32:54] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:32:54] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:32:54] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:32:54] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:32:54] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:32:54] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:32:54] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:32:54] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Building additional document references  
[2025-09-19 21:32:54] local.DEBUG: Added ICV reference {"icv":"137"} 
[2025-09-19 21:32:54] local.DEBUG: Added PIH reference {"pih":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50="} 
[2025-09-19 21:32:54] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 21:32:54] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:32:54] local.DEBUG: Invoice object created successfully {"id":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:32:54] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000137-unsigned.xml","file_size":5277} 
[2025-09-19 21:32:54] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000137-unsigned.xml"} 
[2025-09-19 21:32:54] local.INFO: Signing XML  
[2025-09-19 21:32:54] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758303174.xml"} 
[2025-09-19 21:32:54] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:32:54] local.DEBUG: Invoice hash calculated {"hash":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg="} 
[2025-09-19 21:32:54] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"137","invoice_hash":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg="} 
[2025-09-19 21:32:54] local.INFO: Generating QR code  
[2025-09-19 21:32:54] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000137"} 
[2025-09-19 21:32:54] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-19 21:32:54] local.DEBUG: QR code generated {"length":3452} 
[2025-09-19 21:32:54] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:32:54] local.INFO: Starting unsigned XML generation {"invoice_number":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8"} 
[2025-09-19 21:32:54] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:32:54] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000137"} 
[2025-09-19 21:32:54] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:32:54] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:32:54] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:32:54] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:32:54] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:32:54] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:32:54] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:32:54] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:32:54] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:32:54] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:32:54] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:32:54] local.DEBUG: Building additional document references  
[2025-09-19 21:32:54] local.DEBUG: Added ICV reference {"icv":"137"} 
[2025-09-19 21:32:54] local.DEBUG: Added PIH reference {"pih":"OPuq1812j+qVoV3RhjnLV8tWeG4qXJltiR4yYfBjZ50="} 
[2025-09-19 21:32:54] local.DEBUG: Added QR reference {"qr_length":3452} 
[2025-09-19 21:32:54] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:32:54] local.DEBUG: Invoice object created successfully {"id":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:32:54] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000137-unsigned.xml","file_size":5439} 
[2025-09-19 21:32:54] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000137","uuid":"589764cd-67b4-4722-b883-f72266900ce8","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000137-unsigned.xml"} 
[2025-09-19 21:32:54] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":137,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:35:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:35:49] local.DEBUG: Final line items before generation {"line_items_count":5,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:35:49] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:35:49] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:35:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:35:49] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:35:49] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:35:49] local.DEBUG: Applying default values {"current_data":{"id":"PLEX34IN","invoice_number":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-67838","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":77.0,"vat_amount":3.67,"currency":"SAR","transaction_type":"B2C","invoice_counter":"138","previous_invoice_hash":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 21:35:49] local.DEBUG: Default values applied {"result_data":{"uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0","invoice_counter":"138","pih":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":77.0,"amount_due":77.0,"id":"PLEX34IN","invoice_number":"001000138","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-67838","buyer_vat":"","buyer_city":"Dubai","vat_amount":3.67,"transaction_type":"B2C","previous_invoice_hash":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 21:35:49] local.DEBUG: Provided totals validation {"provided_total":77.0,"provided_vat":3.67} 
[2025-09-19 21:35:49] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:35:49] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:35:49] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:35:49] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:35:49] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:35:49] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:35:49] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:35:49] local.INFO: Generating unsigned XML  
[2025-09-19 21:35:49] local.INFO: Starting unsigned XML generation {"invoice_number":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0"} 
[2025-09-19 21:35:49] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:35:49] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000138"} 
[2025-09-19 21:35:49] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 21:35:49] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 21:35:49] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 21:35:49] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:35:49] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:35:49] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 21:35:49] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:35:49] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 21:35:49] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 21:35:49] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 21:35:49] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 21:35:49] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 21:35:49] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 21:35:49] local.DEBUG: Building additional document references  
[2025-09-19 21:35:49] local.DEBUG: Added ICV reference {"icv":"138"} 
[2025-09-19 21:35:49] local.DEBUG: Added PIH reference {"pih":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg="} 
[2025-09-19 21:35:49] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 21:35:49] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:35:49] local.DEBUG: Invoice object created successfully {"id":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:35:49] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000138-unsigned.xml","file_size":6497} 
[2025-09-19 21:35:49] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000138-unsigned.xml"} 
[2025-09-19 21:35:49] local.INFO: Signing XML  
[2025-09-19 21:35:49] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758303349.xml"} 
[2025-09-19 21:35:49] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:35:49] local.DEBUG: Invoice hash calculated {"hash":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A="} 
[2025-09-19 21:35:49] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"138","invoice_hash":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A="} 
[2025-09-19 21:35:49] local.INFO: Generating QR code  
[2025-09-19 21:35:49] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000138"} 
[2025-09-19 21:35:49] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-19 21:35:49] local.DEBUG: QR code generated {"length":3456} 
[2025-09-19 21:35:49] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:35:49] local.INFO: Starting unsigned XML generation {"invoice_number":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0"} 
[2025-09-19 21:35:49] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:35:49] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000138"} 
[2025-09-19 21:35:49] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 21:35:49] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 21:35:49] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 21:35:49] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:35:49] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:35:49] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 21:35:49] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:35:49] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 21:35:49] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 21:35:49] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 21:35:49] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 21:35:49] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 21:35:49] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 21:35:49] local.DEBUG: Building additional document references  
[2025-09-19 21:35:49] local.DEBUG: Added ICV reference {"icv":"138"} 
[2025-09-19 21:35:49] local.DEBUG: Added PIH reference {"pih":"ZVYyGgm3huLbxbGh8nluZqh6JTDTDg946JdFfjWGbcg="} 
[2025-09-19 21:35:49] local.DEBUG: Added QR reference {"qr_length":3456} 
[2025-09-19 21:35:49] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:35:49] local.DEBUG: Invoice object created successfully {"id":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:35:49] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000138-unsigned.xml","file_size":6659} 
[2025-09-19 21:35:49] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000138","uuid":"00645d16-fbbe-4813-9baa-a0aa98ed06f0","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000138-unsigned.xml"} 
[2025-09-19 21:35:49] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX34IN","invoice_counter_used":138,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:36:26] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:36:26] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:36:26] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:36:26] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:36:26] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:36:26] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:36:26] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:36:26] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"139","previous_invoice_hash":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 21:36:26] local.DEBUG: Default values applied {"result_data":{"uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1","invoice_counter":"139","pih":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000139","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 21:36:26] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:36:26] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:36:26] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:36:26] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:36:26] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:36:26] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:36:26] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:36:26] local.INFO: Generating unsigned XML  
[2025-09-19 21:36:26] local.INFO: Starting unsigned XML generation {"invoice_number":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1"} 
[2025-09-19 21:36:26] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:36:26] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000139"} 
[2025-09-19 21:36:26] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:36:26] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:36:26] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:36:26] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:36:26] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:36:26] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:36:26] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:36:26] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:36:26] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:36:26] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:36:26] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Building additional document references  
[2025-09-19 21:36:26] local.DEBUG: Added ICV reference {"icv":"139"} 
[2025-09-19 21:36:26] local.DEBUG: Added PIH reference {"pih":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A="} 
[2025-09-19 21:36:26] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 21:36:26] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:36:26] local.DEBUG: Invoice object created successfully {"id":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:36:26] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000139-unsigned.xml","file_size":5277} 
[2025-09-19 21:36:26] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000139-unsigned.xml"} 
[2025-09-19 21:36:26] local.INFO: Signing XML  
[2025-09-19 21:36:26] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758303386.xml"} 
[2025-09-19 21:36:26] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:36:26] local.DEBUG: Invoice hash calculated {"hash":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs="} 
[2025-09-19 21:36:26] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"139","invoice_hash":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs="} 
[2025-09-19 21:36:26] local.INFO: Generating QR code  
[2025-09-19 21:36:26] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000139"} 
[2025-09-19 21:36:26] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-19 21:36:26] local.DEBUG: QR code generated {"length":3452} 
[2025-09-19 21:36:26] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:36:26] local.INFO: Starting unsigned XML generation {"invoice_number":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1"} 
[2025-09-19 21:36:26] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:36:26] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000139"} 
[2025-09-19 21:36:26] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 21:36:26] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 21:36:26] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 21:36:26] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:36:26] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:36:26] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 21:36:26] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:36:26] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 21:36:26] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 21:36:26] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 21:36:26] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 21:36:26] local.DEBUG: Building additional document references  
[2025-09-19 21:36:26] local.DEBUG: Added ICV reference {"icv":"139"} 
[2025-09-19 21:36:26] local.DEBUG: Added PIH reference {"pih":"YUfh5MOFxJuI93afK1sPX3YTEiwCWyw5DN1adf5Yu+A="} 
[2025-09-19 21:36:26] local.DEBUG: Added QR reference {"qr_length":3452} 
[2025-09-19 21:36:26] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:36:26] local.DEBUG: Invoice object created successfully {"id":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:36:26] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000139-unsigned.xml","file_size":5439} 
[2025-09-19 21:36:26] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000139","uuid":"0065903e-4563-48d0-94b6-ac413f4f9cf1","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000139-unsigned.xml"} 
[2025-09-19 21:36:26] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":139,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:36:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:36:33] local.DEBUG: Final line items before generation {"line_items_count":5,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:36:33] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:36:33] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:36:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:36:33] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:36:33] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:36:33] local.DEBUG: Applying default values {"current_data":{"id":"PLEX34IN","invoice_number":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-67838","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":77.0,"vat_amount":3.67,"currency":"SAR","transaction_type":"B2C","invoice_counter":"140","previous_invoice_hash":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 21:36:33] local.DEBUG: Default values applied {"result_data":{"uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79","invoice_counter":"140","pih":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":77.0,"amount_due":77.0,"id":"PLEX34IN","invoice_number":"001000140","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-67838","buyer_vat":"","buyer_city":"Dubai","vat_amount":3.67,"transaction_type":"B2C","previous_invoice_hash":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 21:36:33] local.DEBUG: Provided totals validation {"provided_total":77.0,"provided_vat":3.67} 
[2025-09-19 21:36:33] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:36:33] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:36:33] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:36:33] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:36:33] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:36:33] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:36:33] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:36:33] local.INFO: Generating unsigned XML  
[2025-09-19 21:36:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79"} 
[2025-09-19 21:36:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:36:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000140"} 
[2025-09-19 21:36:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 21:36:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 21:36:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 21:36:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:36:33] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:36:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 21:36:33] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:36:33] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 21:36:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 21:36:33] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 21:36:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 21:36:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 21:36:33] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 21:36:33] local.DEBUG: Building additional document references  
[2025-09-19 21:36:33] local.DEBUG: Added ICV reference {"icv":"140"} 
[2025-09-19 21:36:33] local.DEBUG: Added PIH reference {"pih":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs="} 
[2025-09-19 21:36:33] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 21:36:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:36:33] local.DEBUG: Invoice object created successfully {"id":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:36:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000140-unsigned.xml","file_size":6497} 
[2025-09-19 21:36:33] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000140-unsigned.xml"} 
[2025-09-19 21:36:33] local.INFO: Signing XML  
[2025-09-19 21:36:34] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758303394.xml"} 
[2025-09-19 21:36:34] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:36:34] local.DEBUG: Invoice hash calculated {"hash":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y="} 
[2025-09-19 21:36:34] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"140","invoice_hash":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y="} 
[2025-09-19 21:36:34] local.INFO: Generating QR code  
[2025-09-19 21:36:34] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000140"} 
[2025-09-19 21:36:34] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-19 21:36:34] local.DEBUG: QR code generated {"length":3456} 
[2025-09-19 21:36:34] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:36:34] local.INFO: Starting unsigned XML generation {"invoice_number":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79"} 
[2025-09-19 21:36:34] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:36:34] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000140"} 
[2025-09-19 21:36:34] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 21:36:34] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 21:36:34] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 21:36:34] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:36:34] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:36:34] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 21:36:34] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:36:34] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 21:36:34] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 21:36:34] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 21:36:34] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 21:36:34] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 21:36:34] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 21:36:34] local.DEBUG: Building additional document references  
[2025-09-19 21:36:34] local.DEBUG: Added ICV reference {"icv":"140"} 
[2025-09-19 21:36:34] local.DEBUG: Added PIH reference {"pih":"+x13yAmoi9T5mtqQlZGe3xv2q2RGPdH/4clfZrInBTs="} 
[2025-09-19 21:36:34] local.DEBUG: Added QR reference {"qr_length":3456} 
[2025-09-19 21:36:34] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:36:34] local.DEBUG: Invoice object created successfully {"id":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:36:34] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000140-unsigned.xml","file_size":6659} 
[2025-09-19 21:36:34] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000140","uuid":"b5f05524-3eaa-4778-ace9-78243ca2af79","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000140-unsigned.xml"} 
[2025-09-19 21:36:34] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX34IN","invoice_counter_used":140,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 21:42:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:42:24] local.DEBUG: Final line items before generation {"line_items_count":5,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 21:42:24] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 21:42:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 21:42:24] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 21:42:24] local.DEBUG: Applying default values to invoice data  
[2025-09-19 21:42:24] local.DEBUG: Applying default values {"current_data":{"id":"PLEX34IN","invoice_number":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-67838","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":77.0,"vat_amount":3.67,"currency":"SAR","transaction_type":"B2C","invoice_counter":"141","previous_invoice_hash":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 21:42:24] local.DEBUG: Default values applied {"result_data":{"uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7","invoice_counter":"141","pih":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":77.0,"amount_due":77.0,"id":"PLEX34IN","invoice_number":"001000141","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-67838","buyer_vat":"","buyer_city":"Dubai","vat_amount":3.67,"transaction_type":"B2C","previous_invoice_hash":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 21:42:24] local.DEBUG: Provided totals validation {"provided_total":77.0,"provided_vat":3.67} 
[2025-09-19 21:42:24] local.DEBUG: Running ZATCA validation  
[2025-09-19 21:42:24] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 21:42:24] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 21:42:24] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:42:24] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 21:42:24] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 21:42:24] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 21:42:24] local.INFO: Generating unsigned XML  
[2025-09-19 21:42:24] local.INFO: Starting unsigned XML generation {"invoice_number":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7"} 
[2025-09-19 21:42:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:42:24] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000141"} 
[2025-09-19 21:42:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 21:42:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 21:42:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 21:42:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:42:24] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:42:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 21:42:24] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:42:24] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 21:42:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 21:42:24] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 21:42:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 21:42:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 21:42:24] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 21:42:24] local.DEBUG: Building additional document references  
[2025-09-19 21:42:24] local.DEBUG: Added ICV reference {"icv":"141"} 
[2025-09-19 21:42:24] local.DEBUG: Added PIH reference {"pih":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y="} 
[2025-09-19 21:42:24] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 21:42:24] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:42:24] local.DEBUG: Invoice object created successfully {"id":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:42:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000141-unsigned.xml","file_size":6497} 
[2025-09-19 21:42:24] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000141-unsigned.xml"} 
[2025-09-19 21:42:24] local.INFO: Signing XML  
[2025-09-19 21:42:24] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758303744.xml"} 
[2025-09-19 21:42:24] local.DEBUG: Calculating invoice hash  
[2025-09-19 21:42:24] local.DEBUG: Invoice hash calculated {"hash":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04="} 
[2025-09-19 21:42:24] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"141","invoice_hash":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04="} 
[2025-09-19 21:42:24] local.INFO: Generating QR code  
[2025-09-19 21:42:24] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000141"} 
[2025-09-19 21:42:24] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-19 21:42:24] local.DEBUG: QR code generated {"length":3456} 
[2025-09-19 21:42:24] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 21:42:24] local.INFO: Starting unsigned XML generation {"invoice_number":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7"} 
[2025-09-19 21:42:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 21:42:24] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000141"} 
[2025-09-19 21:42:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 21:42:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 21:42:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 21:42:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 21:42:24] local.DEBUG: Supplier party built successfully  
[2025-09-19 21:42:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 21:42:24] local.DEBUG: Buyer party built successfully  
[2025-09-19 21:42:24] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 21:42:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 21:42:24] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 21:42:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 21:42:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 21:42:24] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 21:42:24] local.DEBUG: Building additional document references  
[2025-09-19 21:42:24] local.DEBUG: Added ICV reference {"icv":"141"} 
[2025-09-19 21:42:24] local.DEBUG: Added PIH reference {"pih":"RMSxGPIvhTpBVE0mWMhZE1nPjsMEO23ih8remFKXr5Y="} 
[2025-09-19 21:42:24] local.DEBUG: Added QR reference {"qr_length":3456} 
[2025-09-19 21:42:24] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 21:42:24] local.DEBUG: Invoice object created successfully {"id":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 21:42:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000141-unsigned.xml","file_size":6659} 
[2025-09-19 21:42:24] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000141","uuid":"0c21119e-7512-4fcd-ae94-f296cc98a6f7","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000141-unsigned.xml"} 
[2025-09-19 21:42:24] local.ERROR: ZATCA generation process failed: TLV structure invalid after decoding {"transaction_id":"PLEX34IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX34IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-19 22:26:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 22:26:08] local.DEBUG: Final line items before generation {"line_items_count":5,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 22:26:08] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 22:26:08] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:26:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 22:26:08] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 22:26:08] local.DEBUG: Applying default values to invoice data  
[2025-09-19 22:26:08] local.DEBUG: Applying default values {"current_data":{"id":"PLEX34IN","invoice_number":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-67838","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":77.0,"vat_amount":3.67,"currency":"SAR","transaction_type":"B2C","invoice_counter":"142","previous_invoice_hash":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 22:26:08] local.DEBUG: Default values applied {"result_data":{"uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b","invoice_counter":"142","pih":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":77.0,"amount_due":77.0,"id":"PLEX34IN","invoice_number":"001000142","issue_datetime":"2025-09-11 17:38:38","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-67838","buyer_vat":"","buyer_city":"Dubai","vat_amount":3.67,"transaction_type":"B2C","previous_invoice_hash":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTc6Mzg6MzhaBAU3Ny4wMAUEMy42Nw=="}} 
[2025-09-19 22:26:08] local.DEBUG: Provided totals validation {"provided_total":77.0,"provided_vat":3.67} 
[2025-09-19 22:26:08] local.DEBUG: Running ZATCA validation  
[2025-09-19 22:26:08] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 22:26:08] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 22:26:08] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:26:08] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 22:26:08] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 22:26:08] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 22:26:08] local.INFO: Generating unsigned XML  
[2025-09-19 22:26:08] local.INFO: Starting unsigned XML generation {"invoice_number":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b"} 
[2025-09-19 22:26:08] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 22:26:08] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000142"} 
[2025-09-19 22:26:08] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 22:26:08] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 22:26:08] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 22:26:08] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:26:08] local.DEBUG: Supplier party built successfully  
[2025-09-19 22:26:08] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 22:26:08] local.DEBUG: Buyer party built successfully  
[2025-09-19 22:26:08] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 22:26:08] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 22:26:08] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 22:26:08] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 22:26:08] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 22:26:08] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 22:26:08] local.DEBUG: Building additional document references  
[2025-09-19 22:26:08] local.DEBUG: Added ICV reference {"icv":"142"} 
[2025-09-19 22:26:08] local.DEBUG: Added PIH reference {"pih":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04="} 
[2025-09-19 22:26:08] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 22:26:08] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 22:26:08] local.DEBUG: Invoice object created successfully {"id":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:26:08] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000142-unsigned.xml","file_size":6497} 
[2025-09-19 22:26:08] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000142-unsigned.xml"} 
[2025-09-19 22:26:08] local.INFO: Signing XML  
[2025-09-19 22:26:08] local.DEBUG: XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758306368.xml"} 
[2025-09-19 22:26:08] local.DEBUG: Calculating invoice hash  
[2025-09-19 22:26:08] local.DEBUG: Invoice hash calculated {"hash":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU="} 
[2025-09-19 22:26:08] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"142","invoice_hash":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU="} 
[2025-09-19 22:26:08] local.INFO: Generating QR code  
[2025-09-19 22:26:08] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":true,"invoice_number":"001000142"} 
[2025-09-19 22:26:08] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-19 22:26:08] local.DEBUG: QR code generated {"length":3456} 
[2025-09-19 22:26:08] local.INFO: Regenerating XML with QR code and hash  
[2025-09-19 22:26:08] local.INFO: Starting unsigned XML generation {"invoice_number":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b"} 
[2025-09-19 22:26:08] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 22:26:08] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000142"} 
[2025-09-19 22:26:08] local.DEBUG: Parsing datetime {"input":"2025-09-11 17:38:38"} 
[2025-09-19 22:26:08] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 17:38:38"} 
[2025-09-19 22:26:08] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"17:38:38Z"} 
[2025-09-19 22:26:08] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:26:08] local.DEBUG: Supplier party built successfully  
[2025-09-19 22:26:08] local.DEBUG: Building buyer party {"buyer_name":"CUST-67838"} 
[2025-09-19 22:26:08] local.DEBUG: Buyer party built successfully  
[2025-09-19 22:26:08] local.DEBUG: Building invoice lines {"line_items_count":5,"pricing_type":"inclusive"} 
[2025-09-19 22:26:08] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0,"vat_groups":{"S_5":{"taxable":73.34,"tax":3.6599999999999997,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":77.0,"controller_vat_amount":3.67} 
[2025-09-19 22:26:08] local.DEBUG: Invoice lines built {"line_count":5,"total_line_amount":73.34,"total_vat_amount":3.66,"grand_total":77.0} 
[2025-09-19 22:26:08] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":3.66} 
[2025-09-19 22:26:08] local.DEBUG: Tax total built with distribution fix {"calculated_total":3.66,"final_total":3.66,"subtotals_count":1} 
[2025-09-19 22:26:08] local.DEBUG: Monetary totals built {"grand_total":77.0,"line_amount":73.34,"amount_due":77.0,"vat_amount":3.66} 
[2025-09-19 22:26:08] local.DEBUG: Building additional document references  
[2025-09-19 22:26:08] local.DEBUG: Added ICV reference {"icv":"142"} 
[2025-09-19 22:26:08] local.DEBUG: Added PIH reference {"pih":"QMzGnPITRNrRN0f2CGJ7sfBLQUSWb55bgl/zxUZnw04="} 
[2025-09-19 22:26:08] local.DEBUG: Added QR reference {"qr_length":3456} 
[2025-09-19 22:26:08] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 22:26:08] local.DEBUG: Invoice object created successfully {"id":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:26:08] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000142-unsigned.xml","file_size":6659} 
[2025-09-19 22:26:08] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000142","uuid":"9f0f3f23-b3d7-4309-b83f-9b20c02b319b","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000142-unsigned.xml"} 
[2025-09-19 22:26:08] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX34IN","invoice_counter_used":142,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 22:33:00] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 22:33:00] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 22:33:00] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 22:33:00] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:33:00] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 22:33:00] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 22:33:00] local.DEBUG: Applying default values to invoice data  
[2025-09-19 22:33:00] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"143","previous_invoice_hash":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 22:33:00] local.DEBUG: Default values applied {"result_data":{"uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725","invoice_counter":"143","pih":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000143","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 22:33:00] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Running ZATCA validation  
[2025-09-19 22:33:00] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 22:33:00] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 22:33:00] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:33:00] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 22:33:00] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 22:33:00] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 22:33:00] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-19 22:33:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725"} 
[2025-09-19 22:33:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 22:33:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000143"} 
[2025-09-19 22:33:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 22:33:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 22:33:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 22:33:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:33:00] local.DEBUG: Supplier party built successfully  
[2025-09-19 22:33:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 22:33:00] local.DEBUG: Buyer party built successfully  
[2025-09-19 22:33:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 22:33:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 22:33:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 22:33:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Building additional document references  
[2025-09-19 22:33:00] local.DEBUG: Added ICV reference {"icv":"143"} 
[2025-09-19 22:33:00] local.DEBUG: Added PIH reference {"pih":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU="} 
[2025-09-19 22:33:00] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 22:33:00] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 22:33:00] local.DEBUG: Invoice object created successfully {"id":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:33:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000143-unsigned.xml","file_size":5277} 
[2025-09-19 22:33:00] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000143-unsigned.xml"} 
[2025-09-19 22:33:00] local.INFO: Signing initial XML  
[2025-09-19 22:33:00] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758306780.xml"} 
[2025-09-19 22:33:00] local.INFO: Generating QR code with cryptographic tags  
[2025-09-19 22:33:00] local.INFO: Generating QR code with cryptographic tags  
[2025-09-19 22:33:00] local.ERROR: ECDSA signature generation failed {"error":"Call to undefined method phpseclib3\\File\\X509::getSecret()"} 
[2025-09-19 22:33:00] local.ERROR: QR crypto generation failed {"error":"ECDSA signature generation failed: Call to undefined method phpseclib3\\File\\X509::getSecret()"} 
[2025-09-19 22:33:00] local.ERROR: QR generation with crypto tags failed {"error":"QR crypto generation failed: ECDSA signature generation failed: Call to undefined method phpseclib3\\File\\X509::getSecret()"} 
[2025-09-19 22:33:00] local.DEBUG: Falling back to empty base64 QR {"length":0} 
[2025-09-19 22:33:00] local.INFO: Generating final unsigned XML with QR code  
[2025-09-19 22:33:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725"} 
[2025-09-19 22:33:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 22:33:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000143"} 
[2025-09-19 22:33:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 22:33:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 22:33:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 22:33:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:33:00] local.DEBUG: Supplier party built successfully  
[2025-09-19 22:33:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 22:33:00] local.DEBUG: Buyer party built successfully  
[2025-09-19 22:33:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 22:33:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 22:33:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 22:33:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 22:33:00] local.DEBUG: Building additional document references  
[2025-09-19 22:33:00] local.DEBUG: Added ICV reference {"icv":"143"} 
[2025-09-19 22:33:00] local.DEBUG: Added PIH reference {"pih":"IosQKd5oHnAFKVqX42Tn0KdHvuNFUl2TL4aFoE71dMU="} 
[2025-09-19 22:33:00] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 22:33:00] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 22:33:00] local.DEBUG: Invoice object created successfully {"id":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:33:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000143-unsigned.xml","file_size":5194} 
[2025-09-19 22:33:00] local.INFO: Signing final XML with QR embedded  
[2025-09-19 22:33:00] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758306780.xml"} 
[2025-09-19 22:33:00] local.DEBUG: Calculating final invoice hash  
[2025-09-19 22:33:00] local.DEBUG: Final invoice hash calculated {"hash":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc="} 
[2025-09-19 22:33:00] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"143","invoice_hash":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc="} 
[2025-09-19 22:33:00] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000143","uuid":"983bbb95-f2a7-4d6c-9741-e09abc78f725","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758306780.xml"} 
[2025-09-19 22:33:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":143,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-19 22:37:55] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 22:37:55] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-19 22:37:55] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-19 22:37:55] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:37:55] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-19 22:37:55] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31","has_certificate":true,"branch_number":"0010"} 
[2025-09-19 22:37:55] local.DEBUG: Applying default values to invoice data  
[2025-09-19 22:37:55] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"144","previous_invoice_hash":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 22:37:55] local.DEBUG: Default values applied {"result_data":{"uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31","invoice_counter":"144","pih":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000144","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-19 22:37:55] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Running ZATCA validation  
[2025-09-19 22:37:55] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-19 22:37:55] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-19 22:37:55] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:37:55] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-19 22:37:55] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-19 22:37:55] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-19 22:37:55] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-19 22:37:55] local.INFO: Starting unsigned XML generation {"invoice_number":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31"} 
[2025-09-19 22:37:55] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 22:37:55] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000144"} 
[2025-09-19 22:37:55] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 22:37:55] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 22:37:55] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 22:37:55] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:37:55] local.DEBUG: Supplier party built successfully  
[2025-09-19 22:37:55] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 22:37:55] local.DEBUG: Buyer party built successfully  
[2025-09-19 22:37:55] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 22:37:55] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 22:37:55] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 22:37:55] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Building additional document references  
[2025-09-19 22:37:55] local.DEBUG: Added ICV reference {"icv":"144"} 
[2025-09-19 22:37:55] local.DEBUG: Added PIH reference {"pih":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc="} 
[2025-09-19 22:37:55] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-19 22:37:55] local.DEBUG: Additional document references built {"count":3} 
[2025-09-19 22:37:55] local.DEBUG: Invoice object created successfully {"id":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:37:55] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000144-unsigned.xml","file_size":5277} 
[2025-09-19 22:37:55] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000144-unsigned.xml"} 
[2025-09-19 22:37:55] local.INFO: Signing initial XML  
[2025-09-19 22:37:55] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758307075.xml"} 
[2025-09-19 22:37:55] local.INFO: Generating QR code with cryptographic tags  
[2025-09-19 22:37:55] local.INFO: Generating QR code with cryptographic tags  
[2025-09-19 22:37:55] local.ERROR: ECDSA signature generation failed {"error":"Unsupported certificate object type: Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-19 22:37:55] local.ERROR: QR crypto generation failed {"error":"ECDSA signature generation failed: Unsupported certificate object type: Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-19 22:37:55] local.ERROR: QR generation with crypto tags failed {"error":"QR crypto generation failed: ECDSA signature generation failed: Unsupported certificate object type: Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-19 22:37:55] local.DEBUG: Falling back to empty base64 QR {"length":0} 
[2025-09-19 22:37:55] local.INFO: Generating final unsigned XML with QR code  
[2025-09-19 22:37:55] local.INFO: Starting unsigned XML generation {"invoice_number":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31"} 
[2025-09-19 22:37:55] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-19 22:37:55] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000144"} 
[2025-09-19 22:37:55] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-19 22:37:55] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-19 22:37:55] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-19 22:37:55] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-19 22:37:55] local.DEBUG: Supplier party built successfully  
[2025-09-19 22:37:55] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-19 22:37:55] local.DEBUG: Buyer party built successfully  
[2025-09-19 22:37:55] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-19 22:37:55] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-19 22:37:55] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-19 22:37:55] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-19 22:37:55] local.DEBUG: Building additional document references  
[2025-09-19 22:37:55] local.DEBUG: Added ICV reference {"icv":"144"} 
[2025-09-19 22:37:55] local.DEBUG: Added PIH reference {"pih":"66JAqZ+7jbryjPqSdz2xP+Vq1pR3oqRbV6GWRubqfRc="} 
[2025-09-19 22:37:55] local.WARNING: QR reference skipped - invalid or missing TLV {"type":"string"} 
[2025-09-19 22:37:55] local.DEBUG: Additional document references built {"count":2} 
[2025-09-19 22:37:55] local.DEBUG: Invoice object created successfully {"id":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-19 22:37:55] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000144-unsigned.xml","file_size":5194} 
[2025-09-19 22:37:55] local.INFO: Signing final XML with QR embedded  
[2025-09-19 22:37:55] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758307075.xml"} 
[2025-09-19 22:37:55] local.DEBUG: Calculating final invoice hash  
[2025-09-19 22:37:55] local.DEBUG: Final invoice hash calculated {"hash":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8="} 
[2025-09-19 22:37:55] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"144","invoice_hash":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8="} 
[2025-09-19 22:37:55] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000144","uuid":"5b64f0d2-e403-4fdd-825c-f6535aa38b31","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758307075.xml"} 
[2025-09-19 22:37:55] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":144,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-20 05:12:20] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:12:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:12:39] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 05:12:39] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 05:12:42] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:12:42] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:12:42] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 05:12:42] local.DEBUG: Applying default values to invoice data  
[2025-09-20 05:12:42] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"145","previous_invoice_hash":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 05:12:42] local.DEBUG: Default values applied {"result_data":{"uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0","invoice_counter":"145","pih":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000145","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 05:12:42] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 05:12:42] local.DEBUG: Running ZATCA validation  
[2025-09-20 05:12:42] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 05:12:42] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 05:12:42] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:12:42] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 05:12:42] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 05:12:42] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 05:12:42] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 05:12:42] local.INFO: Starting unsigned XML generation {"invoice_number":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0"} 
[2025-09-20 05:12:42] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 05:12:42] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000145"} 
[2025-09-20 05:12:42] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 05:12:42] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 05:12:42] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 05:12:42] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:12:43] local.DEBUG: Supplier party built successfully  
[2025-09-20 05:12:43] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 05:12:43] local.DEBUG: Buyer party built successfully  
[2025-09-20 05:12:43] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 05:12:43] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 05:12:43] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 05:12:43] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 05:12:43] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 05:12:43] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 05:12:43] local.DEBUG: Building additional document references  
[2025-09-20 05:12:43] local.DEBUG: Added ICV reference {"icv":"145"} 
[2025-09-20 05:12:43] local.DEBUG: Added PIH reference {"pih":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8="} 
[2025-09-20 05:12:43] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 05:12:43] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 05:12:43] local.DEBUG: Invoice object created successfully {"id":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:12:43] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000145-unsigned.xml","file_size":5277} 
[2025-09-20 05:12:43] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000145-unsigned.xml"} 
[2025-09-20 05:12:43] local.INFO: Signing initial XML  
[2025-09-20 05:12:43] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758330763.xml"} 
[2025-09-20 05:12:43] local.INFO: Generating QR code with cryptographic tags  
[2025-09-20 05:12:43] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-20 05:12:43] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-20 05:12:45] local.DEBUG: QR code with crypto tags generated {"length":4504} 
[2025-09-20 05:12:45] local.INFO: Generating final unsigned XML with QR code  
[2025-09-20 05:12:45] local.INFO: Starting unsigned XML generation {"invoice_number":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0"} 
[2025-09-20 05:12:45] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 05:12:45] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000145"} 
[2025-09-20 05:12:45] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 05:12:45] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 05:12:45] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 05:12:45] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:12:45] local.DEBUG: Supplier party built successfully  
[2025-09-20 05:12:45] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 05:12:45] local.DEBUG: Buyer party built successfully  
[2025-09-20 05:12:45] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 05:12:45] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 05:12:45] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 05:12:45] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 05:12:45] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 05:12:45] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 05:12:45] local.DEBUG: Building additional document references  
[2025-09-20 05:12:45] local.DEBUG: Added ICV reference {"icv":"145"} 
[2025-09-20 05:12:45] local.DEBUG: Added PIH reference {"pih":"xwxLyU74xUafA+dbcPMKX25aacngrfxXRKAgF/ZOnt8="} 
[2025-09-20 05:12:45] local.DEBUG: Added QR reference {"qr_length":4504} 
[2025-09-20 05:12:45] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 05:12:45] local.DEBUG: Invoice object created successfully {"id":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:12:45] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000145-unsigned.xml","file_size":5277} 
[2025-09-20 05:12:45] local.INFO: Signing final XML with QR embedded  
[2025-09-20 05:12:45] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758330765.xml"} 
[2025-09-20 05:12:45] local.DEBUG: Calculating final invoice hash  
[2025-09-20 05:12:45] local.DEBUG: Final invoice hash calculated {"hash":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA="} 
[2025-09-20 05:12:45] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"145","invoice_hash":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA="} 
[2025-09-20 05:12:45] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000145","uuid":"4b41f873-5808-4c07-884a-b8d76bb807e0","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758330765.xml"} 
[2025-09-20 05:12:45] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":145,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-20 05:16:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:16:33] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 05:16:33] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 05:16:33] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:16:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:16:33] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 05:16:33] local.DEBUG: Applying default values to invoice data  
[2025-09-20 05:16:33] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"146","previous_invoice_hash":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 05:16:33] local.DEBUG: Default values applied {"result_data":{"uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2","invoice_counter":"146","pih":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000146","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 05:16:33] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Running ZATCA validation  
[2025-09-20 05:16:33] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 05:16:33] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 05:16:33] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:16:33] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 05:16:33] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 05:16:33] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 05:16:33] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 05:16:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2"} 
[2025-09-20 05:16:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 05:16:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000146"} 
[2025-09-20 05:16:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 05:16:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 05:16:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 05:16:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:16:33] local.DEBUG: Supplier party built successfully  
[2025-09-20 05:16:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 05:16:33] local.DEBUG: Buyer party built successfully  
[2025-09-20 05:16:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 05:16:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 05:16:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 05:16:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Building additional document references  
[2025-09-20 05:16:33] local.DEBUG: Added ICV reference {"icv":"146"} 
[2025-09-20 05:16:33] local.DEBUG: Added PIH reference {"pih":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA="} 
[2025-09-20 05:16:33] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 05:16:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 05:16:33] local.DEBUG: Invoice object created successfully {"id":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:16:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000146-unsigned.xml","file_size":5277} 
[2025-09-20 05:16:33] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000146-unsigned.xml"} 
[2025-09-20 05:16:33] local.INFO: Signing initial XML  
[2025-09-20 05:16:33] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758330993.xml"} 
[2025-09-20 05:16:33] local.INFO: Generating QR code with cryptographic tags  
[2025-09-20 05:16:33] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-20 05:16:33] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-20 05:16:33] local.DEBUG: QR code with crypto tags generated {"length":4548} 
[2025-09-20 05:16:33] local.INFO: Generating final unsigned XML with QR code  
[2025-09-20 05:16:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2"} 
[2025-09-20 05:16:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 05:16:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000146"} 
[2025-09-20 05:16:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 05:16:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 05:16:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 05:16:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:16:33] local.DEBUG: Supplier party built successfully  
[2025-09-20 05:16:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 05:16:33] local.DEBUG: Buyer party built successfully  
[2025-09-20 05:16:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 05:16:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 05:16:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 05:16:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 05:16:33] local.DEBUG: Building additional document references  
[2025-09-20 05:16:33] local.DEBUG: Added ICV reference {"icv":"146"} 
[2025-09-20 05:16:33] local.DEBUG: Added PIH reference {"pih":"7FLBh6MHM9aHxT9GCJTWx7JeMoBoVdZni5sE2F+T/TA="} 
[2025-09-20 05:16:33] local.DEBUG: Added QR reference {"qr_length":4548} 
[2025-09-20 05:16:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 05:16:33] local.DEBUG: Invoice object created successfully {"id":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:16:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000146-unsigned.xml","file_size":5277} 
[2025-09-20 05:16:33] local.INFO: Signing final XML with QR embedded  
[2025-09-20 05:16:33] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758330993.xml"} 
[2025-09-20 05:16:33] local.DEBUG: Calculating final invoice hash  
[2025-09-20 05:16:33] local.DEBUG: Final invoice hash calculated {"hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw="} 
[2025-09-20 05:16:33] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"146","invoice_hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw="} 
[2025-09-20 05:16:33] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000146","uuid":"bc3ff687-d10f-4710-b4c0-9aebe0e1baf2","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758330993.xml"} 
[2025-09-20 05:16:33] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":146,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-20 05:35:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:35:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 05:35:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 05:35:59] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:35:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 05:35:59] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 05:35:59] local.DEBUG: Applying default values to invoice data  
[2025-09-20 05:35:59] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"147","previous_invoice_hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 05:35:59] local.DEBUG: Default values applied {"result_data":{"uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","invoice_counter":"147","pih":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000147","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 05:35:59] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 05:35:59] local.DEBUG: Running ZATCA validation  
[2025-09-20 05:35:59] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 05:35:59] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 05:35:59] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:35:59] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 05:35:59] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 05:35:59] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 05:35:59] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 05:35:59] local.INFO: Starting unsigned XML generation {"invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499"} 
[2025-09-20 05:35:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 05:35:59] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000147"} 
[2025-09-20 05:35:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 05:35:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 05:35:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 05:35:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:35:59] local.DEBUG: Supplier party built successfully  
[2025-09-20 05:35:59] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 05:35:59] local.DEBUG: Buyer party built successfully  
[2025-09-20 05:35:59] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 05:35:59] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 05:35:59] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 05:35:59] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 05:35:59] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 05:35:59] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 05:35:59] local.DEBUG: Building additional document references  
[2025-09-20 05:36:00] local.DEBUG: Added ICV reference {"icv":"147"} 
[2025-09-20 05:36:00] local.DEBUG: Added PIH reference {"pih":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw="} 
[2025-09-20 05:36:00] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 05:36:00] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 05:36:00] local.DEBUG: Invoice object created successfully {"id":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:36:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000147-unsigned.xml","file_size":5277} 
[2025-09-20 05:36:00] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000147-unsigned.xml"} 
[2025-09-20 05:36:00] local.INFO: Signing initial XML  
[2025-09-20 05:36:00] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758332160.xml"} 
[2025-09-20 05:36:00] local.INFO: Generating QR code with cryptographic tags  
[2025-09-20 05:36:00] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-20 05:36:00] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"AJagM19npfhEa2Y/gwJWUn2s8YBWyD...[14 more bytes]","value_base64":"QUphZ00xOW5wZmhFYTJZL2d3SldVbjJzOFlCV3lEcWNMR0hncld1VktoST0="},{"tag":7,"length":96,"value_preview":"MEUCIQC49MapI6YXSQ5A6mxCnrvbRC...[66 more bytes]","value_base64":"TUVVQ0lRQzQ5TWFwSTZZWFNRNUE2bXhDbnJ2YlJDQjJZekFkY005ZXFpOXdFY2hWYVFJZ2ZPMGVBVE1NZ3NvSnNqNmZnTEVIZU5zaU14aE9veDBIalhCTjE0R3NnUTQ9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":40,"value_preview":"WkFUQ0FfQ0FfU0lHTkFUVVJFX1BMQU...[10 more bytes]","value_base64":"V2tGVVEwRmZRMEZmVTBsSFRrRlVWVkpGWDFCTVFVTkZTRTlNUkVWUw=="}]} 
[2025-09-20 05:36:00] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-20 05:36:00] local.DEBUG: QR code with crypto tags generated {"length":4556} 
[2025-09-20 05:36:00] local.INFO: Generating final unsigned XML with QR code  
[2025-09-20 05:36:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499"} 
[2025-09-20 05:36:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 05:36:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000147"} 
[2025-09-20 05:36:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 05:36:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 05:36:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 05:36:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 05:36:00] local.DEBUG: Supplier party built successfully  
[2025-09-20 05:36:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 05:36:00] local.DEBUG: Buyer party built successfully  
[2025-09-20 05:36:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 05:36:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 05:36:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 05:36:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 05:36:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 05:36:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 05:36:00] local.DEBUG: Building additional document references  
[2025-09-20 05:36:00] local.DEBUG: Added ICV reference {"icv":"147"} 
[2025-09-20 05:36:00] local.DEBUG: Added PIH reference {"pih":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw="} 
[2025-09-20 05:36:00] local.DEBUG: Added QR reference {"qr_length":4556} 
[2025-09-20 05:36:00] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 05:36:00] local.DEBUG: Invoice object created successfully {"id":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 05:36:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000147-unsigned.xml","file_size":5277} 
[2025-09-20 05:36:00] local.INFO: Signing final XML with QR embedded  
[2025-09-20 05:36:00] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758332160.xml"} 
[2025-09-20 05:36:00] local.DEBUG: Calculating final invoice hash  
[2025-09-20 05:36:00] local.DEBUG: Final invoice hash calculated {"hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 05:36:00] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"147","invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 05:36:00] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/PLEX33IN-signed-1758332160.xml"} 
[2025-09-20 05:36:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":147,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-20 07:07:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 07:07:08] local.INFO: Starting ZATCA invoice generation {"invoice_number":"unknown","uuid":"unknown","has_certificate":false,"branch_number":null} 
[2025-09-20 07:07:08] local.DEBUG: Applying default values to invoice data  
[2025-09-20 07:07:08] local.DEBUG: Applying default values {"current_data":{"id":"TEST-001","amount":100.0}} 
[2025-09-20 07:07:08] local.DEBUG: Default values applied {"result_data":{"uuid":"091e9466-8b73-46ac-9a42-3b7619d590c5","invoice_counter":"1","pih":"","supplier_building":"0000","supplier_postal":"00000","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"N/A","buyer_postal":"00000","total_amount":0,"amount_due":0,"id":"TEST-001","amount":100.0}} 
[2025-09-20 07:07:08] local.ERROR: Mandatory field validation failed {"errors":["Missing mandatory field: VAT registration number","Missing mandatory field: Supplier name","Missing mandatory field: Supplier street","Missing mandatory field: Supplier city","Missing mandatory field: Buyer name","Missing mandatory field: Invoice number","Missing mandatory field: Issue date/time","Missing mandatory field: Total amount"],"invoice_data":{"uuid":"091e9466-8b73-46ac-9a42-3b7619d590c5","invoice_counter":"1","pih":"","supplier_building":"0000","supplier_postal":"00000","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"N/A","buyer_postal":"00000","total_amount":0,"amount_due":0,"id":"TEST-001","amount":100.0}} 
[2025-09-20 07:07:08] local.INFO: Starting ZATCA invoice generation {"invoice_number":"unknown","uuid":"unknown","has_certificate":false,"branch_number":null} 
[2025-09-20 07:07:08] local.DEBUG: Applying default values to invoice data  
[2025-09-20 07:07:08] local.DEBUG: Applying default values {"current_data":{"id":"TEST-001","amount":100.0,"vat_amount":15.0,"seller_name":"Test Company","seller_vat_number":"1234567891"}} 
[2025-09-20 07:07:08] local.DEBUG: Default values applied {"result_data":{"uuid":"9501cf76-742e-4655-9879-ff201788a913","invoice_counter":"1","pih":"","supplier_building":"0000","supplier_postal":"00000","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"N/A","buyer_postal":"00000","total_amount":0,"amount_due":0,"id":"TEST-001","amount":100.0,"vat_amount":15.0,"seller_name":"Test Company","seller_vat_number":"1234567891"}} 
[2025-09-20 07:07:08] local.ERROR: Mandatory field validation failed {"errors":["Missing mandatory field: VAT registration number","Missing mandatory field: Supplier name","Missing mandatory field: Supplier street","Missing mandatory field: Supplier city","Missing mandatory field: Buyer name","Missing mandatory field: Invoice number","Missing mandatory field: Issue date/time","Missing mandatory field: Total amount"],"invoice_data":{"uuid":"9501cf76-742e-4655-9879-ff201788a913","invoice_counter":"1","pih":"","supplier_building":"0000","supplier_postal":"00000","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"N/A","buyer_postal":"00000","total_amount":0,"amount_due":0,"id":"TEST-001","amount":100.0,"vat_amount":15.0,"seller_name":"Test Company","seller_vat_number":"1234567891"}} 
[2025-09-20 07:32:13] local.DEBUG: Generating QR code {"has_signed_xml":true,"has_certificate":false,"invoice_number":"001000147"} 
[2025-09-20 07:32:14] local.DEBUG: QR generated from Tecfinite library successfully  
[2025-09-20 07:32:52] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 07:32:52] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","has_certificate":false,"branch_number":null} 
[2025-09-20 07:32:52] local.DEBUG: Applying default values to invoice data  
[2025-09-20 07:32:52] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000147","uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","invoice_counter":"147","previous_invoice_hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","tlv_qr":""}} 
[2025-09-20 07:32:52] local.DEBUG: Default values applied {"result_data":{"uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","invoice_counter":"147","pih":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","supplier_building":"0000","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000147","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_city":"Dubai","vat_amount":2.14,"previous_invoice_hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","tlv_qr":""}} 
[2025-09-20 07:32:52] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 07:32:52] local.DEBUG: Running ZATCA validation  
[2025-09-20 07:32:52] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 07:32:52] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 07:32:52] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 07:32:52] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 07:32:52] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 07:32:52] local.WARNING: ZATCA validation [{"errors":["BR-KSA-30: Invoice must have at least one line item."],"warnings":[],"info":[]}] 
[2025-09-20 07:32:52] local.ERROR: ZATCA validation failed {"errors":["BR-KSA-30: Invoice must have at least one line item."],"warnings":[],"invoice_data":{"uuid":"d99ede92-fa68-4f9e-8402-6e032781e499","invoice_counter":"147","pih":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","supplier_building":"0000","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000147","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_city":"Dubai","vat_amount":2.14,"previous_invoice_hash":"/0qkIQztXetRQMpOEyMQ3iFjQsxmxGehalXiVlESxYw=","tlv_qr":""}} 
[2025-09-20 07:42:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 07:43:04] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 07:43:04] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 07:43:04] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 07:43:04] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 07:43:04] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 07:43:04] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"e9091f24-596e-4f86-a865-9401ca66b1c5","has_certificate":false,"branch_number":null} 
[2025-09-20 07:43:04] local.DEBUG: Applying default values to invoice data  
[2025-09-20 07:43:04] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"e9091f24-596e-4f86-a865-9401ca66b1c5","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 07:43:04] local.DEBUG: Default values applied {"result_data":{"uuid":"e9091f24-596e-4f86-a865-9401ca66b1c5","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 07:43:04] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 07:43:04] local.DEBUG: Running ZATCA validation  
[2025-09-20 07:43:04] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 07:43:04] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 07:43:04] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 07:43:04] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 07:43:04] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 07:43:04] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 07:43:04] local.DEBUG: Loading certificate from config  
[2025-09-20 07:43:04] local.DEBUG: Certificate paths {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-09-20 07:43:04] local.DEBUG: Certificate loaded successfully  
[2025-09-20 07:43:04] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 07:43:04] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"e9091f24-596e-4f86-a865-9401ca66b1c5"} 
[2025-09-20 07:43:04] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 07:43:04] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000148"} 
[2025-09-20 07:43:04] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 07:43:04] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 07:43:04] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 07:43:04] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 07:43:04] local.DEBUG: Supplier party built successfully  
[2025-09-20 07:43:04] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 07:43:04] local.DEBUG: Buyer party built successfully  
[2025-09-20 07:43:04] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 07:43:04] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 07:43:04] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 07:43:04] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 07:43:04] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 07:43:04] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 07:43:04] local.DEBUG: Building additional document references  
[2025-09-20 07:43:04] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 07:43:04] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 07:43:04] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 07:43:04] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 07:43:04] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"e9091f24-596e-4f86-a865-9401ca66b1c5","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 07:43:04] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000148-unsigned.xml","file_size":5277} 
[2025-09-20 07:43:04] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/000000148-unsigned.xml"} 
[2025-09-20 07:43:04] local.INFO: Signing initial XML  
[2025-09-20 07:43:04] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 09:30:15] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 09:30:15] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 09:30:15] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 09:30:15] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 09:30:15] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 09:30:15] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"3de96163-5b13-41f5-98d9-6fd8256f2ff0","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 09:30:15] local.DEBUG: Applying default values to invoice data  
[2025-09-20 09:30:15] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"3de96163-5b13-41f5-98d9-6fd8256f2ff0","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 09:30:15] local.DEBUG: Default values applied {"result_data":{"uuid":"3de96163-5b13-41f5-98d9-6fd8256f2ff0","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 09:30:15] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 09:30:15] local.DEBUG: Running ZATCA validation  
[2025-09-20 09:30:15] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 09:30:15] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 09:30:15] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 09:30:15] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 09:30:15] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 09:30:15] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 09:30:15] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 09:30:15] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"3de96163-5b13-41f5-98d9-6fd8256f2ff0"} 
[2025-09-20 09:30:15] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 09:30:15] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 09:30:15] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 09:30:15] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 09:30:15] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 09:30:15] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 09:30:15] local.DEBUG: Supplier party built successfully  
[2025-09-20 09:30:15] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 09:30:15] local.DEBUG: Buyer party built successfully  
[2025-09-20 09:30:15] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 09:30:15] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 09:30:15] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 09:30:15] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 09:30:15] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 09:30:15] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 09:30:15] local.DEBUG: Building additional document references  
[2025-09-20 09:30:15] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 09:30:15] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 09:30:15] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 09:30:15] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 09:30:15] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"3de96163-5b13-41f5-98d9-6fd8256f2ff0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 09:30:15] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 09:30:15] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 09:30:15] local.INFO: Signing initial XML  
[2025-09-20 09:30:15] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 09:30:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 09:30:30] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 09:30:30] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 09:30:30] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 09:30:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 09:30:30] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"f7bef624-35af-413a-a60a-7e498c07bda3","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 09:30:30] local.DEBUG: Applying default values to invoice data  
[2025-09-20 09:30:30] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"f7bef624-35af-413a-a60a-7e498c07bda3","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 09:30:30] local.DEBUG: Default values applied {"result_data":{"uuid":"f7bef624-35af-413a-a60a-7e498c07bda3","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 09:30:30] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 09:30:30] local.DEBUG: Running ZATCA validation  
[2025-09-20 09:30:30] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 09:30:30] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 09:30:30] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 09:30:30] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 09:30:30] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 09:30:30] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 09:30:30] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 09:30:30] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"f7bef624-35af-413a-a60a-7e498c07bda3"} 
[2025-09-20 09:30:30] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 09:30:30] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 09:30:30] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 09:30:30] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 09:30:30] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 09:30:30] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 09:30:30] local.DEBUG: Supplier party built successfully  
[2025-09-20 09:30:30] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 09:30:30] local.DEBUG: Buyer party built successfully  
[2025-09-20 09:30:30] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 09:30:30] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 09:30:30] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 09:30:30] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 09:30:30] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 09:30:30] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 09:30:30] local.DEBUG: Building additional document references  
[2025-09-20 09:30:30] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 09:30:30] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 09:30:30] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 09:30:30] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 09:30:30] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"f7bef624-35af-413a-a60a-7e498c07bda3","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 09:30:30] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 09:30:30] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 09:30:30] local.INFO: Signing initial XML  
[2025-09-20 09:30:30] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 09:30:55] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 09:30:55] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 09:30:55] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 09:30:55] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 09:30:55] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 09:30:55] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"143becc3-cf22-4727-9894-97b959bdfda6","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 09:30:55] local.DEBUG: Applying default values to invoice data  
[2025-09-20 09:30:55] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"143becc3-cf22-4727-9894-97b959bdfda6","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 09:30:55] local.DEBUG: Default values applied {"result_data":{"uuid":"143becc3-cf22-4727-9894-97b959bdfda6","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 09:30:55] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 09:30:55] local.DEBUG: Running ZATCA validation  
[2025-09-20 09:30:55] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 09:30:55] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 09:30:55] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 09:30:55] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 09:30:55] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 09:30:55] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 09:30:55] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 09:30:55] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"143becc3-cf22-4727-9894-97b959bdfda6"} 
[2025-09-20 09:30:55] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 09:30:55] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 09:30:55] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 09:30:55] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 09:30:55] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 09:30:55] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 09:30:55] local.DEBUG: Supplier party built successfully  
[2025-09-20 09:30:55] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 09:30:55] local.DEBUG: Buyer party built successfully  
[2025-09-20 09:30:55] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 09:30:55] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 09:30:55] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 09:30:55] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 09:30:55] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 09:30:55] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 09:30:55] local.DEBUG: Building additional document references  
[2025-09-20 09:30:55] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 09:30:55] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 09:30:55] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 09:30:55] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 09:30:55] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"143becc3-cf22-4727-9894-97b959bdfda6","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 09:30:55] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 09:30:55] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 09:30:55] local.INFO: Signing initial XML  
[2025-09-20 09:30:55] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 14:59:13] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 14:59:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 14:59:33] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 14:59:33] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 14:59:33] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 14:59:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 14:59:33] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"2c02207f-41c6-4746-bf6c-524a6330b69d","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 14:59:33] local.DEBUG: Applying default values to invoice data  
[2025-09-20 14:59:33] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"2c02207f-41c6-4746-bf6c-524a6330b69d","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 14:59:33] local.DEBUG: Default values applied {"result_data":{"uuid":"2c02207f-41c6-4746-bf6c-524a6330b69d","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 14:59:33] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 14:59:33] local.DEBUG: Running ZATCA validation  
[2025-09-20 14:59:33] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 14:59:33] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 14:59:33] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 14:59:33] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 14:59:33] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 14:59:33] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 14:59:33] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 14:59:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"2c02207f-41c6-4746-bf6c-524a6330b69d"} 
[2025-09-20 14:59:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 14:59:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 14:59:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 14:59:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 14:59:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 14:59:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 14:59:33] local.DEBUG: Supplier party built successfully  
[2025-09-20 14:59:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 14:59:33] local.DEBUG: Buyer party built successfully  
[2025-09-20 14:59:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 14:59:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 14:59:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 14:59:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 14:59:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 14:59:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 14:59:33] local.DEBUG: Building additional document references  
[2025-09-20 14:59:33] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 14:59:33] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 14:59:33] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 14:59:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 14:59:33] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"2c02207f-41c6-4746-bf6c-524a6330b69d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 14:59:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 14:59:33] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 14:59:33] local.INFO: Signing initial XML  
[2025-09-20 14:59:33] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 15:00:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 15:00:08] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 15:00:08] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 15:00:08] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 15:00:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 15:00:08] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"7f0204a9-e864-401f-a66c-b8a36df21f39","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 15:00:08] local.DEBUG: Applying default values to invoice data  
[2025-09-20 15:00:08] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"7f0204a9-e864-401f-a66c-b8a36df21f39","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 15:00:08] local.DEBUG: Default values applied {"result_data":{"uuid":"7f0204a9-e864-401f-a66c-b8a36df21f39","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 15:00:08] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 15:00:08] local.DEBUG: Running ZATCA validation  
[2025-09-20 15:00:08] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 15:00:08] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 15:00:08] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 15:00:08] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 15:00:08] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 15:00:08] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 15:00:08] local.INFO: Generating unsigned XML  
[2025-09-20 15:00:08] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"7f0204a9-e864-401f-a66c-b8a36df21f39"} 
[2025-09-20 15:00:08] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 15:00:08] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 15:00:08] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 15:00:08] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 15:00:08] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 15:00:08] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 15:00:08] local.DEBUG: Supplier party built successfully  
[2025-09-20 15:00:08] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 15:00:08] local.DEBUG: Buyer party built successfully  
[2025-09-20 15:00:08] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 15:00:08] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 15:00:08] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 15:00:08] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 15:00:08] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 15:00:08] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 15:00:08] local.DEBUG: Building additional document references  
[2025-09-20 15:00:08] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 15:00:08] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 15:00:08] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 15:00:08] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 15:00:08] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"7f0204a9-e864-401f-a66c-b8a36df21f39","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 15:00:08] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 15:00:08] local.DEBUG: Unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 15:00:08] local.INFO: Signing XML  
[2025-09-20 15:00:08] local.ERROR: Signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 15:00:29] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 15:00:29] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 15:00:29] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 15:00:29] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 15:00:29] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 15:00:29] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"0a6d313a-4c1a-4b46-9051-3fe2a983a07b","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 15:00:29] local.DEBUG: Applying default values to invoice data  
[2025-09-20 15:00:29] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"0a6d313a-4c1a-4b46-9051-3fe2a983a07b","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 15:00:29] local.DEBUG: Default values applied {"result_data":{"uuid":"0a6d313a-4c1a-4b46-9051-3fe2a983a07b","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 15:00:29] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 15:00:29] local.DEBUG: Running ZATCA validation  
[2025-09-20 15:00:29] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 15:00:29] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 15:00:29] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 15:00:29] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 15:00:29] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 15:00:29] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 15:00:29] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 15:00:29] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"0a6d313a-4c1a-4b46-9051-3fe2a983a07b"} 
[2025-09-20 15:00:29] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 15:00:29] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 15:00:29] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 15:00:29] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 15:00:29] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 15:00:29] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 15:00:29] local.DEBUG: Supplier party built successfully  
[2025-09-20 15:00:29] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 15:00:29] local.DEBUG: Buyer party built successfully  
[2025-09-20 15:00:29] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 15:00:29] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 15:00:29] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 15:00:29] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 15:00:29] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 15:00:29] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 15:00:29] local.DEBUG: Building additional document references  
[2025-09-20 15:00:29] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 15:00:29] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 15:00:29] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 15:00:29] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 15:00:29] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"0a6d313a-4c1a-4b46-9051-3fe2a983a07b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 15:00:29] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 15:00:29] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 15:00:29] local.INFO: Signing initial XML  
[2025-09-20 15:00:29] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 16:52:13] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 16:52:17] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 16:52:17] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 16:52:22] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 16:52:22] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 16:52:22] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"b6d501f6-022d-481f-bb15-a33d18a29882","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 16:52:22] local.DEBUG: Applying default values to invoice data  
[2025-09-20 16:52:22] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"b6d501f6-022d-481f-bb15-a33d18a29882","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 16:52:22] local.DEBUG: Default values applied {"result_data":{"uuid":"b6d501f6-022d-481f-bb15-a33d18a29882","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 16:52:22] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 16:52:22] local.DEBUG: Running ZATCA validation  
[2025-09-20 16:52:22] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 16:52:22] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 16:52:22] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 16:52:22] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 16:52:22] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 16:52:22] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 16:52:22] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 16:52:22] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"b6d501f6-022d-481f-bb15-a33d18a29882"} 
[2025-09-20 16:52:22] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 16:52:22] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 16:52:22] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 16:52:22] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 16:52:22] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 16:52:22] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 16:52:22] local.DEBUG: Supplier party built successfully  
[2025-09-20 16:52:22] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 16:52:22] local.DEBUG: Buyer party built successfully  
[2025-09-20 16:52:22] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 16:52:22] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 16:52:22] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 16:52:22] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 16:52:22] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 16:52:22] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 16:52:22] local.DEBUG: Building additional document references  
[2025-09-20 16:52:22] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 16:52:22] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 16:52:22] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 16:52:22] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 16:52:22] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"b6d501f6-022d-481f-bb15-a33d18a29882","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 16:52:23] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 16:52:23] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 16:52:23] local.INFO: Signing initial XML  
[2025-09-20 16:52:23] local.ERROR: Initial signing failed {"error":"Undefined variable $certificate"} 
[2025-09-20 18:14:04] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:15:42] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:15:42] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 18:15:42] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 18:15:42] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:15:42] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:15:42] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"2c50085d-7549-476e-b620-6476975afe51","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 18:15:42] local.DEBUG: Applying default values to invoice data  
[2025-09-20 18:15:42] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"2c50085d-7549-476e-b620-6476975afe51","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:15:42] local.DEBUG: Default values applied {"result_data":{"uuid":"2c50085d-7549-476e-b620-6476975afe51","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:15:42] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 18:15:42] local.DEBUG: Running ZATCA validation  
[2025-09-20 18:15:42] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 18:15:42] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 18:15:42] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:15:42] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 18:15:42] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 18:15:42] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 18:15:42] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 18:15:42] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"2c50085d-7549-476e-b620-6476975afe51"} 
[2025-09-20 18:15:42] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 18:15:42] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 18:15:42] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 18:15:42] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 18:15:42] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 18:15:42] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:15:42] local.DEBUG: Supplier party built successfully  
[2025-09-20 18:15:42] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 18:15:42] local.DEBUG: Buyer party built successfully  
[2025-09-20 18:15:42] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 18:15:42] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 18:15:42] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 18:15:42] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 18:15:42] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 18:15:42] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 18:15:42] local.DEBUG: Building additional document references  
[2025-09-20 18:15:42] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 18:15:42] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 18:15:42] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 18:15:42] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 18:15:42] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"2c50085d-7549-476e-b620-6476975afe51","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:15:42] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 18:15:42] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 18:15:42] local.INFO: Signing initial XML  
[2025-09-20 18:15:42] local.ERROR: Initial signing failed {"error":"Both direct signing and certificate loading failed: Private key content does not contain valid PEM format header | Certificate: Private key content does not contain valid PEM format header"} 
[2025-09-20 18:25:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:25:34] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 18:25:34] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 18:25:34] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:25:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:25:34] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 18:25:34] local.DEBUG: Applying default values to invoice data  
[2025-09-20 18:25:34] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"148","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:25:34] local.DEBUG: Default values applied {"result_data":{"uuid":"9a7a1e33-1108-4936-be57-e42a268a721e","invoice_counter":"148","pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000148","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:25:34] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 18:25:34] local.DEBUG: Running ZATCA validation  
[2025-09-20 18:25:34] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 18:25:34] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 18:25:34] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:25:34] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 18:25:34] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 18:25:34] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 18:25:34] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 18:25:34] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e"} 
[2025-09-20 18:25:34] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 18:25:34] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 18:25:34] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 18:25:34] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 18:25:34] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 18:25:34] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:25:34] local.DEBUG: Supplier party built successfully  
[2025-09-20 18:25:34] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 18:25:34] local.DEBUG: Buyer party built successfully  
[2025-09-20 18:25:34] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 18:25:34] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 18:25:34] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 18:25:34] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 18:25:34] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 18:25:34] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 18:25:34] local.DEBUG: Building additional document references  
[2025-09-20 18:25:34] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 18:25:34] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 18:25:34] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 18:25:34] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 18:25:34] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:25:34] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 18:25:34] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml"} 
[2025-09-20 18:25:34] local.INFO: Signing initial XML  
[2025-09-20 18:25:34] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-signed-1758378334.xml"} 
[2025-09-20 18:25:34] local.INFO: Generating QR code with cryptographic tags  
[2025-09-20 18:25:34] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-20 18:25:34] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"GKStgH2Z2NHv245PrxLk2IzskAHTaA...[14 more bytes]","value_base64":"R0tTdGdIMloyTkh2MjQ1UHJ4TGsySXpza0FIVGFBYlpnVE9Xb2s0NS96ST0="},{"tag":7,"length":96,"value_preview":"MEQCIGhpnl1Sf40LR806lekUcIw5Db...[66 more bytes]","value_base64":"TUVRQ0lHaHBubDFTZjQwTFI4MDZsZWtVY0l3NURiWXFwUituSThNbW9aQnNCREo3QWlCYk1xb2kzRTZXbHlXSjJZUnJmR2RjYlhTREtldUNZb0RoOEhMZ09hbTVwdz09"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":40,"value_preview":"WkFUQ0FfQ0FfU0lHTkFUVVJFX1BMQU...[10 more bytes]","value_base64":"V2tGVVEwRmZRMEZmVTBsSFRrRlVWVkpGWDFCTVFVTkZTRTlNUkVWUw=="}]} 
[2025-09-20 18:25:34] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-20 18:25:36] local.DEBUG: QR code with crypto tags generated {"length":4468} 
[2025-09-20 18:25:36] local.INFO: Generating final unsigned XML with QR code  
[2025-09-20 18:25:36] local.INFO: Starting unsigned XML generation {"invoice_number":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e"} 
[2025-09-20 18:25:36] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 18:25:36] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000148"} 
[2025-09-20 18:25:36] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 18:25:36] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 18:25:36] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 18:25:36] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:25:36] local.DEBUG: Supplier party built successfully  
[2025-09-20 18:25:36] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 18:25:36] local.DEBUG: Buyer party built successfully  
[2025-09-20 18:25:36] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 18:25:36] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 18:25:36] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 18:25:36] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 18:25:36] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 18:25:36] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 18:25:36] local.DEBUG: Building additional document references  
[2025-09-20 18:25:36] local.DEBUG: Added ICV reference {"icv":"148"} 
[2025-09-20 18:25:36] local.DEBUG: Added PIH reference {"pih":"QPmv3sxjsAq76u9JLW3Wgjl4K4iDRYTws5kzqf5BcPE="} 
[2025-09-20 18:25:36] local.DEBUG: Added QR reference {"qr_length":4468} 
[2025-09-20 18:25:36] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 18:25:36] local.DEBUG: Invoice object created successfully {"id":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:25:36] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-unsigned.xml","file_size":5277} 
[2025-09-20 18:25:36] local.INFO: Signing final XML with QR embedded  
[2025-09-20 18:25:36] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-signed-1758378336.xml"} 
[2025-09-20 18:25:36] local.DEBUG: Calculating final invoice hash  
[2025-09-20 18:25:36] local.DEBUG: Final invoice hash calculated {"hash":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM="} 
[2025-09-20 18:25:36] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"148","invoice_hash":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM="} 
[2025-09-20 18:25:36] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000148","uuid":"9a7a1e33-1108-4936-be57-e42a268a721e","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000148-signed-1758378336.xml"} 
[2025-09-20 18:25:36] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":148,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-20 18:53:57] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:53:57] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 18:53:57] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 18:53:57] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:53:57] local.ERROR: ZATCA generation process failed: Call to protected method App\Services\Zatca\InvoiceXmlGenerator::generateUnsignedXml() from scope App\Http\Controllers\PDFController {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-20 18:55:35] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:55:35] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 18:55:35] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 18:55:35] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:55:35] local.INFO: Starting unsigned XML generation {"invoice_number":"001000149","uuid":"9b7e3d9f-6090-4dc3-9a8f-ce5ef3ea204a"} 
[2025-09-20 18:55:35] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 18:55:35] local.DEBUG: Invoice identification {"branch_part":"0000","invoice_number":"000000149"} 
[2025-09-20 18:55:35] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 18:55:35] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 18:55:35] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 18:55:35] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:55:35] local.DEBUG: Supplier party built successfully  
[2025-09-20 18:55:35] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 18:55:35] local.DEBUG: Buyer party built successfully  
[2025-09-20 18:55:35] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 18:55:35] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 18:55:35] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 18:55:35] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 18:55:35] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 18:55:35] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 18:55:35] local.DEBUG: Building additional document references  
[2025-09-20 18:55:35] local.DEBUG: Added ICV reference {"icv":"149"} 
[2025-09-20 18:55:35] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 18:55:35] local.DEBUG: Additional document references built {"count":2} 
[2025-09-20 18:55:35] local.ERROR: XML generation failed {"error":"Undefined array key \"invoice_type_code\"","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(549): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined array...', 'C:\\\\xampp\\\\htdocs...', 549)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3223): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000149","uuid":"9b7e3d9f-6090-4dc3-9a8f-ce5ef3ea204a","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"149","previous_invoice_hash":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:55:35] local.ERROR: ZATCA generation process failed: Call to undefined method App\Services\Zatca\InvoiceXmlGenerator::sign() {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-20 18:55:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:55:47] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 18:55:47] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 18:55:48] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:55:48] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 18:55:48] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 18:55:48] local.DEBUG: Applying default values to invoice data  
[2025-09-20 18:55:48] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"149","previous_invoice_hash":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:55:48] local.DEBUG: Default values applied {"result_data":{"uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752","invoice_counter":"149","pih":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000149","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 18:55:48] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Running ZATCA validation  
[2025-09-20 18:55:48] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 18:55:48] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 18:55:48] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:55:48] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 18:55:48] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 18:55:48] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 18:55:48] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 18:55:48] local.INFO: Starting unsigned XML generation {"invoice_number":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752"} 
[2025-09-20 18:55:48] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 18:55:48] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000149"} 
[2025-09-20 18:55:48] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 18:55:48] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 18:55:48] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 18:55:48] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:55:48] local.DEBUG: Supplier party built successfully  
[2025-09-20 18:55:48] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 18:55:48] local.DEBUG: Buyer party built successfully  
[2025-09-20 18:55:48] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 18:55:48] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 18:55:48] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 18:55:48] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Building additional document references  
[2025-09-20 18:55:48] local.DEBUG: Added ICV reference {"icv":"149"} 
[2025-09-20 18:55:48] local.DEBUG: Added PIH reference {"pih":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM="} 
[2025-09-20 18:55:48] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 18:55:48] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 18:55:48] local.DEBUG: Invoice object created successfully {"id":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:55:48] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000149-unsigned.xml","file_size":5277} 
[2025-09-20 18:55:48] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000149-unsigned.xml"} 
[2025-09-20 18:55:48] local.INFO: Signing initial XML  
[2025-09-20 18:55:48] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000149-signed-1758380148.xml"} 
[2025-09-20 18:55:48] local.INFO: Generating QR code with cryptographic tags  
[2025-09-20 18:55:48] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-20 18:55:48] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"l0tQl5kX+UsD4Kv2U+/iBPqzq+Z//Z...[14 more bytes]","value_base64":"bDB0UWw1a1grVXNENEt2MlUrL2lCUHF6cStaLy9ab0ZLMW9pbmNSUW9LND0="},{"tag":7,"length":96,"value_preview":"MEUCIGwN4VvzcxIv0QN2b7FLwtb+Cy...[66 more bytes]","value_base64":"TUVVQ0lHd040VnZ6Y3hJdjBRTjJiN0ZMd3RiK0N5S3krQnRCbjJOSHJta1cvdXZWQWlFQTlZVTdyRGpBbWVXbkhlaks4ZGJCN3p0Y0tBQnp3WEpGcW1JNFUrMkphOFE9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":40,"value_preview":"WkFUQ0FfQ0FfU0lHTkFUVVJFX1BMQU...[10 more bytes]","value_base64":"V2tGVVEwRmZRMEZmVTBsSFRrRlVWVkpGWDFCTVFVTkZTRTlNUkVWUw=="}]} 
[2025-09-20 18:55:48] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-20 18:55:48] local.DEBUG: QR code with crypto tags generated {"length":4520} 
[2025-09-20 18:55:48] local.INFO: Generating final unsigned XML with QR code  
[2025-09-20 18:55:48] local.INFO: Starting unsigned XML generation {"invoice_number":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752"} 
[2025-09-20 18:55:48] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 18:55:48] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000149"} 
[2025-09-20 18:55:48] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 18:55:48] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 18:55:48] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 18:55:48] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 18:55:48] local.DEBUG: Supplier party built successfully  
[2025-09-20 18:55:48] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 18:55:48] local.DEBUG: Buyer party built successfully  
[2025-09-20 18:55:48] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 18:55:48] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 18:55:48] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 18:55:48] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 18:55:48] local.DEBUG: Building additional document references  
[2025-09-20 18:55:48] local.DEBUG: Added ICV reference {"icv":"149"} 
[2025-09-20 18:55:48] local.DEBUG: Added PIH reference {"pih":"93Ifwzvhbae8RSFM7UF0wudEZGIaJ273gwu3WscS5FM="} 
[2025-09-20 18:55:48] local.DEBUG: Added QR reference {"qr_length":4520} 
[2025-09-20 18:55:48] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 18:55:48] local.DEBUG: Invoice object created successfully {"id":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 18:55:48] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000149-unsigned.xml","file_size":5277} 
[2025-09-20 18:55:48] local.INFO: Signing final XML with QR embedded  
[2025-09-20 18:55:48] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000149-signed-1758380148.xml"} 
[2025-09-20 18:55:48] local.DEBUG: Calculating final invoice hash  
[2025-09-20 18:55:48] local.DEBUG: Final invoice hash calculated {"hash":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4="} 
[2025-09-20 18:55:48] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"149","invoice_hash":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4="} 
[2025-09-20 18:55:48] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000149","uuid":"e3ef1757-fe9d-49df-a79b-86c1a4ac8752","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000149-signed-1758380148.xml"} 
[2025-09-20 18:55:48] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":149,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-20 19:06:58] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 19:07:01] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 19:07:01] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 19:07:06] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 19:07:06] local.INFO: Starting unsigned XML generation {"invoice_number":"001000150","uuid":"2540ead8-a7c6-4017-b512-c76b62739ee6"} 
[2025-09-20 19:07:06] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 19:07:06] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000150"} 
[2025-09-20 19:07:06] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 19:07:06] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 19:07:06] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 19:07:06] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 19:07:06] local.DEBUG: Supplier party built successfully  
[2025-09-20 19:07:06] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 19:07:06] local.DEBUG: Buyer party built successfully  
[2025-09-20 19:07:06] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 19:07:06] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 19:07:06] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 19:07:06] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 19:07:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 19:07:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 19:07:07] local.DEBUG: Building additional document references  
[2025-09-20 19:07:07] local.DEBUG: Added ICV reference {"icv":"150"} 
[2025-09-20 19:07:07] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 19:07:07] local.DEBUG: Additional document references built {"count":2} 
[2025-09-20 19:07:07] local.ERROR: XML generation failed {"error":"Undefined array key \"invoice_type_code\"","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(551): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined array...', 'C:\\\\xampp\\\\htdocs...', 551)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3223): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000150","uuid":"2540ead8-a7c6-4017-b512-c76b62739ee6","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"150","previous_invoice_hash":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 19:07:07] local.ERROR: ZATCA generation process failed: Failed to generate unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-20 19:07:26] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 19:07:27] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-20 19:07:27] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-20 19:07:27] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 19:07:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-20 19:07:27] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f","has_certificate":true,"branch_number":"0010"} 
[2025-09-20 19:07:27] local.DEBUG: Applying default values to invoice data  
[2025-09-20 19:07:27] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"150","previous_invoice_hash":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 19:07:27] local.DEBUG: Default values applied {"result_data":{"uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f","invoice_counter":"150","pih":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000150","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-20 19:07:27] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-20 19:07:27] local.DEBUG: Running ZATCA validation  
[2025-09-20 19:07:27] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-20 19:07:27] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-20 19:07:27] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 19:07:27] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-20 19:07:27] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-20 19:07:27] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-20 19:07:27] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-20 19:07:27] local.INFO: Starting unsigned XML generation {"invoice_number":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f"} 
[2025-09-20 19:07:27] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 19:07:27] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000150"} 
[2025-09-20 19:07:27] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 19:07:27] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 19:07:27] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 19:07:27] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 19:07:27] local.DEBUG: Supplier party built successfully  
[2025-09-20 19:07:27] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 19:07:27] local.DEBUG: Buyer party built successfully  
[2025-09-20 19:07:27] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 19:07:27] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 19:07:27] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 19:07:27] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 19:07:27] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 19:07:27] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 19:07:27] local.DEBUG: Building additional document references  
[2025-09-20 19:07:27] local.DEBUG: Added ICV reference {"icv":"150"} 
[2025-09-20 19:07:27] local.DEBUG: Added PIH reference {"pih":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4="} 
[2025-09-20 19:07:27] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-20 19:07:27] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 19:07:27] local.DEBUG: Invoice object created successfully {"id":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 19:07:27] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000150-unsigned.xml","file_size":5277} 
[2025-09-20 19:07:27] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000150-unsigned.xml"} 
[2025-09-20 19:07:27] local.INFO: Signing initial XML  
[2025-09-20 19:07:27] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000150-signed-1758380847.xml"} 
[2025-09-20 19:07:27] local.INFO: Generating QR code with cryptographic tags  
[2025-09-20 19:07:27] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-20 19:07:27] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"NFOIpV5ckqlZdT/8HM/GXAFHfACQuC...[14 more bytes]","value_base64":"TkZPSXBWNWNrcWxaZFQvOEhNL0dYQUZIZkFDUXVDK0YyWEgwOTVwZmwxWT0="},{"tag":7,"length":96,"value_preview":"MEUCIQCSriC/lWrNk5gKSD9/e+XwZ4...[66 more bytes]","value_base64":"TUVVQ0lRQ1NyaUMvbFdyTms1Z0tTRDkvZStYd1o0TW5rbTVFamZ6RkczMmliVWFjdndJZ1NiaUVVQk93QXprYUl4Wkh4T3V4Q1gwT3pwMDdtL2xtVUQ0WGNHOU9uNFk9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":40,"value_preview":"WkFUQ0FfQ0FfU0lHTkFUVVJFX1BMQU...[10 more bytes]","value_base64":"V2tGVVEwRmZRMEZmVTBsSFRrRlVWVkpGWDFCTVFVTkZTRTlNUkVWUw=="}]} 
[2025-09-20 19:07:27] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-20 19:07:29] local.DEBUG: QR code with crypto tags generated {"length":4484} 
[2025-09-20 19:07:29] local.INFO: Generating final unsigned XML with QR code  
[2025-09-20 19:07:29] local.INFO: Starting unsigned XML generation {"invoice_number":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f"} 
[2025-09-20 19:07:29] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-20 19:07:29] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000150"} 
[2025-09-20 19:07:29] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-20 19:07:29] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-20 19:07:29] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-20 19:07:29] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-20 19:07:29] local.DEBUG: Supplier party built successfully  
[2025-09-20 19:07:29] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-20 19:07:29] local.DEBUG: Buyer party built successfully  
[2025-09-20 19:07:29] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-20 19:07:29] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-20 19:07:29] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-20 19:07:29] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-20 19:07:29] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-20 19:07:29] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-20 19:07:29] local.DEBUG: Building additional document references  
[2025-09-20 19:07:29] local.DEBUG: Added ICV reference {"icv":"150"} 
[2025-09-20 19:07:29] local.DEBUG: Added PIH reference {"pih":"sSHwMdgj3nrrZjfohZJi3nMDJRFB4vW7lADMsFwQ/e4="} 
[2025-09-20 19:07:29] local.DEBUG: Added QR reference {"qr_length":4484} 
[2025-09-20 19:07:29] local.DEBUG: Additional document references built {"count":3} 
[2025-09-20 19:07:29] local.DEBUG: Invoice object created successfully {"id":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-20 19:07:29] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000150-unsigned.xml","file_size":5277} 
[2025-09-20 19:07:29] local.INFO: Signing final XML with QR embedded  
[2025-09-20 19:07:29] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000150-signed-1758380849.xml"} 
[2025-09-20 19:07:29] local.DEBUG: Calculating final invoice hash  
[2025-09-20 19:07:29] local.DEBUG: Final invoice hash calculated {"hash":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY="} 
[2025-09-20 19:07:29] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"150","invoice_hash":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY="} 
[2025-09-20 19:07:29] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000150","uuid":"1b107c2d-688b-4b91-b6bc-941b1089276f","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000150-signed-1758380849.xml"} 
[2025-09-20 19:07:29] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":150,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 15:57:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 15:58:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 15:58:32] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 15:58:32] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 15:58:37] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 15:58:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 15:58:37] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 15:58:37] local.DEBUG: Applying default values to invoice data  
[2025-09-22 15:58:37] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"151","previous_invoice_hash":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 15:58:37] local.DEBUG: Default values applied {"result_data":{"uuid":"0160567d-b27f-46fa-a547-318926922fa4","invoice_counter":"151","pih":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000151","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 15:58:37] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 15:58:37] local.DEBUG: Running ZATCA validation  
[2025-09-22 15:58:37] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 15:58:37] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 15:58:37] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 15:58:37] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 15:58:37] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 15:58:37] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 15:58:37] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 15:58:37] local.INFO: Starting unsigned XML generation {"invoice_number":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4"} 
[2025-09-22 15:58:37] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 15:58:37] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000151"} 
[2025-09-22 15:58:37] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 15:58:37] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 15:58:37] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 15:58:37] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 15:58:37] local.DEBUG: Supplier party built successfully  
[2025-09-22 15:58:37] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 15:58:37] local.DEBUG: Buyer party built successfully  
[2025-09-22 15:58:37] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 15:58:37] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 15:58:37] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 15:58:37] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 15:58:37] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 15:58:37] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 15:58:37] local.DEBUG: Building additional document references  
[2025-09-22 15:58:37] local.DEBUG: Added ICV reference {"icv":"151"} 
[2025-09-22 15:58:37] local.DEBUG: Added PIH reference {"pih":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY="} 
[2025-09-22 15:58:37] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 15:58:37] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 15:58:37] local.DEBUG: Invoice object created successfully {"id":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 15:58:37] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000151-unsigned.xml","file_size":5277} 
[2025-09-22 15:58:37] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000151-unsigned.xml"} 
[2025-09-22 15:58:37] local.INFO: Signing initial XML  
[2025-09-22 15:58:38] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000151-signed-1758542318.xml"} 
[2025-09-22 15:58:38] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 15:58:38] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 15:58:38] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"pkdf5p2HbvgISpKBF1wtGWWlJwew6S...[14 more bytes]","value_base64":"cGtkZjVwMkhidmdJU3BLQkYxd3RHV1dsSndldzZTUlZyL1dLdUlmMGJmMD0="},{"tag":7,"length":96,"value_preview":"MEQCIDGhCd0ePc1It7tXkjcl5u5Rvw...[66 more bytes]","value_base64":"TUVRQ0lER2hDZDBlUGMxSXQ3dFhramNsNXU1UnZ3MjA0Zk9sbVJjL3V4T1F4aXdEQWlBSk1YUVdyS2tPOGU3WVVEUVdLNHhkNkMxUXVsdTdxaVlTL0dIbGNwZGh3QT09"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":40,"value_preview":"WkFUQ0FfQ0FfU0lHTkFUVVJFX1BMQU...[10 more bytes]","value_base64":"V2tGVVEwRmZRMEZmVTBsSFRrRlVWVkpGWDFCTVFVTkZTRTlNUkVWUw=="}]} 
[2025-09-22 15:58:38] local.DEBUG: Complete TLV generated with crypto tags {"length":370,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 15:58:40] local.DEBUG: QR code with crypto tags generated {"length":4516} 
[2025-09-22 15:58:40] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 15:58:40] local.INFO: Starting unsigned XML generation {"invoice_number":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4"} 
[2025-09-22 15:58:40] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 15:58:40] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000151"} 
[2025-09-22 15:58:40] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 15:58:40] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 15:58:40] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 15:58:40] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 15:58:40] local.DEBUG: Supplier party built successfully  
[2025-09-22 15:58:40] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 15:58:40] local.DEBUG: Buyer party built successfully  
[2025-09-22 15:58:40] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 15:58:40] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 15:58:40] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 15:58:40] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 15:58:40] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 15:58:40] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 15:58:40] local.DEBUG: Building additional document references  
[2025-09-22 15:58:40] local.DEBUG: Added ICV reference {"icv":"151"} 
[2025-09-22 15:58:40] local.DEBUG: Added PIH reference {"pih":"rUWB+6dG2P/DId6Wx5tsdtZnTIqO7DbcrhWDKhFuHmY="} 
[2025-09-22 15:58:40] local.DEBUG: Added QR reference {"qr_length":4516} 
[2025-09-22 15:58:40] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 15:58:40] local.DEBUG: Invoice object created successfully {"id":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 15:58:40] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000151-unsigned.xml","file_size":5277} 
[2025-09-22 15:58:40] local.INFO: Signing final XML with QR embedded  
[2025-09-22 15:58:40] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000151-signed-1758542320.xml"} 
[2025-09-22 15:58:40] local.DEBUG: Calculating final invoice hash  
[2025-09-22 15:58:40] local.DEBUG: Final invoice hash calculated {"hash":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU="} 
[2025-09-22 15:58:40] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"151","invoice_hash":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU="} 
[2025-09-22 15:58:40] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000151","uuid":"0160567d-b27f-46fa-a547-318926922fa4","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000151-signed-1758542320.xml"} 
[2025-09-22 15:58:40] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":151,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:10:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:10:37] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:10:37] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:10:37] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:10:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:10:37] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:10:37] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:10:37] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"152","previous_invoice_hash":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:10:37] local.DEBUG: Default values applied {"result_data":{"uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02","invoice_counter":"152","pih":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000152","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:10:37] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:10:37] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:10:37] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:10:37] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:10:37] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:10:37] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:10:37] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:10:37] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:10:37] local.INFO: Starting unsigned XML generation {"invoice_number":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02"} 
[2025-09-22 16:10:37] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:10:37] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000152"} 
[2025-09-22 16:10:37] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:10:37] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:10:37] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:10:37] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:10:37] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:10:37] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:10:37] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:10:37] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:10:37] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:10:37] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:10:37] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Building additional document references  
[2025-09-22 16:10:37] local.DEBUG: Added ICV reference {"icv":"152"} 
[2025-09-22 16:10:37] local.DEBUG: Added PIH reference {"pih":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU="} 
[2025-09-22 16:10:37] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:10:37] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:10:37] local.DEBUG: Invoice object created successfully {"id":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:10:37] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000152-unsigned.xml","file_size":5277} 
[2025-09-22 16:10:37] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000152-unsigned.xml"} 
[2025-09-22 16:10:37] local.INFO: Signing initial XML  
[2025-09-22 16:10:37] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000152-signed-1758543037.xml"} 
[2025-09-22 16:10:37] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 16:10:37] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 16:10:37] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"6Gnat4rbLO5NiPNdUFoNkPK3y+z+3q...[14 more bytes]","value_base64":"NkduYXQ0cmJMTzVOaVBOZFVGb05rUEszeSt6KzNxRmRyZkxoVUh5Tks2ST0="},{"tag":7,"length":96,"value_preview":"MEUCIQDTWlxLkiZj25qW0OKiIpvhxQ...[66 more bytes]","value_base64":"TUVVQ0lRRFRXbHhMa2laajI1cVcwT0tpSXB2aHhRTVBVZ3BoRnhrM1IxY3BybmwwbVFJZ0lSV0hVZmpZUlhVcFg5N1ZxYm5NRVFZbm1qNTRldTUzWHl5MGQ2TlRZd2s9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 16:10:37] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 16:10:37] local.DEBUG: QR code with crypto tags generated {"length":4524} 
[2025-09-22 16:10:37] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 16:10:37] local.INFO: Starting unsigned XML generation {"invoice_number":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02"} 
[2025-09-22 16:10:37] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:10:37] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000152"} 
[2025-09-22 16:10:37] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:10:37] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:10:37] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:10:37] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:10:37] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:10:37] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:10:37] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:10:37] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:10:37] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:10:37] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:10:37] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:10:37] local.DEBUG: Building additional document references  
[2025-09-22 16:10:37] local.DEBUG: Added ICV reference {"icv":"152"} 
[2025-09-22 16:10:37] local.DEBUG: Added PIH reference {"pih":"aspnsqN0LsFpltjNGVoqB0WJQyCBl2+Lw2b/5Yc2bNU="} 
[2025-09-22 16:10:37] local.DEBUG: Added QR reference {"qr_length":4524} 
[2025-09-22 16:10:37] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:10:37] local.DEBUG: Invoice object created successfully {"id":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:10:37] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000152-unsigned.xml","file_size":5277} 
[2025-09-22 16:10:37] local.INFO: Signing final XML with QR embedded  
[2025-09-22 16:10:37] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000152-signed-1758543037.xml"} 
[2025-09-22 16:10:37] local.DEBUG: Calculating final invoice hash  
[2025-09-22 16:10:37] local.DEBUG: Final invoice hash calculated {"hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM="} 
[2025-09-22 16:10:37] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"152","invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM="} 
[2025-09-22 16:10:37] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000152","uuid":"3f685151-d4ab-4ea2-a70e-607ed8d9ea02","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000152-signed-1758543037.xml"} 
[2025-09-22 16:10:37] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":152,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:15:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:15:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:15:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:15:59] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:15:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:15:59] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000153","uuid":"9284a88d-4527-4838-a683-34e3c793c8f9","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:15:59] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:15:59] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000153","uuid":"9284a88d-4527-4838-a683-34e3c793c8f9","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"153","previous_invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:15:59] local.DEBUG: Default values applied {"result_data":{"uuid":"9284a88d-4527-4838-a683-34e3c793c8f9","invoice_counter":"153","pih":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000153","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:15:59] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:15:59] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:15:59] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:15:59] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:15:59] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:15:59] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:15:59] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:15:59] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:15:59] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:15:59] local.INFO: Starting unsigned XML generation {"invoice_number":"001000153","uuid":"9284a88d-4527-4838-a683-34e3c793c8f9"} 
[2025-09-22 16:15:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:15:59] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000153"} 
[2025-09-22 16:15:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:15:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:15:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:15:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:15:59] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:15:59] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:15:59] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:15:59] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:15:59] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:15:59] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:15:59] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:15:59] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:15:59] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:15:59] local.DEBUG: Building additional document references  
[2025-09-22 16:15:59] local.DEBUG: Added ICV reference {"icv":"153"} 
[2025-09-22 16:15:59] local.DEBUG: Added PIH reference {"pih":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM="} 
[2025-09-22 16:15:59] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-22 16:15:59] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(543): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(196): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#50 {main}","invoice_data":{"uuid":"9284a88d-4527-4838-a683-34e3c793c8f9","invoice_counter":"153","pih":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000153","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:15:59] local.ERROR: Failed to generate initial unsigned XML  
[2025-09-22 16:26:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:26:49] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:26:49] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:26:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:26:49] local.INFO: Starting unsigned XML generation {"invoice_number":"001000153","uuid":"68ffe997-4d23-461a-ba09-b8b2a5d79cfa"} 
[2025-09-22 16:26:49] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:26:49] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000153"} 
[2025-09-22 16:26:49] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:26:49] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:26:49] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:26:49] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:26:49] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:26:49] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:26:49] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:26:49] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:26:49] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:26:49] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:26:49] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:26:49] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:26:49] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:26:49] local.DEBUG: Building additional document references  
[2025-09-22 16:26:49] local.DEBUG: Added ICV reference {"icv":"153"} 
[2025-09-22 16:26:49] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:26:49] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 16:26:49] local.ERROR: XML generation failed {"error":"Undefined array key \"invoice_type_code\"","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(551): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined array...', 'C:\\\\xampp\\\\htdocs...', 551)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3223): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000153","uuid":"68ffe997-4d23-461a-ba09-b8b2a5d79cfa","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"153","previous_invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:26:49] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-22 16:26:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:26:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:26:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:26:59] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:26:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:26:59] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:26:59] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:26:59] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"153","previous_invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:26:59] local.DEBUG: Default values applied {"result_data":{"uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169","invoice_counter":"153","pih":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000153","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:26:59] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:26:59] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:26:59] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:26:59] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:26:59] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:26:59] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:26:59] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:26:59] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:26:59] local.INFO: Starting unsigned XML generation {"invoice_number":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169"} 
[2025-09-22 16:26:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:26:59] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000153"} 
[2025-09-22 16:26:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:26:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:26:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:26:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:26:59] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:26:59] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:26:59] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:26:59] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:26:59] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:26:59] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:26:59] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Building additional document references  
[2025-09-22 16:26:59] local.DEBUG: Added ICV reference {"icv":"153"} 
[2025-09-22 16:26:59] local.DEBUG: Added PIH reference {"pih":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM="} 
[2025-09-22 16:26:59] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:26:59] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:26:59] local.DEBUG: Invoice object created successfully {"id":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:26:59] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000153-unsigned.xml","file_size":5277} 
[2025-09-22 16:26:59] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000153-unsigned.xml"} 
[2025-09-22 16:26:59] local.INFO: Signing initial XML  
[2025-09-22 16:26:59] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000153-signed-1758544019.xml"} 
[2025-09-22 16:26:59] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 16:26:59] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 16:26:59] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"K5BturpaqzqPXCuphY90/hk6KaoXCE...[14 more bytes]","value_base64":"SzVCdHVycGFxenFQWEN1cGhZOTAvaGs2S2FvWENFQTZWTzBmM2VxY21hTT0="},{"tag":7,"length":96,"value_preview":"MEUCIQDdXQINh7fuXcPrtDQKB6XbQV...[66 more bytes]","value_base64":"TUVVQ0lRRGRYUUlOaDdmdVhjUHJ0RFFLQjZYYlFWVU1STVNFUThFcUlPd2pSRHFtZGdJZ1hDTU1ZVER4RlB1MC9mRmdGdW12RklHSVlYRlltWU54TitvOUNjc09uTUU9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 16:26:59] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 16:26:59] local.DEBUG: QR code with crypto tags generated {"length":4528} 
[2025-09-22 16:26:59] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 16:26:59] local.INFO: Starting unsigned XML generation {"invoice_number":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169"} 
[2025-09-22 16:26:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:26:59] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000153"} 
[2025-09-22 16:26:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:26:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:26:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:26:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:26:59] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:26:59] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:26:59] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:26:59] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:26:59] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:26:59] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:26:59] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:26:59] local.DEBUG: Building additional document references  
[2025-09-22 16:26:59] local.DEBUG: Added ICV reference {"icv":"153"} 
[2025-09-22 16:26:59] local.DEBUG: Added PIH reference {"pih":"5pdXX9PBgLQ+mRmzRISM1v9bWDwA5/q2CusYge0ibuM="} 
[2025-09-22 16:26:59] local.DEBUG: Added QR reference {"qr_length":4528} 
[2025-09-22 16:26:59] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:26:59] local.DEBUG: Invoice object created successfully {"id":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:26:59] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000153-unsigned.xml","file_size":5277} 
[2025-09-22 16:26:59] local.INFO: Signing final XML with QR embedded  
[2025-09-22 16:26:59] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000153-signed-1758544019.xml"} 
[2025-09-22 16:26:59] local.DEBUG: Calculating final invoice hash  
[2025-09-22 16:26:59] local.DEBUG: Final invoice hash calculated {"hash":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM="} 
[2025-09-22 16:27:00] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"153","invoice_hash":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM="} 
[2025-09-22 16:27:00] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000153","uuid":"50e60997-d9df-4d59-bbce-c7f6dfd70169","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000153-signed-1758544019.xml"} 
[2025-09-22 16:27:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":153,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:27:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:27:07] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:27:07] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:27:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:27:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000154","uuid":"251baff2-55ad-457b-886f-d7cc9071496b"} 
[2025-09-22 16:27:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:27:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000154"} 
[2025-09-22 16:27:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:27:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:27:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:27:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:27:07] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:27:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:27:07] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:27:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:27:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:27:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:27:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:27:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:27:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:27:07] local.DEBUG: Building additional document references  
[2025-09-22 16:27:07] local.DEBUG: Added ICV reference {"icv":"154"} 
[2025-09-22 16:27:07] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:27:07] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 16:27:07] local.ERROR: XML generation failed {"error":"Undefined array key \"invoice_type_code\"","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(551): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined array...', 'C:\\\\xampp\\\\htdocs...', 551)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3223): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000154","uuid":"251baff2-55ad-457b-886f-d7cc9071496b","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"154","previous_invoice_hash":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:27:07] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-22 16:40:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:40:50] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:40:50] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:40:50] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:40:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:40:50] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:40:50] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:40:50] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"154","previous_invoice_hash":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:40:50] local.DEBUG: Default values applied {"result_data":{"uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8","invoice_counter":"154","pih":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000154","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:40:50] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:40:50] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:40:50] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:40:50] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:40:50] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:40:50] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:40:50] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:40:50] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:40:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8"} 
[2025-09-22 16:40:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:40:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000154"} 
[2025-09-22 16:40:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:40:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:40:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:40:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:40:50] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:40:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:40:50] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:40:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:40:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:40:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:40:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Building additional document references  
[2025-09-22 16:40:50] local.DEBUG: Added ICV reference {"icv":"154"} 
[2025-09-22 16:40:50] local.DEBUG: Added PIH reference {"pih":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM="} 
[2025-09-22 16:40:50] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:40:50] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:40:50] local.DEBUG: Invoice object created successfully {"id":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:40:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000154-unsigned.xml","file_size":5277} 
[2025-09-22 16:40:50] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000154-unsigned.xml"} 
[2025-09-22 16:40:50] local.INFO: Signing initial XML  
[2025-09-22 16:40:50] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000154-signed-1758544850.xml"} 
[2025-09-22 16:40:50] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 16:40:50] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 16:40:50] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"XurJhjjpybVHPn4h3/Yc2RHGkBsGPk...[14 more bytes]","value_base64":"WHVySmhqanB5YlZIUG40aDMvWWMyUkhHa0JzR1BrS2xVNVJIZXRWS1dCOD0="},{"tag":7,"length":96,"value_preview":"MEUCIFxbFPvTu3xOBfnXwzeFGcogrh...[66 more bytes]","value_base64":"TUVVQ0lGeGJGUHZUdTN4T0Jmblh3emVGR2NvZ3JoaFk1ZTMvL0FkbytqVGpxQ3FPQWlFQWdLVWwyMnlQaW1mVGY0V1VwR3JZR0J1WEoxYTNGMUdkMlhrRllFRVpqcU09"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 16:40:50] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 16:40:50] local.DEBUG: QR code with crypto tags generated {"length":4448} 
[2025-09-22 16:40:50] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 16:40:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8"} 
[2025-09-22 16:40:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:40:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000154"} 
[2025-09-22 16:40:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:40:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:40:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:40:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:40:50] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:40:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:40:50] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:40:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:40:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:40:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:40:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:40:50] local.DEBUG: Building additional document references  
[2025-09-22 16:40:50] local.DEBUG: Added ICV reference {"icv":"154"} 
[2025-09-22 16:40:50] local.DEBUG: Added PIH reference {"pih":"5YReLYKLRhJmbNdgxhekWVfn8eBurT169VLRk5WEmMM="} 
[2025-09-22 16:40:50] local.DEBUG: Added QR reference {"qr_length":4448} 
[2025-09-22 16:40:50] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:40:50] local.DEBUG: Invoice object created successfully {"id":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:40:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000154-unsigned.xml","file_size":5277} 
[2025-09-22 16:40:50] local.INFO: Signing final XML with QR embedded  
[2025-09-22 16:40:50] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000154-signed-1758544850.xml"} 
[2025-09-22 16:40:50] local.DEBUG: Calculating final invoice hash  
[2025-09-22 16:40:50] local.DEBUG: Final invoice hash calculated {"hash":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y="} 
[2025-09-22 16:40:50] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"154","invoice_hash":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y="} 
[2025-09-22 16:40:50] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000154","uuid":"d2aacf98-ca51-4c43-8071-5c2ef8c2b6d8","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000154-signed-1758544850.xml"} 
[2025-09-22 16:40:50] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":154,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:46:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:46:49] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:46:49] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:46:50] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:46:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:46:50] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:46:50] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:46:50] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"155","previous_invoice_hash":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:46:50] local.DEBUG: Default values applied {"result_data":{"uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1","invoice_counter":"155","pih":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000155","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:46:50] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:46:50] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:46:50] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:46:50] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:46:50] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:46:50] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:46:50] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:46:50] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:46:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1"} 
[2025-09-22 16:46:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:46:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000155"} 
[2025-09-22 16:46:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:46:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:46:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:46:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:46:50] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:46:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:46:50] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:46:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:46:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:46:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:46:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Building additional document references  
[2025-09-22 16:46:50] local.DEBUG: Added ICV reference {"icv":"155"} 
[2025-09-22 16:46:50] local.DEBUG: Added PIH reference {"pih":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y="} 
[2025-09-22 16:46:50] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:46:50] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:46:50] local.DEBUG: Invoice object created successfully {"id":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:46:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000155-unsigned.xml","file_size":5277} 
[2025-09-22 16:46:50] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000155-unsigned.xml"} 
[2025-09-22 16:46:50] local.INFO: Signing initial XML  
[2025-09-22 16:46:50] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000155-signed-1758545210.xml"} 
[2025-09-22 16:46:50] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 16:46:50] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 16:46:50] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"3uEsHTNTgGhjJgOlaTRPGZeScqG6Qz...[14 more bytes]","value_base64":"M3VFc0hUTlRnR2hqSmdPbGFUUlBHWmVTY3FHNlF6WWFLMXNidm5CU1hJdz0="},{"tag":7,"length":96,"value_preview":"MEUCIHVeFuNOLmPNROZzr6NH33Q3oS...[66 more bytes]","value_base64":"TUVVQ0lIVmVGdU5PTG1QTlJPWnpyNk5IMzNRM29TWW9ubG1TY0V3ckFNQU1ZYVcyQWlFQThBQkJHaTZQQkpPVWh2T2ZQV2VZc2hxUGlaNk52NzVlYW1OYmVDRDd1VEk9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 16:46:50] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 16:46:50] local.DEBUG: QR code with crypto tags generated {"length":4492} 
[2025-09-22 16:46:50] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 16:46:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1"} 
[2025-09-22 16:46:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:46:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000155"} 
[2025-09-22 16:46:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:46:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:46:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:46:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:46:50] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:46:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:46:50] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:46:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:46:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:46:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:46:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:46:50] local.DEBUG: Building additional document references  
[2025-09-22 16:46:50] local.DEBUG: Added ICV reference {"icv":"155"} 
[2025-09-22 16:46:50] local.DEBUG: Added PIH reference {"pih":"pZJl9D2FV/HtfPSi/NnAcOh06HkTQO5HH4m0uHQnz9Y="} 
[2025-09-22 16:46:50] local.DEBUG: Added QR reference {"qr_length":4492} 
[2025-09-22 16:46:50] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:46:50] local.DEBUG: Invoice object created successfully {"id":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:46:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000155-unsigned.xml","file_size":5277} 
[2025-09-22 16:46:50] local.INFO: Signing final XML with QR embedded  
[2025-09-22 16:46:50] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000155-signed-1758545210.xml"} 
[2025-09-22 16:46:50] local.DEBUG: Calculating final invoice hash  
[2025-09-22 16:46:50] local.DEBUG: Final invoice hash calculated {"hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8="} 
[2025-09-22 16:46:50] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"155","invoice_hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8="} 
[2025-09-22 16:46:50] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000155","uuid":"5a404f51-ac08-4135-9033-2bf4042c4ca1","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000155-signed-1758545210.xml"} 
[2025-09-22 16:46:50] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":155,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:50:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:50:30] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:50:30] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:50:30] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:50:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:50:30] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000156","uuid":"2fdf118a-2442-432e-b01c-d26af96fcbfa","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:50:30] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:50:30] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000156","uuid":"2fdf118a-2442-432e-b01c-d26af96fcbfa","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"156","previous_invoice_hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:50:30] local.DEBUG: Default values applied {"result_data":{"uuid":"2fdf118a-2442-432e-b01c-d26af96fcbfa","invoice_counter":"156","pih":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000156","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:50:30] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:50:30] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:50:30] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:50:30] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:50:30] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:50:30] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:50:30] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:50:30] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:50:30] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:50:30] local.INFO: Starting unsigned XML generation {"invoice_number":"001000156","uuid":"2fdf118a-2442-432e-b01c-d26af96fcbfa"} 
[2025-09-22 16:50:30] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:50:30] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000156"} 
[2025-09-22 16:50:30] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:50:30] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:50:30] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:50:30] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:50:30] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:50:30] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:50:30] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:50:30] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:50:30] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:50:30] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:50:30] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:50:30] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:50:30] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:50:30] local.DEBUG: Building additional document references  
[2025-09-22 16:50:30] local.DEBUG: Added ICV reference {"icv":"156"} 
[2025-09-22 16:50:30] local.DEBUG: Added PIH reference {"pih":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8="} 
[2025-09-22 16:50:30] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-22 16:50:30] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(543): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(196): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3235): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#50 {main}","invoice_data":{"uuid":"2fdf118a-2442-432e-b01c-d26af96fcbfa","invoice_counter":"156","pih":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000156","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:50:30] local.ERROR: Failed to generate initial unsigned XML  
[2025-09-22 16:52:52] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:52:52] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:52:52] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:52:52] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:52:52] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:52:52] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:52:52] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:52:52] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"156","previous_invoice_hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:52:52] local.DEBUG: Default values applied {"result_data":{"uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9","invoice_counter":"156","pih":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000156","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:52:52] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:52:52] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:52:52] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:52:52] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:52:52] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:52:52] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:52:52] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:52:52] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:52:52] local.INFO: Starting unsigned XML generation {"invoice_number":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9"} 
[2025-09-22 16:52:52] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:52:52] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000156"} 
[2025-09-22 16:52:52] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:52:52] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:52:52] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:52:52] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:52:52] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:52:52] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:52:52] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:52:52] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:52:52] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:52:52] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:52:52] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Building additional document references  
[2025-09-22 16:52:52] local.DEBUG: Added ICV reference {"icv":"156"} 
[2025-09-22 16:52:52] local.DEBUG: Added PIH reference {"pih":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8="} 
[2025-09-22 16:52:52] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:52:52] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:52:52] local.DEBUG: Invoice object created successfully {"id":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:52:52] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000156-unsigned.xml","file_size":5277} 
[2025-09-22 16:52:52] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000156-unsigned.xml"} 
[2025-09-22 16:52:52] local.INFO: Signing initial XML  
[2025-09-22 16:52:52] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000156-signed-1758545572.xml"} 
[2025-09-22 16:52:52] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 16:52:52] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 16:52:52] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"Ugo1caHFzttehylcNAguV0lEfTuV/0...[14 more bytes]","value_base64":"VWdvMWNhSEZ6dHRlaHlsY05BZ3VWMGxFZlR1Vi8wS2syR2N1Um53bFlwZz0="},{"tag":7,"length":96,"value_preview":"MEQCICgnGVjdcsPFiZ7FI/ZmmXqh23...[66 more bytes]","value_base64":"TUVRQ0lDZ25HVmpkY3NQRmlaN0ZJL1ptbVhxaDIzbzBRNHlzcHU2VEUrYno4aWI1QWlBYnpSQlY1VnpLUGw1TzlkaENVZGxsWWN6MzJPem0yMmJtZDUvWU1vREk2dz09"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 16:52:52] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 16:52:52] local.DEBUG: QR code with crypto tags generated {"length":4516} 
[2025-09-22 16:52:52] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 16:52:52] local.INFO: Starting unsigned XML generation {"invoice_number":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9"} 
[2025-09-22 16:52:52] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:52:52] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000156"} 
[2025-09-22 16:52:52] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:52:52] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:52:52] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:52:52] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:52:52] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:52:52] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:52:52] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:52:52] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:52:52] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:52:52] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:52:52] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:52:52] local.DEBUG: Building additional document references  
[2025-09-22 16:52:52] local.DEBUG: Added ICV reference {"icv":"156"} 
[2025-09-22 16:52:52] local.DEBUG: Added PIH reference {"pih":"W+Zs0HfgvADLd/sqo9FDi4mrrC8fSHbs4cMay97BXt8="} 
[2025-09-22 16:52:52] local.DEBUG: Added QR reference {"qr_length":4516} 
[2025-09-22 16:52:52] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:52:52] local.DEBUG: Invoice object created successfully {"id":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:52:52] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000156-unsigned.xml","file_size":5277} 
[2025-09-22 16:52:52] local.INFO: Signing final XML with QR embedded  
[2025-09-22 16:52:52] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000156-signed-1758545572.xml"} 
[2025-09-22 16:52:52] local.DEBUG: Calculating final invoice hash  
[2025-09-22 16:52:52] local.DEBUG: Final invoice hash calculated {"hash":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg="} 
[2025-09-22 16:52:52] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"156","invoice_hash":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg="} 
[2025-09-22 16:52:52] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000156","uuid":"8e3d125e-c916-4bed-9ceb-76c170deece9","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000156-signed-1758545572.xml"} 
[2025-09-22 16:52:52] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":156,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:53:09] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:53:09] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:53:09] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:53:09] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:53:09] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:53:09] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:53:09] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:53:09] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"157","previous_invoice_hash":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:53:09] local.DEBUG: Default values applied {"result_data":{"uuid":"f25a66ce-1777-447f-9d1e-61e446318a39","invoice_counter":"157","pih":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000157","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:53:09] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:53:09] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:53:09] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:53:09] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:53:09] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:53:09] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:53:09] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:53:09] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:53:09] local.INFO: Starting unsigned XML generation {"invoice_number":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39"} 
[2025-09-22 16:53:09] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:53:09] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000157"} 
[2025-09-22 16:53:09] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:53:09] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:53:09] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:53:09] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:53:09] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:53:09] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:53:09] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:53:09] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:53:09] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:53:09] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:53:09] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Building additional document references  
[2025-09-22 16:53:09] local.DEBUG: Added ICV reference {"icv":"157"} 
[2025-09-22 16:53:09] local.DEBUG: Added PIH reference {"pih":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg="} 
[2025-09-22 16:53:09] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 16:53:09] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:53:09] local.DEBUG: Invoice object created successfully {"id":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:53:09] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000157-unsigned.xml","file_size":5277} 
[2025-09-22 16:53:09] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000157-unsigned.xml"} 
[2025-09-22 16:53:09] local.INFO: Signing initial XML  
[2025-09-22 16:53:09] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000157-signed-1758545589.xml"} 
[2025-09-22 16:53:09] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 16:53:09] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 16:53:09] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"jQrnagth6UFMP+UmXdRtoKc+FL/koE...[14 more bytes]","value_base64":"alFybmFndGg2VUZNUCtVbVhkUnRvS2MrRkwva29Fc3NxZTErbWhhc0JPcz0="},{"tag":7,"length":96,"value_preview":"MEUCICbl+e9xoBeBLWzt1KaTvfJejl...[66 more bytes]","value_base64":"TUVVQ0lDYmwrZTl4b0JlQkxXenQxS2FUdmZKZWpsSmRTT3pjQlBzMUpOZjMrdFRxQWlFQStJNm1NUEQ3U1gyTHZHenN0cHFLUThlWUIyVlJ2Yk1ScE84VzAwdDFFQ1U9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 16:53:09] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 16:53:09] local.DEBUG: QR code with crypto tags generated {"length":4476} 
[2025-09-22 16:53:09] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 16:53:09] local.INFO: Starting unsigned XML generation {"invoice_number":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39"} 
[2025-09-22 16:53:09] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:53:09] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000157"} 
[2025-09-22 16:53:09] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:53:09] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:53:09] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:53:09] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:53:09] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:53:09] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:53:09] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:53:09] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:53:09] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:53:09] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:53:09] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:53:09] local.DEBUG: Building additional document references  
[2025-09-22 16:53:09] local.DEBUG: Added ICV reference {"icv":"157"} 
[2025-09-22 16:53:09] local.DEBUG: Added PIH reference {"pih":"HBMJqmDeO4hgxsOEcqhh+q3MnAxPxbbc06+Oto+zOfg="} 
[2025-09-22 16:53:09] local.DEBUG: Added QR reference {"qr_length":4476} 
[2025-09-22 16:53:09] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 16:53:09] local.DEBUG: Invoice object created successfully {"id":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:53:09] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000157-unsigned.xml","file_size":5277} 
[2025-09-22 16:53:09] local.INFO: Signing final XML with QR embedded  
[2025-09-22 16:53:09] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000157-signed-1758545589.xml"} 
[2025-09-22 16:53:09] local.DEBUG: Calculating final invoice hash  
[2025-09-22 16:53:09] local.DEBUG: Final invoice hash calculated {"hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk="} 
[2025-09-22 16:53:09] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"157","invoice_hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk="} 
[2025-09-22 16:53:09] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000157","uuid":"f25a66ce-1777-447f-9d1e-61e446318a39","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000157-signed-1758545589.xml"} 
[2025-09-22 16:53:09] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":157,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 16:58:09] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:58:09] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 16:58:09] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 16:58:10] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:58:10] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 16:58:10] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000158","uuid":"46b7becb-2dee-4998-a657-3a1c809335b3","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 16:58:10] local.DEBUG: Applying default values to invoice data  
[2025-09-22 16:58:10] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000158","uuid":"46b7becb-2dee-4998-a657-3a1c809335b3","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"158","previous_invoice_hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:58:10] local.DEBUG: Default values applied {"result_data":{"uuid":"46b7becb-2dee-4998-a657-3a1c809335b3","invoice_counter":"158","pih":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000158","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:58:10] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 16:58:10] local.DEBUG: Running ZATCA validation  
[2025-09-22 16:58:10] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 16:58:10] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 16:58:10] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 16:58:10] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 16:58:10] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 16:58:10] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 16:58:10] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 16:58:10] local.INFO: Starting unsigned XML generation {"invoice_number":"001000158","uuid":"46b7becb-2dee-4998-a657-3a1c809335b3"} 
[2025-09-22 16:58:10] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 16:58:10] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000158"} 
[2025-09-22 16:58:10] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 16:58:10] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 16:58:10] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 16:58:10] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 16:58:10] local.DEBUG: Supplier party built successfully  
[2025-09-22 16:58:10] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 16:58:10] local.DEBUG: Buyer party built successfully  
[2025-09-22 16:58:10] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 16:58:10] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 16:58:10] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 16:58:10] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 16:58:10] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 16:58:10] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 16:58:10] local.DEBUG: Building additional document references  
[2025-09-22 16:58:10] local.DEBUG: Added ICV reference {"icv":"158"} 
[2025-09-22 16:58:10] local.DEBUG: Added PIH reference {"pih":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk="} 
[2025-09-22 16:58:10] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-22 16:58:10] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(543): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(196): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3235): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#50 {main}","invoice_data":{"uuid":"46b7becb-2dee-4998-a657-3a1c809335b3","invoice_counter":"158","pih":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000158","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 16:58:10] local.ERROR: Failed to generate initial unsigned XML  
[2025-09-22 17:53:22] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 17:53:22] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 17:53:22] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 17:53:22] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 17:53:22] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 17:53:22] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 17:53:22] local.DEBUG: Applying default values to invoice data  
[2025-09-22 17:53:22] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"158","previous_invoice_hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 17:53:22] local.DEBUG: Default values applied {"result_data":{"uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473","invoice_counter":"158","pih":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000158","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 17:53:22] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Running ZATCA validation  
[2025-09-22 17:53:22] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 17:53:22] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 17:53:22] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 17:53:22] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 17:53:22] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 17:53:22] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 17:53:22] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 17:53:22] local.INFO: Starting unsigned XML generation {"invoice_number":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473"} 
[2025-09-22 17:53:22] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 17:53:22] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000158"} 
[2025-09-22 17:53:22] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 17:53:22] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 17:53:22] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 17:53:22] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 17:53:22] local.DEBUG: Supplier party built successfully  
[2025-09-22 17:53:22] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 17:53:22] local.DEBUG: Buyer party built successfully  
[2025-09-22 17:53:22] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 17:53:22] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 17:53:22] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 17:53:22] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Building additional document references  
[2025-09-22 17:53:22] local.DEBUG: Added ICV reference {"icv":"158"} 
[2025-09-22 17:53:22] local.DEBUG: Added PIH reference {"pih":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk="} 
[2025-09-22 17:53:22] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 17:53:22] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 17:53:22] local.DEBUG: Invoice object created successfully {"id":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 17:53:22] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000158-unsigned.xml","file_size":5277} 
[2025-09-22 17:53:22] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000158-unsigned.xml"} 
[2025-09-22 17:53:22] local.INFO: Signing initial XML  
[2025-09-22 17:53:22] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000158-signed-1758549202.xml"} 
[2025-09-22 17:53:22] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 17:53:22] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 17:53:22] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"xlVfa8gbOxGelaeoxguxQJpghNQvJW...[14 more bytes]","value_base64":"eGxWZmE4Z2JPeEdlbGFlb3hndXhRSnBnaE5RdkpXcm9HeEs3VU0vSy9kcz0="},{"tag":7,"length":96,"value_preview":"MEYCIQDH1m0zFvMr2I4+iiSs+vIatb...[66 more bytes]","value_base64":"TUVZQ0lRREgxbTB6RnZNcjJJNCtpaVNzK3ZJYXRicE1TOHBKZGg3citGSGF0ZkdQOFFJaEFMZ1VtOVgxQ3o4ZFByclBmRVRmalNSbVgrVWl5aXhsaGJGMzgzS0lvSEgy"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 17:53:22] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 17:53:22] local.DEBUG: QR code with crypto tags generated {"length":4444} 
[2025-09-22 17:53:22] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 17:53:22] local.INFO: Starting unsigned XML generation {"invoice_number":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473"} 
[2025-09-22 17:53:22] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 17:53:22] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000158"} 
[2025-09-22 17:53:22] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 17:53:22] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 17:53:22] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 17:53:22] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 17:53:22] local.DEBUG: Supplier party built successfully  
[2025-09-22 17:53:22] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 17:53:22] local.DEBUG: Buyer party built successfully  
[2025-09-22 17:53:22] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 17:53:22] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 17:53:22] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 17:53:22] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 17:53:22] local.DEBUG: Building additional document references  
[2025-09-22 17:53:22] local.DEBUG: Added ICV reference {"icv":"158"} 
[2025-09-22 17:53:22] local.DEBUG: Added PIH reference {"pih":"qd9Q/do+FM/9ls7xKnwrHa3owWvSE7UtMuFUaOA7rmk="} 
[2025-09-22 17:53:22] local.DEBUG: Added QR reference {"qr_length":4444} 
[2025-09-22 17:53:22] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 17:53:22] local.DEBUG: Invoice object created successfully {"id":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 17:53:22] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000158-unsigned.xml","file_size":5277} 
[2025-09-22 17:53:22] local.INFO: Signing final XML with QR embedded  
[2025-09-22 17:53:22] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000158-signed-1758549202.xml"} 
[2025-09-22 17:53:22] local.DEBUG: Calculating final invoice hash  
[2025-09-22 17:53:22] local.DEBUG: Final invoice hash calculated {"hash":"83FO+pR5Pthp3E1IWEFCG0IJZbU6heZF17w/pIuUjYQ="} 
[2025-09-22 17:53:22] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"158","invoice_hash":"83FO+pR5Pthp3E1IWEFCG0IJZbU6heZF17w/pIuUjYQ="} 
[2025-09-22 17:53:22] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000158","uuid":"f5773b12-c5d0-4bd8-b970-4bfb4b44e473","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000158-signed-1758549202.xml"} 
[2025-09-22 17:53:22] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":158,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 18:21:42] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:21:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:21:49] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 18:21:49] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 18:21:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:21:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000159","uuid":"d08a73c3-a941-423d-ac00-c926f25b2e24"} 
[2025-09-22 18:21:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 18:21:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000159"} 
[2025-09-22 18:21:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 18:21:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 18:21:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 18:21:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:21:50] local.DEBUG: Supplier party built successfully  
[2025-09-22 18:21:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 18:21:50] local.DEBUG: Buyer party built successfully  
[2025-09-22 18:21:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 18:21:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 18:21:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 18:21:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 18:21:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 18:21:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 18:21:50] local.DEBUG: Building additional document references  
[2025-09-22 18:21:50] local.DEBUG: Added ICV reference {"icv":"159"} 
[2025-09-22 18:21:50] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 18:21:50] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 18:21:50] local.DEBUG: Invoice object created successfully {"id":"001000159","uuid":"d08a73c3-a941-423d-ac00-c926f25b2e24","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:21:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000159-unsigned.xml","file_size":5206} 
[2025-09-22 18:21:50] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000159-unsigned.xml"} 
[2025-09-22 18:21:50] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000159-signed-1758550910.xml"} 
[2025-09-22 18:21:50] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 18:21:50] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"3lpTgYsFNOvn/6Ure992ZFryfBd+pC...[14 more bytes]","value_base64":"M2xwVGdZc0ZOT3ZuLzZVcmU5OTJaRnJ5ZkJkK3BDczN2azh1M2hEUXNBZz0="},{"tag":7,"length":96,"value_preview":"MEQCIE4vLvWMgttSUEbn/MTJdnt8Pi...[66 more bytes]","value_base64":"TUVRQ0lFNHZMdldNZ3R0U1VFYm4vTVRKZG50OFBpNXhFU1FndUJLMVBwZ0JXbk5GQWlCZGREaUJNWUl2SGs5YzdyNFNZREtlWlFzaWpTR3JHTzlJZGoxL3JtYXVDdz09"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 18:21:50] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 18:21:50] local.DEBUG: QR code with crypto tags generated {"length":4444} 
[2025-09-22 18:21:50] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":159,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 18:22:16] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:22:16] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 18:22:16] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 18:22:16] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:22:16] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:22:16] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 18:22:16] local.DEBUG: Applying default values to invoice data  
[2025-09-22 18:22:16] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"160","previous_invoice_hash":"bWAQUkFyRPsFk6usMgZg0j5QAJz/CYtJp0MlyrmWODA=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 18:22:16] local.DEBUG: Default values applied {"result_data":{"uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de","invoice_counter":"160","pih":"bWAQUkFyRPsFk6usMgZg0j5QAJz/CYtJp0MlyrmWODA=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000160","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"bWAQUkFyRPsFk6usMgZg0j5QAJz/CYtJp0MlyrmWODA=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 18:22:16] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 18:22:16] local.DEBUG: Running ZATCA validation  
[2025-09-22 18:22:16] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 18:22:16] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 18:22:16] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:22:16] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 18:22:16] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 18:22:16] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 18:22:16] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 18:22:16] local.INFO: Starting unsigned XML generation {"invoice_number":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de"} 
[2025-09-22 18:22:16] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 18:22:16] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000160"} 
[2025-09-22 18:22:16] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 18:22:16] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 18:22:16] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 18:22:16] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:22:16] local.DEBUG: Supplier party built successfully  
[2025-09-22 18:22:16] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 18:22:16] local.DEBUG: Buyer party built successfully  
[2025-09-22 18:22:16] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 18:22:17] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 18:22:17] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 18:22:17] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 18:22:17] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 18:22:17] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 18:22:17] local.DEBUG: Building additional document references  
[2025-09-22 18:22:17] local.DEBUG: Added ICV reference {"icv":"160"} 
[2025-09-22 18:22:17] local.DEBUG: Added PIH reference {"pih":"bWAQUkFyRPsFk6usMgZg0j5QAJz/CYtJp0MlyrmWODA="} 
[2025-09-22 18:22:17] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 18:22:17] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 18:22:17] local.DEBUG: Invoice object created successfully {"id":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:22:17] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000160-unsigned.xml","file_size":5277} 
[2025-09-22 18:22:17] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000160-unsigned.xml"} 
[2025-09-22 18:22:17] local.INFO: Signing initial XML  
[2025-09-22 18:22:17] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000160-signed-1758550937.xml"} 
[2025-09-22 18:22:17] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 18:22:17] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 18:22:17] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"Cz/J6HmnGsHAe3eipL74qxLXuIKvVE...[14 more bytes]","value_base64":"Q3ovSjZIbW5Hc0hBZTNlaXBMNzRxeExYdUlLdlZFMDhIaUlKVmJQSzZObz0="},{"tag":7,"length":96,"value_preview":"MEUCIQCQCHojzh+U/Af3ikeL7XvPTI...[66 more bytes]","value_base64":"TUVVQ0lRQ1FDSG9qemgrVS9BZjNpa2VMN1h2UFRJeS9Wc0NTSjlzVUVYUEtSYTV5Z2dJZ0dlWkd2MGQ5SThPWWVGdUJjN012TnZoa3lvRUlYS21HVGM4SjR3akFPOHM9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 18:22:17] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 18:22:17] local.DEBUG: QR code with crypto tags generated {"length":4468} 
[2025-09-22 18:22:17] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 18:22:17] local.INFO: Starting unsigned XML generation {"invoice_number":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de"} 
[2025-09-22 18:22:17] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 18:22:17] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000160"} 
[2025-09-22 18:22:17] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 18:22:17] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 18:22:17] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 18:22:17] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:22:17] local.DEBUG: Supplier party built successfully  
[2025-09-22 18:22:17] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 18:22:17] local.DEBUG: Buyer party built successfully  
[2025-09-22 18:22:17] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 18:22:17] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 18:22:17] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 18:22:17] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 18:22:17] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 18:22:17] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 18:22:17] local.DEBUG: Building additional document references  
[2025-09-22 18:22:17] local.DEBUG: Added ICV reference {"icv":"160"} 
[2025-09-22 18:22:17] local.DEBUG: Added PIH reference {"pih":"bWAQUkFyRPsFk6usMgZg0j5QAJz/CYtJp0MlyrmWODA="} 
[2025-09-22 18:22:17] local.DEBUG: Added QR reference {"qr_length":4468} 
[2025-09-22 18:22:17] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 18:22:17] local.DEBUG: Invoice object created successfully {"id":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:22:17] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000160-unsigned.xml","file_size":5277} 
[2025-09-22 18:22:17] local.INFO: Signing final XML with QR embedded  
[2025-09-22 18:22:17] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000160-signed-1758550937.xml"} 
[2025-09-22 18:22:17] local.DEBUG: Calculating final invoice hash  
[2025-09-22 18:22:17] local.DEBUG: Final invoice hash calculated {"hash":"TsnPiggMYryI6yNqLhIqGo0ZF/OX/b58d5zqcX45PEU="} 
[2025-09-22 18:22:17] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"160","invoice_hash":"TsnPiggMYryI6yNqLhIqGo0ZF/OX/b58d5zqcX45PEU="} 
[2025-09-22 18:22:17] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000160","uuid":"bb722c09-1353-40b5-8997-0e3e8c2a77de","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000160-signed-1758550937.xml"} 
[2025-09-22 18:22:17] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":160,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 18:27:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:27:49] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 18:27:49] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 18:27:49] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:27:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:27:49] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":161,"invoice_hash_stored":false,"branch_id":"2"} 
[2025-09-22 18:31:28] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:31:28] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 18:31:28] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 18:31:29] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:31:29] local.INFO: Starting unsigned XML generation {"invoice_number":"001000162","uuid":"361bba36-8f69-4c80-8a9a-3a3ece46db26"} 
[2025-09-22 18:31:29] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 18:31:29] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000162"} 
[2025-09-22 18:31:29] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 18:31:29] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 18:31:29] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 18:31:29] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:31:29] local.DEBUG: Supplier party built successfully  
[2025-09-22 18:31:29] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 18:31:29] local.DEBUG: Buyer party built successfully  
[2025-09-22 18:31:29] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 18:31:29] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 18:31:29] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 18:31:29] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 18:31:29] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 18:31:29] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 18:31:29] local.DEBUG: Building additional document references  
[2025-09-22 18:31:29] local.DEBUG: Added ICV reference {"icv":"162"} 
[2025-09-22 18:31:29] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 18:31:29] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 18:31:29] local.DEBUG: Invoice object created successfully {"id":"001000162","uuid":"361bba36-8f69-4c80-8a9a-3a3ece46db26","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:31:29] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000162-unsigned.xml","file_size":5206} 
[2025-09-22 18:31:29] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000162-unsigned.xml"} 
[2025-09-22 18:31:29] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000162-signed-1758551489.xml"} 
[2025-09-22 18:31:29] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 18:31:29] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"wTEKZctnPOM85RPQP6c+O3MW65AC7b...[14 more bytes]","value_base64":"d1RFS1pjdG5QT004NVJQUVA2YytPM01XNjVBQzdiVFBXbEhpZGlBWGh0dz0="},{"tag":7,"length":96,"value_preview":"MEYCIQClpty0OWn57wn5cPkEeriGvL...[66 more bytes]","value_base64":"TUVZQ0lRQ2xwdHkwT1duNTd3bjVjUGtFZXJpR3ZMRzJjck93TCtQeDQyZ25TT1A4SXdJaEFPcnMvaElhcHFiK0dlemlKM21jSmp0QTlhSi9YdE9OdjNQY3NPN1doWDFK"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 18:31:29] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 18:31:29] local.DEBUG: QR code with crypto tags generated {"length":4564} 
[2025-09-22 18:31:29] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":162,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 18:36:35] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:36:35] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 18:36:35] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 18:36:35] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:36:35] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 18:36:35] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 18:36:35] local.DEBUG: Applying default values to invoice data  
[2025-09-22 18:36:35] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"163","previous_invoice_hash":"Zznu5QeM095RZKxTjKxrNIPZ35d5SzVNgKt+SvufYC4=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 18:36:35] local.DEBUG: Default values applied {"result_data":{"uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112","invoice_counter":"163","pih":"Zznu5QeM095RZKxTjKxrNIPZ35d5SzVNgKt+SvufYC4=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000163","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"Zznu5QeM095RZKxTjKxrNIPZ35d5SzVNgKt+SvufYC4=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 18:36:35] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Running ZATCA validation  
[2025-09-22 18:36:35] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 18:36:35] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 18:36:35] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:36:35] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 18:36:35] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 18:36:35] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 18:36:35] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 18:36:35] local.INFO: Starting unsigned XML generation {"invoice_number":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112"} 
[2025-09-22 18:36:35] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 18:36:35] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000163"} 
[2025-09-22 18:36:35] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 18:36:35] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 18:36:35] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 18:36:35] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:36:35] local.DEBUG: Supplier party built successfully  
[2025-09-22 18:36:35] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 18:36:35] local.DEBUG: Buyer party built successfully  
[2025-09-22 18:36:35] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 18:36:35] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 18:36:35] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 18:36:35] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Building additional document references  
[2025-09-22 18:36:35] local.DEBUG: Added ICV reference {"icv":"163"} 
[2025-09-22 18:36:35] local.DEBUG: Added PIH reference {"pih":"Zznu5QeM095RZKxTjKxrNIPZ35d5SzVNgKt+SvufYC4="} 
[2025-09-22 18:36:35] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 18:36:35] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 18:36:35] local.DEBUG: Invoice object created successfully {"id":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:36:35] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000163-unsigned.xml","file_size":5277} 
[2025-09-22 18:36:35] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000163-unsigned.xml"} 
[2025-09-22 18:36:35] local.INFO: Signing initial XML  
[2025-09-22 18:36:35] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000163-signed-1758551795.xml"} 
[2025-09-22 18:36:35] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 18:36:35] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 18:36:35] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"N+j9TXIjDpOSRL5f6f/nces1DF0iRB...[14 more bytes]","value_base64":"TitqOVRYSWpEcE9TUkw1ZjZmL25jZXMxREYwaVJCSnF0Uk9MSnd1TjlwQT0="},{"tag":7,"length":96,"value_preview":"MEQCIAxgpueWmVzBQ3AyPpHC1a64hA...[66 more bytes]","value_base64":"TUVRQ0lBeGdwdWVXbVZ6QlEzQXlQcEhDMWE2NGhBRXRyVHlmMmk0Q0pDdlgrdHRYQWlCY2VsMjNnSjdLYVJxYTFJdGg0MVIzYWt4WjE4ekg4SFg5QXRuU3g3NEhuZz09"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 18:36:35] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 18:36:35] local.DEBUG: QR code with crypto tags generated {"length":4476} 
[2025-09-22 18:36:35] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 18:36:35] local.INFO: Starting unsigned XML generation {"invoice_number":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112"} 
[2025-09-22 18:36:35] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 18:36:35] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000163"} 
[2025-09-22 18:36:35] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 18:36:35] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 18:36:35] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 18:36:35] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 18:36:35] local.DEBUG: Supplier party built successfully  
[2025-09-22 18:36:35] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 18:36:35] local.DEBUG: Buyer party built successfully  
[2025-09-22 18:36:35] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 18:36:35] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 18:36:35] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 18:36:35] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 18:36:35] local.DEBUG: Building additional document references  
[2025-09-22 18:36:35] local.DEBUG: Added ICV reference {"icv":"163"} 
[2025-09-22 18:36:35] local.DEBUG: Added PIH reference {"pih":"Zznu5QeM095RZKxTjKxrNIPZ35d5SzVNgKt+SvufYC4="} 
[2025-09-22 18:36:35] local.DEBUG: Added QR reference {"qr_length":4476} 
[2025-09-22 18:36:35] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 18:36:35] local.DEBUG: Invoice object created successfully {"id":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 18:36:35] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000163-unsigned.xml","file_size":5277} 
[2025-09-22 18:36:35] local.INFO: Signing final XML with QR embedded  
[2025-09-22 18:36:35] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000163-signed-1758551795.xml"} 
[2025-09-22 18:36:35] local.DEBUG: Calculating final invoice hash  
[2025-09-22 18:36:35] local.DEBUG: Final invoice hash calculated {"hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI="} 
[2025-09-22 18:36:35] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"163","invoice_hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI="} 
[2025-09-22 18:36:35] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000163","uuid":"c030d905-cbf8-4f87-bd53-3073a4d02112","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000163-signed-1758551795.xml"} 
[2025-09-22 18:36:35] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":163,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 19:26:41] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 19:26:41] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 19:26:41] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 19:26:41] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 19:26:41] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 19:26:41] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000164","uuid":"cb675d89-0fe6-4591-945a-b36cebab9ba5","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 19:26:41] local.DEBUG: Applying default values to invoice data  
[2025-09-22 19:26:41] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000164","uuid":"cb675d89-0fe6-4591-945a-b36cebab9ba5","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"164","previous_invoice_hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 19:26:41] local.DEBUG: Default values applied {"result_data":{"uuid":"cb675d89-0fe6-4591-945a-b36cebab9ba5","invoice_counter":"164","pih":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000164","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 19:26:41] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 19:26:41] local.DEBUG: Running ZATCA validation  
[2025-09-22 19:26:41] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 19:26:41] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 19:26:41] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 19:26:41] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 19:26:41] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 19:26:41] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 19:26:41] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 19:26:41] local.INFO: Starting unsigned XML generation {"invoice_number":"001000164","uuid":"cb675d89-0fe6-4591-945a-b36cebab9ba5"} 
[2025-09-22 19:26:41] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 19:26:41] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000164"} 
[2025-09-22 19:26:41] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 19:26:41] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 19:26:41] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 19:26:41] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 19:26:41] local.DEBUG: Supplier party built successfully  
[2025-09-22 19:26:41] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 19:26:41] local.DEBUG: Buyer party built successfully  
[2025-09-22 19:26:41] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 19:26:41] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 19:26:41] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 19:26:41] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 19:26:41] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 19:26:41] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 19:26:41] local.DEBUG: Building additional document references  
[2025-09-22 19:26:41] local.DEBUG: Added ICV reference {"icv":"164"} 
[2025-09-22 19:26:41] local.DEBUG: Added PIH reference {"pih":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI="} 
[2025-09-22 19:26:41] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-22 19:26:41] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(543): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(196): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3235): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#50 {main}","invoice_data":{"uuid":"cb675d89-0fe6-4591-945a-b36cebab9ba5","invoice_counter":"164","pih":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000164","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 19:26:41] local.ERROR: Failed to generate initial unsigned XML  
[2025-09-22 20:21:25] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:21:28] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:21:28] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:21:31] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:21:31] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:21:31] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 20:21:31] local.DEBUG: Applying default values to invoice data  
[2025-09-22 20:21:31] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"164","previous_invoice_hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 20:21:31] local.DEBUG: Default values applied {"result_data":{"uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225","invoice_counter":"164","pih":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000164","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 20:21:31] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 20:21:31] local.DEBUG: Running ZATCA validation  
[2025-09-22 20:21:31] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 20:21:31] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 20:21:31] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:21:31] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 20:21:31] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 20:21:31] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 20:21:31] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 20:21:31] local.INFO: Starting unsigned XML generation {"invoice_number":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225"} 
[2025-09-22 20:21:31] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:21:31] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000164"} 
[2025-09-22 20:21:31] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:21:31] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:21:31] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:21:31] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:21:31] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:21:31] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:21:31] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:21:31] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:21:31] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:21:31] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:21:31] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:21:31] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:21:31] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:21:31] local.DEBUG: Building additional document references  
[2025-09-22 20:21:31] local.DEBUG: Added ICV reference {"icv":"164"} 
[2025-09-22 20:21:31] local.DEBUG: Added PIH reference {"pih":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI="} 
[2025-09-22 20:21:31] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:21:31] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 20:21:31] local.DEBUG: Invoice object created successfully {"id":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:21:32] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000164-unsigned.xml","file_size":5277} 
[2025-09-22 20:21:32] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000164-unsigned.xml"} 
[2025-09-22 20:21:32] local.INFO: Signing initial XML  
[2025-09-22 20:21:32] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000164-signed-1758558092.xml"} 
[2025-09-22 20:21:32] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 20:21:32] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:21:32] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"lsiKMAjEQLXas8kW+z4WRM5RAAxBF7...[14 more bytes]","value_base64":"bHNpS01BakVRTFhhczhrVyt6NFdSTTVSQUF4QkY3RFU3aVpoMFNTRVB3ST0="},{"tag":7,"length":96,"value_preview":"MEYCIQC8UarRJboNdsj3mh/hLYbcF7...[66 more bytes]","value_base64":"TUVZQ0lRQzhVYXJSSmJvTmRzajNtaC9oTFliY0Y3SU4xM1B4SkRmUk5wU1dHRXBxaWdJaEFOdWdjcVNrWHQ3K2lyd2ZqL1N3UmR1N2pqeTdmcVhiOEU1WWdCL21jZkcv"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:21:32] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:21:33] local.DEBUG: QR code with crypto tags generated {"length":4560} 
[2025-09-22 20:21:33] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 20:21:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225"} 
[2025-09-22 20:21:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:21:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000164"} 
[2025-09-22 20:21:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:21:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:21:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:21:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:21:33] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:21:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:21:33] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:21:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:21:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:21:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:21:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:21:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:21:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:21:33] local.DEBUG: Building additional document references  
[2025-09-22 20:21:33] local.DEBUG: Added ICV reference {"icv":"164"} 
[2025-09-22 20:21:33] local.DEBUG: Added PIH reference {"pih":"xeeGUowQlEk4nPGs6pAYJw6HckrAl1x+oUSDEumjkpI="} 
[2025-09-22 20:21:33] local.DEBUG: Added QR reference {"qr_length":4560} 
[2025-09-22 20:21:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 20:21:33] local.DEBUG: Invoice object created successfully {"id":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:21:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000164-unsigned.xml","file_size":5277} 
[2025-09-22 20:21:33] local.INFO: Signing final XML with QR embedded  
[2025-09-22 20:21:33] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000164-signed-1758558093.xml"} 
[2025-09-22 20:21:33] local.DEBUG: Calculating final invoice hash  
[2025-09-22 20:21:33] local.DEBUG: Final invoice hash calculated {"hash":"r5DEi7YFjT4Rarp5uzpGp2D8VgWee4YN4K3il8yoA34="} 
[2025-09-22 20:21:33] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"164","invoice_hash":"r5DEi7YFjT4Rarp5uzpGp2D8VgWee4YN4K3il8yoA34="} 
[2025-09-22 20:21:33] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000164","uuid":"47c90a0d-2aa8-469e-9a86-ccf421eab225","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000164-signed-1758558093.xml"} 
[2025-09-22 20:21:33] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":164,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 20:24:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:24:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:24:45] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:24:45] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:24:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:24:45] local.INFO: Starting unsigned XML generation {"invoice_number":"001000165","uuid":"7b041bd1-ecec-49a0-a5b5-927a766b259d"} 
[2025-09-22 20:24:45] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:24:45] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000165"} 
[2025-09-22 20:24:45] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:24:45] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:24:45] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:24:45] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:24:45] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:24:45] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:24:45] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:24:45] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:24:45] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:24:45] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:24:45] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:24:45] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:24:45] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:24:45] local.DEBUG: Building additional document references  
[2025-09-22 20:24:45] local.DEBUG: Added ICV reference {"icv":"165"} 
[2025-09-22 20:24:45] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:24:45] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 20:24:45] local.DEBUG: Invoice object created successfully {"id":"001000165","uuid":"7b041bd1-ecec-49a0-a5b5-927a766b259d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:24:45] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000165-unsigned.xml","file_size":5206} 
[2025-09-22 20:24:45] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000165-unsigned.xml"} 
[2025-09-22 20:24:46] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000165-signed-1758558286.xml"} 
[2025-09-22 20:24:46] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:24:46] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"enWtoA5gwqBQHtWKz5X2paT8ky/ckS...[14 more bytes]","value_base64":"ZW5XdG9BNWd3cUJRSHRXS3o1WDJwYVQ4a3kvY2tTaUNoUXZMU3lmTTZzbz0="},{"tag":7,"length":96,"value_preview":"MEUCIFXFT6/V93KM0p9oclBo+h1C2L...[66 more bytes]","value_base64":"TUVVQ0lGWEZUNi9WOTNLTTBwOW9jbEJvK2gxQzJMNFBNRlo5L2ZsNWxMdjkyVGNSQWlFQTlJTndWdGJ5Q05yUG9DdjMvQ2pHSGZITDNjMUs3WEN0bThqNXR4VnNnUVE9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:24:46] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:24:46] local.DEBUG: QR code with crypto tags generated {"length":4508} 
[2025-09-22 20:24:46] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":165,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 20:30:12] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:30:12] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:30:12] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:30:12] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:30:12] local.INFO: Starting unsigned XML generation {"invoice_number":"001000166","uuid":"b9440a09-1903-4678-87b4-82ceb27d6344"} 
[2025-09-22 20:30:12] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:30:12] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000166"} 
[2025-09-22 20:30:12] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:30:12] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:30:12] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:30:12] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:30:12] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:30:12] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:30:12] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:30:12] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:30:12] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:30:12] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:30:12] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:30:12] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:30:12] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:30:12] local.DEBUG: Building additional document references  
[2025-09-22 20:30:12] local.DEBUG: Added ICV reference {"icv":"166"} 
[2025-09-22 20:30:12] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:30:12] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 20:30:12] local.DEBUG: Invoice object created successfully {"id":"001000166","uuid":"b9440a09-1903-4678-87b4-82ceb27d6344","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:30:12] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000166-unsigned.xml","file_size":5206} 
[2025-09-22 20:30:12] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000166-unsigned.xml"} 
[2025-09-22 20:30:12] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000166-signed-1758558612.xml"} 
[2025-09-22 20:30:12] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:30:12] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"kxK2HIcuVnHxZVARkvY2+HZP7BK7NW...[14 more bytes]","value_base64":"a3hLMkhJY3VWbkh4WlZBUmt2WTIrSFpQN0JLN05XL1FNbjU3Qlk3bGxuWT0="},{"tag":7,"length":96,"value_preview":"MEYCIQDINut8UrXwT1QRK1TE3G6LG9...[66 more bytes]","value_base64":"TUVZQ0lRRElOdXQ4VXJYd1QxUVJLMVRFM0c2TEc5WTBEd0Y4dUx4TThqN0NjY3FSVXdJaEFQNXlwTlhQUHNIQXVGTXVuZ1NRcFM0WVFscm9ENnFMQVhhWmdFYTNZeDdC"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:30:12] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:30:12] local.DEBUG: QR code with crypto tags generated {"length":4564} 
[2025-09-22 20:30:12] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":166,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 20:43:22] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:43:58] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:44:11] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:44:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:44:50] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:44:50] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:44:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:44:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000167","uuid":"703fd423-9f3d-420c-9ec0-eaba40ffb477"} 
[2025-09-22 20:44:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:44:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000167"} 
[2025-09-22 20:44:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:44:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:44:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:44:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:44:50] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:44:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:44:50] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:44:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:44:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:44:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:44:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:44:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:44:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:44:50] local.DEBUG: Building additional document references  
[2025-09-22 20:44:50] local.DEBUG: Added ICV reference {"icv":"167"} 
[2025-09-22 20:44:50] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:44:50] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 20:44:50] local.DEBUG: Invoice object created successfully {"id":"001000167","uuid":"703fd423-9f3d-420c-9ec0-eaba40ffb477","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:44:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000167-unsigned.xml","file_size":5206} 
[2025-09-22 20:44:50] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000167-unsigned.xml"} 
[2025-09-22 20:44:50] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000167-signed-1758559490.xml"} 
[2025-09-22 20:44:50] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:44:50] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"NCdIZxN6pOQV6hYI15kfALrSIkv2qH...[14 more bytes]","value_base64":"TkNkSVp4TjZwT1FWNmhZSTE1a2ZBTHJTSWt2MnFISktpUC9pTjdxN3RMMD0="},{"tag":7,"length":96,"value_preview":"MEYCIQC6rCItWPswI3Kk/rmp/7bW+h...[66 more bytes]","value_base64":"TUVZQ0lRQzZyQ0l0V1Bzd0kzS2svcm1wLzdiVytocWdFRXBweHg2WXpJampURnVjRmdJaEFNQnRIOXNYRGZ5Y291WWxiRUc0M1FiOWJFeHYvWGlYd0V4M3l6b25VVW9V"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:44:50] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:44:50] local.DEBUG: QR code with crypto tags generated {"length":4552} 
[2025-09-22 20:44:50] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":167,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 20:58:56] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:58:56] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:58:56] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:58:56] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:58:56] local.INFO: Starting unsigned XML generation {"invoice_number":"001000168","uuid":"e845d33c-5d56-4724-b01f-6cf8fae638ad"} 
[2025-09-22 20:58:56] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:58:56] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000168"} 
[2025-09-22 20:58:56] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:58:56] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:58:56] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:58:56] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:58:56] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:58:56] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:58:56] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:58:56] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:58:56] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:58:56] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:58:56] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:58:56] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:58:56] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:58:56] local.DEBUG: Building additional document references  
[2025-09-22 20:58:56] local.DEBUG: Added ICV reference {"icv":"168"} 
[2025-09-22 20:58:56] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:58:56] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 20:58:56] local.DEBUG: Invoice object created successfully {"id":"001000168","uuid":"e845d33c-5d56-4724-b01f-6cf8fae638ad","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:58:56] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000168-unsigned.xml","file_size":5206} 
[2025-09-22 20:58:56] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000168-unsigned.xml"} 
[2025-09-22 20:58:56] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000168-signed-1758560336.xml"} 
[2025-09-22 20:58:56] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:58:56] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"TQ+fiUAbVdAot3kbCp6UEuE3u/e0bE...[14 more bytes]","value_base64":"VFErZmlVQWJWZEFvdDNrYkNwNlVFdUUzdS9lMGJFWGVrTUY2MEV0SDFBTT0="},{"tag":7,"length":96,"value_preview":"MEUCIQDcFBtpPdW4uRfLq6NZga/LmT...[66 more bytes]","value_base64":"TUVVQ0lRRGNGQnRwUGRXNHVSZkxxNk5aZ2EvTG1UVUhMY09OYWQzZ3ZRa04vejU3YWdJZ1M1ZmVCdUFhSjRuZmF1MS85dmtndzdhWTVNL0padnBsUUg3Z1JrK1B4ZUE9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:58:56] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:58:56] local.DEBUG: QR code with crypto tags generated {"length":4496} 
[2025-09-22 20:58:56] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":168,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 20:59:23] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:59:23] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:59:23] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:59:23] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:59:23] local.INFO: Starting unsigned XML generation {"invoice_number":"001000169","uuid":"05d7e807-28e3-4c93-84be-57f17db3ea95"} 
[2025-09-22 20:59:23] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:59:23] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000169"} 
[2025-09-22 20:59:23] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:59:23] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:59:23] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:59:23] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:59:23] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:59:23] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:59:23] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:59:23] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:59:23] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:59:23] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:59:23] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:59:23] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:59:23] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:59:23] local.DEBUG: Building additional document references  
[2025-09-22 20:59:23] local.DEBUG: Added ICV reference {"icv":"169"} 
[2025-09-22 20:59:23] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:59:23] local.DEBUG: Additional document references built {"count":2} 
[2025-09-22 20:59:23] local.DEBUG: Invoice object created successfully {"id":"001000169","uuid":"05d7e807-28e3-4c93-84be-57f17db3ea95","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:59:23] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000169-unsigned.xml","file_size":5206} 
[2025-09-22 20:59:23] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000169-unsigned.xml"} 
[2025-09-22 20:59:23] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000169-signed-1758560363.xml"} 
[2025-09-22 20:59:23] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:59:23] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"PxRkWxL2app/IGt5IxR2yMiVxQqrnT...[14 more bytes]","value_base64":"UHhSa1d4TDJhcHAvSUd0NUl4UjJ5TWlWeFFxcm5UT2FZTC81U042TjFFVT0="},{"tag":7,"length":96,"value_preview":"MEYCIQCFL6oWTIkhQTrswcaM4rR6L9...[66 more bytes]","value_base64":"TUVZQ0lRQ0ZMNm9XVElraFFUcnN3Y2FNNHJSNkw5WXhNZEp0cXBPVWI5QXNyMFRMV2dJaEFKbHp1NFo1OWJYeWplRnN4QUVTR0t6QzBzNXRkZHl6ZWRTaGNXMmVNYzlJ"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:59:23] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:59:23] local.DEBUG: QR code with crypto tags generated {"length":4416} 
[2025-09-22 20:59:23] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":169,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 20:59:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:59:33] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 20:59:33] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 20:59:33] local.DEBUG: Generated TLV for XML embedding {"tlv_length":84,"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:59:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 20:59:33] local.INFO: Starting ZATCA invoice generation {"invoice_number":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14","has_certificate":true,"branch_number":"0010"} 
[2025-09-22 20:59:33] local.DEBUG: Applying default values to invoice data  
[2025-09-22 20:59:33] local.DEBUG: Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"170","previous_invoice_hash":"RD1LpqimJpfIWGHGXxs+QkGLGt67r6NyUrM+uN/FTdc=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 20:59:33] local.DEBUG: Default values applied {"result_data":{"uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14","invoice_counter":"170","pih":"RD1LpqimJpfIWGHGXxs+QkGLGt67r6NyUrM+uN/FTdc=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"id":"PLEX35IN","invoice_number":"001000170","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"RD1LpqimJpfIWGHGXxs+QkGLGt67r6NyUrM+uN/FTdc=","pricing_type":"inclusive","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 20:59:33] local.DEBUG: Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Running ZATCA validation  
[2025-09-22 20:59:33] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-09-22 20:59:33] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-09-22 20:59:33] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:59:33] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-09-22 20:59:33] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-09-22 20:59:33] local.DEBUG: ZATCA validation passed {"warnings":[]} 
[2025-09-22 20:59:33] local.INFO: Generating initial unsigned XML (without QR)  
[2025-09-22 20:59:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14"} 
[2025-09-22 20:59:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:59:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000170"} 
[2025-09-22 20:59:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:59:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:59:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:59:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:59:33] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:59:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:59:33] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:59:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:59:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:59:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:59:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Building additional document references  
[2025-09-22 20:59:33] local.DEBUG: Added ICV reference {"icv":"170"} 
[2025-09-22 20:59:33] local.DEBUG: Added PIH reference {"pih":"RD1LpqimJpfIWGHGXxs+QkGLGt67r6NyUrM+uN/FTdc="} 
[2025-09-22 20:59:33] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 20:59:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 20:59:33] local.DEBUG: Invoice object created successfully {"id":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:59:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000170-unsigned.xml","file_size":5277} 
[2025-09-22 20:59:33] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000170-unsigned.xml"} 
[2025-09-22 20:59:33] local.INFO: Signing initial XML  
[2025-09-22 20:59:33] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000170-signed-1758560373.xml"} 
[2025-09-22 20:59:33] local.INFO: Generating QR code with cryptographic tags  
[2025-09-22 20:59:33] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 20:59:33] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"jecqFDcmNR0fua09i2S4ecS6KRGT22...[14 more bytes]","value_base64":"amVjcUZEY21OUjBmdWEwOWkyUzRlY1M2S1JHVDIyNjJzU0ljY3RHcHNZZz0="},{"tag":7,"length":96,"value_preview":"MEUCIQCtWZWixyMsFpae/xgtWPGe2i...[66 more bytes]","value_base64":"TUVVQ0lRQ3RXWldpeHlNc0ZwYWUveGd0V1BHZTJpdGRpMURJWUswT3dwU21Ib2xCM0FJZ0hrQys1NUF2VklFV0s1UEtzSjVzeHM0YUlVRUlmRzFwOGZjcW91WS9maW89"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 20:59:33] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 20:59:33] local.DEBUG: QR code with crypto tags generated {"length":4548} 
[2025-09-22 20:59:33] local.INFO: Generating final unsigned XML with QR code  
[2025-09-22 20:59:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14"} 
[2025-09-22 20:59:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 20:59:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000170"} 
[2025-09-22 20:59:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 20:59:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 20:59:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 20:59:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 20:59:33] local.DEBUG: Supplier party built successfully  
[2025-09-22 20:59:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 20:59:33] local.DEBUG: Buyer party built successfully  
[2025-09-22 20:59:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 20:59:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 20:59:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 20:59:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 20:59:33] local.DEBUG: Building additional document references  
[2025-09-22 20:59:33] local.DEBUG: Added ICV reference {"icv":"170"} 
[2025-09-22 20:59:33] local.DEBUG: Added PIH reference {"pih":"RD1LpqimJpfIWGHGXxs+QkGLGt67r6NyUrM+uN/FTdc="} 
[2025-09-22 20:59:33] local.DEBUG: Added QR reference {"qr_length":4548} 
[2025-09-22 20:59:33] local.DEBUG: Additional document references built {"count":3} 
[2025-09-22 20:59:33] local.DEBUG: Invoice object created successfully {"id":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 20:59:34] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000170-unsigned.xml","file_size":5277} 
[2025-09-22 20:59:34] local.INFO: Signing final XML with QR embedded  
[2025-09-22 20:59:34] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000170-signed-1758560374.xml"} 
[2025-09-22 20:59:34] local.DEBUG: Calculating final invoice hash  
[2025-09-22 20:59:34] local.DEBUG: Final invoice hash calculated {"hash":"bNmzYuXxLa6u790Mt4YHAJJHRzU5Qx7GBO9yyc62lnw="} 
[2025-09-22 20:59:34] local.INFO: Branch invoice state updated {"branch_id":2,"invoice_counter":"170","invoice_hash":"bNmzYuXxLa6u790Mt4YHAJJHRzU5Qx7GBO9yyc62lnw="} 
[2025-09-22 20:59:34] local.INFO: ZATCA invoice generation completed successfully {"invoice_number":"001000170","uuid":"fd918066-fb0f-4719-adb0-1e04d07c7a14","final_xml_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000170-signed-1758560374.xml"} 
[2025-09-22 20:59:34] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":170,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 21:31:11] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 21:31:11] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 21:31:11] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 21:31:11] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 21:31:11] local.INFO: Starting unsigned XML generation {"invoice_number":"001000171","uuid":"d36c0c87-7c9e-497f-a0cc-b4118d46ff2f"} 
[2025-09-22 21:31:11] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 21:31:11] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000171"} 
[2025-09-22 21:31:11] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 21:31:11] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 21:31:11] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 21:31:11] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 21:31:11] local.DEBUG: Supplier party built successfully  
[2025-09-22 21:31:11] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 21:31:11] local.DEBUG: Buyer party built successfully  
[2025-09-22 21:31:11] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 21:31:11] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 21:31:11] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 21:31:11] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 21:31:11] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 21:31:11] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 21:31:11] local.DEBUG: Building additional document references  
[2025-09-22 21:31:11] local.DEBUG: Added ICV reference {"icv":"171"} 
[2025-09-22 21:31:11] local.DEBUG: Added QR reference {"qr_length":84} 
[2025-09-22 21:31:11] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"171"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-22 21:31:11] local.DEBUG: Invoice object created successfully {"id":"001000171","uuid":"d36c0c87-7c9e-497f-a0cc-b4118d46ff2f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 21:31:11] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000171-unsigned.xml","file_size":5241} 
[2025-09-22 21:31:11] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000171-unsigned.xml"} 
[2025-09-22 21:31:11] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000171-signed-1758562271.xml"} 
[2025-09-22 21:31:11] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 21:31:11] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"q5/YKLNLuBhtYouErmS3TP/Vc4QLa6...[14 more bytes]","value_base64":"cTUvWUtMTkx1Qmh0WW91RXJtUzNUUC9WYzRRTGE2OVBmOG5tT0c4SWlCYz0="},{"tag":7,"length":96,"value_preview":"MEYCIQClpE9JwI0KbOHDLgrrGd7nLj...[66 more bytes]","value_base64":"TUVZQ0lRQ2xwRTlKd0kwS2JPSERMZ3JyR2Q3bkxqNG5kelhiT2I2b0hjTWpINEtzaWdJaEFLNDZlWHZsbTV5NFFzL1BXTCtiL3UwRi80azVYWWFJdEJVRlkvSkJkdjJZ"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 21:31:11] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 21:31:11] local.DEBUG: QR code with crypto tags generated {"length":4488} 
[2025-09-22 21:31:11] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":171,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 21:45:13] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 21:45:13] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 21:45:13] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 21:45:13] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 21:45:13] local.INFO: Starting unsigned XML generation {"invoice_number":"001000172","uuid":"49f7f25d-d9c5-4adc-b700-6a9b2720e7d7"} 
[2025-09-22 21:45:13] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 21:45:13] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000172"} 
[2025-09-22 21:45:13] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 21:45:13] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 21:45:13] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 21:45:13] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 21:45:13] local.DEBUG: Supplier party built successfully  
[2025-09-22 21:45:13] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 21:45:13] local.DEBUG: Buyer party built successfully  
[2025-09-22 21:45:13] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 21:45:13] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 21:45:13] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 21:45:13] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 21:45:13] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 21:45:13] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 21:45:13] local.DEBUG: Building additional document references  
[2025-09-22 21:45:13] local.DEBUG: Added ICV reference {"icv":"172"} 
[2025-09-22 21:45:13] local.DEBUG: Added QR reference with manual structure {"qr_length":84} 
[2025-09-22 21:45:13] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"172"},{"id":"QR","uuid":null}]} 
[2025-09-22 21:45:13] local.DEBUG: Invoice object created successfully {"id":"001000172","uuid":"49f7f25d-d9c5-4adc-b700-6a9b2720e7d7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 21:45:13] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000172-unsigned.xml","file_size":5133} 
[2025-09-22 21:45:13] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000172-unsigned.xml"} 
[2025-09-22 21:45:13] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000172-signed-1758563113.xml"} 
[2025-09-22 21:45:13] local.INFO: Generating QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 21:45:13] local.DEBUG: TLV structure detailed analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","value_base64":"TmV0cGxleCA="},{"tag":2,"length":15,"value_preview":"312345678930003","value_base64":"MzEyMzQ1Njc4OTMwMDAz"},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","value_base64":"MjAyNS0wOS0xMVQxOToyNDoyMFo="},{"tag":4,"length":5,"value_preview":"45.00","value_base64":"NDUuMDA="},{"tag":5,"length":4,"value_preview":"2.14","value_base64":"Mi4xNA=="},{"tag":6,"length":44,"value_preview":"OSwHY86k0hQHAl/Y82xxO0GrpZ9Vof...[14 more bytes]","value_base64":"T1N3SFk4NmswaFFIQWwvWTgyeHhPMEdycFo5Vm9mREpFT2dGZjNWdVd6dz0="},{"tag":7,"length":96,"value_preview":"MEUCIDN7J0fEUS3nwsj7Mv8B36qNhx...[66 more bytes]","value_base64":"TUVVQ0lETjdKMGZFVVMzbndzajdNdjhCMzZxTmh4bHBDazk5U2hRdGdTUC91ZDBxQWlFQXZodlgrNlptWGVMV0Nhajd4MXFteVhiYXUzZUJPbkdTdVdjekc1dm1NU0E9"},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","value_base64":"TUZZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUFvRFFnQUVKNDVlcVRHWnR2cTV4Y0wxUFN6WEJ3L3NRcWNFQk0vWHNjajVSWThnQUsyTE9SYjJzTmp4M2J2TUVWWXA4U1BJVmZ5ZG5SWm1nNjZyRXRwUGZqNWJlZz09"},{"tag":9,"length":44,"value_preview":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[14 more bytes]","value_base64":"QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQT0="}]} 
[2025-09-22 21:45:13] local.DEBUG: Complete TLV generated with crypto tags {"length":374,"tags_present":[1,2,3,4,5,6,7,8,9],"invoice_hash_length":44,"signature_length":96,"public_key_length":120} 
[2025-09-22 21:45:13] local.DEBUG: QR code with crypto tags generated {"length":4548} 
[2025-09-22 21:45:13] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":172,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 21:51:01] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 21:51:01] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 21:51:01] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 21:51:01] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 21:51:01] local.INFO: Starting unsigned XML generation {"invoice_number":"001000173","uuid":"07dbeebb-4bbd-4c9d-9bc2-bac4e73d7209"} 
[2025-09-22 21:51:01] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 21:51:01] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000173"} 
[2025-09-22 21:51:01] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 21:51:01] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 21:51:01] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 21:51:01] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 21:51:01] local.DEBUG: Supplier party built successfully  
[2025-09-22 21:51:01] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 21:51:01] local.DEBUG: Buyer party built successfully  
[2025-09-22 21:51:01] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 21:51:01] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 21:51:01] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 21:51:01] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 21:51:01] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 21:51:01] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 21:51:01] local.DEBUG: Building additional document references  
[2025-09-22 21:51:01] local.DEBUG: Added ICV reference {"icv":"173"} 
[2025-09-22 21:51:01] local.DEBUG: Added QR reference with manual structure {"qr_length":84} 
[2025-09-22 21:51:01] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"173"},{"id":"QR","uuid":null}]} 
[2025-09-22 21:51:01] local.DEBUG: Invoice object created successfully {"id":"001000173","uuid":"07dbeebb-4bbd-4c9d-9bc2-bac4e73d7209","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 21:51:01] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000173-unsigned.xml","file_size":5133} 
[2025-09-22 21:51:01] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000173-unsigned.xml"} 
[2025-09-22 21:51:01] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000173-signed-1758563461.xml"} 
[2025-09-22 21:51:01] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 21:51:01] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-22 21:51:01] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-22 21:51:01] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"%N*M24$=m\u000b\u001b\fo^\u0000\u0013...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 \tE\u0000~>!f\u0015\"\"R\u0010...[40 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-22 21:51:01] local.DEBUG: ZATCA-compliant TLV generated {"total_length":324,"tags_present":[1,2,3,4,5,6,7,8,9],"tag6_is_binary":true,"tag7_is_binary":true,"tag8_is_binary":true} 
[2025-09-22 21:51:01] local.ERROR: QR code image generation failed {"error":"Could not encode content to UTF-8"} 
[2025-09-22 21:51:01] local.ERROR: ZATCA QR generation failed {"error":"QR code image generation failed: Could not encode content to UTF-8","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceQrGenerator.php(341): App\\Services\\Zatca\\InvoiceQrGenerator->generateQrCodeImage('\\x01\\x08Netplex \\x02\\x0F312...')
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3251): App\\Services\\Zatca\\InvoiceQrGenerator->generateBase64WithCrypto('<?xml version=\"...', Object(Saleh7\\Zatca\\Helpers\\Certificate), Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}"} 
[2025-09-22 21:51:01] local.ERROR: ZATCA generation process failed: ZATCA QR generation failed: QR code image generation failed: Could not encode content to UTF-8 {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3251): App\\Services\\Zatca\\InvoiceQrGenerator->generateBase64WithCrypto('<?xml version=\"...', Object(Saleh7\\Zatca\\Helpers\\Certificate), Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-22 22:05:05] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:05:05] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 22:05:05] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 22:05:05] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:05:05] local.INFO: Starting unsigned XML generation {"invoice_number":"001000173","uuid":"f1df6046-562b-418a-9606-2106d1414dfe"} 
[2025-09-22 22:05:05] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 22:05:05] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000173"} 
[2025-09-22 22:05:05] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 22:05:05] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 22:05:05] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 22:05:05] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 22:05:05] local.DEBUG: Supplier party built successfully  
[2025-09-22 22:05:05] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 22:05:05] local.DEBUG: Buyer party built successfully  
[2025-09-22 22:05:05] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 22:05:05] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 22:05:05] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 22:05:05] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 22:05:05] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 22:05:05] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 22:05:05] local.DEBUG: Building additional document references  
[2025-09-22 22:05:05] local.DEBUG: Added ICV reference {"icv":"173"} 
[2025-09-22 22:05:05] local.DEBUG: Added QR reference with manual structure {"qr_length":84} 
[2025-09-22 22:05:05] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"173"},{"id":"QR","uuid":null}]} 
[2025-09-22 22:05:05] local.DEBUG: Invoice object created successfully {"id":"001000173","uuid":"f1df6046-562b-418a-9606-2106d1414dfe","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 22:05:05] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000173-unsigned.xml","file_size":5133} 
[2025-09-22 22:05:05] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000173-unsigned.xml"} 
[2025-09-22 22:05:05] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000173-signed-1758564305.xml"} 
[2025-09-22 22:05:05] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 22:05:05] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-22 22:05:05] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-22 22:05:05] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"D]
R\fU/\u0000Q_K4\u0007I:...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000}A\u000fa4\u0018,_|1Fb\u00077...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-22 22:05:05] local.DEBUG: ZATCA-compliant TLV generated {"total_length":326,"tags_present":[1,2,3,4,5,6,7,8,9],"tag6_is_binary":true,"tag7_is_binary":true,"tag8_is_binary":true} 
[2025-09-22 22:05:05] local.DEBUG: QR code with crypto tags generated {"length":4872} 
[2025-09-22 22:05:05] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":173,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 22:10:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:10:24] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 22:10:24] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 22:10:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:10:24] local.INFO: Starting unsigned XML generation {"invoice_number":"001000174","uuid":"94cf9604-cfd3-4a09-b0af-20d277374b9a"} 
[2025-09-22 22:10:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 22:10:24] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000174"} 
[2025-09-22 22:10:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 22:10:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 22:10:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 22:10:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 22:10:24] local.DEBUG: Supplier party built successfully  
[2025-09-22 22:10:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 22:10:24] local.DEBUG: Buyer party built successfully  
[2025-09-22 22:10:24] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 22:10:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 22:10:24] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 22:10:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 22:10:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 22:10:24] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 22:10:24] local.DEBUG: Building additional document references  
[2025-09-22 22:10:24] local.DEBUG: Added ICV reference {"icv":"174"} 
[2025-09-22 22:10:24] local.DEBUG: Added QR reference with manual structure {"qr_length":84} 
[2025-09-22 22:10:24] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"174"},{"id":"QR","uuid":null}]} 
[2025-09-22 22:10:24] local.DEBUG: Invoice object created successfully {"id":"001000174","uuid":"94cf9604-cfd3-4a09-b0af-20d277374b9a","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 22:10:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000174-unsigned.xml","file_size":5133} 
[2025-09-22 22:10:24] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000174-unsigned.xml"} 
[2025-09-22 22:10:24] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000174-signed-1758564624.xml"} 
[2025-09-22 22:10:24] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 22:10:24] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-22 22:10:24] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-22 22:10:24] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"$!\u0007H\u000f5)'\u0015TB...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 PEVpo'\u001c3,BI
)...[40 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-22 22:10:24] local.DEBUG: ZATCA-compliant TLV generated {"total_length":324,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-22 22:10:24] local.DEBUG: QR code with crypto tags generated {"length":4884} 
[2025-09-22 22:10:24] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":174,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 22:15:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:15:47] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 22:15:47] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 22:15:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:15:47] local.INFO: Starting unsigned XML generation {"invoice_number":"001000175","uuid":"e72bea1d-11ae-4cd7-802e-4b86f96c7b21"} 
[2025-09-22 22:15:47] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 22:15:47] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000175"} 
[2025-09-22 22:15:47] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 22:15:47] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 22:15:47] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 22:15:47] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 22:15:47] local.DEBUG: Supplier party built successfully  
[2025-09-22 22:15:47] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 22:15:47] local.DEBUG: Buyer party built successfully  
[2025-09-22 22:15:47] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 22:15:47] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 22:15:47] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 22:15:47] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 22:15:47] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 22:15:47] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 22:15:47] local.DEBUG: Building additional document references  
[2025-09-22 22:15:47] local.DEBUG: Added ICV reference {"icv":"175"} 
[2025-09-22 22:15:47] local.DEBUG: Added QR reference with proper structure {"qr_length":84} 
[2025-09-22 22:15:47] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"175"},{"id":"QR","uuid":null}]} 
[2025-09-22 22:15:47] local.DEBUG: Invoice object created successfully {"id":"001000175","uuid":"e72bea1d-11ae-4cd7-802e-4b86f96c7b21","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 22:15:47] local.ERROR: XML generation failed {"error":"Attachment must have a filePath, an externalReference, or a fileContent","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\Attachment.php(158): Saleh7\\Zatca\\Attachment->validate()
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\Attachment->xmlSerialize(Object(Sabre\\Xml\\Writer))
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\Attachment))
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\Attachment))
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\AdditionalDocumentReference.php(151): Sabre\\Xml\\Writer->write(Array)
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\AdditionalDocumentReference->xmlSerialize(Object(Sabre\\Xml\\Writer))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#10 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\ZatcaInvoice.php(232): Sabre\\Xml\\Writer->write(Array)
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): App\\Services\\Zatca\\ZatcaInvoice->xmlSerialize(Object(Sabre\\Xml\\Writer))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(App\\Services\\Zatca\\ZatcaInvoice))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(191): Sabre\\Xml\\Writer->write(Object(App\\Services\\Zatca\\ZatcaInvoice))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Service.php(224): Sabre\\Xml\\Writer->writeElement('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#15 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(598): Sabre\\Xml\\Service->write('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#16 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#48 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#50 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#51 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#52 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#53 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#54 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#55 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#56 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#57 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#58 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#59 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#60 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#61 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#62 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#63 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#64 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000175","uuid":"e72bea1d-11ae-4cd7-802e-4b86f96c7b21","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"175","previous_invoice_hash":"0b0BBfK9UQyghCXLNN2HhHHfemuItX+vRBQ3crRkMqo=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-22 22:15:47] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-22 22:20:29] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:20:31] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 22:20:31] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 22:20:35] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:20:35] local.INFO: Starting unsigned XML generation {"invoice_number":"001000175","uuid":"8db2f4b7-47ec-4a8a-b185-5b93fe7f097e"} 
[2025-09-22 22:20:35] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 22:20:35] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000175"} 
[2025-09-22 22:20:35] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 22:20:35] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 22:20:35] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 22:20:35] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 22:20:35] local.DEBUG: Supplier party built successfully  
[2025-09-22 22:20:35] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 22:20:35] local.DEBUG: Buyer party built successfully  
[2025-09-22 22:20:35] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 22:20:35] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 22:20:35] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 22:20:35] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 22:20:35] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 22:20:35] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 22:20:35] local.DEBUG: Building additional document references  
[2025-09-22 22:20:35] local.DEBUG: Added ICV reference {"icv":"175"} 
[2025-09-22 22:20:35] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-22 22:20:35] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"175"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-22 22:20:36] local.DEBUG: Invoice object created successfully {"id":"001000175","uuid":"8db2f4b7-47ec-4a8a-b185-5b93fe7f097e","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 22:20:36] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000175-unsigned.xml","file_size":5241} 
[2025-09-22 22:20:36] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000175-unsigned.xml"} 
[2025-09-22 22:20:36] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000175-signed-1758565236.xml"} 
[2025-09-22 22:20:36] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 22:20:36] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-22 22:20:36] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-22 22:20:36] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"Y\u000b=\u0019\u0007\u0011|jW .F.?(\b...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000C\u0014CH;H\u0006KR\u0003T4\u0001...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-22 22:20:36] local.DEBUG: ZATCA-compliant TLV generated {"total_length":326,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-22 22:20:37] local.DEBUG: QR code with crypto tags generated {"length":4868} 
[2025-09-22 22:20:37] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":175,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-22 22:23:31] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:23:31] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-22 22:23:31] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-22 22:23:32] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-22 22:23:32] local.INFO: Starting unsigned XML generation {"invoice_number":"001000176","uuid":"1045b2ff-c152-4a5f-850a-f8032b60f15d"} 
[2025-09-22 22:23:32] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-22 22:23:32] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-22 22:23:32] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-22 22:23:32] local.DEBUG: === END DEBUG ===  
[2025-09-22 22:23:32] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-22 22:23:32] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000176"} 
[2025-09-22 22:23:32] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-22 22:23:32] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-22 22:23:32] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-22 22:23:32] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-22 22:23:32] local.DEBUG: Supplier party built successfully  
[2025-09-22 22:23:32] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-22 22:23:32] local.DEBUG: Buyer party built successfully  
[2025-09-22 22:23:32] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-22 22:23:32] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-22 22:23:32] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-22 22:23:32] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-22 22:23:32] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-22 22:23:32] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-22 22:23:32] local.DEBUG: Building additional document references  
[2025-09-22 22:23:32] local.DEBUG: Added ICV reference {"icv":"176"} 
[2025-09-22 22:23:32] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-22 22:23:32] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"176"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-22 22:23:32] local.DEBUG: Invoice object created successfully {"id":"001000176","uuid":"1045b2ff-c152-4a5f-850a-f8032b60f15d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-22 22:23:32] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000176-unsigned.xml","file_size":5241} 
[2025-09-22 22:23:32] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000176-unsigned.xml"} 
[2025-09-22 22:23:32] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000176-signed-1758565412.xml"} 
[2025-09-22 22:23:32] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-22 22:23:32] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-22 22:23:32] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-22 22:23:32] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u001fy\u0002dTW{xga];:/N\u0014...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 $=n\u000et\u0013t02#e n]~...[40 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-22 22:23:32] local.DEBUG: ZATCA-compliant TLV generated {"total_length":324,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-22 22:23:32] local.DEBUG: QR code with crypto tags generated {"length":4836} 
[2025-09-22 22:23:32] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":176,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 05:14:36] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:15:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:15:07] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 05:15:07] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 05:15:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:15:08] local.INFO: Starting unsigned XML generation {"invoice_number":"001000177","uuid":"71617a55-3203-4db2-9d7b-a689b93b3683"} 
[2025-09-23 05:15:08] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 05:15:08] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 05:15:08] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 05:15:08] local.DEBUG: === END DEBUG ===  
[2025-09-23 05:15:08] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 05:15:08] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000177"} 
[2025-09-23 05:15:08] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 05:15:08] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 05:15:08] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 05:15:08] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 05:15:08] local.DEBUG: Supplier party built successfully  
[2025-09-23 05:15:08] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 05:15:08] local.DEBUG: Buyer party built successfully  
[2025-09-23 05:15:08] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 05:15:08] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 05:15:08] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 05:15:08] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 05:15:08] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 05:15:08] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 05:15:08] local.DEBUG: Building additional document references  
[2025-09-23 05:15:08] local.DEBUG: Added ICV reference {"icv":"177"} 
[2025-09-23 05:15:08] local.DEBUG: Added QR reference {"tlv_base64_length":84} 
[2025-09-23 05:15:08] local.DEBUG: Additional document references built {"count":2} 
[2025-09-23 05:15:08] local.DEBUG: Invoice object created successfully {"id":"001000177","uuid":"71617a55-3203-4db2-9d7b-a689b93b3683","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 05:15:08] local.ERROR: XML generation failed {"error":"Attachment must have a filePath, an externalReference, or a fileContent","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\Attachment.php(158): Saleh7\\Zatca\\Attachment->validate()
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\Attachment->xmlSerialize(Object(Sabre\\Xml\\Writer))
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\Attachment))
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\Attachment))
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\AdditionalDocumentReference.php(151): Sabre\\Xml\\Writer->write(Array)
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\AdditionalDocumentReference->xmlSerialize(Object(Sabre\\Xml\\Writer))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#10 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\ZatcaInvoice.php(232): Sabre\\Xml\\Writer->write(Array)
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): App\\Services\\Zatca\\ZatcaInvoice->xmlSerialize(Object(Sabre\\Xml\\Writer))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(App\\Services\\Zatca\\ZatcaInvoice))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(191): Sabre\\Xml\\Writer->write(Object(App\\Services\\Zatca\\ZatcaInvoice))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Service.php(224): Sabre\\Xml\\Writer->writeElement('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#15 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(601): Sabre\\Xml\\Service->write('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#16 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#48 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#50 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#51 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#52 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#53 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#54 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#55 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#56 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#57 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#58 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#59 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#60 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#61 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#62 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#63 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#64 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000177","uuid":"71617a55-3203-4db2-9d7b-a689b93b3683","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"177","previous_invoice_hash":"GjKstuFKTmggb6iU4UgDajzcihc++YYZbzqIa3T5RXc=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 05:15:08] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 05:17:21] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:17:21] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 05:17:21] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 05:17:21] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:17:22] local.INFO: Starting unsigned XML generation {"invoice_number":"001000177","uuid":"124bb45d-f836-4771-b582-bfac14f9ddf9"} 
[2025-09-23 05:17:22] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 05:17:22] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 05:17:22] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 05:17:22] local.DEBUG: === END DEBUG ===  
[2025-09-23 05:17:22] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 05:17:22] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000177"} 
[2025-09-23 05:17:22] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 05:17:22] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 05:17:22] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 05:17:22] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 05:17:22] local.DEBUG: Supplier party built successfully  
[2025-09-23 05:17:22] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 05:17:22] local.DEBUG: Buyer party built successfully  
[2025-09-23 05:17:22] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 05:17:22] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 05:17:22] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 05:17:22] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 05:17:22] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 05:17:22] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 05:17:22] local.DEBUG: Building additional document references  
[2025-09-23 05:17:22] local.DEBUG: Added ICV reference {"icv":"177"} 
[2025-09-23 05:17:22] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 05:17:22] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"177"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 05:17:22] local.DEBUG: Invoice object created successfully {"id":"001000177","uuid":"124bb45d-f836-4771-b582-bfac14f9ddf9","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 05:17:22] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000177-unsigned.xml","file_size":5241} 
[2025-09-23 05:17:22] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000177-unsigned.xml"} 
[2025-09-23 05:17:22] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000177-signed-1758590242.xml"} 
[2025-09-23 05:17:22] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 05:17:22] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-23 05:17:22] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 05:17:22] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"):K%-\u0006
l=\u0005T...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 \b{0R)(~y)\u0004E\u0003B\u001ehHp...[40 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-23 05:17:22] local.DEBUG: ZATCA-compliant TLV generated {"total_length":324,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 05:17:22] local.DEBUG: QR code with crypto tags generated {"length":4856} 
[2025-09-23 05:17:22] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":177,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 05:17:32] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:17:32] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 05:17:32] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 05:17:32] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:17:32] local.INFO: Starting unsigned XML generation {"invoice_number":"001000178","uuid":"b8402207-b2e6-4e3e-9042-212bd1fa2c3d"} 
[2025-09-23 05:17:32] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 05:17:32] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 05:17:32] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 05:17:32] local.DEBUG: === END DEBUG ===  
[2025-09-23 05:17:32] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 05:17:32] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000178"} 
[2025-09-23 05:17:32] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 05:17:32] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 05:17:32] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 05:17:32] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 05:17:32] local.DEBUG: Supplier party built successfully  
[2025-09-23 05:17:32] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 05:17:32] local.DEBUG: Buyer party built successfully  
[2025-09-23 05:17:32] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 05:17:32] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 05:17:32] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 05:17:32] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 05:17:32] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 05:17:32] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 05:17:32] local.DEBUG: Building additional document references  
[2025-09-23 05:17:32] local.DEBUG: Added ICV reference {"icv":"178"} 
[2025-09-23 05:17:32] local.DEBUG: Added QR reference {"tlv_base64_length":84} 
[2025-09-23 05:17:32] local.DEBUG: Additional document references built {"count":2} 
[2025-09-23 05:17:32] local.DEBUG: Invoice object created successfully {"id":"001000178","uuid":"b8402207-b2e6-4e3e-9042-212bd1fa2c3d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 05:17:32] local.ERROR: XML generation failed {"error":"Attachment must have a filePath, an externalReference, or a fileContent","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\Attachment.php(158): Saleh7\\Zatca\\Attachment->validate()
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\Attachment->xmlSerialize(Object(Sabre\\Xml\\Writer))
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\Attachment))
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\Attachment))
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\AdditionalDocumentReference.php(151): Sabre\\Xml\\Writer->write(Array)
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\AdditionalDocumentReference->xmlSerialize(Object(Sabre\\Xml\\Writer))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#10 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\ZatcaInvoice.php(232): Sabre\\Xml\\Writer->write(Array)
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): App\\Services\\Zatca\\ZatcaInvoice->xmlSerialize(Object(Sabre\\Xml\\Writer))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(App\\Services\\Zatca\\ZatcaInvoice))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(191): Sabre\\Xml\\Writer->write(Object(App\\Services\\Zatca\\ZatcaInvoice))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Service.php(224): Sabre\\Xml\\Writer->writeElement('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#15 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(601): Sabre\\Xml\\Service->write('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#16 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#48 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#50 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#51 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#52 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#53 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#54 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#55 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#56 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#57 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#58 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#59 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#60 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#61 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#62 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#63 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#64 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000178","uuid":"b8402207-b2e6-4e3e-9042-212bd1fa2c3d","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"178","previous_invoice_hash":"6I3DSR6zkh6CZCy/JlDaPP4AKq7bWFTmNbMXDTEbUtE=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 05:17:32] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 05:19:25] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:19:25] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 05:19:25] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 05:19:25] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:19:25] local.INFO: Starting unsigned XML generation {"invoice_number":"001000178","uuid":"5da532ae-8360-46c1-bdaf-07204fee687c"} 
[2025-09-23 05:19:25] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 05:19:25] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 05:19:25] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 05:19:25] local.DEBUG: === END DEBUG ===  
[2025-09-23 05:19:25] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 05:19:25] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000178"} 
[2025-09-23 05:19:25] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 05:19:25] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 05:19:25] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 05:19:25] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 05:19:25] local.DEBUG: Supplier party built successfully  
[2025-09-23 05:19:25] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 05:19:25] local.DEBUG: Buyer party built successfully  
[2025-09-23 05:19:25] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 05:19:25] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 05:19:25] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 05:19:25] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 05:19:25] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 05:19:25] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 05:19:25] local.DEBUG: Building additional document references  
[2025-09-23 05:19:25] local.DEBUG: Added ICV reference {"icv":"178"} 
[2025-09-23 05:19:25] local.DEBUG: Added QR reference {"tlv_base64_length":84} 
[2025-09-23 05:19:25] local.DEBUG: Additional document references built {"count":2} 
[2025-09-23 05:19:25] local.DEBUG: Invoice object created successfully {"id":"001000178","uuid":"5da532ae-8360-46c1-bdaf-07204fee687c","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 05:19:25] local.ERROR: XML generation failed {"error":"Attachment must have a filePath, an externalReference, or a fileContent","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\Attachment.php(158): Saleh7\\Zatca\\Attachment->validate()
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\Attachment->xmlSerialize(Object(Sabre\\Xml\\Writer))
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\Attachment))
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\Attachment))
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\AdditionalDocumentReference.php(151): Sabre\\Xml\\Writer->write(Array)
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\AdditionalDocumentReference->xmlSerialize(Object(Sabre\\Xml\\Writer))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#10 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\ZatcaInvoice.php(232): Sabre\\Xml\\Writer->write(Array)
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): App\\Services\\Zatca\\ZatcaInvoice->xmlSerialize(Object(Sabre\\Xml\\Writer))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(App\\Services\\Zatca\\ZatcaInvoice))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(191): Sabre\\Xml\\Writer->write(Object(App\\Services\\Zatca\\ZatcaInvoice))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Service.php(224): Sabre\\Xml\\Writer->writeElement('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#15 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(601): Sabre\\Xml\\Service->write('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#16 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#48 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#50 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#51 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#52 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#53 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#54 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#55 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#56 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#57 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#58 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#59 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#60 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#61 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#62 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#63 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#64 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000178","uuid":"5da532ae-8360-46c1-bdaf-07204fee687c","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"178","previous_invoice_hash":"6I3DSR6zkh6CZCy/JlDaPP4AKq7bWFTmNbMXDTEbUtE=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 05:19:25] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 05:26:48] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:26:48] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 05:26:48] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 05:26:48] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:26:48] local.INFO: Starting unsigned XML generation {"invoice_number":"001000178","uuid":"90430262-22da-4f56-8765-c2b0e769ba5f"} 
[2025-09-23 05:26:48] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 05:26:48] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 05:26:48] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 05:26:48] local.DEBUG: === END DEBUG ===  
[2025-09-23 05:26:48] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 05:26:48] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000178"} 
[2025-09-23 05:26:48] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 05:26:48] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 05:26:48] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 05:26:48] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 05:26:48] local.DEBUG: Supplier party built successfully  
[2025-09-23 05:26:48] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 05:26:48] local.DEBUG: Buyer party built successfully  
[2025-09-23 05:26:48] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 05:26:48] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 05:26:48] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 05:26:48] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 05:26:48] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 05:26:48] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 05:26:48] local.DEBUG: Building additional document references  
[2025-09-23 05:26:48] local.DEBUG: Added ICV reference {"icv":"178"} 
[2025-09-23 05:26:48] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 05:26:48] local.DEBUG: Additional document references built {"count":2} 
[2025-09-23 05:26:48] local.DEBUG: Invoice object created successfully {"id":"001000178","uuid":"90430262-22da-4f56-8765-c2b0e769ba5f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 05:26:48] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000178-unsigned.xml","file_size":5241} 
[2025-09-23 05:26:48] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000178-unsigned.xml"} 
[2025-09-23 05:26:48] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000178-signed-1758590808.xml"} 
[2025-09-23 05:26:48] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 05:26:48] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 05:26:48] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 05:26:48] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"J~Rx;\u0014tU\u000fp\u0001\u001e<...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000bS&h7r\u0017\\\u0017A3...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-23 05:26:48] local.DEBUG: ZATCA-compliant TLV generated {"total_length":326,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 05:26:48] local.DEBUG: QR code with crypto tags generated {"length":4836} 
[2025-09-23 05:26:48] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":178,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 05:52:23] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:52:23] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 05:52:23] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 05:52:23] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 05:52:23] local.INFO: Starting unsigned XML generation {"invoice_number":"001000179","uuid":"c05dc093-7d0a-4b9f-b11b-e1358b13575f"} 
[2025-09-23 05:52:23] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 05:52:23] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 05:52:23] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 05:52:23] local.DEBUG: === END DEBUG ===  
[2025-09-23 05:52:23] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 05:52:23] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000179"} 
[2025-09-23 05:52:23] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 05:52:23] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 05:52:23] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 05:52:23] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 05:52:23] local.DEBUG: Supplier party built successfully  
[2025-09-23 05:52:23] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 05:52:23] local.DEBUG: Buyer party built successfully  
[2025-09-23 05:52:23] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 05:52:23] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 05:52:23] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 05:52:23] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 05:52:23] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 05:52:23] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 05:52:23] local.DEBUG: Building additional document references  
[2025-09-23 05:52:23] local.DEBUG: Added ICV reference {"icv":"179"} 
[2025-09-23 05:52:23] local.DEBUG: Added PIH reference {"pih":"czFqlMtCLQu/I92fHN9l5zL474JdU6xhvZXHfk3hmB4="} 
[2025-09-23 05:52:23] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-23 05:52:23] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(561): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000179","uuid":"c05dc093-7d0a-4b9f-b11b-e1358b13575f","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"179","previous_invoice_hash":"czFqlMtCLQu/I92fHN9l5zL474JdU6xhvZXHfk3hmB4=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 05:52:23] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 06:05:16] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 06:05:16] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 06:05:16] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 06:05:16] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 06:05:16] local.INFO: Starting unsigned XML generation {"invoice_number":"001000179","uuid":"92fd34f1-f6b5-4c08-9901-036e13e0ba23"} 
[2025-09-23 06:05:16] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 06:05:16] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 06:05:16] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 06:05:16] local.DEBUG: === END DEBUG ===  
[2025-09-23 06:05:16] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 06:05:16] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000179"} 
[2025-09-23 06:05:16] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 06:05:16] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 06:05:16] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 06:05:16] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 06:05:16] local.DEBUG: Supplier party built successfully  
[2025-09-23 06:05:16] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 06:05:16] local.DEBUG: Buyer party built successfully  
[2025-09-23 06:05:16] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 06:05:16] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 06:05:16] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 06:05:16] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 06:05:16] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 06:05:16] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 06:05:16] local.DEBUG: Building additional document references  
[2025-09-23 06:05:16] local.DEBUG: Added ICV reference {"icv":"179"} 
[2025-09-23 06:05:16] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 06:05:16] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"179"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 06:05:16] local.DEBUG: Invoice object created successfully {"id":"001000179","uuid":"92fd34f1-f6b5-4c08-9901-036e13e0ba23","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 06:05:16] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000179-unsigned.xml","file_size":5241} 
[2025-09-23 06:05:16] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000179-unsigned.xml"} 
[2025-09-23 06:05:16] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000179-signed-1758593116.xml"} 
[2025-09-23 06:05:16] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 06:05:16] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-23 06:05:16] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 06:05:16] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"/Es=\tPf\u0014li!V
...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 \u0016\u001f<+M\u0002\\\u0001\u000bi4%\u001cy...[41 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-23 06:05:16] local.DEBUG: ZATCA-compliant TLV generated {"total_length":325,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 06:05:16] local.DEBUG: QR code with crypto tags generated {"length":4932} 
[2025-09-23 06:05:16] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":179,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 06:59:06] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 06:59:06] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 06:59:06] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 06:59:06] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 06:59:06] local.INFO: Starting unsigned XML generation {"invoice_number":"001000180","uuid":"12af035a-4e14-45e8-8323-92a7ed2f4b93"} 
[2025-09-23 06:59:06] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 06:59:06] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 06:59:06] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 06:59:06] local.DEBUG: === END DEBUG ===  
[2025-09-23 06:59:06] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 06:59:06] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000180"} 
[2025-09-23 06:59:06] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 06:59:06] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 06:59:06] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 06:59:06] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 06:59:06] local.DEBUG: Supplier party built successfully  
[2025-09-23 06:59:06] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 06:59:06] local.DEBUG: Buyer party built successfully  
[2025-09-23 06:59:06] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 06:59:06] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 06:59:06] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 06:59:06] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 06:59:06] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 06:59:06] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 06:59:06] local.DEBUG: Building additional document references  
[2025-09-23 06:59:06] local.DEBUG: Added ICV reference {"icv":"180"} 
[2025-09-23 06:59:06] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-23 06:59:06] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(561): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000180","uuid":"12af035a-4e14-45e8-8323-92a7ed2f4b93","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"180","previous_invoice_hash":"hvmmCrvhjtwIerLhR7zq8Deogw2kUdDq/209UuEHEg4=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 06:59:06] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 15:31:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:32:03] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:32:05] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 15:32:05] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 15:32:11] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:32:11] local.INFO: Starting unsigned XML generation {"invoice_number":"001000180","uuid":"8911298c-a6fd-4748-8547-6dc0f01c72a1"} 
[2025-09-23 15:32:11] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 15:32:11] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 15:32:11] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 15:32:11] local.DEBUG: === END DEBUG ===  
[2025-09-23 15:32:11] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 15:32:11] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000180"} 
[2025-09-23 15:32:11] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 15:32:11] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 15:32:11] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 15:32:11] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 15:32:11] local.DEBUG: Supplier party built successfully  
[2025-09-23 15:32:11] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 15:32:11] local.DEBUG: Buyer party built successfully  
[2025-09-23 15:32:11] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 15:32:11] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 15:32:11] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 15:32:11] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 15:32:11] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 15:32:11] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 15:32:11] local.DEBUG: Building additional document references  
[2025-09-23 15:32:12] local.DEBUG: Added ICV reference {"icv":"180"} 
[2025-09-23 15:32:12] local.DEBUG: Added QR reference {"tlv_length":84,"preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 15:32:12] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"180","document_type_code":"N/A"},{"id":"QR","uuid":null,"document_type_code":"QR"}]} 
[2025-09-23 15:32:12] local.DEBUG: Invoice object created successfully {"id":"001000180","uuid":"8911298c-a6fd-4748-8547-6dc0f01c72a1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 15:32:12] local.ERROR: XML generation failed {"error":"Attachment must have a filePath, an externalReference, or a fileContent","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\Attachment.php(158): Saleh7\\Zatca\\Attachment->validate()
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\Attachment->xmlSerialize(Object(Sabre\\Xml\\Writer))
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\Attachment))
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\Attachment))
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\saleh7\\php-zatca-xml\\src\\AdditionalDocumentReference.php(224): Sabre\\Xml\\Writer->write(Array)
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): Saleh7\\Zatca\\AdditionalDocumentReference->xmlSerialize(Object(Sabre\\Xml\\Writer))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(196): Sabre\\Xml\\Writer->write(Object(Saleh7\\Zatca\\AdditionalDocumentReference))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Array)
#10 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\ZatcaInvoice.php(232): Sabre\\Xml\\Writer->write(Array)
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Serializer\\functions.php(159): App\\Services\\Zatca\\ZatcaInvoice->xmlSerialize(Object(Sabre\\Xml\\Writer))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(99): Sabre\\Xml\\Serializer\\standardSerializer(Object(Sabre\\Xml\\Writer), Object(App\\Services\\Zatca\\ZatcaInvoice))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Writer.php(191): Sabre\\Xml\\Writer->write(Object(App\\Services\\Zatca\\ZatcaInvoice))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\sabre\\xml\\lib\\Service.php(224): Sabre\\Xml\\Writer->writeElement('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#15 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(601): Sabre\\Xml\\Service->write('{urn:oasis:name...', Object(App\\Services\\Zatca\\ZatcaInvoice))
#16 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#47 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#48 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#49 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#50 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#51 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#52 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#53 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#54 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#55 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#56 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#57 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#58 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#59 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#60 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#61 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#62 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#63 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#64 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000180","uuid":"8911298c-a6fd-4748-8547-6dc0f01c72a1","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"180","previous_invoice_hash":"hvmmCrvhjtwIerLhR7zq8Deogw2kUdDq/209UuEHEg4=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 15:32:12] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 15:32:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:32:27] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 15:32:27] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 15:32:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:32:27] local.INFO: Starting unsigned XML generation {"invoice_number":"001000180","uuid":"c742f07e-e54a-427b-9b07-d2340acd331d"} 
[2025-09-23 15:32:27] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 15:32:27] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 15:32:27] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 15:32:27] local.DEBUG: === END DEBUG ===  
[2025-09-23 15:32:27] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 15:32:27] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000180"} 
[2025-09-23 15:32:27] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 15:32:27] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 15:32:27] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 15:32:27] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 15:32:27] local.DEBUG: Supplier party built successfully  
[2025-09-23 15:32:27] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 15:32:27] local.DEBUG: Buyer party built successfully  
[2025-09-23 15:32:27] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 15:32:27] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 15:32:27] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 15:32:27] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 15:32:27] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 15:32:27] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 15:32:27] local.DEBUG: Building additional document references  
[2025-09-23 15:32:27] local.DEBUG: Added ICV reference {"icv":"180"} 
[2025-09-23 15:32:27] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 15:32:27] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"180"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 15:32:27] local.DEBUG: Invoice object created successfully {"id":"001000180","uuid":"c742f07e-e54a-427b-9b07-d2340acd331d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 15:32:27] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000180-unsigned.xml","file_size":5241} 
[2025-09-23 15:32:27] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000180-unsigned.xml"} 
[2025-09-23 15:32:27] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000180-signed-1758627147.xml"} 
[2025-09-23 15:32:27] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 15:32:27] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 15:32:27] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 15:32:27] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\\8xL|D!\u0016.\u000bV\u000eT...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000x\u000f\u001fa7)P3=
Ws\u001f...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-23 15:32:27] local.DEBUG: ZATCA-compliant TLV generated {"total_length":326,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 15:32:29] local.DEBUG: QR code with crypto tags generated {"length":4904} 
[2025-09-23 15:32:29] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":180,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 15:55:02] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:55:02] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 15:55:02] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 15:55:02] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:55:02] local.INFO: Starting unsigned XML generation {"invoice_number":"001000181","uuid":"e10dda01-4e0e-4127-a395-12382f57686d"} 
[2025-09-23 15:55:02] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 15:55:02] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 15:55:02] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 15:55:02] local.DEBUG: === END DEBUG ===  
[2025-09-23 15:55:02] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 15:55:02] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000181"} 
[2025-09-23 15:55:02] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 15:55:02] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 15:55:02] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 15:55:02] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 15:55:02] local.DEBUG: Supplier party built successfully  
[2025-09-23 15:55:02] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 15:55:02] local.DEBUG: Buyer party built successfully  
[2025-09-23 15:55:02] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 15:55:02] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 15:55:02] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 15:55:02] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 15:55:02] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 15:55:02] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 15:55:02] local.DEBUG: Building additional document references  
[2025-09-23 15:55:02] local.DEBUG: Added ICV reference {"icv":"181"} 
[2025-09-23 15:55:02] local.DEBUG: Added PIH reference {"pih":"tqim6zfHnROmOClCYNni1EBTa2fDOjdo+fWxN6+A53k="} 
[2025-09-23 15:55:02] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-23 15:55:02] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(561): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000181","uuid":"e10dda01-4e0e-4127-a395-12382f57686d","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"181","previous_invoice_hash":"tqim6zfHnROmOClCYNni1EBTa2fDOjdo+fWxN6+A53k=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 15:55:02] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 15:55:17] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:55:18] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 15:55:18] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 15:55:18] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:55:18] local.INFO: Starting unsigned XML generation {"invoice_number":"001000181","uuid":"f885c6a4-7c6e-438a-84f9-3392a368de1d"} 
[2025-09-23 15:55:18] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 15:55:18] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 15:55:18] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 15:55:18] local.DEBUG: === END DEBUG ===  
[2025-09-23 15:55:18] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 15:55:18] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000181"} 
[2025-09-23 15:55:18] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 15:55:18] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 15:55:18] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 15:55:18] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 15:55:18] local.DEBUG: Supplier party built successfully  
[2025-09-23 15:55:18] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 15:55:18] local.DEBUG: Buyer party built successfully  
[2025-09-23 15:55:18] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 15:55:18] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 15:55:18] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 15:55:18] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 15:55:18] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 15:55:18] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 15:55:18] local.DEBUG: Building additional document references  
[2025-09-23 15:55:18] local.DEBUG: Added ICV reference {"icv":"181"} 
[2025-09-23 15:55:18] local.DEBUG: Added PIH reference {"pih":"tqim6zfHnROmOClCYNni1EBTa2fDOjdo+fWxN6+A53k="} 
[2025-09-23 15:55:18] local.ERROR: QR reference missing or invalid {"qr_image_base64":"NOT SET","type":"NULL"} 
[2025-09-23 15:55:18] local.ERROR: XML generation failed {"error":"QR code image is required for ZATCA Phase 2 compliance","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(561): App\\Services\\Zatca\\InvoiceXmlGenerator->buildAdditionalDocumentReferences(Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3229): App\\Services\\Zatca\\InvoiceXmlGenerator->generateUnsignedXml(Array, '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}","invoice_data":{"id":"PLEX35IN","invoice_number":"001000181","uuid":"f885c6a4-7c6e-438a-84f9-3392a368de1d","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"181","previous_invoice_hash":"tqim6zfHnROmOClCYNni1EBTa2fDOjdo+fWxN6+A53k=","pricing_type":"inclusive","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","tlv_qr":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}} 
[2025-09-23 15:55:18] local.ERROR: ZATCA generation process failed: Failed to generate initial unsigned XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-09-23 15:55:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:55:24] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 15:55:24] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 15:55:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:55:24] local.INFO: Starting unsigned XML generation {"invoice_number":"001000181","uuid":"c64f78f7-1583-483e-9a38-9bcf3d3fbaad"} 
[2025-09-23 15:55:24] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 15:55:24] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 15:55:24] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 15:55:24] local.DEBUG: === END DEBUG ===  
[2025-09-23 15:55:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 15:55:24] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000181"} 
[2025-09-23 15:55:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 15:55:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 15:55:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 15:55:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 15:55:24] local.DEBUG: Supplier party built successfully  
[2025-09-23 15:55:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 15:55:24] local.DEBUG: Buyer party built successfully  
[2025-09-23 15:55:24] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 15:55:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 15:55:24] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 15:55:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 15:55:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 15:55:24] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 15:55:24] local.DEBUG: Building additional document references  
[2025-09-23 15:55:24] local.DEBUG: Added ICV reference {"icv":"181"} 
[2025-09-23 15:55:24] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 15:55:24] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"181"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 15:55:24] local.DEBUG: Invoice object created successfully {"id":"001000181","uuid":"c64f78f7-1583-483e-9a38-9bcf3d3fbaad","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 15:55:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000181-unsigned.xml","file_size":5241} 
[2025-09-23 15:55:24] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000181-unsigned.xml"} 
[2025-09-23 15:55:24] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000181-signed-1758628524.xml"} 
[2025-09-23 15:55:24] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 15:55:24] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 15:55:24] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 15:55:24] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"s\t_Y 5y
pa?|\u0011/%`...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000IQi a3GrX[@\u0006{QvL\u0015\u0005...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-23 15:55:24] local.DEBUG: ZATCA-compliant TLV generated {"total_length":326,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 15:55:24] local.DEBUG: QR code with crypto tags generated {"length":4828} 
[2025-09-23 15:55:24] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":181,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 15:59:31] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:59:31] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 15:59:31] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 15:59:31] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 15:59:31] local.INFO: Starting unsigned XML generation {"invoice_number":"001000182","uuid":"c3b2dd7c-515e-4fd3-899a-714e17db53e0"} 
[2025-09-23 15:59:31] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 15:59:31] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 15:59:31] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 15:59:31] local.DEBUG: === END DEBUG ===  
[2025-09-23 15:59:31] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 15:59:31] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000182"} 
[2025-09-23 15:59:31] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 15:59:31] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 15:59:31] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 15:59:31] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 15:59:31] local.DEBUG: Supplier party built successfully  
[2025-09-23 15:59:31] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 15:59:31] local.DEBUG: Buyer party built successfully  
[2025-09-23 15:59:31] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 15:59:31] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 15:59:31] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 15:59:31] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 15:59:31] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 15:59:31] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 15:59:31] local.DEBUG: Building additional document references  
[2025-09-23 15:59:31] local.DEBUG: Added ICV reference {"icv":"182"} 
[2025-09-23 15:59:31] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 15:59:31] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"182"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 15:59:31] local.DEBUG: Invoice object created successfully {"id":"001000182","uuid":"c3b2dd7c-515e-4fd3-899a-714e17db53e0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 15:59:31] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000182-unsigned.xml","file_size":5241} 
[2025-09-23 15:59:31] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000182-unsigned.xml"} 
[2025-09-23 15:59:31] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000182-signed-1758628771.xml"} 
[2025-09-23 15:59:31] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 15:59:31] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 15:59:31] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 15:59:31] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":",C:\u0015Cz\tva\u001f'\u000e...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000%\u00136Woq\u001d\u000bh\u0014\u001b{tnK...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000...[2 more bytes]","is_binary":true}]} 
[2025-09-23 15:59:31] local.DEBUG: ZATCA-compliant TLV generated {"total_length":326,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 15:59:31] local.DEBUG: QR code with crypto tags generated {"length":4816} 
[2025-09-23 15:59:31] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":182,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 17:50:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:01:55] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:01:56] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:01:56] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:02:00] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:02:01] local.INFO: Starting unsigned XML generation {"invoice_number":"001000183","uuid":"a7e843c6-bc7a-4632-900f-82b6572823a7"} 
[2025-09-23 18:02:01] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:02:01] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:02:01] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:02:01] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:02:01] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:02:01] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000183"} 
[2025-09-23 18:02:01] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:02:01] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:02:01] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:02:01] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:02:01] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:02:01] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:02:01] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:02:01] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:02:01] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:02:01] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:02:01] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:02:01] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:02:01] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:02:01] local.DEBUG: Building additional document references  
[2025-09-23 18:02:01] local.DEBUG: Added ICV reference {"icv":"183"} 
[2025-09-23 18:02:01] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:02:01] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"183"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:02:01] local.DEBUG: Invoice object created successfully {"id":"001000183","uuid":"a7e843c6-bc7a-4632-900f-82b6572823a7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:02:01] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000183-unsigned.xml","file_size":5241} 
[2025-09-23 18:02:01] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000183-unsigned.xml"} 
[2025-09-23 18:02:02] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000183-signed-1758636122.xml"} 
[2025-09-23 18:02:02] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:02:02] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 18:02:02] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 18:02:02] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\t!vnlj$q8\u0005F\u001c8B`C...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000>OvH&\bg6\u000f,m\u0002r\u001a\u0019/...[42 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":44,"value_preview":"2uo8KjRGPA4fi7kWzkNiK58u/4IryT...[14 more bytes]","is_binary":true}]} 
[2025-09-23 18:02:02] local.DEBUG: ZATCA-compliant TLV generated {"total_length":338,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 18:02:03] local.DEBUG: QR code with crypto tags generated {"length":4884} 
[2025-09-23 18:02:03] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":183,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 18:22:08] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:22:12] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:22:12] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:22:16] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:22:17] local.INFO: Starting unsigned XML generation {"invoice_number":"001000184","uuid":"aaa624e7-0740-4445-9d08-fd4fa07801eb"} 
[2025-09-23 18:22:17] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:22:17] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:22:17] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:22:17] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:22:17] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:22:17] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000184"} 
[2025-09-23 18:22:17] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:22:17] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:22:17] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:22:17] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:22:17] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:22:17] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:22:17] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:22:17] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:22:17] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:22:17] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:22:17] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:22:17] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:22:17] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:22:17] local.DEBUG: Building additional document references  
[2025-09-23 18:22:17] local.DEBUG: Added ICV reference {"icv":"184"} 
[2025-09-23 18:22:17] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:22:17] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"184"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:22:17] local.DEBUG: Invoice object created successfully {"id":"001000184","uuid":"aaa624e7-0740-4445-9d08-fd4fa07801eb","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:22:18] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000184-unsigned.xml","file_size":5241} 
[2025-09-23 18:22:18] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000184-unsigned.xml"} 
[2025-09-23 18:22:18] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000184-signed-1758637338.xml"} 
[2025-09-23 18:22:18] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:22:18] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":69,"is_binary":true} 
[2025-09-23 18:22:18] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 18:22:18] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"wH=\u0019J\u001a}\u001c{;\u0011]2me...[2 more bytes]","is_binary":true},{"tag":7,"length":69,"value_preview":"0C\u0002 'K\u0016Nm^*(ju\"E=\u001d...[39 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":44,"value_preview":"u8eXEoHEZo7PYV+ndBlCwLyxxkIPou...[14 more bytes]","is_binary":true}]} 
[2025-09-23 18:22:18] local.DEBUG: ZATCA-compliant TLV generated {"total_length":335,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 18:22:20] local.DEBUG: QR code with crypto tags generated {"length":4860} 
[2025-09-23 18:22:20] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":184,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 18:24:11] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:24:11] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:24:11] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:24:11] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:24:11] local.INFO: Starting unsigned XML generation {"invoice_number":"001000185","uuid":"7770aca3-17d8-4eb0-a248-528fcdb0e702"} 
[2025-09-23 18:24:11] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:24:11] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:24:11] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:24:11] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:24:11] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:24:11] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000185"} 
[2025-09-23 18:24:11] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:24:11] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:24:11] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:24:11] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:24:11] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:24:11] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:24:11] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:24:11] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:24:11] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:24:11] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:24:11] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:24:11] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:24:11] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:24:11] local.DEBUG: Building additional document references  
[2025-09-23 18:24:11] local.DEBUG: Added ICV reference {"icv":"185"} 
[2025-09-23 18:24:11] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:24:11] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"185"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:24:11] local.DEBUG: Invoice object created successfully {"id":"001000185","uuid":"7770aca3-17d8-4eb0-a248-528fcdb0e702","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:24:11] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000185-unsigned.xml","file_size":5241} 
[2025-09-23 18:24:11] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000185-unsigned.xml"} 
[2025-09-23 18:24:11] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000185-signed-1758637451.xml"} 
[2025-09-23 18:24:11] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:24:11] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-23 18:24:11] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 18:24:11] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"&\bY_\u000263\u0011$!\u0012\u00104\u0015PM,\u000e%8...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 
,s\u001e8un@?...[40 more bytes]","is_binary":true},{"tag":8,"length":120,"value_preview":"MFYwEAYHKoZIzj0CAQYFK4EEAAoDQg...[90 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"'{\u0019G\u001dJm%G y_f@?...[2 more bytes]","is_binary":true}]} 
[2025-09-23 18:24:11] local.DEBUG: ZATCA-compliant TLV generated {"total_length":324,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 18:24:11] local.DEBUG: QR code with crypto tags generated {"length":4956} 
[2025-09-23 18:24:11] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":185,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 18:26:41] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:26:41] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:26:41] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:26:41] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:26:41] local.INFO: Starting unsigned XML generation {"invoice_number":"001000186","uuid":"dd5a4d1c-3616-4c6a-af6f-2fc1bde28e79"} 
[2025-09-23 18:26:41] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:26:41] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:26:41] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:26:41] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:26:41] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:26:41] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000186"} 
[2025-09-23 18:26:41] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:26:41] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:26:41] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:26:41] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:26:41] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:26:41] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:26:41] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:26:41] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:26:41] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:26:41] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:26:41] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:26:41] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:26:41] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:26:41] local.DEBUG: Building additional document references  
[2025-09-23 18:26:41] local.DEBUG: Added ICV reference {"icv":"186"} 
[2025-09-23 18:26:41] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:26:41] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"186"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:26:41] local.DEBUG: Invoice object created successfully {"id":"001000186","uuid":"dd5a4d1c-3616-4c6a-af6f-2fc1bde28e79","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:26:41] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000186-unsigned.xml","file_size":5241} 
[2025-09-23 18:26:41] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000186-unsigned.xml"} 
[2025-09-23 18:26:41] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000186-signed-1758637601.xml"} 
[2025-09-23 18:26:41] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:26:41] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-23 18:26:41] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 18:26:41] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"D*,Q93O/Ljn1\"I\u0005...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 l\u00032D\u0006Nv0\u001dld\u0013|\u001b...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"GCZT@z\t{#\u0003'6$[>T...[2 more bytes]","is_binary":true}]} 
[2025-09-23 18:26:41] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 18:26:41] local.DEBUG: QR code with crypto tags generated {"length":4516} 
[2025-09-23 18:26:41] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":186,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 18:35:41] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:35:41] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:35:41] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:35:41] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:35:41] local.INFO: Starting unsigned XML generation {"invoice_number":"001000187","uuid":"c04340da-1a28-4b5f-93d4-be33b88cab7d"} 
[2025-09-23 18:35:41] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:35:41] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:35:41] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:35:41] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:35:41] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:35:41] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000187"} 
[2025-09-23 18:35:41] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:35:41] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:35:41] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:35:41] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:35:41] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:35:41] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:35:41] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:35:41] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:35:41] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:35:41] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:35:41] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:35:41] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:35:41] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:35:41] local.DEBUG: Building additional document references  
[2025-09-23 18:35:41] local.DEBUG: Added ICV reference {"icv":"187"} 
[2025-09-23 18:35:41] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:35:41] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"187"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:35:41] local.DEBUG: Invoice object created successfully {"id":"001000187","uuid":"c04340da-1a28-4b5f-93d4-be33b88cab7d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:35:41] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000187-unsigned.xml","file_size":5241} 
[2025-09-23 18:35:41] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000187-unsigned.xml"} 
[2025-09-23 18:35:41] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000187-signed-1758638141.xml"} 
[2025-09-23 18:35:41] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:35:41] local.ERROR: ZATCA QR generation failed {"error":"Undefined array key \"customer_name\"","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceQrGenerator.php(238): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(2, 'Undefined array...', 'C:\\\\xampp\\\\htdocs...', 238)
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3251): App\\Services\\Zatca\\InvoiceQrGenerator->generateBase64WithCrypto('<?xml version=\"...', Object(Saleh7\\Zatca\\Helpers\\Certificate), Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}"} 
[2025-09-23 18:35:41] local.ERROR: ZATCA generation process failed: ZATCA QR generation failed: Undefined array key "customer_name" {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3251): App\\Services\\Zatca\\InvoiceQrGenerator->generateBase64WithCrypto('<?xml version=\"...', Object(Saleh7\\Zatca\\Helpers\\Certificate), Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-23 18:37:56] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:37:57] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:37:57] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:38:00] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:38:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000187","uuid":"edde8612-48f0-48c6-a8dc-a5d4e26b1f05"} 
[2025-09-23 18:38:00] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:38:00] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:38:00] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:38:00] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:38:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:38:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000187"} 
[2025-09-23 18:38:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:38:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:38:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:38:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:38:01] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:38:01] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:38:01] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:38:01] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:38:01] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:38:01] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:38:01] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:38:01] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:38:01] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:38:01] local.DEBUG: Building additional document references  
[2025-09-23 18:38:01] local.DEBUG: Added ICV reference {"icv":"187"} 
[2025-09-23 18:38:01] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:38:01] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"187"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:38:01] local.DEBUG: Invoice object created successfully {"id":"001000187","uuid":"edde8612-48f0-48c6-a8dc-a5d4e26b1f05","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:38:01] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000187-unsigned.xml","file_size":5241} 
[2025-09-23 18:38:01] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000187-unsigned.xml"} 
[2025-09-23 18:38:01] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000187-signed-1758638281.xml"} 
[2025-09-23 18:38:01] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:38:01] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-23 18:38:01] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 18:38:01] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"uXc.}$\u0010J8\u0010M=jdi8...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 \u001d6`B#\u0017\u001506R
R2...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"=ox&x3T\u001e\u0004b\u0014\u0005vI...[2 more bytes]","is_binary":true}]} 
[2025-09-23 18:38:01] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 18:38:02] local.DEBUG: QR code with crypto tags generated {"length":4532} 
[2025-09-23 18:38:02] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":187,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 18:46:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:46:50] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 18:46:50] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 18:46:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 18:46:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000188","uuid":"7a8a5f97-484d-46da-9a5d-df1434ee81b6"} 
[2025-09-23 18:46:50] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 18:46:50] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 18:46:50] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 18:46:50] local.DEBUG: === END DEBUG ===  
[2025-09-23 18:46:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 18:46:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000188"} 
[2025-09-23 18:46:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 18:46:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 18:46:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 18:46:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 18:46:50] local.DEBUG: Supplier party built successfully  
[2025-09-23 18:46:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 18:46:50] local.DEBUG: Buyer party built successfully  
[2025-09-23 18:46:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 18:46:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 18:46:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 18:46:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 18:46:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 18:46:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 18:46:50] local.DEBUG: Building additional document references  
[2025-09-23 18:46:50] local.DEBUG: Added ICV reference {"icv":"188"} 
[2025-09-23 18:46:50] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 18:46:50] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"188"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 18:46:50] local.DEBUG: Invoice object created successfully {"id":"001000188","uuid":"7a8a5f97-484d-46da-9a5d-df1434ee81b6","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 18:46:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000188-unsigned.xml","file_size":5241} 
[2025-09-23 18:46:50] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000188-unsigned.xml"} 
[2025-09-23 18:46:50] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000188-signed-1758638810.xml"} 
[2025-09-23 18:46:50] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 18:46:50] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 18:46:50] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 18:46:50] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"Q\u001bSL\u0014zY5Tj\t\u001d@
...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000!;\t\u001a\u0000wDPO0`...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"3K\u0001dQJkb\u001cv9/\u0014p@4aT?...[2 more bytes]","is_binary":true}]} 
[2025-09-23 18:46:50] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 18:46:50] local.DEBUG: QR code with crypto tags generated {"length":4528} 
[2025-09-23 18:46:50] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":188,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 19:58:57] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 19:59:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 19:59:07] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 19:59:07] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 19:59:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 19:59:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000189","uuid":"d5cc3e87-cbec-43ac-bdfc-4ecdcc09529d"} 
[2025-09-23 19:59:07] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 19:59:07] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 19:59:07] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 19:59:07] local.DEBUG: === END DEBUG ===  
[2025-09-23 19:59:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 19:59:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000189"} 
[2025-09-23 19:59:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 19:59:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 19:59:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 19:59:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 19:59:07] local.DEBUG: Supplier party built successfully  
[2025-09-23 19:59:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 19:59:07] local.DEBUG: Buyer party built successfully  
[2025-09-23 19:59:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 19:59:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 19:59:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 19:59:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 19:59:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 19:59:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 19:59:07] local.DEBUG: Building additional document references  
[2025-09-23 19:59:07] local.DEBUG: Added ICV reference {"icv":"189"} 
[2025-09-23 19:59:07] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 19:59:07] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"189"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 19:59:07] local.DEBUG: Invoice object created successfully {"id":"001000189","uuid":"d5cc3e87-cbec-43ac-bdfc-4ecdcc09529d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 19:59:07] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000189-unsigned.xml","file_size":5241} 
[2025-09-23 19:59:07] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000189-unsigned.xml"} 
[2025-09-23 19:59:07] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000189-signed-1758643147.xml"} 
[2025-09-23 19:59:07] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 19:59:07] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-23 19:59:07] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 19:59:07] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u0004\u0007)\u0002\\q\u001b'a'0\u001bEu...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000\u001ehh&\u0005`qe...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"W]EF#n}PLha\u00137...[2 more bytes]","is_binary":true}]} 
[2025-09-23 19:59:07] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 19:59:07] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-23 19:59:07] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":189,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 20:01:28] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:01:29] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 20:01:29] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 20:01:29] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:01:29] local.INFO: Starting unsigned XML generation {"invoice_number":"001000190","uuid":"830e56b6-6660-401b-aa91-6b27ea7587be"} 
[2025-09-23 20:01:29] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 20:01:29] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 20:01:29] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 20:01:29] local.DEBUG: === END DEBUG ===  
[2025-09-23 20:01:29] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 20:01:29] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000190"} 
[2025-09-23 20:01:29] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 20:01:29] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 20:01:29] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 20:01:29] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 20:01:29] local.DEBUG: Supplier party built successfully  
[2025-09-23 20:01:29] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 20:01:29] local.DEBUG: Buyer party built successfully  
[2025-09-23 20:01:29] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 20:01:29] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 20:01:29] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 20:01:29] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 20:01:29] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 20:01:29] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 20:01:29] local.DEBUG: Building additional document references  
[2025-09-23 20:01:29] local.DEBUG: Added ICV reference {"icv":"190"} 
[2025-09-23 20:01:29] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 20:01:29] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"190"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 20:01:29] local.DEBUG: Invoice object created successfully {"id":"001000190","uuid":"830e56b6-6660-401b-aa91-6b27ea7587be","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 20:01:29] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000190-unsigned.xml","file_size":5241} 
[2025-09-23 20:01:29] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000190-unsigned.xml"} 
[2025-09-23 20:01:29] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000190-signed-1758643289.xml"} 
[2025-09-23 20:01:29] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 20:01:29] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-23 20:01:29] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 20:01:29] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"G^<o\u000e|sR\u0005q7\u0010+k8q\u0003f;KIN...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 2ie\u0007['...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u000b,*9\tc5\u000b\u0014{\u0014i6...[2 more bytes]","is_binary":true}]} 
[2025-09-23 20:01:29] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 20:01:29] local.DEBUG: QR code with crypto tags generated {"length":4420} 
[2025-09-23 20:01:29] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":190,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 20:11:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:11:37] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 20:11:37] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 20:11:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:11:37] local.INFO: Starting unsigned XML generation {"invoice_number":"001000191","uuid":"c1b42db4-9773-4ca3-a695-ec876d7738bd"} 
[2025-09-23 20:11:37] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 20:11:37] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 20:11:37] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 20:11:37] local.DEBUG: === END DEBUG ===  
[2025-09-23 20:11:37] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 20:11:37] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000191"} 
[2025-09-23 20:11:37] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 20:11:37] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 20:11:37] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 20:11:37] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 20:11:37] local.DEBUG: Supplier party built successfully  
[2025-09-23 20:11:37] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 20:11:37] local.DEBUG: Buyer party built successfully  
[2025-09-23 20:11:37] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 20:11:37] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 20:11:37] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 20:11:37] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 20:11:37] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 20:11:37] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 20:11:37] local.DEBUG: Building additional document references  
[2025-09-23 20:11:37] local.DEBUG: Added ICV reference {"icv":"191"} 
[2025-09-23 20:11:37] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 20:11:37] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"191"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 20:11:37] local.DEBUG: Invoice object created successfully {"id":"001000191","uuid":"c1b42db4-9773-4ca3-a695-ec876d7738bd","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 20:11:37] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000191-unsigned.xml","file_size":5241} 
[2025-09-23 20:11:37] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000191-unsigned.xml"} 
[2025-09-23 20:11:37] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000191-signed-1758643897.xml"} 
[2025-09-23 20:11:37] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 20:11:37] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 20:11:37] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 20:11:37] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":">+\u0001\u0002F\u001d\\)hn\u0007u\u0000Ho\u0015...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000\u000b\f\u0014.\u0012\u001d\u0000\u001d...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"PV\u0017\u0005\t'\u0003*\u0010,'?\u0005...[2 more bytes]","is_binary":true}]} 
[2025-09-23 20:11:37] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 20:11:37] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-23 20:11:37] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":191,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 20:33:53] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:33:53] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 20:33:53] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 20:33:53] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:33:53] local.INFO: Starting unsigned XML generation {"invoice_number":"001000192","uuid":"eac1f29d-3f8f-4d13-967d-1130700d670b"} 
[2025-09-23 20:33:53] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 20:33:53] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 20:33:53] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 20:33:53] local.DEBUG: === END DEBUG ===  
[2025-09-23 20:33:53] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 20:33:53] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000192"} 
[2025-09-23 20:33:53] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 20:33:53] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 20:33:53] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 20:33:53] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 20:33:53] local.DEBUG: Supplier party built successfully  
[2025-09-23 20:33:53] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 20:33:53] local.DEBUG: Buyer party built successfully  
[2025-09-23 20:33:53] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 20:33:53] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 20:33:53] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 20:33:53] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 20:33:53] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 20:33:53] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 20:33:53] local.DEBUG: Building additional document references  
[2025-09-23 20:33:53] local.DEBUG: Added ICV reference {"icv":"192"} 
[2025-09-23 20:33:53] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 20:33:53] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"192"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 20:33:53] local.DEBUG: Invoice object created successfully {"id":"001000192","uuid":"eac1f29d-3f8f-4d13-967d-1130700d670b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 20:33:53] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000192-unsigned.xml","file_size":5241} 
[2025-09-23 20:33:53] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000192-unsigned.xml"} 
[2025-09-23 20:33:53] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000192-signed-1758645233.xml"} 
[2025-09-23 20:33:53] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 20:33:53] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 20:33:53] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 20:33:53] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"/(cbU!{\u000fQ0\u0005+8~0WJ...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000M\u0011#\u0002~\u0017\u0007\u0000D...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"KD.zN6\u000eM\u000b=@Ar#\u0003\u0013...[2 more bytes]","is_binary":true}]} 
[2025-09-23 20:33:53] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 20:33:53] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-23 20:33:53] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":192,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-23 20:33:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:33:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-23 20:33:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-23 20:33:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-23 20:33:59] local.INFO: Starting unsigned XML generation {"invoice_number":"001000193","uuid":"5cbdd6f1-e8e4-4e4e-8393-632d26e38fa5"} 
[2025-09-23 20:33:59] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-23 20:33:59] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-23 20:33:59] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-23 20:33:59] local.DEBUG: === END DEBUG ===  
[2025-09-23 20:33:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-23 20:33:59] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000193"} 
[2025-09-23 20:33:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-23 20:33:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-23 20:33:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-23 20:33:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-23 20:33:59] local.DEBUG: Supplier party built successfully  
[2025-09-23 20:33:59] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-23 20:33:59] local.DEBUG: Buyer party built successfully  
[2025-09-23 20:33:59] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-23 20:33:59] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-23 20:33:59] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-23 20:33:59] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-23 20:33:59] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-23 20:33:59] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-23 20:33:59] local.DEBUG: Building additional document references  
[2025-09-23 20:33:59] local.DEBUG: Added ICV reference {"icv":"193"} 
[2025-09-23 20:33:59] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-23 20:33:59] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"193"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-23 20:33:59] local.DEBUG: Invoice object created successfully {"id":"001000193","uuid":"5cbdd6f1-e8e4-4e4e-8393-632d26e38fa5","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-23 20:33:59] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000193-unsigned.xml","file_size":5241} 
[2025-09-23 20:33:59] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000193-unsigned.xml"} 
[2025-09-23 20:33:59] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000193-signed-1758645239.xml"} 
[2025-09-23 20:33:59] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-23 20:33:59] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-23 20:33:59] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-23 20:33:59] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"pFV\u001529h\u001bUl;M*H...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000w9
}Lr2lr\"\u00032\"...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0017\by}%\fE$!Jp;\u0000\tI...[2 more bytes]","is_binary":true}]} 
[2025-09-23 20:33:59] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-23 20:34:00] local.DEBUG: QR code with crypto tags generated {"length":4544} 
[2025-09-23 20:34:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":193,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 08:11:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:11:56] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:11:56] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 08:11:56] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 08:11:56] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:11:56] local.INFO: Starting unsigned XML generation {"invoice_number":"001000194","uuid":"0d095492-b022-4f2b-8d57-c583b7073a36"} 
[2025-09-24 08:11:56] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 08:11:56] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 08:11:56] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 08:11:56] local.DEBUG: === END DEBUG ===  
[2025-09-24 08:11:56] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 08:11:56] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000194"} 
[2025-09-24 08:11:56] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 08:11:56] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 08:11:56] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 08:11:56] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 08:11:56] local.DEBUG: Supplier party built successfully  
[2025-09-24 08:11:56] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 08:11:56] local.DEBUG: Buyer party built successfully  
[2025-09-24 08:11:56] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 08:11:56] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 08:11:56] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 08:11:56] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 08:11:56] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 08:11:56] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 08:11:56] local.DEBUG: Building additional document references  
[2025-09-24 08:11:56] local.DEBUG: Added ICV reference {"icv":"194"} 
[2025-09-24 08:11:56] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-24 08:11:56] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"194"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-24 08:11:56] local.DEBUG: Invoice object created successfully {"id":"001000194","uuid":"0d095492-b022-4f2b-8d57-c583b7073a36","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 08:11:56] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000194-unsigned.xml","file_size":5241} 
[2025-09-24 08:11:56] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000194-unsigned.xml"} 
[2025-09-24 08:11:56] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000194-signed-1758687116.xml"} 
[2025-09-24 08:11:56] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 08:11:56] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 08:11:56] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 08:11:56] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"Mc\u0017-V2&(51\fd...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000K<\\\u001b\u0005`=4;@\u001d\f...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"zOm%=x3\u0000^loC%\u0004&\u001b...[2 more bytes]","is_binary":true}]} 
[2025-09-24 08:11:56] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 08:11:56] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 08:11:56] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":194,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 08:27:21] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:27:21] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 08:27:21] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 08:27:21] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:27:21] local.INFO: Starting unsigned XML generation {"invoice_number":"001000195","uuid":"f738174d-c7c6-4ce3-a717-d50c5639bc1b"} 
[2025-09-24 08:27:21] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 08:27:21] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 08:27:21] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 08:27:21] local.DEBUG: === END DEBUG ===  
[2025-09-24 08:27:21] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 08:27:21] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000195"} 
[2025-09-24 08:27:21] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 08:27:21] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 08:27:21] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 08:27:21] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 08:27:21] local.DEBUG: Supplier party built successfully  
[2025-09-24 08:27:21] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 08:27:21] local.DEBUG: Buyer party built successfully  
[2025-09-24 08:27:21] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 08:27:21] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 08:27:21] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 08:27:21] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 08:27:21] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 08:27:21] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 08:27:21] local.DEBUG: Building additional document references  
[2025-09-24 08:27:21] local.DEBUG: Added ICV reference {"icv":"195"} 
[2025-09-24 08:27:21] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-24 08:27:21] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"195"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-24 08:27:21] local.DEBUG: Invoice object created successfully {"id":"001000195","uuid":"f738174d-c7c6-4ce3-a717-d50c5639bc1b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 08:27:21] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000195-unsigned.xml","file_size":5241} 
[2025-09-24 08:27:21] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000195-unsigned.xml"} 
[2025-09-24 08:27:21] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000195-signed-1758688041.xml"} 
[2025-09-24 08:27:21] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 08:27:21] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 08:27:21] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 08:27:21] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u0019\u0014p$M:;\u0011R_W\fp9\u0013\u000b]O...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 J^\"IAU\u0017.9f&N4g\f...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":".\"\u001cDw\u0001.#N H\u0013`...[2 more bytes]","is_binary":true}]} 
[2025-09-24 08:27:21] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 08:27:21] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 08:27:21] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":195,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 08:27:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:27:47] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 08:27:47] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 08:27:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:27:47] local.INFO: Starting unsigned XML generation {"invoice_number":"001000196","uuid":"9f67b5bb-e1f7-443c-ba24-ab0768f160f0"} 
[2025-09-24 08:27:47] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 08:27:47] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 08:27:47] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 08:27:47] local.DEBUG: === END DEBUG ===  
[2025-09-24 08:27:47] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 08:27:47] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000196"} 
[2025-09-24 08:27:47] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 08:27:47] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 08:27:47] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 08:27:47] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 08:27:47] local.DEBUG: Supplier party built successfully  
[2025-09-24 08:27:47] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 08:27:47] local.DEBUG: Buyer party built successfully  
[2025-09-24 08:27:47] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 08:27:47] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 08:27:47] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 08:27:47] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 08:27:47] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 08:27:47] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 08:27:47] local.DEBUG: Building additional document references  
[2025-09-24 08:27:47] local.DEBUG: Added ICV reference {"icv":"196"} 
[2025-09-24 08:27:47] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-24 08:27:47] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"196"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-24 08:27:47] local.DEBUG: Invoice object created successfully {"id":"001000196","uuid":"9f67b5bb-e1f7-443c-ba24-ab0768f160f0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 08:27:47] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000196-unsigned.xml","file_size":5241} 
[2025-09-24 08:27:47] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000196-unsigned.xml"} 
[2025-09-24 08:27:47] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000196-signed-1758688067.xml"} 
[2025-09-24 08:27:47] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 08:27:47] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 08:27:47] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 08:27:47] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"gk\u000b+vOt\u001aO()J{...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000\u0013e\u0003P\u0003\u0003,\u0017\u001d\u0015<'`)\fy...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"JZ[w|wC\u001bO\u0001r~Zl\u0015...[2 more bytes]","is_binary":true}]} 
[2025-09-24 08:27:47] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 08:27:47] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 08:27:47] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":196,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 08:32:58] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:32:58] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 08:32:58] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 08:32:58] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 08:32:58] local.INFO: Starting unsigned XML generation {"invoice_number":"001000197","uuid":"83b37a58-c529-445c-bb4d-0809dd169d69"} 
[2025-09-24 08:32:58] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 08:32:58] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 08:32:58] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 08:32:58] local.DEBUG: === END DEBUG ===  
[2025-09-24 08:32:58] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 08:32:58] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000197"} 
[2025-09-24 08:32:58] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 08:32:58] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 08:32:58] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 08:32:58] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 08:32:58] local.DEBUG: Supplier party built successfully  
[2025-09-24 08:32:58] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 08:32:58] local.DEBUG: Buyer party built successfully  
[2025-09-24 08:32:58] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 08:32:58] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 08:32:58] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 08:32:58] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 08:32:58] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 08:32:58] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 08:32:58] local.DEBUG: Building additional document references  
[2025-09-24 08:32:58] local.DEBUG: Added ICV reference {"icv":"197"} 
[2025-09-24 08:32:58] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-24 08:32:58] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"197"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-24 08:32:58] local.DEBUG: Invoice object created successfully {"id":"001000197","uuid":"83b37a58-c529-445c-bb4d-0809dd169d69","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 08:32:58] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000197-unsigned.xml","file_size":5241} 
[2025-09-24 08:32:58] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000197-unsigned.xml"} 
[2025-09-24 08:32:58] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000197-signed-1758688378.xml"} 
[2025-09-24 08:32:58] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 08:32:58] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 08:32:58] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 08:32:58] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"IEn\f\u0010\u0017'SMuCH5...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000ojh\">\u0004_\u00017u...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"s4\u001d_]\u0017\u0003pXQT\tf...[2 more bytes]","is_binary":true}]} 
[2025-09-24 08:32:58] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 08:32:58] local.DEBUG: QR PNG image generated for display {"image_length":4572,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 08:32:58] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 08:32:58] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":197,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 13:33:16] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:33:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:33:39] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 13:33:39] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 13:33:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:33:45] local.INFO: Starting unsigned XML generation {"invoice_number":"001000198","uuid":"e84adad7-48a0-4751-a24d-e46fbaeae4b0"} 
[2025-09-24 13:33:45] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:33:45] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:33:45] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:33:45] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:33:45] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:33:45] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000198"} 
[2025-09-24 13:33:45] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:33:45] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:33:45] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:33:45] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:33:45] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:33:45] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:33:45] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:33:45] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:33:46] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:33:46] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:33:46] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:33:46] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:33:46] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:33:46] local.DEBUG: Building additional document references  
[2025-09-24 13:33:46] local.DEBUG: Added ICV reference {"icv":"198"} 
[2025-09-24 13:33:46] local.WARNING: No QR content provided for embedding  
[2025-09-24 13:33:46] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"198"}]} 
[2025-09-24 13:33:46] local.DEBUG: Invoice object created successfully {"id":"001000198","uuid":"e84adad7-48a0-4751-a24d-e46fbaeae4b0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:33:46] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000198-unsigned.xml","file_size":5040} 
[2025-09-24 13:33:46] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000198-unsigned.xml"} 
[2025-09-24 13:33:46] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000198-signed-1758706426.xml"} 
[2025-09-24 13:33:46] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 13:33:46] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 13:33:47] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 13:33:47] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"_U\u000eH;O\u000b\u0019dq\u001e
\u000f...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000~\u0006=\u001f2nS`
u.p9bf...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"IEn\f\u0010\u0017'SMuCH5...[2 more bytes]","is_binary":true}]} 
[2025-09-24 13:33:47] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 13:33:49] local.DEBUG: QR PNG image generated for display {"image_length":4608,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 13:33:49] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 13:33:49] local.INFO: Starting unsigned XML generation {"invoice_number":"001000198","uuid":"e84adad7-48a0-4751-a24d-e46fbaeae4b0"} 
[2025-09-24 13:33:49] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:33:49] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:33:49] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:33:49] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:33:49] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:33:49] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000198"} 
[2025-09-24 13:33:49] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:33:49] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:33:49] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:33:49] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:33:49] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:33:49] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:33:49] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:33:49] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:33:49] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:33:49] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:33:49] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:33:49] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:33:49] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:33:49] local.DEBUG: Building additional document references  
[2025-09-24 13:33:49] local.DEBUG: Added ICV reference {"icv":"198"} 
[2025-09-24 13:33:49] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 13:33:49] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"198"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGIF+Aq5xVn7GMDuLBx49If387TwvExJUZZKJxHgr7D/RfB0cwRQIhAMC3fgaE2j0fMm7/U2AKra51LnA5qvJixGYhpSBdpaNgAiAR2fV38Pnube93SUCkGmPcYdq19UNclu2DU8lc26aiMwhYMFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEJ45eqTGZtvq5xcL1PSzXBw/sQqcEBM/Xscj5RY8gAK2LORb2sNjx3bvMEVYp8SPIVfydnRZmg66rEtpPfj5begkgSUVuDPLS+eSi3v0Q3bC7FydTo8hNdX9D9N9IvjWA+7w="}]} 
[2025-09-24 13:33:49] local.DEBUG: Invoice object created successfully {"id":"001000198","uuid":"e84adad7-48a0-4751-a24d-e46fbaeae4b0","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:33:49] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000198-unsigned.xml","file_size":5549} 
[2025-09-24 13:33:49] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000198-signed-1758706429.xml"} 
[2025-09-24 13:33:49] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":198,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 13:34:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:34:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 13:34:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 13:34:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:34:59] local.INFO: Starting unsigned XML generation {"invoice_number":"001000199","uuid":"02706e23-d6a8-495d-a2dd-f7d5b87eb404"} 
[2025-09-24 13:34:59] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:34:59] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:34:59] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:34:59] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:34:59] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:34:59] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000199"} 
[2025-09-24 13:34:59] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:34:59] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:34:59] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:34:59] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:34:59] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:34:59] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:34:59] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:34:59] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:34:59] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:34:59] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:34:59] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:34:59] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:34:59] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:34:59] local.DEBUG: Building additional document references  
[2025-09-24 13:34:59] local.DEBUG: Added ICV reference {"icv":"199"} 
[2025-09-24 13:34:59] local.WARNING: No QR content provided for embedding  
[2025-09-24 13:34:59] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"199"}]} 
[2025-09-24 13:34:59] local.DEBUG: Invoice object created successfully {"id":"001000199","uuid":"02706e23-d6a8-495d-a2dd-f7d5b87eb404","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:34:59] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000199-unsigned.xml","file_size":5040} 
[2025-09-24 13:34:59] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000199-unsigned.xml"} 
[2025-09-24 13:35:00] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000199-signed-1758706500.xml"} 
[2025-09-24 13:35:00] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 13:35:00] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 13:35:00] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 13:35:00] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"}p9'hLaW#Apd\u0011...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 \"b]\u001a{H<>9]y2/\u0001w A...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"'%F\f\u001e\"dT,\b<%$\fF2i\u001a...[2 more bytes]","is_binary":true}]} 
[2025-09-24 13:35:00] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 13:35:00] local.DEBUG: QR PNG image generated for display {"image_length":4552,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 13:35:00] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 13:35:00] local.INFO: Starting unsigned XML generation {"invoice_number":"001000199","uuid":"02706e23-d6a8-495d-a2dd-f7d5b87eb404"} 
[2025-09-24 13:35:00] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:35:00] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:35:00] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:35:00] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:35:00] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:35:00] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000199"} 
[2025-09-24 13:35:00] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:35:00] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:35:00] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:35:00] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:35:00] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:35:00] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:35:00] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:35:00] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:35:00] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:35:00] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:35:00] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:35:00] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:35:00] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:35:00] local.DEBUG: Building additional document references  
[2025-09-24 13:35:00] local.DEBUG: Added ICV reference {"icv":"199"} 
[2025-09-24 13:35:00] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 13:35:00] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"199"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGIH1wOSdo7eyhTMxhV5sj599B7Phw0IfDl+Bk5BHO/Ol/B0YwRAIgImJdGoWm0f57SDw+OV15ozIvqvgBd+UgnEEZhS3M35ICIHYtaPch1RcxLE88bS19LOZbw3ODC9BInAvCsVKa/OLKCFgwVjAQBgcqhkjOPQIBBgUrgQQACgNCAAQnjl6pMZm2+rnFwvU9LNcHD+xCpwQEz9exyPlFjyAArYs5Fvaw2PHdu8wRVinxI8hV/J2dFmaDrqsS2k9+Plt6CSAnkiX8RqQMHiLaZKbIVCz5CDzMJZckDLlGMmn65xqt1A=="}]} 
[2025-09-24 13:35:00] local.DEBUG: Invoice object created successfully {"id":"001000199","uuid":"02706e23-d6a8-495d-a2dd-f7d5b87eb404","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:35:00] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000199-unsigned.xml","file_size":5549} 
[2025-09-24 13:35:00] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000199-signed-1758706500.xml"} 
[2025-09-24 13:35:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":199,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 13:36:06] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:36:06] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 13:36:06] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 13:36:06] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:36:06] local.INFO: Starting unsigned XML generation {"invoice_number":"001000200","uuid":"daab0c90-717e-4d9d-aaac-5f856ecf31dd"} 
[2025-09-24 13:36:06] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:36:06] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:36:06] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:36:06] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:36:06] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:36:06] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000200"} 
[2025-09-24 13:36:06] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:36:06] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:36:06] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:36:06] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:36:06] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:36:06] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:36:06] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:36:06] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:36:06] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:36:06] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:36:06] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:36:06] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:36:06] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:36:06] local.DEBUG: Building additional document references  
[2025-09-24 13:36:06] local.DEBUG: Added ICV reference {"icv":"200"} 
[2025-09-24 13:36:06] local.DEBUG: Added QR reference {"qr_length":84,"qr_preview":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMT..."} 
[2025-09-24 13:36:06] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"200"},{"id":"QR","uuid":"AQdOZXRwbGV4Ag8zMTIzNDU2Nzg5MzAwMDMDFDIwMjUtMDktMTFUMTk6MjQ6MjBaBAU0NS4wMAUEMi4xNA=="}]} 
[2025-09-24 13:36:06] local.DEBUG: Invoice object created successfully {"id":"001000200","uuid":"daab0c90-717e-4d9d-aaac-5f856ecf31dd","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:36:06] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000200-unsigned.xml","file_size":5241} 
[2025-09-24 13:36:06] local.DEBUG: Initial unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000200-unsigned.xml"} 
[2025-09-24 13:36:06] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000200-signed-1758706566.xml"} 
[2025-09-24 13:36:06] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 13:36:06] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 13:36:06] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 13:36:06] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"Rb=&S*!V\u0017\u000b...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000}\u001biw\u0012z8a\u001bVD+...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"VfX%b;G\fNP^UyyA\u001f...[2 more bytes]","is_binary":true}]} 
[2025-09-24 13:36:06] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 13:36:06] local.DEBUG: QR PNG image generated for display {"image_length":4500,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 13:36:06] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 13:36:06] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":200,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 13:36:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:36:34] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 13:36:34] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 13:36:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:36:34] local.INFO: Starting unsigned XML generation {"invoice_number":"001000201","uuid":"72245924-4262-42ef-90a0-5f96b74cf180"} 
[2025-09-24 13:36:34] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:36:34] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:36:34] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:36:34] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:36:34] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:36:34] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000201"} 
[2025-09-24 13:36:34] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:36:34] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:36:34] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:36:34] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:36:34] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:36:34] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:36:34] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:36:34] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:36:34] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:36:34] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:36:34] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:36:34] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:36:34] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:36:34] local.DEBUG: Building additional document references  
[2025-09-24 13:36:34] local.DEBUG: Added ICV reference {"icv":"201"} 
[2025-09-24 13:36:34] local.WARNING: No QR content provided for embedding  
[2025-09-24 13:36:34] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"201"}]} 
[2025-09-24 13:36:34] local.DEBUG: Invoice object created successfully {"id":"001000201","uuid":"72245924-4262-42ef-90a0-5f96b74cf180","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:36:34] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000201-unsigned.xml","file_size":5040} 
[2025-09-24 13:36:34] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000201-unsigned.xml"} 
[2025-09-24 13:36:34] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000201-signed-1758706594.xml"} 
[2025-09-24 13:36:34] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 13:36:34] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-24 13:36:34] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 13:36:34] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"N@Wz70\u0010eWq4...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000S\u0014_,Vc`\u0011Z5z:...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"Rb=&S*!V\u0017\u000b...[2 more bytes]","is_binary":true}]} 
[2025-09-24 13:36:34] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 13:36:35] local.DEBUG: QR PNG image generated for display {"image_length":4460,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 13:36:35] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 13:36:35] local.INFO: Starting unsigned XML generation {"invoice_number":"001000201","uuid":"72245924-4262-42ef-90a0-5f96b74cf180"} 
[2025-09-24 13:36:35] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:36:35] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:36:35] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:36:35] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:36:35] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:36:35] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000201"} 
[2025-09-24 13:36:35] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:36:35] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:36:35] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:36:35] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:36:35] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:36:35] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:36:35] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:36:35] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:36:35] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:36:35] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:36:35] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:36:35] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:36:35] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:36:35] local.DEBUG: Building additional document references  
[2025-09-24 13:36:35] local.DEBUG: Added ICV reference {"icv":"201"} 
[2025-09-24 13:36:35] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 13:36:35] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"201"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGIE5A4JDAipmeu1d68483pdXiMNaO4NwQZetXcZuoNFZNB0gwRgIhALWRvtSE3lPYFLCuXyzoVmNgEfdahTV6OqMsKchIgkmrAiEAymCf4N61aKqdNiFnxLLQmQITIckGWu2dHkrnlRS2N90IWDBWMBAGByqGSM49AgEGBSuBBAAKA0IABCeOXqkxmbb6ucXC9T0s1wcP7EKnBATP17HI+UWPIACtizkW9rDY8d27zBFWKfEjyFX8nZ0WZoOuqxLaT34+W3oJIFKzvsSGYoc9v84mvlMql4G+utzdme4hqIL0Vhf2C00G"}]} 
[2025-09-24 13:36:35] local.DEBUG: Invoice object created successfully {"id":"001000201","uuid":"72245924-4262-42ef-90a0-5f96b74cf180","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:36:35] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000201-unsigned.xml","file_size":5549} 
[2025-09-24 13:36:35] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000201-signed-1758706595.xml"} 
[2025-09-24 13:36:35] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":201,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 13:40:53] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:40:53] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 13:40:53] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 13:40:53] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:40:53] local.INFO: Starting unsigned XML generation {"invoice_number":"001000202","uuid":"e2ebd69e-a33e-4484-9b86-064db33c3971"} 
[2025-09-24 13:40:53] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:40:53] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:40:53] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:40:53] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:40:53] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:40:53] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000202"} 
[2025-09-24 13:40:53] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:40:53] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:40:53] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:40:53] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:40:53] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:40:53] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:40:53] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:40:53] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:40:53] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:40:53] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:40:53] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:40:53] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:40:53] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:40:53] local.DEBUG: Building additional document references  
[2025-09-24 13:40:53] local.DEBUG: Added ICV reference {"icv":"202"} 
[2025-09-24 13:40:53] local.WARNING: No QR content provided for embedding  
[2025-09-24 13:40:53] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"202"}]} 
[2025-09-24 13:40:53] local.DEBUG: Invoice object created successfully {"id":"001000202","uuid":"e2ebd69e-a33e-4484-9b86-064db33c3971","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:40:53] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000202-unsigned.xml","file_size":5040} 
[2025-09-24 13:40:53] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000202-unsigned.xml"} 
[2025-09-24 13:40:53] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000202-signed-1758706853.xml"} 
[2025-09-24 13:40:53] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 13:40:53] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 13:40:53] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 13:40:53] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"$fHFX#LiA4Il9]j\\E...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 '\u001aP\u0013Op:V\u0011)|7\u0003hz...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"qQO'\u000fj1+!Ha4?(
6Z...[2 more bytes]","is_binary":true}]} 
[2025-09-24 13:40:53] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 13:40:53] local.DEBUG: QR PNG image generated for display {"image_length":4484,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 13:40:53] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 13:40:53] local.INFO: Starting unsigned XML generation {"invoice_number":"001000202","uuid":"e2ebd69e-a33e-4484-9b86-064db33c3971"} 
[2025-09-24 13:40:53] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:40:53] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:40:53] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:40:53] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:40:53] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:40:53] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000202"} 
[2025-09-24 13:40:53] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:40:53] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:40:53] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:40:53] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:40:53] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:40:53] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:40:53] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:40:53] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:40:53] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:40:53] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:40:53] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:40:53] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:40:53] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:40:53] local.DEBUG: Building additional document references  
[2025-09-24 13:40:53] local.DEBUG: Added ICV reference {"icv":"202"} 
[2025-09-24 13:40:53] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 13:40:53] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"202"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGICTY8mZIRrRY1SPi6cTITPi0aUHlNEls0TldalxFgiRXB0cwRQIgJxpQE09wOlag7xGTy8rGxSl8qdXtozcDaHprxtBSfkUCIQDOjcjKalEuCkUIExzIe11XweGYX0YcmamRtVE9MZEhZQhYMFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEJ45eqTGZtvq5xcL1PSzXBw/sQqcEBM/Xscj5RY8gAK2LORb2sNjx3bvMEVYp8SPIVfydnRZmg66rEtpPfj5begkgcVHFT5a+J5qOD2oxKyFIYfY00q/RPygKNu7wqfRavU4="}]} 
[2025-09-24 13:40:53] local.DEBUG: Invoice object created successfully {"id":"001000202","uuid":"e2ebd69e-a33e-4484-9b86-064db33c3971","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:40:53] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000202-unsigned.xml","file_size":5549} 
[2025-09-24 13:40:53] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000202-signed-1758706853.xml"} 
[2025-09-24 13:40:53] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":202,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 13:50:28] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:50:29] local.DEBUG: Final line items before PDF generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 13:50:29] local.DEBUG: Certificate loaded successfully for QR display {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 13:50:32] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 13:50:32] local.INFO: Starting unsigned XML generation {"invoice_number":"001000203","uuid":"cd7a53ab-9ff0-4b63-acc4-ebd568b70c34"} 
[2025-09-24 13:50:32] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 13:50:32] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 13:50:32] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 13:50:32] local.DEBUG: === END DEBUG ===  
[2025-09-24 13:50:32] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 13:50:32] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000203"} 
[2025-09-24 13:50:32] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 13:50:32] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 13:50:32] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 13:50:32] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 13:50:32] local.DEBUG: Supplier party built successfully  
[2025-09-24 13:50:32] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 13:50:32] local.DEBUG: Buyer party built successfully  
[2025-09-24 13:50:32] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 13:50:32] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 13:50:32] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 13:50:32] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 13:50:32] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 13:50:32] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 13:50:32] local.DEBUG: Building additional document references  
[2025-09-24 13:50:33] local.DEBUG: Added ICV reference {"icv":"203"} 
[2025-09-24 13:50:33] local.WARNING: No QR content provided for embedding  
[2025-09-24 13:50:33] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"203"}]} 
[2025-09-24 13:50:33] local.DEBUG: Invoice object created successfully {"id":"001000203","uuid":"cd7a53ab-9ff0-4b63-acc4-ebd568b70c34","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 13:50:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000203-unsigned.xml","file_size":5040} 
[2025-09-24 13:50:33] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 13:50:33] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 13:50:33] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 13:50:33] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u0014$h
5K!'h\u0017...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000\\xaCgsf\u0011\u0012jE...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"*j\u001f2Ll)\u001d\u0016\u001aOd|...[2 more bytes]","is_binary":true}]} 
[2025-09-24 13:50:33] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 13:50:34] local.DEBUG: QR PNG image generated for display {"image_length":4532,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 14:14:03] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 14:14:03] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 14:14:03] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 14:14:03] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 14:14:03] local.INFO: Starting unsigned XML generation {"invoice_number":"001000203","uuid":"4416f6d7-f24e-4af2-a89e-71285e161e3f","suffix":""} 
[2025-09-24 14:14:03] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 14:14:03] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 14:14:03] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 14:14:03] local.DEBUG: === END DEBUG ===  
[2025-09-24 14:14:03] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 14:14:03] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000203","suffix":""} 
[2025-09-24 14:14:03] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 14:14:03] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 14:14:03] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 14:14:03] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 14:14:03] local.DEBUG: Supplier party built successfully  
[2025-09-24 14:14:03] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 14:14:03] local.DEBUG: Buyer party built successfully  
[2025-09-24 14:14:03] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 14:14:03] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 14:14:03] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 14:14:03] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 14:14:03] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 14:14:03] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 14:14:03] local.DEBUG: Building additional document references  
[2025-09-24 14:14:03] local.DEBUG: Added ICV reference {"icv":"203"} 
[2025-09-24 14:14:03] local.WARNING: No QR content provided for embedding  
[2025-09-24 14:14:03] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"203"}]} 
[2025-09-24 14:14:03] local.DEBUG: Invoice object created successfully {"id":"001000203","uuid":"4416f6d7-f24e-4af2-a89e-71285e161e3f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 14:14:03] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000203-unsigned.xml","file_size":5040,"suffix_used":""} 
[2025-09-24 14:14:03] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000203-unsigned.xml"} 
[2025-09-24 14:14:04] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000203-signed-1758708844.xml"} 
[2025-09-24 14:14:04] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 14:14:04] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-24 14:14:04] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 14:14:04] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"Mk/gw\u00173\u0018
$ON>\u000e5 ...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000w+DC\u0012Lo\u0010+65L\"\u001a...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"*j\u001f2Ll)\u001d\u0016\u001aOd|...[2 more bytes]","is_binary":true}]} 
[2025-09-24 14:14:04] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 14:14:04] local.DEBUG: QR PNG image generated for display {"image_length":4524,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 14:14:04] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 14:14:04] local.INFO: Starting unsigned XML generation {"invoice_number":"001000203","uuid":"4416f6d7-f24e-4af2-a89e-71285e161e3f","suffix":""} 
[2025-09-24 14:14:04] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 14:14:04] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 14:14:04] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 14:14:04] local.DEBUG: === END DEBUG ===  
[2025-09-24 14:14:04] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 14:14:04] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000203","suffix":""} 
[2025-09-24 14:14:04] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 14:14:04] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 14:14:04] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 14:14:04] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 14:14:04] local.DEBUG: Supplier party built successfully  
[2025-09-24 14:14:04] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 14:14:04] local.DEBUG: Buyer party built successfully  
[2025-09-24 14:14:04] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 14:14:04] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 14:14:04] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 14:14:04] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 14:14:04] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 14:14:04] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 14:14:04] local.DEBUG: Building additional document references  
[2025-09-24 14:14:04] local.DEBUG: Added ICV reference {"icv":"203"} 
[2025-09-24 14:14:04] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 14:14:04] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"203"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGIIFN+GutyO0viGeV5Hf5FzMYDSRPTj7YDpI1mSCCgdqpB0gwRgIhAPDWdyvbREMSTOnWym8QKzY1TCIai9qAntlJwSzuWhDSAiEAqNM97IxUrvKtnBUALv6flqpnKHtruEiHikhgoGRHExQIWDBWMBAGByqGSM49AgEGBSuBBAAKA0IABCeOXqkxmbb6ucXC9T0s1wcP7EKnBATP17HI+UWPIACtizkW9rDY8d27zBFWKfEjyFX8nZ0WZoOuqxLaT34+W3oJIMUqah+jMkyEyciAuWwppqWUkR2pv6AWwBpPgWR87dHT"}]} 
[2025-09-24 14:14:04] local.DEBUG: Invoice object created successfully {"id":"001000203","uuid":"4416f6d7-f24e-4af2-a89e-71285e161e3f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 14:14:04] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000203-unsigned.xml","file_size":5549,"suffix_used":""} 
[2025-09-24 14:14:04] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000203-signed-1758708844.xml"} 
[2025-09-24 14:14:04] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":203,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 14:25:05] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 14:25:05] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 14:25:05] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 14:25:05] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 14:25:05] local.INFO: Starting unsigned XML generation {"invoice_number":"001000204","uuid":"821a7d09-a388-40f9-91b3-ace59d0d179b","suffix":"noqr"} 
[2025-09-24 14:25:05] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 14:25:05] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 14:25:05] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 14:25:05] local.DEBUG: === END DEBUG ===  
[2025-09-24 14:25:05] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 14:25:05] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000204","suffix":"-noqr"} 
[2025-09-24 14:25:05] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 14:25:05] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 14:25:05] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 14:25:05] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 14:25:05] local.DEBUG: Supplier party built successfully  
[2025-09-24 14:25:05] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 14:25:05] local.DEBUG: Buyer party built successfully  
[2025-09-24 14:25:05] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 14:25:05] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 14:25:05] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 14:25:05] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 14:25:05] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 14:25:05] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 14:25:05] local.DEBUG: Building additional document references  
[2025-09-24 14:25:05] local.DEBUG: Added ICV reference {"icv":"204"} 
[2025-09-24 14:25:05] local.WARNING: No QR content provided for embedding  
[2025-09-24 14:25:05] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"204"}]} 
[2025-09-24 14:25:05] local.DEBUG: Invoice object created successfully {"id":"001000204","uuid":"821a7d09-a388-40f9-91b3-ace59d0d179b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 14:25:05] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000204-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 14:25:05] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000204-unsigned-noqr.xml"} 
[2025-09-24 14:25:05] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000204-signed-1758709505.xml"} 
[2025-09-24 14:25:05] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 14:25:05] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-24 14:25:05] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 14:25:05] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"md
_jBzQ\u0001\u0010\u0002M|GbO\t\u0017\"...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000Tw_pz)\u000eYG,*@z....[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0011>4F>?S0l7\u000eQk...[2 more bytes]","is_binary":true}]} 
[2025-09-24 14:25:05] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 14:25:05] local.DEBUG: QR PNG image generated for display {"image_length":4524,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 14:25:05] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 14:25:05] local.INFO: Starting unsigned XML generation {"invoice_number":"001000204","uuid":"821a7d09-a388-40f9-91b3-ace59d0d179b","suffix":"withqr"} 
[2025-09-24 14:25:05] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 14:25:05] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 14:25:05] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 14:25:05] local.DEBUG: === END DEBUG ===  
[2025-09-24 14:25:05] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 14:25:05] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000204","suffix":"-withqr"} 
[2025-09-24 14:25:05] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 14:25:05] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 14:25:05] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 14:25:05] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 14:25:05] local.DEBUG: Supplier party built successfully  
[2025-09-24 14:25:05] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 14:25:05] local.DEBUG: Buyer party built successfully  
[2025-09-24 14:25:05] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 14:25:05] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 14:25:05] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 14:25:05] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 14:25:05] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 14:25:05] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 14:25:05] local.DEBUG: Building additional document references  
[2025-09-24 14:25:05] local.DEBUG: Added ICV reference {"icv":"204"} 
[2025-09-24 14:25:05] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 14:25:05] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"204"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGIG1kDV9qhpZCetlRmM8B+eoQAk3//3xH5WJPCRcijb66B0gwRgIhAKy4kb2fVPLyd19wm3qKKQ5ZRywqQHqqLutf/Y0U0B9gAiEAvngCWCQL56ng7WNM54sRnqGLQp7xbGAM3sWYtcu8BlwIWDBWMBAGByqGSM49AgEGBSuBBAAKA0IABCeOXqkxmbb6ucXC9T0s1wcP7EKnBATP17HI+UWPIACtizkW9rDY8d27zBFWKfEjyFX8nZ0WZoOuqxLaT34+W3oJIJsR2j40nMXSRujSPrw/7NaHU/Qw3r9sNw5RhWvS8IDP"}]} 
[2025-09-24 14:25:05] local.DEBUG: Invoice object created successfully {"id":"001000204","uuid":"821a7d09-a388-40f9-91b3-ace59d0d179b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 14:25:05] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000204-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 14:25:05] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000204-signed-1758709505.xml"} 
[2025-09-24 14:25:05] local.DEBUG: Cleaned up temporary file {"file":"001000204-unsigned-noqr.xml"} 
[2025-09-24 14:25:05] local.DEBUG: Cleaned up temporary file {"file":"001000204-signed-1758709505.xml"} 
[2025-09-24 14:25:05] local.DEBUG: Cleaned up temporary file {"file":"001000204-unsigned-withqr.xml"} 
[2025-09-24 14:25:05] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":204,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 14:47:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 14:47:45] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 14:47:45] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 14:47:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 14:47:45] local.INFO: Starting unsigned XML generation {"invoice_number":"001000205","uuid":"bc8eddca-193e-4bb1-ba85-096f1be74787","suffix":"noqr"} 
[2025-09-24 14:47:45] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 14:47:45] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 14:47:45] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 14:47:45] local.DEBUG: === END DEBUG ===  
[2025-09-24 14:47:45] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 14:47:45] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000205","suffix":"-noqr"} 
[2025-09-24 14:47:45] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 14:47:45] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 14:47:45] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 14:47:45] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 14:47:45] local.DEBUG: Supplier party built successfully  
[2025-09-24 14:47:45] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 14:47:45] local.DEBUG: Buyer party built successfully  
[2025-09-24 14:47:45] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 14:47:45] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 14:47:45] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 14:47:45] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 14:47:45] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 14:47:45] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 14:47:45] local.DEBUG: Building additional document references  
[2025-09-24 14:47:45] local.DEBUG: Added ICV reference {"icv":"205"} 
[2025-09-24 14:47:45] local.WARNING: No QR content provided for embedding  
[2025-09-24 14:47:45] local.DEBUG: Additional document references built {"count":1,"references":[{"id":"ICV","uuid":"205"}]} 
[2025-09-24 14:47:45] local.DEBUG: Invoice object created successfully {"id":"001000205","uuid":"bc8eddca-193e-4bb1-ba85-096f1be74787","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 14:47:45] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000205-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 14:47:45] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000205-unsigned-noqr.xml"} 
[2025-09-24 14:47:45] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000205-signed-1758710865.xml"} 
[2025-09-24 14:47:45] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 14:47:45] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-24 14:47:45] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 14:47:45] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"):f=|JdApT6qu$\u001f...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000\f\u0018<\u001e?yb9\u0010`Be\u0001...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0015
,H\tm3dr8\u0014NFD\u0001...[2 more bytes]","is_binary":true}]} 
[2025-09-24 14:47:45] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 14:47:46] local.DEBUG: QR PNG image generated for display {"image_length":4472,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 14:47:46] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 14:47:46] local.INFO: Starting unsigned XML generation {"invoice_number":"001000205","uuid":"bc8eddca-193e-4bb1-ba85-096f1be74787","suffix":"withqr"} 
[2025-09-24 14:47:46] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 14:47:46] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 14:47:46] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 14:47:46] local.DEBUG: === END DEBUG ===  
[2025-09-24 14:47:46] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 14:47:46] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000205","suffix":"-withqr"} 
[2025-09-24 14:47:46] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 14:47:46] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 14:47:46] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 14:47:46] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 14:47:46] local.DEBUG: Supplier party built successfully  
[2025-09-24 14:47:46] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 14:47:46] local.DEBUG: Buyer party built successfully  
[2025-09-24 14:47:46] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 14:47:46] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 14:47:46] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 14:47:46] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 14:47:46] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 14:47:46] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 14:47:46] local.DEBUG: Building additional document references  
[2025-09-24 14:47:46] local.DEBUG: Added ICV reference {"icv":"205"} 
[2025-09-24 14:47:46] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 14:47:46] local.DEBUG: Additional document references built {"count":2,"references":[{"id":"ICV","uuid":"205"},{"id":"QR","uuid":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LTExVDE5OjI0OjIwWgQFNDUuMDAFBDIuMTQGICk6r5Zm7so9fEqim46iZEFwVDaDkXF1nMUknOW9H07hB0gwRgIhALwMrsgYwDznHsM/eWI5hxD14GCBQmXujAEnInsaceazAiEA86vRuzGqnsG5rRtKMQ3v8qFMt+uMBwHFEtKcQfhiE3MIWDBWMBAGByqGSM49AgEGBSuBBAAKA0IABCeOXqkxmbb6ucXC9T0s1wcP7EKnBATP17HI+UWPIACtizkW9rDY8d27zBFWKfEjyFX8nZ0WZoOuqxLaT34+W3oJIBUKLPz4m7Sh7UjECZJtr/4zZPfLcoM4FNxORodEAUQA"}]} 
[2025-09-24 14:47:46] local.DEBUG: Invoice object created successfully {"id":"001000205","uuid":"bc8eddca-193e-4bb1-ba85-096f1be74787","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 14:47:46] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000205-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 14:47:46] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000205-signed-1758710866.xml"} 
[2025-09-24 14:47:46] local.DEBUG: Cleaned up temporary file {"file":"001000205-unsigned-noqr.xml"} 
[2025-09-24 14:47:46] local.DEBUG: Cleaned up temporary file {"file":"001000205-signed-1758710865.xml"} 
[2025-09-24 14:47:46] local.DEBUG: Cleaned up temporary file {"file":"001000205-unsigned-withqr.xml"} 
[2025-09-24 14:47:46] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":205,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 15:11:44] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:11:44] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 15:11:44] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 15:11:44] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:11:44] local.INFO: Starting unsigned XML generation {"invoice_number":"001000206","uuid":"5890297c-8c2e-4abd-8ec1-3f3ed4e26baf","suffix":"noqr"} 
[2025-09-24 15:11:44] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:11:44] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:11:44] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:11:44] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:11:44] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:11:44] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000206","suffix":"-noqr"} 
[2025-09-24 15:11:44] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:11:44] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:11:44] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:11:44] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:11:44] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:11:44] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:11:44] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:11:44] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:11:44] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:11:44] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:11:44] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:11:44] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:11:44] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:11:44] local.DEBUG: Building additional document references  
[2025-09-24 15:11:44] local.DEBUG: Added ICV reference {"icv":"206"} 
[2025-09-24 15:11:44] local.WARNING: No QR content provided for embedding  
[2025-09-24 15:11:44] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 15:11:44] local.DEBUG: Invoice object created successfully {"id":"001000206","uuid":"5890297c-8c2e-4abd-8ec1-3f3ed4e26baf","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:11:44] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000206-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 15:11:44] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000206-unsigned-noqr.xml"} 
[2025-09-24 15:11:44] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000206-signed-1758712304.xml"} 
[2025-09-24 15:11:44] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 15:11:44] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 15:11:44] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 15:11:44] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"!n\u0014U`\u0011DSU\u0002O/j/Ek...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 \u0010\u000f1YJxy~g\u0015/t...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"5M_#AT\u0003Vu&\u0000M\u000eJ\u0019L...[2 more bytes]","is_binary":true}]} 
[2025-09-24 15:11:44] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 15:11:44] local.DEBUG: QR PNG image generated for display {"image_length":4552,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 15:11:44] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 15:11:44] local.INFO: Starting unsigned XML generation {"invoice_number":"001000206","uuid":"5890297c-8c2e-4abd-8ec1-3f3ed4e26baf","suffix":"withqr"} 
[2025-09-24 15:11:44] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:11:44] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:11:44] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:11:44] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:11:44] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:11:44] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000206","suffix":"-withqr"} 
[2025-09-24 15:11:44] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:11:44] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:11:44] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:11:44] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:11:44] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:11:44] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:11:44] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:11:44] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:11:44] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:11:44] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:11:44] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:11:44] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:11:44] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:11:44] local.DEBUG: Building additional document references  
[2025-09-24 15:11:44] local.DEBUG: Added ICV reference {"icv":"206"} 
[2025-09-24 15:11:44] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-09-24 15:11:44] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 15:11:44] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 15:11:44] local.DEBUG: Invoice object created successfully {"id":"001000206","uuid":"5890297c-8c2e-4abd-8ec1-3f3ed4e26baf","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:11:44] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000206-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 15:11:44] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000206-signed-1758712304.xml"} 
[2025-09-24 15:11:44] local.DEBUG: Cleaned up temporary file {"file":"001000206-unsigned-noqr.xml"} 
[2025-09-24 15:11:44] local.DEBUG: Cleaned up temporary file {"file":"001000206-signed-1758712304.xml"} 
[2025-09-24 15:11:44] local.DEBUG: Cleaned up temporary file {"file":"001000206-unsigned-withqr.xml"} 
[2025-09-24 15:11:44] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":206,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 15:36:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:36:49] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:36:50] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 15:36:50] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 15:36:50] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:36:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000207","uuid":"415ff1d8-6006-4f30-b3b6-1d3fc61a5633","suffix":"noqr"} 
[2025-09-24 15:36:50] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:36:50] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:36:50] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:36:50] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:36:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:36:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000207","suffix":"-noqr"} 
[2025-09-24 15:36:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:36:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:36:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:36:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:36:50] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:36:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:36:50] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:36:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:36:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:36:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:36:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:36:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:36:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:36:50] local.DEBUG: Building additional document references  
[2025-09-24 15:36:50] local.DEBUG: Added ICV reference {"icv":"207"} 
[2025-09-24 15:36:50] local.WARNING: No QR content provided for embedding  
[2025-09-24 15:36:50] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 15:36:50] local.DEBUG: Invoice object created successfully {"id":"001000207","uuid":"415ff1d8-6006-4f30-b3b6-1d3fc61a5633","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:36:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000207-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 15:36:50] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000207-unsigned-noqr.xml"} 
[2025-09-24 15:36:50] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000207-signed-1758713810.xml"} 
[2025-09-24 15:36:50] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 15:36:50] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 15:36:50] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 15:36:50] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"$o\u001er\u0003IyBT+b...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 }#\"
EC4[\u0000\u0014\u001e[...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"KB\u0019zH\u0014^\u0014tCx...[2 more bytes]","is_binary":true}]} 
[2025-09-24 15:36:50] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 15:36:50] local.DEBUG: QR PNG image generated for display {"image_length":4556,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 15:36:50] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 15:36:50] local.INFO: Starting unsigned XML generation {"invoice_number":"001000207","uuid":"415ff1d8-6006-4f30-b3b6-1d3fc61a5633","suffix":"withqr"} 
[2025-09-24 15:36:50] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:36:50] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:36:50] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:36:50] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:36:50] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:36:50] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000207","suffix":"-withqr"} 
[2025-09-24 15:36:50] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:36:50] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:36:50] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:36:50] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:36:50] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:36:50] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:36:50] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:36:50] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:36:50] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:36:50] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:36:50] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:36:50] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:36:50] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:36:50] local.DEBUG: Building additional document references  
[2025-09-24 15:36:50] local.DEBUG: Added ICV reference {"icv":"207"} 
[2025-09-24 15:36:50] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-24 15:36:50] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 15:36:50] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 15:36:50] local.DEBUG: Invoice object created successfully {"id":"001000207","uuid":"415ff1d8-6006-4f30-b3b6-1d3fc61a5633","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:36:50] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000207-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 15:36:50] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000207-signed-1758713810.xml"} 
[2025-09-24 15:36:50] local.DEBUG: Cleaned up temporary file {"file":"001000207-unsigned-noqr.xml"} 
[2025-09-24 15:36:50] local.DEBUG: Cleaned up temporary file {"file":"001000207-signed-1758713810.xml"} 
[2025-09-24 15:36:50] local.DEBUG: Cleaned up temporary file {"file":"001000207-unsigned-withqr.xml"} 
[2025-09-24 15:36:50] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":207,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 15:38:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:38:34] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 15:38:34] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 15:38:34] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:38:34] local.INFO: Starting unsigned XML generation {"invoice_number":"001000208","uuid":"a2e36f1e-6623-440c-ba45-f74d196a6fa1","suffix":"noqr"} 
[2025-09-24 15:38:34] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:38:34] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:38:34] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:38:34] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:38:34] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:38:34] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000208","suffix":"-noqr"} 
[2025-09-24 15:38:34] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:38:34] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:38:34] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:38:34] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:38:34] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:38:34] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:38:34] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:38:34] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:38:34] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:38:34] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:38:34] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:38:34] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:38:34] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:38:34] local.DEBUG: Building additional document references  
[2025-09-24 15:38:34] local.DEBUG: Added ICV reference {"icv":"208"} 
[2025-09-24 15:38:34] local.WARNING: No QR content provided for embedding  
[2025-09-24 15:38:34] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 15:38:34] local.DEBUG: Invoice object created successfully {"id":"001000208","uuid":"a2e36f1e-6623-440c-ba45-f74d196a6fa1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:38:34] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000208-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 15:38:34] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000208-unsigned-noqr.xml"} 
[2025-09-24 15:38:34] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000208-signed-1758713914.xml"} 
[2025-09-24 15:38:34] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 15:38:34] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 15:38:34] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 15:38:34] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\fX(%\u000e\u001c>\u0005u\u0018\u001f\u0002BI}\u0019\u000eX\u0015u\\\"...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000\u00151x
H\u001e/2TB
v...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u001c-o~Qp=6y&D\u001a\u0007RY...[2 more bytes]","is_binary":true}]} 
[2025-09-24 15:38:34] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 15:38:34] local.DEBUG: QR PNG image generated for display {"image_length":4468,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 15:38:34] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 15:38:34] local.INFO: Starting unsigned XML generation {"invoice_number":"001000208","uuid":"a2e36f1e-6623-440c-ba45-f74d196a6fa1","suffix":"withqr"} 
[2025-09-24 15:38:34] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:38:34] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:38:34] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:38:34] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:38:34] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:38:34] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000208","suffix":"-withqr"} 
[2025-09-24 15:38:34] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:38:34] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:38:34] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:38:34] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:38:34] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:38:34] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:38:34] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:38:34] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:38:34] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:38:34] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:38:34] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:38:34] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:38:34] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:38:34] local.DEBUG: Building additional document references  
[2025-09-24 15:38:34] local.DEBUG: Added ICV reference {"icv":"208"} 
[2025-09-24 15:38:34] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-24 15:38:34] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 15:38:34] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 15:38:34] local.DEBUG: Invoice object created successfully {"id":"001000208","uuid":"a2e36f1e-6623-440c-ba45-f74d196a6fa1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:38:34] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000208-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 15:38:34] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000208-signed-1758713914.xml"} 
[2025-09-24 15:38:34] local.DEBUG: Cleaned up temporary file {"file":"001000208-unsigned-noqr.xml"} 
[2025-09-24 15:38:34] local.DEBUG: Cleaned up temporary file {"file":"001000208-signed-1758713914.xml"} 
[2025-09-24 15:38:34] local.DEBUG: Cleaned up temporary file {"file":"001000208-unsigned-withqr.xml"} 
[2025-09-24 15:38:34] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":208,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 15:42:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:42:07] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 15:42:07] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 15:42:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:42:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000209","uuid":"d612064f-8d3d-499b-898b-c0f922f2241b","suffix":"noqr"} 
[2025-09-24 15:42:07] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:42:07] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:42:07] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:42:07] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:42:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:42:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000209","suffix":"-noqr"} 
[2025-09-24 15:42:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:42:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:42:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:42:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:42:07] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:42:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:42:07] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:42:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:42:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:42:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:42:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:42:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:42:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:42:07] local.DEBUG: Building additional document references  
[2025-09-24 15:42:07] local.DEBUG: Added ICV reference {"icv":"209"} 
[2025-09-24 15:42:07] local.WARNING: No QR content provided for embedding  
[2025-09-24 15:42:07] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 15:42:07] local.DEBUG: Invoice object created successfully {"id":"001000209","uuid":"d612064f-8d3d-499b-898b-c0f922f2241b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:42:07] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000209-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 15:42:07] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000209-unsigned-noqr.xml"} 
[2025-09-24 15:42:07] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000209-signed-1758714127.xml"} 
[2025-09-24 15:42:07] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 15:42:07] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-09-24 15:42:07] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 15:42:07] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u000f\b3U,
\u0003\u001c\u0013d\u0003/ok\u0007/...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000\"\u0003
=315y2*2\u0000u...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0015\u00077$^\u0010|heZ1n\"o...[2 more bytes]","is_binary":true}]} 
[2025-09-24 15:42:07] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 15:42:07] local.DEBUG: QR PNG image generated for display {"image_length":4500,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 15:42:07] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 15:42:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000209","uuid":"d612064f-8d3d-499b-898b-c0f922f2241b","suffix":"withqr"} 
[2025-09-24 15:42:07] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:42:07] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:42:07] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:42:07] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:42:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:42:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000209","suffix":"-withqr"} 
[2025-09-24 15:42:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:42:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:42:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:42:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:42:07] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:42:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:42:07] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:42:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:42:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:42:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:42:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:42:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:42:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:42:07] local.DEBUG: Building additional document references  
[2025-09-24 15:42:07] local.DEBUG: Added ICV reference {"icv":"209"} 
[2025-09-24 15:42:07] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":294} 
[2025-09-24 15:42:07] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 15:42:07] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 15:42:07] local.DEBUG: Invoice object created successfully {"id":"001000209","uuid":"d612064f-8d3d-499b-898b-c0f922f2241b","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:42:07] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000209-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 15:42:07] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000209-signed-1758714127.xml"} 
[2025-09-24 15:42:07] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 15:56:38] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:56:38] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 15:56:38] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 15:56:38] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:56:38] local.INFO: Starting unsigned XML generation {"invoice_number":"001000210","uuid":"3072a97f-ad31-43de-9341-e63bf5f88547","suffix":"noqr"} 
[2025-09-24 15:56:38] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:56:38] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:56:38] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:56:38] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:56:38] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:56:38] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000210","suffix":"-noqr"} 
[2025-09-24 15:56:38] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:56:38] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:56:38] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:56:38] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:56:38] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:56:38] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:56:38] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:56:38] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:56:38] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:56:38] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:56:38] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:56:38] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:56:38] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:56:38] local.DEBUG: Building additional document references  
[2025-09-24 15:56:38] local.DEBUG: Added ICV reference {"icv":"210"} 
[2025-09-24 15:56:38] local.WARNING: No QR content provided for embedding  
[2025-09-24 15:56:38] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 15:56:38] local.DEBUG: Invoice object created successfully {"id":"001000210","uuid":"3072a97f-ad31-43de-9341-e63bf5f88547","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:56:38] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000210-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 15:56:38] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000210-unsigned-noqr.xml"} 
[2025-09-24 15:56:38] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000210-signed-1758714998.xml"} 
[2025-09-24 15:56:38] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 15:56:38] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 15:56:38] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 15:56:38] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"2~\u001d*x f\tqq{j\u0018F...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000@O0{[\u001eES\u0004\u0002\u0002K...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"bUHTEQ7?\u0018S:
\u0001
r...[2 more bytes]","is_binary":true}]} 
[2025-09-24 15:56:38] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 15:56:38] local.DEBUG: QR PNG image generated for display {"image_length":4512,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 15:56:38] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 15:56:38] local.INFO: Starting unsigned XML generation {"invoice_number":"001000210","uuid":"3072a97f-ad31-43de-9341-e63bf5f88547","suffix":"withqr"} 
[2025-09-24 15:56:38] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:56:38] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:56:38] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:56:38] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:56:38] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:56:38] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000210","suffix":"-withqr"} 
[2025-09-24 15:56:38] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:56:38] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:56:38] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:56:38] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:56:38] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:56:38] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:56:38] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:56:38] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:56:38] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:56:38] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:56:38] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:56:38] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:56:38] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:56:38] local.DEBUG: Building additional document references  
[2025-09-24 15:56:38] local.DEBUG: Added ICV reference {"icv":"210"} 
[2025-09-24 15:56:38] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-24 15:56:38] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 15:56:38] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 15:56:38] local.DEBUG: Invoice object created successfully {"id":"001000210","uuid":"3072a97f-ad31-43de-9341-e63bf5f88547","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:56:38] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000210-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 15:56:38] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000210-signed-1758714998.xml"} 
[2025-09-24 15:56:38] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 15:58:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:58:47] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 15:58:47] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 15:58:47] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 15:58:47] local.INFO: Starting unsigned XML generation {"invoice_number":"001000211","uuid":"6d3669f6-f540-49a5-ba5b-39c5ab311516","suffix":"noqr"} 
[2025-09-24 15:58:47] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:58:47] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:58:47] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:58:47] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:58:47] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:58:47] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000211","suffix":"-noqr"} 
[2025-09-24 15:58:47] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:58:47] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:58:47] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:58:47] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:58:47] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:58:47] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:58:47] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:58:47] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:58:47] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:58:47] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:58:47] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:58:47] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:58:47] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:58:47] local.DEBUG: Building additional document references  
[2025-09-24 15:58:47] local.DEBUG: Added ICV reference {"icv":"211"} 
[2025-09-24 15:58:47] local.WARNING: No QR content provided for embedding  
[2025-09-24 15:58:47] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 15:58:47] local.DEBUG: Invoice object created successfully {"id":"001000211","uuid":"6d3669f6-f540-49a5-ba5b-39c5ab311516","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:58:47] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000211-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 15:58:47] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000211-unsigned-noqr.xml"} 
[2025-09-24 15:58:47] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000211-signed-1758715127.xml"} 
[2025-09-24 15:58:47] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 15:58:47] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 15:58:47] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 15:58:47] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u00010aUhe\u000e\u0014O>rq\u000bb\u0011\u0011f\u0007(d...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 >Ta<^ Bq
\u000eht;\u0019B...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"|j8|v\u001e^==\u0000W,\u0018e^...[2 more bytes]","is_binary":true}]} 
[2025-09-24 15:58:47] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 15:58:47] local.DEBUG: QR PNG image generated for display {"image_length":4596,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 15:58:47] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 15:58:47] local.INFO: Starting unsigned XML generation {"invoice_number":"001000211","uuid":"6d3669f6-f540-49a5-ba5b-39c5ab311516","suffix":"withqr"} 
[2025-09-24 15:58:47] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 15:58:47] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 15:58:47] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 15:58:47] local.DEBUG: === END DEBUG ===  
[2025-09-24 15:58:47] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 15:58:47] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000211","suffix":"-withqr"} 
[2025-09-24 15:58:47] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 15:58:47] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 15:58:47] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 15:58:47] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 15:58:47] local.DEBUG: Supplier party built successfully  
[2025-09-24 15:58:47] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 15:58:47] local.DEBUG: Buyer party built successfully  
[2025-09-24 15:58:47] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 15:58:47] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 15:58:47] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 15:58:47] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 15:58:47] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 15:58:47] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 15:58:47] local.DEBUG: Building additional document references  
[2025-09-24 15:58:47] local.DEBUG: Added ICV reference {"icv":"211"} 
[2025-09-24 15:58:47] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-09-24 15:58:47] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 15:58:47] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 15:58:47] local.DEBUG: Invoice object created successfully {"id":"001000211","uuid":"6d3669f6-f540-49a5-ba5b-39c5ab311516","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 15:58:47] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000211-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 15:58:47] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000211-signed-1758715127.xml"} 
[2025-09-24 15:58:47] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 16:04:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:04:45] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 16:04:45] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 16:04:45] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:04:45] local.INFO: Starting unsigned XML generation {"invoice_number":"001000212","uuid":"a13b2bf1-eeb3-4b17-9493-d81eac2be652","suffix":"noqr"} 
[2025-09-24 16:04:45] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:04:45] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:04:45] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:04:45] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:04:45] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:04:45] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000212","suffix":"-noqr"} 
[2025-09-24 16:04:45] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:04:45] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:04:45] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:04:45] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:04:45] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:04:45] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:04:45] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:04:45] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:04:45] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:04:45] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:04:45] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:04:45] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:04:45] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:04:45] local.DEBUG: Building additional document references  
[2025-09-24 16:04:45] local.DEBUG: Added ICV reference {"icv":"212"} 
[2025-09-24 16:04:45] local.WARNING: No QR content provided for embedding  
[2025-09-24 16:04:45] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 16:04:45] local.DEBUG: Invoice object created successfully {"id":"001000212","uuid":"a13b2bf1-eeb3-4b17-9493-d81eac2be652","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:04:45] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000212-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 16:04:45] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000212-unsigned-noqr.xml"} 
[2025-09-24 16:04:45] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000212-signed-1758715485.xml"} 
[2025-09-24 16:04:45] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 16:04:45] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 16:04:45] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 16:04:45] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"DL=\u0005r\"\u000bY:\u00132
\u001fwW...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000Yw,$\u0017\u0015\u001bq...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"A;\u001b\f\u001bI~9\u0013\u0015...[2 more bytes]","is_binary":true}]} 
[2025-09-24 16:04:45] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 16:04:45] local.DEBUG: QR PNG image generated for display {"image_length":4548,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 16:04:45] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 16:04:45] local.INFO: Starting unsigned XML generation {"invoice_number":"001000212","uuid":"a13b2bf1-eeb3-4b17-9493-d81eac2be652","suffix":"withqr"} 
[2025-09-24 16:04:45] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:04:45] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:04:45] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:04:45] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:04:45] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:04:45] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000212","suffix":"-withqr"} 
[2025-09-24 16:04:45] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:04:45] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:04:45] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:04:45] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:04:45] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:04:45] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:04:45] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:04:45] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:04:45] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:04:45] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:04:45] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:04:45] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:04:45] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:04:45] local.DEBUG: Building additional document references  
[2025-09-24 16:04:45] local.DEBUG: Added ICV reference {"icv":"212"} 
[2025-09-24 16:04:45] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-24 16:04:45] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 16:04:45] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 16:04:45] local.DEBUG: Invoice object created successfully {"id":"001000212","uuid":"a13b2bf1-eeb3-4b17-9493-d81eac2be652","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:04:45] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000212-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 16:04:45] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000212-signed-1758715485.xml"} 
[2025-09-24 16:04:45] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 16:09:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:09:27] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 16:09:27] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 16:09:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:09:27] local.INFO: Starting unsigned XML generation {"invoice_number":"001000213","uuid":"e4f89ed4-777f-41fa-9a0a-507e1afef5c6","suffix":"noqr"} 
[2025-09-24 16:09:27] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:09:27] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:09:27] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:09:27] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:09:27] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:09:27] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000213","suffix":"-noqr"} 
[2025-09-24 16:09:27] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:09:27] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:09:27] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:09:27] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:09:27] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:09:27] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:09:27] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:09:27] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:09:27] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:09:27] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:09:27] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:09:27] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:09:27] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:09:27] local.DEBUG: Building additional document references  
[2025-09-24 16:09:27] local.DEBUG: Added ICV reference {"icv":"213"} 
[2025-09-24 16:09:27] local.WARNING: No QR content provided for embedding  
[2025-09-24 16:09:27] local.DEBUG: Additional document references built {"count":1,"ids":["ICV"],"order":["ICV"]} 
[2025-09-24 16:09:27] local.DEBUG: Invoice object created successfully {"id":"001000213","uuid":"e4f89ed4-777f-41fa-9a0a-507e1afef5c6","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:09:27] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000213-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 16:09:27] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000213-unsigned-noqr.xml"} 
[2025-09-24 16:09:27] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000213-signed-1758715767.xml"} 
[2025-09-24 16:09:27] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 16:09:27] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 16:09:27] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 16:09:27] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"ZDk5j:qt\u001a\u0004...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 KF@!x-^`\u0016b\u001a...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"pcd\u001b#%^TC\u001d\u001cw9
...[2 more bytes]","is_binary":true}]} 
[2025-09-24 16:09:27] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 16:09:27] local.DEBUG: QR PNG image generated for display {"image_length":4580,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 16:09:27] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 16:09:27] local.INFO: Starting unsigned XML generation {"invoice_number":"001000213","uuid":"e4f89ed4-777f-41fa-9a0a-507e1afef5c6","suffix":"withqr"} 
[2025-09-24 16:09:27] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:09:27] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:09:27] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:09:27] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:09:27] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:09:27] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000213","suffix":"-withqr"} 
[2025-09-24 16:09:27] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:09:27] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:09:27] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:09:27] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:09:27] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:09:27] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:09:27] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:09:27] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:09:27] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:09:27] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:09:27] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:09:27] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:09:27] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:09:27] local.DEBUG: Building additional document references  
[2025-09-24 16:09:27] local.DEBUG: Added ICV reference {"icv":"213"} 
[2025-09-24 16:09:27] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-09-24 16:09:27] local.DEBUG: Added QR reference {"qr_length":392,"qr_preview":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-09-24 16:09:27] local.DEBUG: Additional document references built {"count":2,"ids":["ICV","QR"],"order":["ICV","QR"]} 
[2025-09-24 16:09:27] local.DEBUG: Invoice object created successfully {"id":"001000213","uuid":"e4f89ed4-777f-41fa-9a0a-507e1afef5c6","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:09:27] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000213-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 16:09:27] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000213-signed-1758715767.xml"} 
[2025-09-24 16:09:27] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 16:20:52] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:20:52] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 16:20:52] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 16:20:52] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:20:52] local.INFO: Starting unsigned XML generation {"invoice_number":"001000214","uuid":"a19625ad-18e0-4182-8558-31045c023ad7","suffix":"noqr"} 
[2025-09-24 16:20:52] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:20:52] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:20:52] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:20:52] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:20:52] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:20:52] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000214","suffix":"-noqr"} 
[2025-09-24 16:20:52] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:20:52] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:20:52] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:20:52] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:20:52] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:20:52] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:20:52] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:20:52] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:20:52] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:20:52] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:20:52] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:20:52] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:20:52] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:20:52] local.DEBUG: Invoice object created successfully {"id":"001000214","uuid":"a19625ad-18e0-4182-8558-31045c023ad7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:20:52] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000214-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 16:20:52] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000214-unsigned-noqr.xml"} 
[2025-09-24 16:20:52] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000214-signed-1758716452.xml"} 
[2025-09-24 16:20:52] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 16:20:52] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 16:20:52] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 16:20:52] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u000e\b\f\u000b\\(
\u001b\u0012T\u0007[?<_M)...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 G2\u0014[\u0004H#\u00037h...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"X/\u001f\u001b\t4@MNM-@\u001d\f...[2 more bytes]","is_binary":true}]} 
[2025-09-24 16:20:52] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 16:20:52] local.DEBUG: QR PNG image generated for display {"image_length":4488,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 16:20:52] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 16:20:52] local.INFO: Starting unsigned XML generation {"invoice_number":"001000214","uuid":"a19625ad-18e0-4182-8558-31045c023ad7","suffix":"withqr"} 
[2025-09-24 16:20:52] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:20:52] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:20:52] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:20:52] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:20:52] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:20:52] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000214","suffix":"-withqr"} 
[2025-09-24 16:20:52] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:20:52] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:20:52] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:20:52] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:20:52] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:20:52] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:20:52] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:20:52] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:20:52] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:20:52] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:20:52] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:20:52] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:20:52] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:20:52] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-24 16:20:52] local.DEBUG: Invoice object created successfully {"id":"001000214","uuid":"a19625ad-18e0-4182-8558-31045c023ad7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:20:52] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000214-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 16:20:52] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000214-signed-1758716452.xml"} 
[2025-09-24 16:20:52] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 16:26:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:26:33] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 16:26:33] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 16:26:33] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:26:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000215","uuid":"c0ed5230-7113-4b1a-b52c-253f279180c9","suffix":"noqr"} 
[2025-09-24 16:26:33] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:26:33] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:26:33] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:26:33] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:26:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:26:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000215","suffix":"-noqr"} 
[2025-09-24 16:26:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:26:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:26:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:26:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:26:33] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:26:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:26:33] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:26:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:26:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:26:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:26:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:26:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:26:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:26:33] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-09-24 16:26:33] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-09-24 16:26:33] local.DEBUG: Invoice object created successfully {"id":"001000215","uuid":"c0ed5230-7113-4b1a-b52c-253f279180c9","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:26:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000215-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 16:26:33] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000215-unsigned-noqr.xml"} 
[2025-09-24 16:26:33] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000215-signed-1758716793.xml"} 
[2025-09-24 16:26:33] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 16:26:33] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 16:26:33] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 16:26:33] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"H0/*\u000fe[aq\u0013\u0003.q
...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 :hRw2D\u0013[z,\u0006n...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u000f\u001c0yz)d r%AH...[2 more bytes]","is_binary":true}]} 
[2025-09-24 16:26:33] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 16:26:33] local.DEBUG: QR PNG image generated for display {"image_length":4488,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 16:26:33] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 16:26:33] local.INFO: Starting unsigned XML generation {"invoice_number":"001000215","uuid":"c0ed5230-7113-4b1a-b52c-253f279180c9","suffix":"withqr"} 
[2025-09-24 16:26:33] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:26:33] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:26:33] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:26:33] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:26:33] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:26:33] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000215","suffix":"-withqr"} 
[2025-09-24 16:26:33] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:26:33] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:26:33] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:26:33] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:26:33] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:26:33] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:26:33] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:26:33] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:26:33] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:26:33] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:26:33] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:26:33] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:26:33] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:26:33] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-09-24 16:26:33] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 16:26:33] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 16:26:33] local.DEBUG: Invoice object created successfully {"id":"001000215","uuid":"c0ed5230-7113-4b1a-b52c-253f279180c9","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:26:33] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000215-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 16:26:34] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000215-signed-1758716794.xml"} 
[2025-09-24 16:26:34] local.ERROR: ZATCA generation process failed: Method App\Http\Controllers\PDFController::cleanupTemporaryFiles does not exist. {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3303): Illuminate\\Routing\\Controller->__call('cleanupTemporar...', Array)
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#48 {main}"} 
[2025-09-24 16:27:36] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:27:36] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 16:27:36] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 16:27:36] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:27:36] local.INFO: Starting unsigned XML generation {"invoice_number":"001000216","uuid":"e2ce7056-6a71-4709-a898-52d6878fef78","suffix":"noqr"} 
[2025-09-24 16:27:36] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:27:36] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:27:36] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:27:36] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:27:36] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:27:36] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000216","suffix":"-noqr"} 
[2025-09-24 16:27:36] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:27:36] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:27:36] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:27:36] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:27:36] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:27:36] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:27:36] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:27:36] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:27:36] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:27:36] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:27:36] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:27:36] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:27:36] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:27:36] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-09-24 16:27:36] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-09-24 16:27:36] local.DEBUG: Invoice object created successfully {"id":"001000216","uuid":"e2ce7056-6a71-4709-a898-52d6878fef78","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:27:36] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000216-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 16:27:36] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000216-unsigned-noqr.xml"} 
[2025-09-24 16:27:36] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000216-signed-1758716856.xml"} 
[2025-09-24 16:27:36] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 16:27:36] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 16:27:36] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 16:27:36] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"f\u001c//\u001e\u0005U\u0011Ei\"9BH...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 \u000f?vi\u000eav\u0010TwD\u0005Kk...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"7$\u0016\b1\u000f\u0004K\u000fZ],...[2 more bytes]","is_binary":true}]} 
[2025-09-24 16:27:36] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 16:27:36] local.DEBUG: QR PNG image generated for display {"image_length":4496,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 16:27:36] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 16:27:36] local.INFO: Starting unsigned XML generation {"invoice_number":"001000216","uuid":"e2ce7056-6a71-4709-a898-52d6878fef78","suffix":"withqr"} 
[2025-09-24 16:27:36] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:27:36] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:27:36] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:27:36] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:27:36] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:27:36] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000216","suffix":"-withqr"} 
[2025-09-24 16:27:36] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:27:36] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:27:36] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:27:36] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:27:36] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:27:36] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:27:36] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:27:36] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:27:36] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:27:36] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:27:36] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:27:36] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:27:36] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:27:36] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-09-24 16:27:36] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 16:27:36] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 16:27:36] local.DEBUG: Invoice object created successfully {"id":"001000216","uuid":"e2ce7056-6a71-4709-a898-52d6878fef78","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:27:36] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000216-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 16:27:36] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000216-signed-1758716856.xml"} 
[2025-09-24 16:27:36] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":216,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 16:36:02] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:36:02] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 16:36:02] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 16:36:03] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 16:36:03] local.INFO: Starting unsigned XML generation {"invoice_number":"001000217","uuid":"0510f119-4627-4a1d-a0d8-b52e3eb69fdf","suffix":"noqr"} 
[2025-09-24 16:36:03] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:36:03] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:36:03] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:36:03] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:36:03] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:36:03] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000217","suffix":"-noqr"} 
[2025-09-24 16:36:03] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:36:03] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:36:03] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:36:03] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:36:03] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:36:03] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:36:03] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:36:03] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:36:03] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:36:03] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:36:03] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:36:03] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:36:03] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:36:03] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-09-24 16:36:03] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-09-24 16:36:03] local.DEBUG: Invoice object created successfully {"id":"001000217","uuid":"0510f119-4627-4a1d-a0d8-b52e3eb69fdf","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:36:03] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000217-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 16:36:03] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000217-unsigned-noqr.xml"} 
[2025-09-24 16:36:03] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000217-signed-1758717363.xml"} 
[2025-09-24 16:36:03] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 16:36:03] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-09-24 16:36:03] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 16:36:03] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"5?Upm<[\u0001Lv\u0006Yo?~\u0013N...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 A\u0005\u0010\u001dQi\u0019\u001b\u0000\"LZ~)\u0003F\u0004...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"se\u0016\u000f2`
F,<5jaZo/\u001a...[2 more bytes]","is_binary":true}]} 
[2025-09-24 16:36:03] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 16:36:03] local.DEBUG: QR PNG image generated for display {"image_length":4520,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 16:36:03] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 16:36:03] local.INFO: Starting unsigned XML generation {"invoice_number":"001000217","uuid":"0510f119-4627-4a1d-a0d8-b52e3eb69fdf","suffix":"withqr"} 
[2025-09-24 16:36:03] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 16:36:03] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 16:36:03] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 16:36:03] local.DEBUG: === END DEBUG ===  
[2025-09-24 16:36:03] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 16:36:03] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000217","suffix":"-withqr"} 
[2025-09-24 16:36:03] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 16:36:03] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 16:36:03] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 16:36:03] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 16:36:03] local.DEBUG: Supplier party built successfully  
[2025-09-24 16:36:03] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 16:36:03] local.DEBUG: Buyer party built successfully  
[2025-09-24 16:36:03] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 16:36:03] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 16:36:03] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 16:36:03] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 16:36:03] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 16:36:03] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 16:36:03] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-09-24 16:36:03] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 16:36:03] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 16:36:03] local.DEBUG: Invoice object created successfully {"id":"001000217","uuid":"0510f119-4627-4a1d-a0d8-b52e3eb69fdf","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 16:36:03] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000217-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 16:36:03] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000217-signed-1758717363.xml"} 
[2025-09-24 16:36:03] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":217,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 17:04:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 17:04:27] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-24 17:04:27] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-24 17:04:27] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-24 17:04:27] local.INFO: Starting unsigned XML generation {"invoice_number":"001000218","uuid":"3c345317-20fe-445b-adb5-1f307ad7d1f1","suffix":"noqr"} 
[2025-09-24 17:04:27] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 17:04:27] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 17:04:27] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 17:04:27] local.DEBUG: === END DEBUG ===  
[2025-09-24 17:04:27] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 17:04:27] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000218","suffix":"-noqr"} 
[2025-09-24 17:04:27] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 17:04:27] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 17:04:27] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 17:04:27] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 17:04:27] local.DEBUG: Supplier party built successfully  
[2025-09-24 17:04:27] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 17:04:27] local.DEBUG: Buyer party built successfully  
[2025-09-24 17:04:27] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 17:04:27] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 17:04:27] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 17:04:27] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 17:04:27] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 17:04:27] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 17:04:27] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-09-24 17:04:27] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-09-24 17:04:27] local.DEBUG: Invoice object created successfully {"id":"001000218","uuid":"3c345317-20fe-445b-adb5-1f307ad7d1f1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 17:04:27] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000218-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-24 17:04:27] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000218-unsigned-noqr.xml"} 
[2025-09-24 17:04:27] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000218-signed-1758719067.xml"} 
[2025-09-24 17:04:27] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-24 17:04:27] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-24 17:04:27] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-24 17:04:27] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u0016z\u0004\\\u0011
}<\u0007/\u000fJDi]R...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 ~\bYUQ^\u0001iVE\u00107<\u001cU...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"$I{\u001a=}`R\u0007~c8+\u0019*\u000f...[2 more bytes]","is_binary":true}]} 
[2025-09-24 17:04:27] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-24 17:04:27] local.DEBUG: QR PNG image generated for display {"image_length":4504,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-24 17:04:27] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-24 17:04:27] local.INFO: Starting unsigned XML generation {"invoice_number":"001000218","uuid":"3c345317-20fe-445b-adb5-1f307ad7d1f1","suffix":"withqr"} 
[2025-09-24 17:04:27] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-24 17:04:27] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-24 17:04:27] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-24 17:04:27] local.DEBUG: === END DEBUG ===  
[2025-09-24 17:04:27] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-24 17:04:27] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000218","suffix":"-withqr"} 
[2025-09-24 17:04:27] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-24 17:04:27] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-24 17:04:27] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-24 17:04:27] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-24 17:04:27] local.DEBUG: Supplier party built successfully  
[2025-09-24 17:04:27] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-24 17:04:27] local.DEBUG: Buyer party built successfully  
[2025-09-24 17:04:27] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-24 17:04:27] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-24 17:04:27] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-24 17:04:27] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-24 17:04:27] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-24 17:04:27] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-24 17:04:27] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-24 17:04:27] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 17:04:27] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-24 17:04:27] local.DEBUG: Invoice object created successfully {"id":"001000218","uuid":"3c345317-20fe-445b-adb5-1f307ad7d1f1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-24 17:04:27] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000218-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-24 17:04:27] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000218-signed-1758719067.xml"} 
[2025-09-24 17:04:27] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":218,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-09-24 20:45:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-29 10:04:59] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-30 20:49:35] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-30 20:49:37] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-09-30 20:49:37] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-09-30 20:49:40] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-09-30 20:49:40] local.INFO: Starting unsigned XML generation {"invoice_number":"001000219","uuid":"804c370a-906b-471c-b142-6091c4fca8bd","suffix":"noqr"} 
[2025-09-30 20:49:40] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-30 20:49:40] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-30 20:49:40] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-30 20:49:40] local.DEBUG: === END DEBUG ===  
[2025-09-30 20:49:40] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-30 20:49:40] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000219","suffix":"-noqr"} 
[2025-09-30 20:49:40] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-30 20:49:40] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-30 20:49:40] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-30 20:49:40] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-30 20:49:40] local.DEBUG: Supplier party built successfully  
[2025-09-30 20:49:40] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-30 20:49:40] local.DEBUG: Buyer party built successfully  
[2025-09-30 20:49:40] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-30 20:49:40] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-30 20:49:40] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-30 20:49:40] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-30 20:49:40] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-30 20:49:40] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-30 20:49:40] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-09-30 20:49:40] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-09-30 20:49:40] local.DEBUG: Invoice object created successfully {"id":"001000219","uuid":"804c370a-906b-471c-b142-6091c4fca8bd","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-30 20:49:40] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000219-unsigned-noqr.xml","file_size":5040,"suffix_used":"-noqr"} 
[2025-09-30 20:49:40] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000219-unsigned-noqr.xml"} 
[2025-09-30 20:49:41] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000219-signed-1759250981.xml"} 
[2025-09-30 20:49:41] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-09-30 20:49:41] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-09-30 20:49:41] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-09-30 20:49:41] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"A\u000fP8A\u0010%q\u0017_\u0002KvKs...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 2X\u0010+\bw\u001eS\u000b-\u0012\u0016...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u001bnu<J\"\u0004*.*8A\u0017S\\yl...[2 more bytes]","is_binary":true}]} 
[2025-09-30 20:49:41] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-09-30 20:49:42] local.DEBUG: QR PNG image generated for display {"image_length":4596,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-09-30 20:49:42] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-09-30 20:49:42] local.INFO: Starting unsigned XML generation {"invoice_number":"001000219","uuid":"804c370a-906b-471c-b142-6091c4fca8bd","suffix":"withqr"} 
[2025-09-30 20:49:42] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-09-30 20:49:42] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-09-30 20:49:42] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-09-30 20:49:42] local.DEBUG: === END DEBUG ===  
[2025-09-30 20:49:42] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-09-30 20:49:42] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000219","suffix":"-withqr"} 
[2025-09-30 20:49:42] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-09-30 20:49:42] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-09-30 20:49:42] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-09-30 20:49:42] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-09-30 20:49:42] local.DEBUG: Supplier party built successfully  
[2025-09-30 20:49:42] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-09-30 20:49:42] local.DEBUG: Buyer party built successfully  
[2025-09-30 20:49:42] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-09-30 20:49:42] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-09-30 20:49:42] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-09-30 20:49:42] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-09-30 20:49:42] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-09-30 20:49:42] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-09-30 20:49:42] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-09-30 20:49:42] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-30 20:49:42] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-09-30 20:49:42] local.DEBUG: Invoice object created successfully {"id":"001000219","uuid":"804c370a-906b-471c-b142-6091c4fca8bd","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-09-30 20:49:42] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000219-unsigned-withqr.xml","file_size":5549,"suffix_used":"-withqr"} 
[2025-09-30 20:49:42] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000219-signed-1759250982.xml"} 
[2025-09-30 20:49:42] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":219,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-07 06:48:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-07 06:48:32] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-07 06:48:32] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-07 06:48:37] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-07 06:48:37] local.INFO: Starting unsigned XML generation {"invoice_number":"001000220","uuid":"6ccb9572-bceb-4ea0-97d5-e75fb1bac7fe","suffix":"noqr"} 
[2025-10-07 06:48:37] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-07 06:48:37] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-07 06:48:37] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-07 06:48:37] local.DEBUG: === END DEBUG ===  
[2025-10-07 06:48:38] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-07 06:48:38] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000220","suffix":"-noqr"} 
[2025-10-07 06:48:38] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-07 06:48:38] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-07 06:48:38] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-07 06:48:38] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-07 06:48:38] local.DEBUG: Supplier party built successfully  
[2025-10-07 06:48:38] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-07 06:48:38] local.DEBUG: Buyer party built successfully  
[2025-10-07 06:48:38] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-07 06:48:38] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-07 06:48:38] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-07 06:48:38] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-07 06:48:38] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-07 06:48:38] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-07 06:48:38] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-10-07 06:48:38] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-10-07 06:48:38] local.DEBUG: Invoice object created successfully {"id":"001000220","uuid":"6ccb9572-bceb-4ea0-97d5-e75fb1bac7fe","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-07 06:48:38] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000220-unsigned-noqr.xml","file_size":5469,"suffix_used":"-noqr"} 
[2025-10-07 06:48:38] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000220-unsigned-noqr.xml"} 
[2025-10-07 06:48:39] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000220-signed-1759805319.xml"} 
[2025-10-07 06:48:39] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-07 06:48:39] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-07 06:48:39] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-07 06:48:39] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"in\u001a\u001b\u0018_\u0014\\.r\u0002
I\u0006`...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 \u0016i\u0016#\u0012D\u0012\u0005c\\d!<a...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0003d Lyt'\u001d+&...[2 more bytes]","is_binary":true}]} 
[2025-10-07 06:48:39] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-07 06:48:40] local.DEBUG: QR PNG image generated for display {"image_length":4452,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-10-07 06:48:40] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-10-07 06:48:40] local.INFO: Starting unsigned XML generation {"invoice_number":"001000220","uuid":"6ccb9572-bceb-4ea0-97d5-e75fb1bac7fe","suffix":"withqr"} 
[2025-10-07 06:48:40] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-07 06:48:40] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-07 06:48:40] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-07 06:48:40] local.DEBUG: === END DEBUG ===  
[2025-10-07 06:48:40] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-07 06:48:40] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000220","suffix":"-withqr"} 
[2025-10-07 06:48:40] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-07 06:48:40] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-07 06:48:40] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-07 06:48:40] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-07 06:48:40] local.DEBUG: Supplier party built successfully  
[2025-10-07 06:48:40] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-07 06:48:40] local.DEBUG: Buyer party built successfully  
[2025-10-07 06:48:40] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-07 06:48:40] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-07 06:48:40] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-07 06:48:40] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-07 06:48:40] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-07 06:48:40] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-07 06:48:40] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-10-07 06:48:40] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-07 06:48:40] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-07 06:48:40] local.DEBUG: Invoice object created successfully {"id":"001000220","uuid":"6ccb9572-bceb-4ea0-97d5-e75fb1bac7fe","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-07 06:48:40] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000220-unsigned-withqr.xml","file_size":5978,"suffix_used":"-withqr"} 
[2025-10-07 06:48:40] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000220-signed-1759805320.xml"} 
[2025-10-07 06:48:40] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":220,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-07 06:53:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-07 06:53:24] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-07 06:53:24] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-07 06:53:24] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-07 06:53:24] local.INFO: Starting unsigned XML generation {"invoice_number":"001000221","uuid":"63bf131a-e116-4036-8202-4fd2eccfa0e1","suffix":"noqr"} 
[2025-10-07 06:53:24] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-07 06:53:24] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-07 06:53:24] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-07 06:53:24] local.DEBUG: === END DEBUG ===  
[2025-10-07 06:53:24] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-07 06:53:24] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000221","suffix":"-noqr"} 
[2025-10-07 06:53:24] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-07 06:53:24] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-07 06:53:24] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-07 06:53:24] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-07 06:53:24] local.DEBUG: Supplier party built successfully  
[2025-10-07 06:53:24] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-07 06:53:24] local.DEBUG: Buyer party built successfully  
[2025-10-07 06:53:24] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-07 06:53:24] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-07 06:53:24] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-07 06:53:24] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-07 06:53:24] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-07 06:53:24] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-07 06:53:24] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-10-07 06:53:24] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-10-07 06:53:24] local.DEBUG: Invoice object created successfully {"id":"001000221","uuid":"63bf131a-e116-4036-8202-4fd2eccfa0e1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-07 06:53:24] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000221-unsigned-noqr.xml","file_size":5469,"suffix_used":"-noqr"} 
[2025-10-07 06:53:24] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000221-unsigned-noqr.xml"} 
[2025-10-07 06:53:24] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000221-signed-1759805604.xml"} 
[2025-10-07 06:53:24] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-07 06:53:24] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-10-07 06:53:24] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-07 06:53:24] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"m/\u0012/rql3UU8*=Lzgr\u0011...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u00009p\u0012yTc\u001amL\u0003o(`...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"{\u0019X\u0010Ngj\u0005*r\u0015e\tEK\u0001...[2 more bytes]","is_binary":true}]} 
[2025-10-07 06:53:24] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-07 06:53:25] local.DEBUG: QR PNG image generated for display {"image_length":4524,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-10-07 06:53:25] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-10-07 06:53:25] local.INFO: Starting unsigned XML generation {"invoice_number":"001000221","uuid":"63bf131a-e116-4036-8202-4fd2eccfa0e1","suffix":"withqr"} 
[2025-10-07 06:53:25] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-07 06:53:25] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-07 06:53:25] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-07 06:53:25] local.DEBUG: === END DEBUG ===  
[2025-10-07 06:53:25] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-07 06:53:25] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000221","suffix":"-withqr"} 
[2025-10-07 06:53:25] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-07 06:53:25] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-07 06:53:25] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-07 06:53:25] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-07 06:53:25] local.DEBUG: Supplier party built successfully  
[2025-10-07 06:53:25] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-07 06:53:25] local.DEBUG: Buyer party built successfully  
[2025-10-07 06:53:25] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-07 06:53:25] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-07 06:53:25] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-07 06:53:25] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-07 06:53:25] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-07 06:53:25] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-07 06:53:25] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":294} 
[2025-10-07 06:53:25] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-07 06:53:25] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-07 06:53:25] local.DEBUG: Invoice object created successfully {"id":"001000221","uuid":"63bf131a-e116-4036-8202-4fd2eccfa0e1","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-07 06:53:25] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000221-unsigned-withqr.xml","file_size":5978,"suffix_used":"-withqr"} 
[2025-10-07 06:53:25] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000221-signed-1759805605.xml"} 
[2025-10-07 06:53:25] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":221,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-07 07:33:25] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-07 07:33:25] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-07 07:33:25] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-07 07:33:25] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-07 07:33:25] local.INFO: Starting unsigned XML generation {"invoice_number":"001000222","uuid":"911134c3-7dbd-4bd1-bb82-81bff9d2f2f8","suffix":"noqr"} 
[2025-10-07 07:33:25] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-07 07:33:25] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-07 07:33:25] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-07 07:33:25] local.DEBUG: === END DEBUG ===  
[2025-10-07 07:33:25] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-07 07:33:25] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000222","suffix":"-noqr"} 
[2025-10-07 07:33:25] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-07 07:33:25] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-07 07:33:25] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-07 07:33:25] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-07 07:33:25] local.DEBUG: Supplier party built successfully  
[2025-10-07 07:33:25] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-07 07:33:25] local.DEBUG: Buyer party built successfully  
[2025-10-07 07:33:25] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-07 07:33:25] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-07 07:33:25] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-07 07:33:25] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-07 07:33:25] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-07 07:33:25] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-07 07:33:25] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-10-07 07:33:25] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-10-07 07:33:25] local.DEBUG: Invoice object created successfully {"id":"001000222","uuid":"911134c3-7dbd-4bd1-bb82-81bff9d2f2f8","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-07 07:33:25] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000222-unsigned-noqr.xml","file_size":5394,"suffix_used":"-noqr"} 
[2025-10-07 07:33:25] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000222-unsigned-noqr.xml"} 
[2025-10-07 07:33:25] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000222-signed-1759808005.xml"} 
[2025-10-07 07:33:25] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-07 07:33:25] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-07 07:33:25] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-07 07:33:25] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"_Jls|\u0010w`ve_a.bn\u0003p4...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 t\u001eItL\f4cG
R6P\u0019\u0018O...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"!<\u0013\u0004I3\u0000\u0001/\u001cuV\u0019C\u0002Y>\u001a...[2 more bytes]","is_binary":true}]} 
[2025-10-07 07:33:25] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-07 07:33:25] local.DEBUG: QR PNG image generated for display {"image_length":4524,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-10-07 07:33:25] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-10-07 07:33:25] local.INFO: Starting unsigned XML generation {"invoice_number":"001000222","uuid":"911134c3-7dbd-4bd1-bb82-81bff9d2f2f8","suffix":"withqr"} 
[2025-10-07 07:33:25] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-07 07:33:25] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-07 07:33:25] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-07 07:33:25] local.DEBUG: === END DEBUG ===  
[2025-10-07 07:33:25] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-07 07:33:25] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000222","suffix":"-withqr"} 
[2025-10-07 07:33:25] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-07 07:33:25] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-07 07:33:25] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-07 07:33:25] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-07 07:33:25] local.DEBUG: Supplier party built successfully  
[2025-10-07 07:33:25] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-07 07:33:25] local.DEBUG: Buyer party built successfully  
[2025-10-07 07:33:25] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-07 07:33:25] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-07 07:33:25] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-07 07:33:25] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-07 07:33:25] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-07 07:33:25] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-07 07:33:25] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":293} 
[2025-10-07 07:33:25] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-07 07:33:25] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-07 07:33:25] local.DEBUG: Invoice object created successfully {"id":"001000222","uuid":"911134c3-7dbd-4bd1-bb82-81bff9d2f2f8","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-07 07:33:25] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000222-unsigned-withqr.xml","file_size":6087,"suffix_used":"-withqr"} 
[2025-10-07 07:33:25] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000222-signed-1759808005.xml"} 
[2025-10-07 07:33:25] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":222,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 08:56:43] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 08:57:01] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 08:57:03] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 08:57:03] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 08:57:07] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 08:57:07] local.INFO: Starting unsigned XML generation {"invoice_number":"001000223","uuid":"aa98ada8-0d27-4b37-8d48-8e7a62aa3595","suffix":"noqr"} 
[2025-10-08 08:57:07] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 08:57:07] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 08:57:07] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 08:57:07] local.DEBUG: === END DEBUG ===  
[2025-10-08 08:57:07] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-08 08:57:07] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000223","suffix":"-noqr"} 
[2025-10-08 08:57:07] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 08:57:07] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 08:57:07] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 08:57:07] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 08:57:07] local.DEBUG: Supplier party built successfully  
[2025-10-08 08:57:07] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 08:57:07] local.DEBUG: Buyer party built successfully  
[2025-10-08 08:57:07] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 08:57:07] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-08 08:57:07] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 08:57:07] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 08:57:07] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 08:57:07] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 08:57:07] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":1,"ids":["ICV"]} 
[2025-10-08 08:57:07] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":1,"ids":["ICV"]} 
[2025-10-08 08:57:07] local.DEBUG: Invoice object created successfully {"id":"001000223","uuid":"aa98ada8-0d27-4b37-8d48-8e7a62aa3595","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 08:57:08] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000223-unsigned-noqr.xml","file_size":5394,"suffix_used":"-noqr"} 
[2025-10-08 08:57:08] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000223-unsigned-noqr.xml"} 
[2025-10-08 08:57:08] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000223-signed-1759899428.xml"} 
[2025-10-08 08:57:08] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 08:57:08] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-10-08 08:57:08] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 08:57:08] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"$zo\u0005y\u00150\u000eyo6W! g...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 @\u0001y8i}<\u00127\u0018u....[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"iSFW< \u0016LK\u001f&s$2]...[2 more bytes]","is_binary":true}]} 
[2025-10-08 08:57:08] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 08:57:10] local.DEBUG: QR PNG image generated for display {"image_length":4584,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-10-08 08:57:10] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-10-08 08:57:10] local.INFO: Starting unsigned XML generation {"invoice_number":"001000223","uuid":"aa98ada8-0d27-4b37-8d48-8e7a62aa3595","suffix":"withqr"} 
[2025-10-08 08:57:10] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 08:57:10] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 08:57:10] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 08:57:10] local.DEBUG: === END DEBUG ===  
[2025-10-08 08:57:10] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-08 08:57:10] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000223","suffix":"-withqr"} 
[2025-10-08 08:57:10] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 08:57:10] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 08:57:10] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 08:57:10] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 08:57:10] local.DEBUG: Supplier party built successfully  
[2025-10-08 08:57:10] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 08:57:10] local.DEBUG: Buyer party built successfully  
[2025-10-08 08:57:10] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 08:57:10] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-08 08:57:10] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 08:57:10] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 08:57:10] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 08:57:10] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 08:57:10] local.DEBUG: QR content validated {"original_length":392,"cleaned_length":392,"decoded_bytes":292} 
[2025-10-08 08:57:10] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-08 08:57:10] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":2,"ids":["ICV","QR"]} 
[2025-10-08 08:57:10] local.DEBUG: Invoice object created successfully {"id":"001000223","uuid":"aa98ada8-0d27-4b37-8d48-8e7a62aa3595","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 08:57:10] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000223-unsigned-withqr.xml","file_size":6087,"suffix_used":"-withqr"} 
[2025-10-08 08:57:10] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000223-signed-1759899430.xml"} 
[2025-10-08 08:57:10] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":223,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 09:29:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 09:29:30] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 09:29:30] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 09:29:30] local.DEBUG: InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 09:29:30] local.INFO: Starting unsigned XML generation {"invoice_number":"001000224","uuid":"99c27ea2-b61c-45b7-9004-60206fa6acac","suffix":"noqr"} 
[2025-10-08 09:29:30] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 09:29:30] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 09:29:30] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 09:29:30] local.DEBUG: === END DEBUG ===  
[2025-10-08 09:29:30] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-08 09:29:30] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000224","suffix":"-noqr"} 
[2025-10-08 09:29:30] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 09:29:30] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 09:29:30] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 09:29:30] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 09:29:30] local.DEBUG: Supplier party built successfully  
[2025-10-08 09:29:30] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 09:29:30] local.DEBUG: Buyer party built successfully  
[2025-10-08 09:29:30] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 09:29:30] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-08 09:29:30] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 09:29:30] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 09:29:30] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 09:29:30] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 09:29:30] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:29:30] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:29:30] local.DEBUG: Invoice object created successfully {"id":"001000224","uuid":"99c27ea2-b61c-45b7-9004-60206fa6acac","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 09:29:30] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000224-unsigned-noqr.xml","file_size":6689,"suffix_used":"-noqr"} 
[2025-10-08 09:29:30] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000224-unsigned-noqr.xml"} 
[2025-10-08 09:29:30] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000224-signed-1759901370.xml"} 
[2025-10-08 09:29:30] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 09:29:30] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-10-08 09:29:30] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 09:29:30] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"#\u0019F@P<XVz2T\u0000\b>'M\u00172...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000\u0000\trK\u001a\"\u001b(H\u0014...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"'2\u0017<\u0013\u0002
ZP&!A3x\u0014b\u000bd...[2 more bytes]","is_binary":true}]} 
[2025-10-08 09:29:30] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 09:29:30] local.DEBUG: QR PNG image generated for display {"image_length":4512,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-10-08 09:29:30] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-10-08 09:29:30] local.INFO: Starting unsigned XML generation {"invoice_number":"001000224","uuid":"99c27ea2-b61c-45b7-9004-60206fa6acac","suffix":"withqr"} 
[2025-10-08 09:29:30] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 09:29:30] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 09:29:30] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 09:29:30] local.DEBUG: === END DEBUG ===  
[2025-10-08 09:29:30] local.DEBUG: Tax scheme created {"id":"VAT"} 
[2025-10-08 09:29:30] local.DEBUG: Invoice identification {"branch_part":"0010","invoice_number":"001000224","suffix":"-withqr"} 
[2025-10-08 09:29:30] local.DEBUG: Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 09:29:30] local.DEBUG: Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 09:29:30] local.DEBUG: Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 09:29:30] local.DEBUG: Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 09:29:30] local.DEBUG: Supplier party built successfully  
[2025-10-08 09:29:30] local.DEBUG: Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 09:29:30] local.DEBUG: Buyer party built successfully  
[2025-10-08 09:29:30] local.DEBUG: Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 09:29:30] local.DEBUG: Invoice lines processed (NO RECONCILIATION) {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups":{"S_5":{"taxable":42.86,"tax":2.14,"rate":5.0,"category":"S"}},"pricing_type":"inclusive","controller_total_amount":45.0,"controller_vat_amount":2.14} 
[2025-10-08 09:29:30] local.DEBUG: Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 09:29:30] local.DEBUG: Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 09:29:30] local.DEBUG: Tax total built with distribution fix {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 09:29:30] local.DEBUG: Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 09:29:30] local.DEBUG: Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:29:30] local.DEBUG: AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:29:30] local.DEBUG: Invoice object created successfully {"id":"001000224","uuid":"99c27ea2-b61c-45b7-9004-60206fa6acac","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 09:29:30] local.INFO: XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000224-unsigned-withqr.xml","file_size":6689,"suffix_used":"-withqr"} 
[2025-10-08 09:29:30] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000224-signed-1759901370.xml"} 
[2025-10-08 09:29:30] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":224,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 09:45:17] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 09:45:17] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 09:45:17] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 09:45:17] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 09:45:17] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000225","uuid":"f3762460-cea4-4d62-b5dd-d235e04872ce","suffix":"noqr"} 
[2025-10-08 09:45:17] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 09:45:17] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 09:45:17] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 09:45:17] local.DEBUG: === END DEBUG ===  
[2025-10-08 09:45:17] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000225","suffix":"-noqr"} 
[2025-10-08 09:45:17] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 09:45:17] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 09:45:17] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 09:45:17] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 09:45:17] local.DEBUG:  Supplier party built successfully  
[2025-10-08 09:45:17] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 09:45:17] local.DEBUG:  Buyer party built successfully  
[2025-10-08 09:45:17] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 09:45:17] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 09:45:17] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 09:45:17] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 09:45:17] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:45:17] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:45:17] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice object created successfully {"id":"001000225","uuid":"f3762460-cea4-4d62-b5dd-d235e04872ce","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 09:45:17] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 09:45:17] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 09:45:17] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 09:45:17] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 09:45:17] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 09:45:17] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 09:45:17] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 09:45:17] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 09:45:17] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 09:45:17] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":[]} 
[2025-10-08 09:45:17] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 09:45:17] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 09:45:17] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":[]} 
[2025-10-08 09:45:17] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 09:45:17] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000225-unsigned-noqr.xml","file_size":6689,"suffix_used":"-noqr"} 
[2025-10-08 09:45:17] local.DEBUG: Initial unsigned XML generated (without QR) {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000225-unsigned-noqr.xml"} 
[2025-10-08 09:45:17] local.DEBUG: Initial XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000225-signed-1759902317.xml"} 
[2025-10-08 09:45:17] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 09:45:17] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-08 09:45:17] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 09:45:17] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"#\u0013/-`X\u0016ig(CM\u001c...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000TzNz^bB7\u001ceU\t\u001d\u001fM-...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"nNFL:b3c^\u000epyV/P\u0018+4
\u000e\u0000...[2 more bytes]","is_binary":true}]} 
[2025-10-08 09:45:17] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 09:45:17] local.DEBUG: QR PNG image generated for display {"image_length":4576,"image_preview":"iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACX..."} 
[2025-10-08 09:45:17] local.DEBUG: QR code with crypto tags generated {"length":392} 
[2025-10-08 09:45:17] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000225","uuid":"f3762460-cea4-4d62-b5dd-d235e04872ce","suffix":"withqr"} 
[2025-10-08 09:45:17] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 09:45:17] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 09:45:17] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 09:45:17] local.DEBUG: === END DEBUG ===  
[2025-10-08 09:45:17] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000225","suffix":"-withqr"} 
[2025-10-08 09:45:17] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 09:45:17] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 09:45:17] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 09:45:17] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 09:45:17] local.DEBUG:  Supplier party built successfully  
[2025-10-08 09:45:17] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 09:45:17] local.DEBUG:  Buyer party built successfully  
[2025-10-08 09:45:17] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 09:45:17] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 09:45:17] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 09:45:17] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 09:45:17] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:45:17] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:45:17] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:45:17] local.DEBUG:  Invoice object created successfully {"id":"001000225","uuid":"f3762460-cea4-4d62-b5dd-d235e04872ce","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 09:45:17] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 09:45:17] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 09:45:17] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 09:45:17] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 09:45:17] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 09:45:17] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 09:45:17] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 09:45:17] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 09:45:17] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 09:45:17] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":[]} 
[2025-10-08 09:45:17] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 09:45:17] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 09:45:17] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":[]} 
[2025-10-08 09:45:17] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 09:45:17] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000225-unsigned-withqr.xml","file_size":6689,"suffix_used":"-withqr"} 
[2025-10-08 09:45:17] local.DEBUG: Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000225-signed-1759902317.xml"} 
[2025-10-08 09:45:17] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":225,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 09:52:10] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 09:52:10] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 09:52:10] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 09:52:10] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 09:52:10] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000226","uuid":"4cac0ab6-c5fe-471c-afb4-fe5d8ba2b5e6","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 09:52:10] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 09:52:10] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000226","uuid":"4cac0ab6-c5fe-471c-afb4-fe5d8ba2b5e6","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"226","previous_invoice_hash":"CU6pE1d6zd+Dqqb7tE71KSp/TLez+mU9X0j/wfAo3TA=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 09:52:10] local.DEBUG:  Default values applied {"result_data":{"uuid":"4cac0ab6-c5fe-471c-afb4-fe5d8ba2b5e6","invoice_counter":"226","pih":"CU6pE1d6zd+Dqqb7tE71KSp/TLez+mU9X0j/wfAo3TA=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000226","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"CU6pE1d6zd+Dqqb7tE71KSp/TLez+mU9X0j/wfAo3TA=","pricing_type":"inclusive"}} 
[2025-10-08 09:52:10] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 09:52:10] local.DEBUG:  Running ZATCA validation  
[2025-10-08 09:52:10] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 09:52:10] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 09:52:10] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 09:52:10] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 09:52:10] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 09:52:10] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 09:52:10] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 09:52:10] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000226","uuid":"4cac0ab6-c5fe-471c-afb4-fe5d8ba2b5e6","suffix":"final"} 
[2025-10-08 09:52:10] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 09:52:10] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 09:52:10] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 09:52:10] local.DEBUG: === END DEBUG ===  
[2025-10-08 09:52:10] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 09:52:10] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000226","suffix":"-final"} 
[2025-10-08 09:52:10] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 09:52:10] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 09:52:10] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 09:52:10] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 09:52:10] local.DEBUG:  Supplier party built successfully  
[2025-10-08 09:52:10] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 09:52:10] local.DEBUG:  Buyer party built successfully  
[2025-10-08 09:52:10] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 09:52:10] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 09:52:10] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 09:52:10] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 09:52:10] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 09:52:10] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 09:52:10] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:52:10] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:52:10] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 09:52:10] local.DEBUG:  Invoice object created successfully {"id":"001000226","uuid":"4cac0ab6-c5fe-471c-afb4-fe5d8ba2b5e6","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 09:52:10] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 09:52:10] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 09:52:10] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 09:52:10] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 09:52:10] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 09:52:10] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 09:52:10] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 09:52:10] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 09:52:10] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 09:52:10] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 09:52:10] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 09:52:10] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 09:52:10] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 09:52:10] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 09:52:10] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000226-unsigned-final.xml","file_size":7655,"suffix_used":"-final"} 
[2025-10-08 09:52:10] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000226-unsigned-final.xml","file_size":7655} 
[2025-10-08 09:52:10] local.INFO:  Signing final XML  
[2025-10-08 09:52:10] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000226-signed-1759902730.xml"} 
[2025-10-08 09:52:10] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 09:52:10] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 09:52:10] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-10-08 09:52:10] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 09:52:10] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u000eL>VZkq=\u0012Z#]\u0005:p_d:...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000&;\u0010\u000fC*R\u0014Zv\u001b\u0005...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\tN\u0013WzN)*Le=_H(...[2 more bytes]","is_binary":true}]} 
[2025-10-08 09:52:10] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 09:52:10] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 09:52:10] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 09:52:10] local.DEBUG:  QR image generated {"image_length":4580} 
[2025-10-08 09:52:10] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 09:52:10] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000226-unsigned-final.xml"} 
[2025-10-08 09:52:10] local.DEBUG: QR references found {"count":1} 
[2025-10-08 09:52:10] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 09:52:10] local.DEBUG:  XML QR code update completed  
[2025-10-08 09:52:10] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000226-signed-1759902730.xml"} 
[2025-10-08 09:52:10] local.DEBUG: QR references found {"count":1} 
[2025-10-08 09:52:10] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 09:52:10] local.DEBUG:  XML QR code update completed  
[2025-10-08 09:52:10] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 09:52:10] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 09:52:10] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"3lsb829JXWSZQ/WqhJdY..."} 
[2025-10-08 09:52:10] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"226","invoice_hash_length":44} 
[2025-10-08 09:52:10] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000226","uuid":"4cac0ab6-c5fe-471c-afb4-fe5d8ba2b5e6","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000226-signed-1759902730.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 09:52:10] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":226,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 09:52:10] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":226,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 10:32:32] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 10:32:34] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 10:32:34] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 10:32:35] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 10:32:35] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000227","uuid":"f836b4b6-0c21-4a0d-9a64-401b60ccb768","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 10:32:35] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 10:32:35] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000227","uuid":"f836b4b6-0c21-4a0d-9a64-401b60ccb768","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"227","previous_invoice_hash":"3lsb829JXWSZQ/WqhJdYYQUl/36/XCkV5x0qwOgeImQ=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 10:32:35] local.DEBUG:  Default values applied {"result_data":{"uuid":"f836b4b6-0c21-4a0d-9a64-401b60ccb768","invoice_counter":"227","pih":"3lsb829JXWSZQ/WqhJdYYQUl/36/XCkV5x0qwOgeImQ=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000227","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"3lsb829JXWSZQ/WqhJdYYQUl/36/XCkV5x0qwOgeImQ=","pricing_type":"inclusive"}} 
[2025-10-08 10:32:35] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 10:32:35] local.DEBUG:  Running ZATCA validation  
[2025-10-08 10:32:35] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 10:32:35] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 10:32:35] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 10:32:35] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 10:32:35] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 10:32:35] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 10:32:35] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":70} 
[2025-10-08 10:32:35] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 10:32:35] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 10:32:35] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000227","uuid":"f836b4b6-0c21-4a0d-9a64-401b60ccb768","suffix":"final"} 
[2025-10-08 10:32:35] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 10:32:35] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 10:32:35] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 10:32:35] local.DEBUG: === END DEBUG ===  
[2025-10-08 10:32:35] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 10:32:35] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000227","suffix":"-final"} 
[2025-10-08 10:32:35] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 10:32:35] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 10:32:35] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 10:32:35] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 10:32:35] local.DEBUG:  Supplier party built successfully  
[2025-10-08 10:32:35] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 10:32:35] local.DEBUG:  Buyer party built successfully  
[2025-10-08 10:32:35] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 10:32:35] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 10:32:35] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 10:32:35] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 10:32:35] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 10:32:35] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 10:32:35] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 10:32:35] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 10:32:35] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 10:32:35] local.DEBUG:  Invoice object created successfully {"id":"001000227","uuid":"f836b4b6-0c21-4a0d-9a64-401b60ccb768","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 10:32:35] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 10:32:35] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 10:32:35] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 10:32:35] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 10:32:35] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 10:32:35] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 10:32:35] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 10:32:35] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 10:32:35] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 10:32:35] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 10:32:35] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 10:32:35] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 10:32:35] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 10:32:35] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 10:32:35] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000227-unsigned-final.xml","file_size":7996,"suffix_used":"-final"} 
[2025-10-08 10:32:35] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000227-unsigned-final.xml","file_size":7996} 
[2025-10-08 10:32:35] local.INFO:  Signing final XML  
[2025-10-08 10:32:36] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000227-signed-1759905156.xml"} 
[2025-10-08 10:32:36] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 10:32:36] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 10:32:36] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-10-08 10:32:36] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 10:32:36] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"ND\u0010!\b`\u0004m\u0016a...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 `WQe4\u0010i\u00037v\bcQ\b\u001a(...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"[\u001boI]dCXa\u0005%~\\)\u0015\u001d*\u001e...[2 more bytes]","is_binary":true}]} 
[2025-10-08 10:32:36] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 10:32:36] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 10:32:36] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 10:32:36] local.DEBUG:  QR image generated {"image_length":4472} 
[2025-10-08 10:32:36] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 10:32:36] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000227-unsigned-final.xml"} 
[2025-10-08 10:32:36] local.DEBUG: QR references found {"count":1} 
[2025-10-08 10:32:36] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 10:32:36] local.DEBUG:  XML QR code update completed  
[2025-10-08 10:32:36] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000227-signed-1759905156.xml"} 
[2025-10-08 10:32:36] local.DEBUG: QR references found {"count":1} 
[2025-10-08 10:32:36] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 10:32:36] local.DEBUG:  XML QR code update completed  
[2025-10-08 10:32:36] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 10:32:36] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 10:32:36] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"rWiyirnWG9AAMnaYuMe7..."} 
[2025-10-08 10:32:36] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"227","invoice_hash_length":44} 
[2025-10-08 10:32:36] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000227","uuid":"f836b4b6-0c21-4a0d-9a64-401b60ccb768","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000227-signed-1759905156.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 10:32:36] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":227,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 10:32:36] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":227,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 13:23:50] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:24:00] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:24:00] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 13:24:00] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 13:24:00] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:24:00] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000228","uuid":"76000086-a34a-466c-b042-72d94e771502","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 13:24:00] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 13:24:00] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000228","uuid":"76000086-a34a-466c-b042-72d94e771502","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"228","previous_invoice_hash":"rWiyirnWG9AAMnaYuMe79ui9kXJtsQ3M918l1KdV89w=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 13:24:00] local.DEBUG:  Default values applied {"result_data":{"uuid":"76000086-a34a-466c-b042-72d94e771502","invoice_counter":"228","pih":"rWiyirnWG9AAMnaYuMe79ui9kXJtsQ3M918l1KdV89w=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000228","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"rWiyirnWG9AAMnaYuMe79ui9kXJtsQ3M918l1KdV89w=","pricing_type":"inclusive"}} 
[2025-10-08 13:24:00] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 13:24:00] local.DEBUG:  Running ZATCA validation  
[2025-10-08 13:24:00] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 13:24:00] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 13:24:00] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:24:00] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 13:24:00] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 13:24:00] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 13:24:00] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 13:24:00] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000228","uuid":"76000086-a34a-466c-b042-72d94e771502","suffix":"final"} 
[2025-10-08 13:24:00] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 13:24:00] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 13:24:00] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 13:24:00] local.DEBUG: === END DEBUG ===  
[2025-10-08 13:24:00] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 13:24:00] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000228","suffix":"-final"} 
[2025-10-08 13:24:00] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 13:24:00] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 13:24:00] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 13:24:00] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 13:24:01] local.DEBUG:  Supplier party built successfully  
[2025-10-08 13:24:01] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 13:24:01] local.DEBUG:  Buyer party built successfully  
[2025-10-08 13:24:01] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 13:24:01] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 13:24:01] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 13:24:01] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 13:24:01] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 13:24:01] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 13:24:01] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:24:01] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:24:01] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:24:01] local.DEBUG:  Invoice object created successfully {"id":"001000228","uuid":"76000086-a34a-466c-b042-72d94e771502","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:24:01] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 13:24:01] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 13:24:01] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:24:01] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 13:24:01] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 13:24:01] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 13:24:01] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:24:01] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 13:24:01] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 13:24:01] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:24:01] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 13:24:01] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 13:24:01] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:24:01] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 13:24:01] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000228-unsigned-final.xml","file_size":7655,"suffix_used":"-final"} 
[2025-10-08 13:24:01] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000228-unsigned-final.xml","file_size":7655} 
[2025-10-08 13:24:01] local.INFO:  Signing final XML  
[2025-10-08 13:24:01] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000228-signed-1759915441.xml"} 
[2025-10-08 13:24:01] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 13:24:01] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 13:24:01] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-08 13:24:01] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 13:24:01] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"X\fsa_\u0003\"36'%b\u001asM'|...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000.|\u0002Gj=dhJ\u0015...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"h\u001b\u00002vrm
_%U...[2 more bytes]","is_binary":true}]} 
[2025-10-08 13:24:01] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 13:24:01] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 13:24:01] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 13:24:01] local.DEBUG:  QR image generated {"image_length":4612} 
[2025-10-08 13:24:01] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 13:24:01] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000228-unsigned-final.xml"} 
[2025-10-08 13:24:01] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:24:01] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:24:01] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:24:01] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000228-signed-1759915441.xml"} 
[2025-10-08 13:24:01] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:24:01] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:24:01] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:24:01] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 13:24:01] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 13:24:01] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"1vmepeP63qjPCXeeJtNs..."} 
[2025-10-08 13:24:01] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"228","invoice_hash_length":44} 
[2025-10-08 13:24:01] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000228","uuid":"76000086-a34a-466c-b042-72d94e771502","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000228-signed-1759915441.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:24:01] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":228,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:24:01] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":228,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 13:24:23] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:24:23] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 13:24:23] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 13:24:23] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:24:23] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000229","uuid":"ea05408a-c22c-47b7-8e89-285b0869cfca","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 13:24:23] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 13:24:23] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000229","uuid":"ea05408a-c22c-47b7-8e89-285b0869cfca","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"229","previous_invoice_hash":"1vmepeP63qjPCXeeJtNssnZN+TbMJcq82Nn8WaTnsz8=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 13:24:23] local.DEBUG:  Default values applied {"result_data":{"uuid":"ea05408a-c22c-47b7-8e89-285b0869cfca","invoice_counter":"229","pih":"1vmepeP63qjPCXeeJtNssnZN+TbMJcq82Nn8WaTnsz8=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000229","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"1vmepeP63qjPCXeeJtNssnZN+TbMJcq82Nn8WaTnsz8=","pricing_type":"inclusive"}} 
[2025-10-08 13:24:23] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 13:24:23] local.DEBUG:  Running ZATCA validation  
[2025-10-08 13:24:23] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 13:24:23] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 13:24:23] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:24:23] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 13:24:23] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 13:24:23] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 13:24:23] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":72} 
[2025-10-08 13:24:23] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 13:24:23] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 13:24:23] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000229","uuid":"ea05408a-c22c-47b7-8e89-285b0869cfca","suffix":"final"} 
[2025-10-08 13:24:23] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 13:24:23] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 13:24:23] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 13:24:23] local.DEBUG: === END DEBUG ===  
[2025-10-08 13:24:23] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 13:24:23] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000229","suffix":"-final"} 
[2025-10-08 13:24:23] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 13:24:23] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 13:24:23] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 13:24:23] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 13:24:23] local.DEBUG:  Supplier party built successfully  
[2025-10-08 13:24:23] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 13:24:23] local.DEBUG:  Buyer party built successfully  
[2025-10-08 13:24:23] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 13:24:23] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 13:24:23] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 13:24:23] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 13:24:23] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 13:24:23] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 13:24:23] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:24:23] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:24:23] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:24:23] local.DEBUG:  Invoice object created successfully {"id":"001000229","uuid":"ea05408a-c22c-47b7-8e89-285b0869cfca","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:24:23] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 13:24:23] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 13:24:23] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:24:23] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 13:24:23] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 13:24:23] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 13:24:23] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:24:23] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 13:24:23] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 13:24:23] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:24:23] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 13:24:23] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 13:24:23] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:24:23] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 13:24:23] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000229-unsigned-final.xml","file_size":8367,"suffix_used":"-final"} 
[2025-10-08 13:24:23] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000229-unsigned-final.xml","file_size":8367} 
[2025-10-08 13:24:23] local.INFO:  Signing final XML  
[2025-10-08 13:24:23] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000229-signed-1759915463.xml"} 
[2025-10-08 13:24:23] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 13:24:23] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 13:24:23] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-10-08 13:24:23] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 13:24:23] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"DQZ\tgo\u0015^bH9...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 j9o&_`cMY\u001a\u0001\u0000\u0017\u0018\t;_\u0001k...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\tw&lvM6%Y...[2 more bytes]","is_binary":true}]} 
[2025-10-08 13:24:23] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 13:24:23] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 13:24:23] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 13:24:23] local.DEBUG:  QR image generated {"image_length":4600} 
[2025-10-08 13:24:23] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 13:24:23] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000229-unsigned-final.xml"} 
[2025-10-08 13:24:23] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:24:23] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:24:23] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:24:23] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000229-signed-1759915463.xml"} 
[2025-10-08 13:24:23] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:24:23] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:24:23] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:24:23] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 13:24:23] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 13:24:23] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"RYE8h16Tijz2JysJ6wA5..."} 
[2025-10-08 13:24:23] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"229","invoice_hash_length":44} 
[2025-10-08 13:24:23] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000229","uuid":"ea05408a-c22c-47b7-8e89-285b0869cfca","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000229-signed-1759915463.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:24:23] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":229,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:24:23] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":229,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 13:38:59] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:38:59] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 13:38:59] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 13:39:00] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:39:00] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000230","uuid":"841f081b-d0b1-4ac8-a0b6-4f0d731caeaf","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 13:39:00] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 13:39:00] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000230","uuid":"841f081b-d0b1-4ac8-a0b6-4f0d731caeaf","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"230","previous_invoice_hash":"RYE8h16Tijz2JysJ6wA5/8M2aK++4D8TtYAx2Xk539c=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 13:39:00] local.DEBUG:  Default values applied {"result_data":{"uuid":"841f081b-d0b1-4ac8-a0b6-4f0d731caeaf","invoice_counter":"230","pih":"RYE8h16Tijz2JysJ6wA5/8M2aK++4D8TtYAx2Xk539c=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000230","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"RYE8h16Tijz2JysJ6wA5/8M2aK++4D8TtYAx2Xk539c=","pricing_type":"inclusive"}} 
[2025-10-08 13:39:00] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 13:39:00] local.DEBUG:  Running ZATCA validation  
[2025-10-08 13:39:00] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 13:39:00] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 13:39:00] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:39:00] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 13:39:00] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 13:39:00] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 13:39:00] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":70} 
[2025-10-08 13:39:00] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 13:39:00] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 13:39:00] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000230","uuid":"841f081b-d0b1-4ac8-a0b6-4f0d731caeaf","suffix":"final"} 
[2025-10-08 13:39:00] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 13:39:00] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 13:39:00] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 13:39:00] local.DEBUG: === END DEBUG ===  
[2025-10-08 13:39:00] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 13:39:00] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000230","suffix":"-final"} 
[2025-10-08 13:39:00] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 13:39:00] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 13:39:00] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 13:39:00] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 13:39:00] local.DEBUG:  Supplier party built successfully  
[2025-10-08 13:39:00] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 13:39:00] local.DEBUG:  Buyer party built successfully  
[2025-10-08 13:39:00] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 13:39:00] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 13:39:00] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 13:39:00] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 13:39:00] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 13:39:00] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 13:39:00] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:39:00] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:39:00] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:39:00] local.DEBUG:  Invoice object created successfully {"id":"001000230","uuid":"841f081b-d0b1-4ac8-a0b6-4f0d731caeaf","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:39:00] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 13:39:00] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 13:39:00] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:39:00] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 13:39:00] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 13:39:00] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 13:39:00] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:39:00] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 13:39:00] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 13:39:00] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:39:00] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 13:39:00] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 13:39:00] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:39:00] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 13:39:00] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final.xml","file_size":8367,"suffix_used":"-final"} 
[2025-10-08 13:39:00] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final.xml","file_size":8367} 
[2025-10-08 13:39:00] local.INFO:  Signing final XML  
[2025-10-08 13:39:00] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final.xml"} 
[2025-10-08 13:39:00] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-08 13:39:00] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-08 13:39:00] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-08 13:39:00] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final-signed-1759916340.xml"} 
[2025-10-08 13:39:00] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final-signed-1759916340.xml"} 
[2025-10-08 13:39:00] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 13:39:00] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 13:39:00] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-10-08 13:39:00] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 13:39:00] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"~/%?KyB}q#\u000b6bUk\u0000...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000&.z:TzS\u001aD.kP\u0002\u000f4\u0005...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"E<^<'+\t\u000096h?\u00131y9...[2 more bytes]","is_binary":true}]} 
[2025-10-08 13:39:00] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 13:39:00] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 13:39:00] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 13:39:00] local.DEBUG:  QR image generated {"image_length":4496} 
[2025-10-08 13:39:00] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 13:39:00] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final.xml"} 
[2025-10-08 13:39:00] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:39:00] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:39:00] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:39:00] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final-signed-1759916340.xml"} 
[2025-10-08 13:39:00] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:39:00] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:39:00] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:39:00] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 13:39:00] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 13:39:00] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"L8uwzYFJm0KEqX+pv4lj..."} 
[2025-10-08 13:39:00] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"230","invoice_hash_length":44} 
[2025-10-08 13:39:00] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000230","uuid":"841f081b-d0b1-4ac8-a0b6-4f0d731caeaf","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000230-unsigned-final-signed-1759916340.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:39:00] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":230,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:39:00] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":230,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 13:41:44] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:41:44] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 13:41:44] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 13:41:44] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:41:44] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000231","uuid":"69ffbccc-eab1-4321-99f1-6c0a5a5664af","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 13:41:44] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 13:41:44] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000231","uuid":"69ffbccc-eab1-4321-99f1-6c0a5a5664af","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"231","previous_invoice_hash":"L8uwzYFJm0KEqX+pv4ljRaQAbFCTXDH635Uag64QvtQ=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 13:41:44] local.DEBUG:  Default values applied {"result_data":{"uuid":"69ffbccc-eab1-4321-99f1-6c0a5a5664af","invoice_counter":"231","pih":"L8uwzYFJm0KEqX+pv4ljRaQAbFCTXDH635Uag64QvtQ=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000231","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"L8uwzYFJm0KEqX+pv4ljRaQAbFCTXDH635Uag64QvtQ=","pricing_type":"inclusive"}} 
[2025-10-08 13:41:44] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 13:41:44] local.DEBUG:  Running ZATCA validation  
[2025-10-08 13:41:44] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 13:41:44] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 13:41:44] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:41:44] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 13:41:44] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 13:41:44] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 13:41:44] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":72} 
[2025-10-08 13:41:44] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 13:41:44] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 13:41:44] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000231","uuid":"69ffbccc-eab1-4321-99f1-6c0a5a5664af","suffix":"final"} 
[2025-10-08 13:41:44] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 13:41:44] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 13:41:44] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 13:41:44] local.DEBUG: === END DEBUG ===  
[2025-10-08 13:41:44] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 13:41:44] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000231","suffix":"-final"} 
[2025-10-08 13:41:44] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 13:41:44] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 13:41:44] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 13:41:44] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 13:41:44] local.DEBUG:  Supplier party built successfully  
[2025-10-08 13:41:44] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 13:41:44] local.DEBUG:  Buyer party built successfully  
[2025-10-08 13:41:44] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 13:41:44] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 13:41:44] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 13:41:44] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 13:41:44] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 13:41:44] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 13:41:44] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:41:44] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:41:44] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:41:44] local.DEBUG:  Invoice object created successfully {"id":"001000231","uuid":"69ffbccc-eab1-4321-99f1-6c0a5a5664af","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:41:44] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 13:41:44] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash  
[2025-10-08 13:41:44] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:41:44] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 13:41:44] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 13:41:44] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 13:41:44] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:41:44] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 13:41:44] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 13:41:44] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:41:44] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 13:41:44] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 13:41:44] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:41:44] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY  
[2025-10-08 13:41:44] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml","file_size":7564,"suffix_used":"-final"} 
[2025-10-08 13:41:44] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml","file_size":7564} 
[2025-10-08 13:41:44] local.INFO:  Signing final XML  
[2025-10-08 13:41:44] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml"} 
[2025-10-08 13:41:44] local.ERROR:  XML signing failed {"error":"SignatureInformation element not found in XML","path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml"} 
[2025-10-08 13:41:44] local.ERROR:  Final signing failed {"error":"SignatureInformation element not found in XML"} 
[2025-10-08 13:41:44] local.ERROR: ZATCA generation process failed: ZATCA generation failed: Final signing failed: SignatureInformation element not found in XML {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-10-08 13:45:17] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:45:17] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 13:45:17] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 13:45:17] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 13:45:17] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000231","uuid":"4e6876a1-b355-4777-b19f-9a9fb7ab2fcb","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 13:45:17] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 13:45:17] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000231","uuid":"4e6876a1-b355-4777-b19f-9a9fb7ab2fcb","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"231","previous_invoice_hash":"L8uwzYFJm0KEqX+pv4ljRaQAbFCTXDH635Uag64QvtQ=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 13:45:17] local.DEBUG:  Default values applied {"result_data":{"uuid":"4e6876a1-b355-4777-b19f-9a9fb7ab2fcb","invoice_counter":"231","pih":"L8uwzYFJm0KEqX+pv4ljRaQAbFCTXDH635Uag64QvtQ=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000231","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"L8uwzYFJm0KEqX+pv4ljRaQAbFCTXDH635Uag64QvtQ=","pricing_type":"inclusive"}} 
[2025-10-08 13:45:17] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 13:45:17] local.DEBUG:  Running ZATCA validation  
[2025-10-08 13:45:17] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 13:45:17] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 13:45:17] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:45:17] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 13:45:17] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 13:45:17] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 13:45:17] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":70} 
[2025-10-08 13:45:17] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 13:45:17] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 13:45:17] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000231","uuid":"4e6876a1-b355-4777-b19f-9a9fb7ab2fcb","suffix":"final"} 
[2025-10-08 13:45:17] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 13:45:17] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 13:45:17] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 13:45:17] local.DEBUG: === END DEBUG ===  
[2025-10-08 13:45:17] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 13:45:17] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000231","suffix":"-final"} 
[2025-10-08 13:45:17] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 13:45:17] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 13:45:17] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 13:45:17] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 13:45:17] local.DEBUG:  Supplier party built successfully  
[2025-10-08 13:45:17] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 13:45:17] local.DEBUG:  Buyer party built successfully  
[2025-10-08 13:45:17] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 13:45:17] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 13:45:17] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 13:45:17] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 13:45:17] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 13:45:17] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 13:45:17] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:45:17] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:45:17] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 13:45:17] local.DEBUG:  Invoice object created successfully {"id":"001000231","uuid":"4e6876a1-b355-4777-b19f-9a9fb7ab2fcb","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 13:45:17] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 13:45:17] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-08 13:45:17] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:45:17] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 13:45:17] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 13:45:17] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 13:45:17] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 13:45:17] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 13:45:17] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 13:45:17] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:45:17] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 13:45:17] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 13:45:17] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 13:45:17] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-08 13:45:17] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-08 13:45:17] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml","file_size":8599} 
[2025-10-08 13:45:17] local.INFO:  Signing final XML  
[2025-10-08 13:45:17] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml"} 
[2025-10-08 13:45:17] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-08 13:45:17] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-08 13:45:17] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final-signed-1759916717.xml"} 
[2025-10-08 13:45:17] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final-signed-1759916717.xml"} 
[2025-10-08 13:45:17] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 13:45:18] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 13:45:18] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":72,"is_binary":true} 
[2025-10-08 13:45:18] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 13:45:18] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"K1Z#Fxc7>\u0005\u000b\u0005\u001e\u001f\u0017...[2 more bytes]","is_binary":true},{"tag":7,"length":72,"value_preview":"0F\u0002!\u0000\u0001.ML\u0005A\u0010\u0004JI\u000eT\u0013sK...[42 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"/IBcE\u0000lP\\1\u001a\u0010...[2 more bytes]","is_binary":true}]} 
[2025-10-08 13:45:18] local.DEBUG: ZATCA-compliant TLV generated {"total_length":294,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 13:45:18] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 13:45:18] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 13:45:18] local.DEBUG:  QR image generated {"image_length":4496} 
[2025-10-08 13:45:18] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 13:45:18] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final.xml"} 
[2025-10-08 13:45:18] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:45:18] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:45:18] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:45:18] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final-signed-1759916717.xml"} 
[2025-10-08 13:45:18] local.DEBUG: QR references found {"count":1} 
[2025-10-08 13:45:18] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 13:45:18] local.DEBUG:  XML QR code update completed  
[2025-10-08 13:45:18] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 13:45:18] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 13:45:18] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"sswWIRCnDMhjOuiqsWCc..."} 
[2025-10-08 13:45:18] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"231","invoice_hash_length":44} 
[2025-10-08 13:45:18] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000231","uuid":"4e6876a1-b355-4777-b19f-9a9fb7ab2fcb","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000231-unsigned-final-signed-1759916717.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:45:18] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":231,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 13:45:18] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":231,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 14:18:44] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 14:18:44] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 14:18:44] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 14:18:44] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 14:18:44] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000232","uuid":"7fdf2919-19c3-43e6-87a4-4bf376cf4e8f","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 14:18:44] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 14:18:44] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000232","uuid":"7fdf2919-19c3-43e6-87a4-4bf376cf4e8f","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"232","previous_invoice_hash":"sswWIRCnDMhjOuiqsWCcjPaJyLb8e2qL2BZbBiYzDPY=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 14:18:44] local.DEBUG:  Default values applied {"result_data":{"uuid":"7fdf2919-19c3-43e6-87a4-4bf376cf4e8f","invoice_counter":"232","pih":"sswWIRCnDMhjOuiqsWCcjPaJyLb8e2qL2BZbBiYzDPY=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000232","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"sswWIRCnDMhjOuiqsWCcjPaJyLb8e2qL2BZbBiYzDPY=","pricing_type":"inclusive"}} 
[2025-10-08 14:18:44] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 14:18:44] local.DEBUG:  Running ZATCA validation  
[2025-10-08 14:18:44] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 14:18:44] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 14:18:44] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 14:18:44] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 14:18:44] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 14:18:44] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 14:18:44] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":72} 
[2025-10-08 14:18:44] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 14:18:44] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 14:18:44] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000232","uuid":"7fdf2919-19c3-43e6-87a4-4bf376cf4e8f","suffix":"final"} 
[2025-10-08 14:18:44] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 14:18:44] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 14:18:44] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 14:18:44] local.DEBUG: === END DEBUG ===  
[2025-10-08 14:18:44] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 14:18:44] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000232","suffix":"-final"} 
[2025-10-08 14:18:44] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 14:18:44] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 14:18:44] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 14:18:44] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 14:18:44] local.DEBUG:  Supplier party built successfully  
[2025-10-08 14:18:44] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 14:18:44] local.DEBUG:  Buyer party built successfully  
[2025-10-08 14:18:44] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 14:18:44] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 14:18:44] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 14:18:44] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 14:18:44] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 14:18:44] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 14:18:44] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 14:18:44] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 14:18:44] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 14:18:44] local.DEBUG:  Invoice object created successfully {"id":"001000232","uuid":"7fdf2919-19c3-43e6-87a4-4bf376cf4e8f","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 14:18:44] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 14:18:44] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-08 14:18:44] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 14:18:44] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 14:18:44] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 14:18:44] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 14:18:44] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 14:18:44] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 14:18:44] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 14:18:44] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 14:18:44] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 14:18:44] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 14:18:44] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 14:18:44] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-08 14:18:44] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-08 14:18:44] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final.xml","file_size":8599} 
[2025-10-08 14:18:44] local.INFO:  Signing final XML  
[2025-10-08 14:18:44] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final.xml"} 
[2025-10-08 14:18:44] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000232-unsigned-final.xml"} 
[2025-10-08 14:18:44] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-08 14:18:44] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-08 14:18:44] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final-signed-1759918724.xml"} 
[2025-10-08 14:18:44] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final-signed-1759918724.xml"} 
[2025-10-08 14:18:44] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-08 14:18:44] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-08 14:18:44] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-08 14:18:44] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-08 14:18:44] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"MpJ
$Q\u000e|\u00101-E&k5)&
_E...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000>gTX\u001f!':QrxD\u0011...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\u0016!\u0010\fc:`{j\u0016[\u0006&3...[2 more bytes]","is_binary":true}]} 
[2025-10-08 14:18:44] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-08 14:18:44] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-08 14:18:44] local.DEBUG:  Generating QR PNG image for display  
[2025-10-08 14:18:44] local.DEBUG:  QR image generated {"image_length":4536} 
[2025-10-08 14:18:44] local.INFO:  Updating final XML with actual QR code  
[2025-10-08 14:18:44] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final.xml"} 
[2025-10-08 14:18:44] local.DEBUG: QR references found {"count":1} 
[2025-10-08 14:18:44] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 14:18:44] local.DEBUG:  XML QR code update completed  
[2025-10-08 14:18:44] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final-signed-1759918724.xml"} 
[2025-10-08 14:18:44] local.DEBUG: QR references found {"count":1} 
[2025-10-08 14:18:44] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-08 14:18:44] local.DEBUG:  XML QR code update completed  
[2025-10-08 14:18:44] local.DEBUG:  Final XML updated with QR code  
[2025-10-08 14:18:44] local.DEBUG:  Calculating final invoice hash  
[2025-10-08 14:18:44] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"0HD3XLG8sWxQOaawEOU5..."} 
[2025-10-08 14:18:44] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"232","invoice_hash_length":44} 
[2025-10-08 14:18:44] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000232","uuid":"7fdf2919-19c3-43e6-87a4-4bf376cf4e8f","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000232-unsigned-final-signed-1759918724.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 14:18:44] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":232,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-08 14:18:44] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":232,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-08 15:03:43] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 15:03:43] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 15:03:43] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 15:03:43] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 15:03:43] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000233","uuid":"d475e5b3-5ece-41ae-8266-37ab696b1882","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 15:03:43] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 15:03:43] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000233","uuid":"d475e5b3-5ece-41ae-8266-37ab696b1882","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"233","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 15:03:43] local.DEBUG:  Default values applied {"result_data":{"uuid":"d475e5b3-5ece-41ae-8266-37ab696b1882","invoice_counter":"233","pih":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000233","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive"}} 
[2025-10-08 15:03:43] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 15:03:43] local.DEBUG:  Running ZATCA validation  
[2025-10-08 15:03:43] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 15:03:43] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 15:03:43] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 15:03:43] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 15:03:43] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 15:03:43] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 15:03:43] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":70} 
[2025-10-08 15:03:43] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 15:03:43] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 15:03:43] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000233","uuid":"d475e5b3-5ece-41ae-8266-37ab696b1882","suffix":"final"} 
[2025-10-08 15:03:43] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 15:03:43] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 15:03:43] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 15:03:43] local.DEBUG: === END DEBUG ===  
[2025-10-08 15:03:43] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 15:03:43] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000233","suffix":"-final"} 
[2025-10-08 15:03:43] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 15:03:43] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 15:03:43] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 15:03:43] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 15:03:44] local.DEBUG:  Supplier party built successfully  
[2025-10-08 15:03:44] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 15:03:44] local.DEBUG:  Buyer party built successfully  
[2025-10-08 15:03:44] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 15:03:44] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 15:03:44] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 15:03:44] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 15:03:44] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 15:03:44] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 15:03:44] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 15:03:44] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 15:03:44] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 15:03:44] local.DEBUG:  Invoice object created successfully {"id":"001000233","uuid":"d475e5b3-5ece-41ae-8266-37ab696b1882","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 15:03:44] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 15:03:44] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-08 15:03:44] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 15:03:44] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 15:03:44] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 15:03:44] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 15:03:44] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 15:03:44] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 15:03:44] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 15:03:44] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 15:03:44] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 15:03:44] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 15:03:44] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 15:03:44] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-08 15:03:44] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-08 15:03:44] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599} 
[2025-10-08 15:03:44] local.INFO:  Signing final XML  
[2025-10-08 15:03:44] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-08 15:03:44] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-08 15:03:44] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-08 15:03:44] local.DEBUG:  Removed UBLDocumentSignatures from incorrect position  
[2025-10-08 15:03:44] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-08 15:03:44] local.DEBUG:  XML structure fixes completed  
[2025-10-08 15:03:44] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-08 15:03:44] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-08 15:03:44] local.ERROR:  XML structure debug info {"file":"001000233-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#","xades":"http://uri.etsi.org/01903/v1.3.2#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-08 15:03:44] local.ERROR:  XML signing failed {"error":"XML validation failed: SignatureInformation element not found","path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(184): App\\Services\\Zatca\\InvoiceSignerService->sign('C:\\\\xampp\\\\htdocs...')
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3239): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}"} 
[2025-10-08 15:03:44] local.ERROR:  Final signing failed {"error":"Final signing failed: XML validation failed: SignatureInformation element not found"} 
[2025-10-08 15:03:44] local.ERROR: ZATCA generation process failed: ZATCA generation failed: Final signing failed: Final signing failed: XML validation failed: SignatureInformation element not found {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-10-08 15:17:40] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 15:17:40] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-08 15:17:40] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-08 15:17:40] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-08 15:17:40] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000233","uuid":"e98deb8a-a793-43eb-b12f-1ee3b63291d4","has_certificate":true,"branch_number":"0010"} 
[2025-10-08 15:17:40] local.DEBUG:  Applying default values to invoice data  
[2025-10-08 15:17:40] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000233","uuid":"e98deb8a-a793-43eb-b12f-1ee3b63291d4","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"233","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-08 15:17:40] local.DEBUG:  Default values applied {"result_data":{"uuid":"e98deb8a-a793-43eb-b12f-1ee3b63291d4","invoice_counter":"233","pih":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000233","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive"}} 
[2025-10-08 15:17:40] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-08 15:17:40] local.DEBUG:  Running ZATCA validation  
[2025-10-08 15:17:40] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-08 15:17:40] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-08 15:17:40] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 15:17:40] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-08 15:17:40] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-08 15:17:40] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-08 15:17:40] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":71} 
[2025-10-08 15:17:40] local.DEBUG:  Provided certificate validated successfully  
[2025-10-08 15:17:40] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-08 15:17:40] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000233","uuid":"e98deb8a-a793-43eb-b12f-1ee3b63291d4","suffix":"final"} 
[2025-10-08 15:17:40] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-08 15:17:40] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-08 15:17:40] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-08 15:17:40] local.DEBUG: === END DEBUG ===  
[2025-10-08 15:17:40] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-08 15:17:40] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000233","suffix":"-final"} 
[2025-10-08 15:17:40] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-08 15:17:40] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-08 15:17:40] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-08 15:17:40] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-08 15:17:40] local.DEBUG:  Supplier party built successfully  
[2025-10-08 15:17:40] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-08 15:17:40] local.DEBUG:  Buyer party built successfully  
[2025-10-08 15:17:40] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-08 15:17:40] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-08 15:17:40] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-08 15:17:40] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-08 15:17:40] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-08 15:17:40] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-08 15:17:40] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 15:17:40] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 15:17:40] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-08 15:17:40] local.DEBUG:  Invoice object created successfully {"id":"001000233","uuid":"e98deb8a-a793-43eb-b12f-1ee3b63291d4","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-08 15:17:40] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-08 15:17:40] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-08 15:17:40] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-08 15:17:40] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-08 15:17:40] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-08 15:17:40] local.DEBUG: Processing QR references {"count":1} 
[2025-10-08 15:17:40] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-08 15:17:40] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-08 15:17:40] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-08 15:17:40] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 15:17:40] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-08 15:17:40] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-08 15:17:40] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-08 15:17:40] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-08 15:17:40] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-08 15:17:40] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599} 
[2025-10-08 15:17:40] local.INFO:  Signing final XML  
[2025-10-08 15:17:40] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-08 15:17:40] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-08 15:17:40] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-08 15:17:40] local.DEBUG:  Removed UBLDocumentSignatures from incorrect position  
[2025-10-08 15:17:40] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-08 15:17:40] local.DEBUG:  XML structure fixes completed  
[2025-10-08 15:17:40] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-08 15:17:40] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-08 15:17:40] local.ERROR:  XML structure debug info {"file":"001000233-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#","xades":"http://uri.etsi.org/01903/v1.3.2#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-08 15:17:40] local.ERROR:  XML signing failed {"error":"XML validation failed: SignatureInformation element not found","path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(184): App\\Services\\Zatca\\InvoiceSignerService->sign('C:\\\\xampp\\\\htdocs...')
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3239): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}"} 
[2025-10-08 15:17:40] local.ERROR:  Final signing failed {"error":"Final signing failed: XML validation failed: SignatureInformation element not found"} 
[2025-10-08 15:17:40] local.ERROR: ZATCA generation process failed: ZATCA generation failed: Final signing failed: Final signing failed: XML validation failed: SignatureInformation element not found {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-10-09 04:46:51] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 04:46:53] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 04:46:53] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 04:46:57] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 04:46:57] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000233","uuid":"a87ddd71-c009-4ad3-9a31-844df71484f7","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 04:46:57] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 04:46:57] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000233","uuid":"a87ddd71-c009-4ad3-9a31-844df71484f7","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"233","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 04:46:57] local.DEBUG:  Default values applied {"result_data":{"uuid":"a87ddd71-c009-4ad3-9a31-844df71484f7","invoice_counter":"233","pih":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000233","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive"}} 
[2025-10-09 04:46:57] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 04:46:57] local.DEBUG:  Running ZATCA validation  
[2025-10-09 04:46:57] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 04:46:57] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 04:46:57] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 04:46:57] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 04:46:57] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 04:46:57] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 04:46:57] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":71} 
[2025-10-09 04:46:57] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 04:46:57] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 04:46:57] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000233","uuid":"a87ddd71-c009-4ad3-9a31-844df71484f7","suffix":"final"} 
[2025-10-09 04:46:57] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 04:46:57] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 04:46:57] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 04:46:57] local.DEBUG: === END DEBUG ===  
[2025-10-09 04:46:57] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 04:46:57] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000233","suffix":"-final"} 
[2025-10-09 04:46:57] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 04:46:57] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 04:46:57] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 04:46:57] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 04:46:57] local.DEBUG:  Supplier party built successfully  
[2025-10-09 04:46:57] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 04:46:57] local.DEBUG:  Buyer party built successfully  
[2025-10-09 04:46:57] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 04:46:57] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 04:46:57] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 04:46:57] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 04:46:57] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 04:46:57] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 04:46:57] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:46:57] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:46:57] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:46:57] local.DEBUG:  Invoice object created successfully {"id":"001000233","uuid":"a87ddd71-c009-4ad3-9a31-844df71484f7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 04:46:58] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 04:46:58] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 04:46:58] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 04:46:58] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 04:46:58] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 04:46:58] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 04:46:58] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 04:46:58] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 04:46:58] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 04:46:58] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 04:46:58] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 04:46:58] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 04:46:58] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 04:46:58] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 04:46:58] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 04:46:58] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599} 
[2025-10-09 04:46:58] local.INFO:  Signing final XML  
[2025-10-09 04:46:58] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-09 04:46:58] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-09 04:46:58] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-09 04:46:58] local.DEBUG:  Removed UBLDocumentSignatures from incorrect position  
[2025-10-09 04:46:58] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-09 04:46:58] local.DEBUG:  XML structure fixes completed  
[2025-10-09 04:46:58] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-09 04:46:58] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-09 04:46:58] local.ERROR:  XML structure debug info {"file":"001000233-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#","xades":"http://uri.etsi.org/01903/v1.3.2#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-09 04:46:58] local.INFO:  Attempting to repair XML structure automatically  
[2025-10-09 04:46:58] local.DEBUG:  Repairing XML structure - adding missing SignatureInformation  
[2025-10-09 04:46:58] local.DEBUG:  XML structure repaired - added SignatureInformation  
[2025-10-09 04:46:58] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-09 04:46:58] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 04:46:58] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 04:46:58] local.DEBUG:  Loading certificate {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 04:46:58] local.DEBUG:  Certificate loaded successfully {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey"} 
[2025-10-09 04:46:58] local.ERROR:  Final signing failed {"error":"Call to undefined method phpseclib3\\File\\X509::getCertificate()"} 
[2025-10-09 04:46:58] local.ERROR: ZATCA generation process failed: ZATCA generation failed: Final signing failed: Call to undefined method phpseclib3\File\X509::getCertificate() {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-10-09 04:47:29] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 04:47:29] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 04:47:29] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 04:47:29] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 04:47:29] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000233","uuid":"66ddaa0e-5278-4fe7-9066-6c6d3635fb4a","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 04:47:29] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 04:47:29] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000233","uuid":"66ddaa0e-5278-4fe7-9066-6c6d3635fb4a","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"233","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 04:47:29] local.DEBUG:  Default values applied {"result_data":{"uuid":"66ddaa0e-5278-4fe7-9066-6c6d3635fb4a","invoice_counter":"233","pih":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000233","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"0HD3XLG8sWxQOaawEOU5KQgteCx+L6PvY63ZQ52N4nE=","pricing_type":"inclusive"}} 
[2025-10-09 04:47:29] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 04:47:29] local.DEBUG:  Running ZATCA validation  
[2025-10-09 04:47:29] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 04:47:29] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 04:47:29] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 04:47:29] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 04:47:29] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 04:47:29] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 04:47:29] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":71} 
[2025-10-09 04:47:29] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 04:47:29] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 04:47:29] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000233","uuid":"66ddaa0e-5278-4fe7-9066-6c6d3635fb4a","suffix":"final"} 
[2025-10-09 04:47:29] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 04:47:29] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 04:47:29] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 04:47:29] local.DEBUG: === END DEBUG ===  
[2025-10-09 04:47:29] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 04:47:29] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000233","suffix":"-final"} 
[2025-10-09 04:47:29] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 04:47:29] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 04:47:29] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 04:47:29] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 04:47:29] local.DEBUG:  Supplier party built successfully  
[2025-10-09 04:47:29] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 04:47:29] local.DEBUG:  Buyer party built successfully  
[2025-10-09 04:47:29] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 04:47:29] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 04:47:29] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 04:47:29] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 04:47:29] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 04:47:29] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 04:47:29] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:47:29] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:47:29] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:47:29] local.DEBUG:  Invoice object created successfully {"id":"001000233","uuid":"66ddaa0e-5278-4fe7-9066-6c6d3635fb4a","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 04:47:29] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 04:47:29] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 04:47:29] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 04:47:29] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 04:47:29] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 04:47:29] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 04:47:29] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 04:47:29] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 04:47:29] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 04:47:29] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 04:47:29] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 04:47:29] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 04:47:29] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 04:47:29] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 04:47:29] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 04:47:29] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml","file_size":8599} 
[2025-10-09 04:47:29] local.INFO:  Signing final XML  
[2025-10-09 04:47:29] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-09 04:47:29] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000233-unsigned-final.xml"} 
[2025-10-09 04:47:29] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 04:47:29] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-09 04:47:29] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final-signed-1759970849.xml"} 
[2025-10-09 04:47:29] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final-signed-1759970849.xml"} 
[2025-10-09 04:47:29] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-09 04:47:29] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-09 04:47:29] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":70,"is_binary":true} 
[2025-10-09 04:47:30] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-09 04:47:30] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"%\u0010r3IS#\u001ba`\u0019Db
G\u001frz`...[2 more bytes]","is_binary":true},{"tag":7,"length":70,"value_preview":"0D\u0002 k\u0001!`d\u001c\b?Fu}w1\u0002qp...[40 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"p\\lP9\u00109)\b-x,~/cC...[2 more bytes]","is_binary":true}]} 
[2025-10-09 04:47:30] local.DEBUG: ZATCA-compliant TLV generated {"total_length":292,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-09 04:47:30] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-09 04:47:30] local.DEBUG:  Generating QR PNG image for display  
[2025-10-09 04:47:30] local.DEBUG:  QR image generated {"image_length":4584} 
[2025-10-09 04:47:30] local.INFO:  Updating final XML with actual QR code  
[2025-10-09 04:47:30] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final.xml"} 
[2025-10-09 04:47:30] local.DEBUG: QR references found {"count":1} 
[2025-10-09 04:47:30] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 04:47:30] local.DEBUG:  XML QR code update completed  
[2025-10-09 04:47:30] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final-signed-1759970849.xml"} 
[2025-10-09 04:47:30] local.DEBUG: QR references found {"count":1} 
[2025-10-09 04:47:30] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 04:47:30] local.DEBUG:  XML QR code update completed  
[2025-10-09 04:47:30] local.DEBUG:  Final XML updated with QR code  
[2025-10-09 04:47:30] local.DEBUG:  Calculating final invoice hash  
[2025-10-09 04:47:30] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"4lM6awLVkhfYpdWp9i0/..."} 
[2025-10-09 04:47:30] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"233","invoice_hash_length":44} 
[2025-10-09 04:47:30] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000233","uuid":"66ddaa0e-5278-4fe7-9066-6c6d3635fb4a","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000233-unsigned-final-signed-1759970849.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 04:47:30] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":233,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 04:47:30] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":233,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-09 04:48:09] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 04:48:10] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 04:48:10] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 04:48:10] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 04:48:10] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000234","uuid":"67668d96-bd9e-4651-a93b-611ec9f093b7","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 04:48:10] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 04:48:10] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000234","uuid":"67668d96-bd9e-4651-a93b-611ec9f093b7","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"234","previous_invoice_hash":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 04:48:10] local.DEBUG:  Default values applied {"result_data":{"uuid":"67668d96-bd9e-4651-a93b-611ec9f093b7","invoice_counter":"234","pih":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000234","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg=","pricing_type":"inclusive"}} 
[2025-10-09 04:48:10] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 04:48:10] local.DEBUG:  Running ZATCA validation  
[2025-10-09 04:48:10] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 04:48:10] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 04:48:10] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 04:48:10] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 04:48:10] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 04:48:10] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 04:48:10] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":70} 
[2025-10-09 04:48:10] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 04:48:10] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 04:48:10] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000234","uuid":"67668d96-bd9e-4651-a93b-611ec9f093b7","suffix":"final"} 
[2025-10-09 04:48:10] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 04:48:10] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 04:48:10] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 04:48:10] local.DEBUG: === END DEBUG ===  
[2025-10-09 04:48:10] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 04:48:10] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000234","suffix":"-final"} 
[2025-10-09 04:48:10] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 04:48:10] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 04:48:10] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 04:48:10] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 04:48:10] local.DEBUG:  Supplier party built successfully  
[2025-10-09 04:48:10] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 04:48:10] local.DEBUG:  Buyer party built successfully  
[2025-10-09 04:48:10] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 04:48:10] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 04:48:10] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 04:48:10] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 04:48:10] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 04:48:10] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 04:48:10] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:48:10] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:48:10] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 04:48:10] local.DEBUG:  Invoice object created successfully {"id":"001000234","uuid":"67668d96-bd9e-4651-a93b-611ec9f093b7","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 04:48:10] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 04:48:10] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 04:48:10] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 04:48:10] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 04:48:10] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 04:48:10] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 04:48:10] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 04:48:10] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 04:48:10] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 04:48:10] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 04:48:10] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 04:48:10] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 04:48:10] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 04:48:10] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 04:48:10] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml","file_size":8252,"suffix_used":"-final"} 
[2025-10-09 04:48:10] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml","file_size":8252} 
[2025-10-09 04:48:10] local.INFO:  Signing final XML  
[2025-10-09 04:48:10] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml"} 
[2025-10-09 04:48:10] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml"} 
[2025-10-09 04:48:10] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 04:48:10] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-09 04:48:10] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-09 04:48:10] local.DEBUG:  XML structure fixes completed  
[2025-10-09 04:48:10] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000234-unsigned-final.xml"} 
[2025-10-09 04:48:10] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 04:48:10] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 04:48:10] local.DEBUG:  Loading certificate {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 04:48:10] local.DEBUG:  Certificate loaded successfully {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey"} 
[2025-10-09 04:48:10] local.ERROR:  Final signing failed {"error":"Call to undefined method phpseclib3\\File\\X509::getCertificate()"} 
[2025-10-09 04:48:10] local.ERROR: ZATCA generation process failed: ZATCA generation failed: Final signing failed: Call to undefined method phpseclib3\File\X509::getCertificate() {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-10-09 05:00:03] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 05:00:03] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 05:00:03] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 05:00:03] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 05:00:03] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000234","uuid":"b1fd799a-3ef8-46a6-af16-f1b6cd2cd091","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 05:00:03] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 05:00:03] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000234","uuid":"b1fd799a-3ef8-46a6-af16-f1b6cd2cd091","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"234","previous_invoice_hash":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 05:00:03] local.DEBUG:  Default values applied {"result_data":{"uuid":"b1fd799a-3ef8-46a6-af16-f1b6cd2cd091","invoice_counter":"234","pih":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000234","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg=","pricing_type":"inclusive"}} 
[2025-10-09 05:00:03] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 05:00:03] local.DEBUG:  Running ZATCA validation  
[2025-10-09 05:00:03] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 05:00:03] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 05:00:03] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 05:00:03] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 05:00:03] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 05:00:03] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 05:00:03] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":72} 
[2025-10-09 05:00:03] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 05:00:03] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 05:00:03] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000234","uuid":"b1fd799a-3ef8-46a6-af16-f1b6cd2cd091","suffix":"final"} 
[2025-10-09 05:00:03] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 05:00:03] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 05:00:03] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 05:00:03] local.DEBUG: === END DEBUG ===  
[2025-10-09 05:00:03] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 05:00:03] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000234","suffix":"-final"} 
[2025-10-09 05:00:03] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 05:00:03] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 05:00:03] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 05:00:03] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 05:00:03] local.DEBUG:  Supplier party built successfully  
[2025-10-09 05:00:03] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 05:00:03] local.DEBUG:  Buyer party built successfully  
[2025-10-09 05:00:03] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 05:00:03] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 05:00:03] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 05:00:03] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 05:00:03] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 05:00:03] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 05:00:03] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 05:00:03] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 05:00:03] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 05:00:03] local.DEBUG:  Invoice object created successfully {"id":"001000234","uuid":"b1fd799a-3ef8-46a6-af16-f1b6cd2cd091","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 05:00:03] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 05:00:03] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 05:00:03] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 05:00:03] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 05:00:03] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 05:00:03] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 05:00:03] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 05:00:03] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 05:00:03] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 05:00:03] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 05:00:03] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 05:00:03] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 05:00:03] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 05:00:03] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 05:00:03] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 05:00:03] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml","file_size":8599} 
[2025-10-09 05:00:03] local.INFO:  Signing final XML  
[2025-10-09 05:00:03] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml"} 
[2025-10-09 05:00:03] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml"} 
[2025-10-09 05:00:03] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-09 05:00:03] local.DEBUG:  Removed UBLDocumentSignatures from incorrect position  
[2025-10-09 05:00:03] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-09 05:00:03] local.DEBUG:  XML structure fixes completed  
[2025-10-09 05:00:03] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000234-unsigned-final.xml"} 
[2025-10-09 05:00:03] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000234-unsigned-final.xml"} 
[2025-10-09 05:00:03] local.ERROR:  XML structure debug info {"file":"001000234-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#","xades":"http://uri.etsi.org/01903/v1.3.2#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"4lM6awLVkhfYpdWp9i0/RWPjtdJ73KBag5pW8fl6Ymg="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-09 05:00:03] local.INFO:  Attempting to repair XML structure automatically  
[2025-10-09 05:00:03] local.DEBUG:  Repairing XML structure - adding missing SignatureInformation  
[2025-10-09 05:00:03] local.DEBUG:  XML structure repaired - added SignatureInformation  
[2025-10-09 05:00:03] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000234-unsigned-final.xml"} 
[2025-10-09 05:00:03] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 05:00:03] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 05:00:03] local.DEBUG:  Loading certificate {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 05:00:03] local.DEBUG:  Certificate loaded successfully {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey"} 
[2025-10-09 05:00:03] local.DEBUG:  Certificate properly encoded for KeyInfo {"certificate_length":704} 
[2025-10-09 05:00:03] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-09 05:00:03] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final-signed-1759971603.xml"} 
[2025-10-09 05:00:03] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final-signed-1759971603.xml"} 
[2025-10-09 05:00:03] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-09 05:00:03] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-09 05:00:03] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-09 05:00:03] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-09 05:00:03] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u001e2\u0011>Pis\tg!iWVaD;...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002 m;J{]2[qnfM]A\u001aC\u0013...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"S:k\u0002\u0017-?Ec{ZVz...[2 more bytes]","is_binary":true}]} 
[2025-10-09 05:00:03] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-09 05:00:03] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-09 05:00:03] local.DEBUG:  Generating QR PNG image for display  
[2025-10-09 05:00:04] local.DEBUG:  QR image generated {"image_length":4504} 
[2025-10-09 05:00:04] local.INFO:  Updating final XML with actual QR code  
[2025-10-09 05:00:04] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final.xml"} 
[2025-10-09 05:00:04] local.DEBUG: QR references found {"count":1} 
[2025-10-09 05:00:04] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 05:00:04] local.DEBUG:  XML QR code update completed  
[2025-10-09 05:00:04] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final-signed-1759971603.xml"} 
[2025-10-09 05:00:04] local.DEBUG: QR references found {"count":1} 
[2025-10-09 05:00:04] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 05:00:04] local.DEBUG:  XML QR code update completed  
[2025-10-09 05:00:04] local.DEBUG:  Final XML updated with QR code  
[2025-10-09 05:00:04] local.DEBUG:  Calculating final invoice hash  
[2025-10-09 05:00:04] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"4U9Wf4AX35yTre5nj8uH..."} 
[2025-10-09 05:00:04] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"234","invoice_hash_length":44} 
[2025-10-09 05:00:04] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000234","uuid":"b1fd799a-3ef8-46a6-af16-f1b6cd2cd091","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000234-unsigned-final-signed-1759971603.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 05:00:04] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":234,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 05:00:04] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":234,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-09 05:00:41] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 05:00:41] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 05:00:41] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 05:00:41] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 05:00:41] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000235","uuid":"b1bb0fa0-66af-467f-bf9f-6fd4c8aae285","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 05:00:41] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 05:00:41] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000235","uuid":"b1bb0fa0-66af-467f-bf9f-6fd4c8aae285","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"235","previous_invoice_hash":"4U9Wf4AX35yTre5nj8uHR10r4iHJZ3MKzinRi7inQmE=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 05:00:41] local.DEBUG:  Default values applied {"result_data":{"uuid":"b1bb0fa0-66af-467f-bf9f-6fd4c8aae285","invoice_counter":"235","pih":"4U9Wf4AX35yTre5nj8uHR10r4iHJZ3MKzinRi7inQmE=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000235","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"4U9Wf4AX35yTre5nj8uHR10r4iHJZ3MKzinRi7inQmE=","pricing_type":"inclusive"}} 
[2025-10-09 05:00:41] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 05:00:41] local.DEBUG:  Running ZATCA validation  
[2025-10-09 05:00:41] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 05:00:41] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 05:00:41] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 05:00:41] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 05:00:41] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 05:00:41] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 05:00:41] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":71} 
[2025-10-09 05:00:41] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 05:00:41] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 05:00:41] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000235","uuid":"b1bb0fa0-66af-467f-bf9f-6fd4c8aae285","suffix":"final"} 
[2025-10-09 05:00:41] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 05:00:41] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 05:00:41] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 05:00:41] local.DEBUG: === END DEBUG ===  
[2025-10-09 05:00:41] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 05:00:41] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000235","suffix":"-final"} 
[2025-10-09 05:00:41] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 05:00:41] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 05:00:41] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 05:00:41] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 05:00:41] local.DEBUG:  Supplier party built successfully  
[2025-10-09 05:00:41] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 05:00:41] local.DEBUG:  Buyer party built successfully  
[2025-10-09 05:00:41] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 05:00:41] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 05:00:41] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 05:00:41] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 05:00:41] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 05:00:41] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 05:00:41] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 05:00:41] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 05:00:41] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 05:00:41] local.DEBUG:  Invoice object created successfully {"id":"001000235","uuid":"b1bb0fa0-66af-467f-bf9f-6fd4c8aae285","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 05:00:41] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 05:00:41] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 05:00:41] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 05:00:41] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 05:00:41] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 05:00:41] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 05:00:41] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 05:00:41] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 05:00:41] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 05:00:41] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 05:00:41] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 05:00:41] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 05:00:41] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 05:00:41] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 05:00:41] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final.xml","file_size":8252,"suffix_used":"-final"} 
[2025-10-09 05:00:41] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final.xml","file_size":8252} 
[2025-10-09 05:00:41] local.INFO:  Signing final XML  
[2025-10-09 05:00:41] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final.xml"} 
[2025-10-09 05:00:41] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final.xml"} 
[2025-10-09 05:00:41] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 05:00:41] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-09 05:00:41] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-09 05:00:41] local.DEBUG:  XML structure fixes completed  
[2025-10-09 05:00:41] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000235-unsigned-final.xml"} 
[2025-10-09 05:00:41] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 05:00:41] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 05:00:41] local.DEBUG:  Loading certificate {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 05:00:41] local.DEBUG:  Certificate loaded successfully {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey"} 
[2025-10-09 05:00:41] local.DEBUG:  Certificate properly encoded for KeyInfo {"certificate_length":704} 
[2025-10-09 05:00:41] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-09 05:00:41] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final-signed-1759971641.xml"} 
[2025-10-09 05:00:41] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final-signed-1759971641.xml"} 
[2025-10-09 05:00:41] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-09 05:00:41] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-09 05:00:41] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-09 05:00:41] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-09 05:00:41] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"W\u0002?kn+\u001c!e|5\u001b&w\u001eW...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000G\"\u0019m\u0003c.\u001a
...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"OV\u0017gG]+!gs
)...[2 more bytes]","is_binary":true}]} 
[2025-10-09 05:00:42] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-09 05:00:42] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-09 05:00:42] local.DEBUG:  Generating QR PNG image for display  
[2025-10-09 05:00:42] local.DEBUG:  QR image generated {"image_length":4528} 
[2025-10-09 05:00:42] local.INFO:  Updating final XML with actual QR code  
[2025-10-09 05:00:42] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final.xml"} 
[2025-10-09 05:00:42] local.DEBUG: QR references found {"count":1} 
[2025-10-09 05:00:42] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 05:00:42] local.DEBUG:  XML QR code update completed  
[2025-10-09 05:00:42] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final-signed-1759971641.xml"} 
[2025-10-09 05:00:42] local.DEBUG: QR references found {"count":1} 
[2025-10-09 05:00:42] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 05:00:42] local.DEBUG:  XML QR code update completed  
[2025-10-09 05:00:42] local.DEBUG:  Final XML updated with QR code  
[2025-10-09 05:00:42] local.DEBUG:  Calculating final invoice hash  
[2025-10-09 05:00:42] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"XV/mnCP/fJsBVYuWu+/N..."} 
[2025-10-09 05:00:42] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"235","invoice_hash_length":44} 
[2025-10-09 05:00:42] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000235","uuid":"b1bb0fa0-66af-467f-bf9f-6fd4c8aae285","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000235-unsigned-final-signed-1759971641.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 05:00:42] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":235,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 05:00:42] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":235,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-09 09:36:48] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 09:36:55] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 09:36:56] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 09:36:56] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 09:36:56] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 09:36:56] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000236","uuid":"bbf0c28d-2b0a-4ecc-bcde-2e185374abed","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 09:36:56] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 09:36:56] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000236","uuid":"bbf0c28d-2b0a-4ecc-bcde-2e185374abed","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"236","previous_invoice_hash":"XV/mnCP/fJsBVYuWu+/NOE1vdf3Kfb8q7DK2vkH4HdA=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 09:36:56] local.DEBUG:  Default values applied {"result_data":{"uuid":"bbf0c28d-2b0a-4ecc-bcde-2e185374abed","invoice_counter":"236","pih":"XV/mnCP/fJsBVYuWu+/NOE1vdf3Kfb8q7DK2vkH4HdA=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000236","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"XV/mnCP/fJsBVYuWu+/NOE1vdf3Kfb8q7DK2vkH4HdA=","pricing_type":"inclusive"}} 
[2025-10-09 09:36:56] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 09:36:56] local.DEBUG:  Running ZATCA validation  
[2025-10-09 09:36:56] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 09:36:56] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 09:36:56] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 09:36:56] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 09:36:56] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 09:36:56] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 09:36:56] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":70} 
[2025-10-09 09:36:56] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 09:36:56] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 09:36:56] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000236","uuid":"bbf0c28d-2b0a-4ecc-bcde-2e185374abed","suffix":"final"} 
[2025-10-09 09:36:56] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 09:36:56] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 09:36:56] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 09:36:56] local.DEBUG: === END DEBUG ===  
[2025-10-09 09:36:56] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 09:36:56] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000236","suffix":"-final"} 
[2025-10-09 09:36:56] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 09:36:56] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 09:36:56] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 09:36:56] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 09:36:56] local.DEBUG:  Supplier party built successfully  
[2025-10-09 09:36:56] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 09:36:56] local.DEBUG:  Buyer party built successfully  
[2025-10-09 09:36:56] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 09:36:56] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 09:36:56] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 09:36:56] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 09:36:56] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 09:36:56] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 09:36:56] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 09:36:56] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 09:36:56] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 09:36:56] local.DEBUG:  Invoice object created successfully {"id":"001000236","uuid":"bbf0c28d-2b0a-4ecc-bcde-2e185374abed","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 09:36:56] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 09:36:56] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 09:36:56] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 09:36:56] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 09:36:56] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 09:36:56] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 09:36:56] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 09:36:56] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 09:36:56] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 09:36:56] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 09:36:56] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 09:36:56] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 09:36:56] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 09:36:56] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 09:36:56] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 09:36:56] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final.xml","file_size":8599} 
[2025-10-09 09:36:56] local.INFO:  Signing final XML  
[2025-10-09 09:36:56] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final.xml"} 
[2025-10-09 09:36:56] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final.xml"} 
[2025-10-09 09:36:56] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-09 09:36:56] local.DEBUG:  Removed UBLDocumentSignatures from incorrect position  
[2025-10-09 09:36:56] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-09 09:36:56] local.DEBUG:  XML structure fixes completed  
[2025-10-09 09:36:56] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000236-unsigned-final.xml"} 
[2025-10-09 09:36:56] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000236-unsigned-final.xml"} 
[2025-10-09 09:36:56] local.ERROR:  XML structure debug info {"file":"001000236-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"XV/mnCP/fJsBVYuWu+/NOE1vdf3Kfb8q7DK2vkH4HdA="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-09 09:36:56] local.INFO:  Attempting to repair XML structure automatically  
[2025-10-09 09:36:56] local.DEBUG:  Repairing XML structure - adding missing SignatureInformation  
[2025-10-09 09:36:56] local.DEBUG:  XML structure repaired - added SignatureInformation  
[2025-10-09 09:36:56] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000236-unsigned-final.xml"} 
[2025-10-09 09:36:56] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 09:36:56] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 09:36:56] local.DEBUG:  Loading certificate for ZATCA ECDSA {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 09:36:56] local.DEBUG:  Certificate loaded successfully for ZATCA {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_algorithm":"ECDSA-SHA256"} 
[2025-10-09 09:36:56] local.DEBUG:  Certificate properly encoded for KeyInfo {"certificate_length":704} 
[2025-10-09 09:36:56] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-09 09:36:56] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final-signed-1759988216.xml"} 
[2025-10-09 09:36:56] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final-signed-1759988216.xml"} 
[2025-10-09 09:36:56] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-09 09:36:56] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-09 09:36:56] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-09 09:36:56] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-09 09:36:56] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"iMv[o\u000eUh5r...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u000061b\u0003K0(5L\u001a\u0014}U>...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"]_#|\u0001U8Mou}*2A...[2 more bytes]","is_binary":true}]} 
[2025-10-09 09:36:56] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-09 09:36:56] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-09 09:36:56] local.DEBUG:  Generating QR PNG image for display  
[2025-10-09 09:36:56] local.DEBUG:  QR image generated {"image_length":4632} 
[2025-10-09 09:36:56] local.INFO:  Updating final XML with actual QR code  
[2025-10-09 09:36:56] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final.xml"} 
[2025-10-09 09:36:56] local.DEBUG: QR references found {"count":1} 
[2025-10-09 09:36:56] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 09:36:56] local.DEBUG:  XML QR code update completed  
[2025-10-09 09:36:56] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final-signed-1759988216.xml"} 
[2025-10-09 09:36:56] local.DEBUG: QR references found {"count":1} 
[2025-10-09 09:36:56] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 09:36:56] local.DEBUG:  XML QR code update completed  
[2025-10-09 09:36:56] local.DEBUG:  Final XML updated with QR code  
[2025-10-09 09:36:56] local.DEBUG:  Calculating final invoice hash  
[2025-10-09 09:36:56] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"XOl2MIWD1kmdjt7a9vF0..."} 
[2025-10-09 09:36:56] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"236","invoice_hash_length":44} 
[2025-10-09 09:36:56] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000236","uuid":"bbf0c28d-2b0a-4ecc-bcde-2e185374abed","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000236-unsigned-final-signed-1759988216.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 09:36:56] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":236,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 09:36:56] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":236,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-09 10:06:01] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 10:06:01] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 10:06:01] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 10:06:01] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 10:06:01] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000237","uuid":"18f356a4-69d6-46e1-9601-b7250a24af6c","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 10:06:01] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 10:06:01] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000237","uuid":"18f356a4-69d6-46e1-9601-b7250a24af6c","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"237","previous_invoice_hash":"XOl2MIWD1kmdjt7a9vF0f2N0lsrSyeYNIRuY8kI9NOQ=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 10:06:01] local.DEBUG:  Default values applied {"result_data":{"uuid":"18f356a4-69d6-46e1-9601-b7250a24af6c","invoice_counter":"237","pih":"XOl2MIWD1kmdjt7a9vF0f2N0lsrSyeYNIRuY8kI9NOQ=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000237","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"XOl2MIWD1kmdjt7a9vF0f2N0lsrSyeYNIRuY8kI9NOQ=","pricing_type":"inclusive"}} 
[2025-10-09 10:06:01] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 10:06:01] local.DEBUG:  Running ZATCA validation  
[2025-10-09 10:06:01] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 10:06:01] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 10:06:01] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 10:06:01] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 10:06:01] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 10:06:01] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 10:06:01] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":71} 
[2025-10-09 10:06:01] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 10:06:01] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 10:06:01] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000237","uuid":"18f356a4-69d6-46e1-9601-b7250a24af6c","suffix":"final"} 
[2025-10-09 10:06:01] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 10:06:01] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 10:06:01] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 10:06:01] local.DEBUG: === END DEBUG ===  
[2025-10-09 10:06:01] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 10:06:01] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000237","suffix":"-final"} 
[2025-10-09 10:06:01] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 10:06:01] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 10:06:01] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 10:06:01] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 10:06:01] local.DEBUG:  Supplier party built successfully  
[2025-10-09 10:06:01] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 10:06:01] local.DEBUG:  Buyer party built successfully  
[2025-10-09 10:06:01] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 10:06:01] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 10:06:01] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 10:06:01] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 10:06:01] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 10:06:01] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 10:06:01] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 10:06:01] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 10:06:01] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 10:06:01] local.DEBUG:  Invoice object created successfully {"id":"001000237","uuid":"18f356a4-69d6-46e1-9601-b7250a24af6c","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 10:06:01] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 10:06:01] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 10:06:01] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 10:06:01] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 10:06:01] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 10:06:01] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 10:06:01] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 10:06:01] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 10:06:01] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 10:06:01] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 10:06:01] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 10:06:01] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 10:06:01] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 10:06:01] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 10:06:01] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 10:06:01] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final.xml","file_size":8599} 
[2025-10-09 10:06:01] local.INFO:  Signing final XML  
[2025-10-09 10:06:01] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final.xml"} 
[2025-10-09 10:06:01] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final.xml"} 
[2025-10-09 10:06:01] local.DEBUG:  Removed all attributes from SignatureInformation  
[2025-10-09 10:06:01] local.DEBUG:  XML structure fixes completed  
[2025-10-09 10:06:01] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000237-unsigned-final.xml"} 
[2025-10-09 10:06:01] local.DEBUG:  Removed all attributes from SignatureInformation  
[2025-10-09 10:06:01] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 10:06:01] local.DEBUG:  Loading certificate {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 10:06:01] local.DEBUG:  Certificate loaded successfully {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey"} 
[2025-10-09 10:06:01] local.DEBUG:  Certificate properly encoded for KeyInfo {"certificate_length":704} 
[2025-10-09 10:06:01] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-09 10:06:01] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final-signed-1759989961.xml"} 
[2025-10-09 10:06:01] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final-signed-1759989961.xml"} 
[2025-10-09 10:06:01] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-09 10:06:01] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-09 10:06:01] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-09 10:06:01] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-09 10:06:01] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"KC`9=\u0013\u001ffu\\\u0017*...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u00008\u00055m7S}J`...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"\\v0Itct
!\u001bB=...[2 more bytes]","is_binary":true}]} 
[2025-10-09 10:06:01] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-09 10:06:01] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-09 10:06:01] local.DEBUG:  Generating QR PNG image for display  
[2025-10-09 10:06:01] local.DEBUG:  QR image generated {"image_length":4596} 
[2025-10-09 10:06:01] local.INFO:  Updating final XML with actual QR code  
[2025-10-09 10:06:01] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final.xml"} 
[2025-10-09 10:06:01] local.DEBUG: QR references found {"count":1} 
[2025-10-09 10:06:01] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 10:06:01] local.DEBUG:  XML QR code update completed  
[2025-10-09 10:06:01] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final-signed-1759989961.xml"} 
[2025-10-09 10:06:01] local.DEBUG: QR references found {"count":1} 
[2025-10-09 10:06:01] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 10:06:01] local.DEBUG:  XML QR code update completed  
[2025-10-09 10:06:01] local.DEBUG:  Final XML updated with QR code  
[2025-10-09 10:06:01] local.DEBUG:  Calculating final invoice hash  
[2025-10-09 10:06:01] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"eu/a6pLrrzvLGXPaH3Bg..."} 
[2025-10-09 10:06:01] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"237","invoice_hash_length":44} 
[2025-10-09 10:06:01] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000237","uuid":"18f356a4-69d6-46e1-9601-b7250a24af6c","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000237-unsigned-final-signed-1759989961.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 10:06:01] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":237,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 10:06:01] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":237,"invoice_hash_stored":true,"branch_id":"2"} 
[2025-10-09 13:07:30] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 13:07:37] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 13:07:37] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 13:07:37] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 13:07:37] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 13:07:37] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000238","uuid":"0cfd2035-7ddd-4915-8d73-43cf2675de5d","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 13:07:37] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 13:07:37] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000238","uuid":"0cfd2035-7ddd-4915-8d73-43cf2675de5d","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"238","previous_invoice_hash":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 13:07:37] local.DEBUG:  Default values applied {"result_data":{"uuid":"0cfd2035-7ddd-4915-8d73-43cf2675de5d","invoice_counter":"238","pih":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000238","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY=","pricing_type":"inclusive"}} 
[2025-10-09 13:07:37] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 13:07:37] local.DEBUG:  Running ZATCA validation  
[2025-10-09 13:07:37] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 13:07:37] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 13:07:37] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 13:07:37] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 13:07:37] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 13:07:37] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 13:07:37] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":71} 
[2025-10-09 13:07:37] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 13:07:37] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 13:07:37] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000238","uuid":"0cfd2035-7ddd-4915-8d73-43cf2675de5d","suffix":"final"} 
[2025-10-09 13:07:37] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 13:07:37] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 13:07:37] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 13:07:37] local.DEBUG: === END DEBUG ===  
[2025-10-09 13:07:37] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 13:07:37] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000238","suffix":"-final"} 
[2025-10-09 13:07:37] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 13:07:37] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 13:07:37] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 13:07:37] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 13:07:37] local.DEBUG:  Supplier party built successfully  
[2025-10-09 13:07:37] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 13:07:37] local.DEBUG:  Buyer party built successfully  
[2025-10-09 13:07:37] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 13:07:37] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 13:07:37] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 13:07:37] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 13:07:37] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 13:07:37] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 13:07:37] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 13:07:37] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 13:07:37] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 13:07:37] local.DEBUG:  Invoice object created successfully {"id":"001000238","uuid":"0cfd2035-7ddd-4915-8d73-43cf2675de5d","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 13:07:37] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 13:07:37] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 13:07:37] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 13:07:37] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 13:07:37] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 13:07:37] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 13:07:37] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 13:07:37] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 13:07:37] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 13:07:37] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 13:07:37] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 13:07:37] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 13:07:37] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 13:07:37] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 13:07:37] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 13:07:37] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml","file_size":8599} 
[2025-10-09 13:07:37] local.INFO:  Signing final XML  
[2025-10-09 13:07:37] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml"} 
[2025-10-09 13:07:37] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml"} 
[2025-10-09 13:07:37] local.DEBUG:  Removed all attributes from SignatureInformation  
[2025-10-09 13:07:37] local.DEBUG:  Removed existing UBLDocumentSignatures  
[2025-10-09 13:07:37] local.DEBUG:  XML structure fixes completed  
[2025-10-09 13:07:37] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000238-unsigned-final.xml"} 
[2025-10-09 13:07:37] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000238-unsigned-final.xml"} 
[2025-10-09 13:07:37] local.ERROR:  XML structure debug info {"file":"001000238-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-09 13:07:37] local.INFO:  Attempting to repair XML structure automatically  
[2025-10-09 13:07:37] local.DEBUG:  Repairing XML structure  
[2025-10-09 13:07:37] local.DEBUG:  XML structure repaired  
[2025-10-09 13:07:37] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000238-unsigned-final.xml"} 
[2025-10-09 13:07:37] local.ERROR:  XML signing failed {"error":"XML validation failed even after repair: SignatureInformation element not found","path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\app\\Services\\Zatca\\InvoiceXmlGenerator.php(184): App\\Services\\Zatca\\InvoiceSignerService->sign('C:\\\\xampp\\\\htdocs...')
#1 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Controllers\\PDFController.php(3239): App\\Services\\Zatca\\InvoiceXmlGenerator->generate(Array, Object(Saleh7\\Zatca\\Helpers\\Certificate), '0010')
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#6 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#8 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#46 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#47 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#48 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#49 {main}"} 
[2025-10-09 13:07:37] local.ERROR:  Final signing failed {"error":"Final signing failed: XML validation failed even after repair: SignatureInformation element not found"} 
[2025-10-09 13:07:37] local.ERROR: ZATCA generation process failed: ZATCA generation failed: Final signing failed: Final signing failed: XML validation failed even after repair: SignatureInformation element not found {"transaction_id":"PLEX35IN","trace":"#0 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Controller.php(54): App\\Http\\Controllers\\PDFController->generatetaxPDFA4('PLEX35IN')
#1 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\ControllerDispatcher.php(45): Illuminate\\Routing\\Controller->callAction('generatetaxPDFA...', Array)
#2 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(261): Illuminate\\Routing\\ControllerDispatcher->dispatch(Object(Illuminate\\Routing\\Route), Object(App\\Http\\Controllers\\PDFController), 'generatetaxPDFA...')
#3 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Route.php(205): Illuminate\\Routing\\Route->runController()
#4 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(721): Illuminate\\Routing\\Route->run()
#5 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}(Object(Illuminate\\Http\\Request))
#6 C:\\xampp\\htdocs\\netplex_26_7\\app\\Http\\Middleware\\DisableBackBtn.php(19): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#7 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): App\\Http\\Middleware\\DisableBackBtn->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#8 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Middleware\\SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#9 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#10 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken.php(78): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#11 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#12 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\View\\Middleware\\ShareErrorsFromSession.php(49): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#13 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\View\\Middleware\\ShareErrorsFromSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#14 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(121): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#15 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Session\\Middleware\\StartSession.php(64): Illuminate\\Session\\Middleware\\StartSession->handleStatefulRequest(Object(Illuminate\\Http\\Request), Object(Illuminate\\Session\\Store), Object(Closure))
#16 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Session\\Middleware\\StartSession->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#17 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse.php(37): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#18 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#19 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Cookie\\Middleware\\EncryptCookies.php(67): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#20 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Cookie\\Middleware\\EncryptCookies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#21 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#22 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(719): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#23 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(698): Illuminate\\Routing\\Router->runRouteWithinStack(Object(Illuminate\\Routing\\Route), Object(Illuminate\\Http\\Request))
#24 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(662): Illuminate\\Routing\\Router->runRoute(Object(Illuminate\\Http\\Request), Object(Illuminate\\Routing\\Route))
#25 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Routing\\Router.php(651): Illuminate\\Routing\\Router->dispatchToRoute(Object(Illuminate\\Http\\Request))
#26 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(167): Illuminate\\Routing\\Router->dispatch(Object(Illuminate\\Http\\Request))
#27 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(128): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}(Object(Illuminate\\Http\\Request))
#28 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#29 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#30 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#31 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#32 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#33 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#34 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#35 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#36 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance.php(86): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#37 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#38 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\fruitcake\\laravel-cors\\src\\HandleCors.php(38): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#39 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Fruitcake\\Cors\\HandleCors->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#40 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Http\\Middleware\\TrustProxies.php(39): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#41 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(167): Illuminate\\Http\\Middleware\\TrustProxies->handle(Object(Illuminate\\Http\\Request), Object(Closure))
#42 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Pipeline\\Pipeline.php(103): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}(Object(Illuminate\\Http\\Request))
#43 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(142): Illuminate\\Pipeline\\Pipeline->then(Object(Closure))
#44 C:\\xampp\\htdocs\\netplex_26_7\\vendor\\laravel\\framework\\src\\Illuminate\\Foundation\\Http\\Kernel.php(111): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter(Object(Illuminate\\Http\\Request))
#45 C:\\xampp\\htdocs\\netplex_26_7\\public\\index.php(51): Illuminate\\Foundation\\Http\\Kernel->handle(Object(Illuminate\\Http\\Request))
#46 C:\\xampp\\htdocs\\netplex_26_7\\server.php(21): require_once('C:\\\\xampp\\\\htdocs...')
#47 {main}"} 
[2025-10-09 13:09:39] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 13:09:39] local.DEBUG: Final line items before generation {"line_items_count":3,"first_item_unit_price":15.0,"first_item_total":15.0,"first_item_vat_percent":5.0} 
[2025-10-09 13:09:39] local.DEBUG: Certificate loaded successfully {"certificate_length":768,"private_key_length":236,"has_secret":true} 
[2025-10-09 13:09:39] local.DEBUG:  InvoiceXmlGenerator initialized {"signer":"App\\Services\\Zatca\\InvoiceSignerService","qrGenerator":"App\\Services\\Zatca\\InvoiceQrGenerator"} 
[2025-10-09 13:09:39] local.INFO:  STARTING ZATCA COMPLIANT INVOICE GENERATION {"invoice_number":"001000238","uuid":"6fe97e45-cf1d-4e7e-8caa-1ec01ffdaf5e","has_certificate":true,"branch_number":"0010"} 
[2025-10-09 13:09:39] local.DEBUG:  Applying default values to invoice data  
[2025-10-09 13:09:39] local.DEBUG:  Applying default values {"current_data":{"id":"PLEX35IN","invoice_number":"001000238","uuid":"6fe97e45-cf1d-4e7e-8caa-1ec01ffdaf5e","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_building":"0N/A","supplier_city":"Dubai","supplier_postal":"21324","supplier_country":"SA","buyer_name":"CUST-72718","buyer_vat":"","buyer_street":"Not Provided","buyer_city":"Dubai","buyer_postal":"00000","buyer_country":"SA","total_amount":45.0,"vat_amount":2.14,"currency":"SAR","transaction_type":"B2C","invoice_counter":"238","previous_invoice_hash":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY=","pricing_type":"inclusive","supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","invoice_type_code":"388","invoice_transaction_code":"02000000","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0"}} 
[2025-10-09 13:09:39] local.DEBUG:  Default values applied {"result_data":{"uuid":"6fe97e45-cf1d-4e7e-8caa-1ec01ffdaf5e","invoice_counter":"238","pih":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY=","supplier_building":"0N/A","supplier_postal":"21324","supplier_country":"SA","buyer_country":"SA","currency":"SAR","customization_id":"urn:cen.eu:en16931:2017#compliant#urn:sa.gov.zatca:invoice","profile_id":"reporting:1.0","invoice_type_code":"388","invoice_transaction_code":"02000000","buyer_street":"Not Provided","buyer_postal":"00000","total_amount":45.0,"amount_due":45.0,"supplier_plot":"PLOT-001","supplier_province":"Riyadh Province","supplier_province_code":"01","supplier_district":"Al Olaya","supplier_additional_address_line":"Building 1","buyer_plot":"PLOT-002","buyer_province":"Makkah Province","buyer_province_code":"02","buyer_district":"Al Zahra","buyer_additional_address_line":"Office 1","id":"PLEX35IN","invoice_number":"001000238","issue_datetime":"2025-09-11 19:24:20","supplier_name":"Netplex ","supplier_id":"312345678930003","supplier_crn":"","supplier_branch_no":"0010","supplier_street":"Ood Metha, Abu Dhabi, UAE","supplier_city":"Dubai","buyer_name":"CUST-72718","buyer_vat":"","buyer_city":"Dubai","vat_amount":2.14,"transaction_type":"B2C","previous_invoice_hash":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY=","pricing_type":"inclusive"}} 
[2025-10-09 13:09:39] local.DEBUG:  Provided totals validation {"provided_total":45.0,"provided_vat":2.14} 
[2025-10-09 13:09:39] local.DEBUG:  Running ZATCA validation  
[2025-10-09 13:09:39] local.DEBUG: ZatcaValidator constructed {"options":[]} 
[2025-10-09 13:09:39] local.DEBUG: ZatcaValidator validation started {"input_type":"array"} 
[2025-10-09 13:09:39] local.DEBUG: ZatcaValidator validating data {"invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 13:09:39] local.DEBUG: Invoice type code validation {"provided":"388","provided_type":"string","valid_codes":["388","381","383","386","389","326","380","384"],"is_valid":true} 
[2025-10-09 13:09:39] local.DEBUG: Transaction code validation {"provided":"02000000","valid_codes":["01000000","02000000","03000000","04000000"],"is_valid":true} 
[2025-10-09 13:09:39] local.DEBUG:  ZATCA validation passed {"warnings":[]} 
[2025-10-09 13:09:39] local.DEBUG:  ZATCA certificate validation passed {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_length":72} 
[2025-10-09 13:09:39] local.DEBUG:  Provided certificate validated successfully  
[2025-10-09 13:09:39] local.INFO:  Generating final unsigned XML with QR placeholder  
[2025-10-09 13:09:39] local.INFO:  Starting unsigned XML generation {"invoice_number":"001000238","uuid":"6fe97e45-cf1d-4e7e-8caa-1ec01ffdaf5e","suffix":"final"} 
[2025-10-09 13:09:39] local.DEBUG: === XML GENERATION DEBUG ===  
[2025-10-09 13:09:39] local.DEBUG: Required fields check {"missing_fields":[],"has_line_items":true,"line_items_count":3} 
[2025-10-09 13:09:39] local.DEBUG: VAT number validation {"vat_number":"312345678930003","is_valid":true,"length":15} 
[2025-10-09 13:09:39] local.DEBUG: === END DEBUG ===  
[2025-10-09 13:09:39] local.DEBUG:  Tax scheme created {"id":"VAT"} 
[2025-10-09 13:09:39] local.DEBUG:  Invoice identification {"branch_part":"0010","invoice_number":"001000238","suffix":"-final"} 
[2025-10-09 13:09:39] local.DEBUG:  Parsing datetime {"input":"2025-09-11 19:24:20"} 
[2025-10-09 13:09:39] local.DEBUG:  Datetime parsed successfully {"result":"2025-09-11 19:24:20"} 
[2025-10-09 13:09:39] local.DEBUG:  Issue date/time parsed {"issue_date":"2025-09-11","issue_time":"19:24:20Z"} 
[2025-10-09 13:09:39] local.DEBUG:  Building supplier party {"supplier_name":"Netplex ","supplier_id":"312345678930003"} 
[2025-10-09 13:09:39] local.DEBUG:  Supplier party built successfully  
[2025-10-09 13:09:39] local.DEBUG:  Building buyer party {"buyer_name":"CUST-72718"} 
[2025-10-09 13:09:39] local.DEBUG:  Buyer party built successfully  
[2025-10-09 13:09:39] local.DEBUG:  Building invoice lines {"line_items_count":3,"pricing_type":"inclusive"} 
[2025-10-09 13:09:39] local.DEBUG:  Invoice lines processed {"total_lines":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0,"vat_groups_count":1,"pricing_type":"inclusive"} 
[2025-10-09 13:09:39] local.DEBUG:  Invoice lines built {"line_count":3,"total_line_amount":42.86,"total_vat_amount":2.14,"grand_total":45.0} 
[2025-10-09 13:09:39] local.DEBUG:  Building tax total {"vat_groups_count":1,"provided_vat_amount":2.14} 
[2025-10-09 13:09:39] local.DEBUG:  Tax total built {"calculated_total":2.14,"final_total":2.14,"subtotals_count":1} 
[2025-10-09 13:09:39] local.DEBUG:  Monetary totals built {"grand_total":45.0,"line_amount":42.86,"amount_due":45.0,"vat_amount":2.14} 
[2025-10-09 13:09:39] local.DEBUG:  AdditionalDocumentReferences built {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 13:09:39] local.DEBUG:  Generated AdditionalDocumentReferences BEFORE setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 13:09:39] local.DEBUG:  AdditionalDocumentReferences AFTER setting {"count":3,"ids":["ICV","PIH","QR"]} 
[2025-10-09 13:09:39] local.DEBUG:  Invoice object created successfully {"id":"001000238","uuid":"6fe97e45-cf1d-4e7e-8caa-1ec01ffdaf5e","invoice_type_code":"388","invoice_transaction_code":"02000000"} 
[2025-10-09 13:09:39] local.DEBUG:  STARTING XML ENHANCEMENT FOR ZATCA PHASE 2  
[2025-10-09 13:09:39] local.DEBUG:  Adding UBLExtensions with PreviousInvoiceHash and SignatureInformation  
[2025-10-09 13:09:39] local.DEBUG:  Converting PIH and QR to EmbeddedDocumentBinaryObject  
[2025-10-09 13:09:39] local.DEBUG: Processing PIH references {"count":1} 
[2025-10-09 13:09:39] local.DEBUG:  Converted PIH to EmbeddedDocumentBinaryObject  
[2025-10-09 13:09:39] local.DEBUG: Processing QR references {"count":1} 
[2025-10-09 13:09:39] local.DEBUG:  Converted QR to EmbeddedDocumentBinaryObject  
[2025-10-09 13:09:39] local.DEBUG:  Enhancing supplier address with KSA fields  
[2025-10-09 13:09:39] local.DEBUG: Injecting KSA address fields for supplier_ {"address_count":1} 
[2025-10-09 13:09:39] local.DEBUG:  KSA address fields injected for supplier_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 13:09:39] local.DEBUG:  Enhancing buyer address with KSA fields  
[2025-10-09 13:09:39] local.DEBUG: Injecting KSA address fields for buyer_ {"address_count":1} 
[2025-10-09 13:09:39] local.DEBUG:  KSA address fields injected for buyer_ {"fields_added":["PlotIdentification","CountrySubentity","CountrySubentityCode","District","AdditionalAddressLine"]} 
[2025-10-09 13:09:39] local.DEBUG:  XML ENHANCEMENT COMPLETED SUCCESSFULLY - SignatureInformation added  
[2025-10-09 13:09:39] local.INFO:  XML file generated successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml","file_size":8599,"suffix_used":"-final"} 
[2025-10-09 13:09:39] local.DEBUG:  Final unsigned XML generated {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml","file_size":8599} 
[2025-10-09 13:09:39] local.INFO:  Signing final XML  
[2025-10-09 13:09:39] local.DEBUG:  Starting XML signing process {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml"} 
[2025-10-09 13:09:39] local.DEBUG:  Fixing XML structure for ZATCA compliance {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml"} 
[2025-10-09 13:09:39] local.DEBUG:  Set correct id attribute for SignatureInformation  
[2025-10-09 13:09:39] local.DEBUG:  Removed UBLDocumentSignatures from incorrect position  
[2025-10-09 13:09:39] local.DEBUG:  UBLDocumentSignatures placement verified  
[2025-10-09 13:09:39] local.DEBUG:  XML structure fixes completed  
[2025-10-09 13:09:39] local.DEBUG:  XML validation for signing completed {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000238-unsigned-final.xml"} 
[2025-10-09 13:09:39] local.ERROR:  XML validation failed before signing {"valid":false,"errors":["SignatureInformation element not found"],"warnings":[],"file":"001000238-unsigned-final.xml"} 
[2025-10-09 13:09:39] local.ERROR:  XML structure debug info {"file":"001000238-unsigned-final.xml","elements":{"UBLExtensions_count":1,"UBLExtension_count":2,"PreviousInvoiceHash":1,"UBLDocumentSignatures":0,"SignatureInformation":0,"UBLVersionID":1,"InvoiceID":16,"IssueDate":1,"IssueTime":1},"namespaces":{"sig":"urn:oasis:names:specification:ubl:schema:xsd:CommonSignatureComponents-2","sac":"urn:oasis:names:specification:ubl:schema:xsd:SignatureAggregateComponents-2","ds":"http://www.w3.org/2000/09/xmldsig#"},"extensions_content":{"extension_0":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"sac:PreviousInvoiceHash","content":"eu/a6pLrrzvLGXPaH3BgyB/8TcgSYJcvdCgtf4mc+qY="}]},"extension_1":{"child_elements":["ext:ExtensionContent"],"content":[{"element":"cbc:UBLVersionID","content":"2.1"}]}}} 
[2025-10-09 13:09:39] local.INFO:  Attempting to repair XML structure automatically  
[2025-10-09 13:09:39] local.DEBUG:  Repairing XML structure - adding missing SignatureInformation  
[2025-10-09 13:09:39] local.DEBUG:  XML structure repaired - added SignatureInformation  
[2025-10-09 13:09:39] local.DEBUG:  XML validation for signing completed {"valid":true,"errors":[],"warnings":[],"file":"001000238-unsigned-final.xml"} 
[2025-10-09 13:09:39] local.DEBUG:  Removed invalid id attribute from SignatureInformation  
[2025-10-09 13:09:39] local.DEBUG:  Creating ZATCA-compliant signature structure  
[2025-10-09 13:09:39] local.DEBUG:  Loading certificate for ZATCA ECDSA {"cert_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/certificate.pem","key_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/dev/private_ec.pem"} 
[2025-10-09 13:09:39] local.DEBUG:  Certificate loaded successfully for ZATCA {"private_key_type":"phpseclib3\\Crypt\\EC\\PrivateKey","signature_algorithm":"ECDSA-SHA256"} 
[2025-10-09 13:09:39] local.DEBUG:  Certificate properly encoded for KeyInfo {"certificate_length":704} 
[2025-10-09 13:09:39] local.DEBUG:  ZATCA-compliant signature structure created  
[2025-10-09 13:09:39] local.DEBUG:  XML signed successfully {"signed_path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final-signed-1760000979.xml"} 
[2025-10-09 13:09:39] local.DEBUG:  Final XML signed successfully {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final-signed-1760000979.xml"} 
[2025-10-09 13:09:39] local.INFO:  Generating QR code with cryptographic tags  
[2025-10-09 13:09:39] local.INFO: Generating ZATCA-compliant QR code with cryptographic tags {"certificate_type":"Saleh7\\Zatca\\Helpers\\Certificate"} 
[2025-10-09 13:09:39] local.DEBUG: ECDSA signature generated {"data_length":32,"signature_length":71,"is_binary":true} 
[2025-10-09 13:09:39] local.DEBUG: Public key extracted {"public_key_length":120,"is_binary":true} 
[2025-10-09 13:09:39] local.DEBUG: TLV structure analysis {"tags":[{"tag":1,"length":8,"value_preview":"Netplex ","is_binary":true},{"tag":2,"length":15,"value_preview":"312345678930003","is_binary":true},{"tag":3,"length":20,"value_preview":"2025-09-11T19:24:20Z","is_binary":true},{"tag":4,"length":5,"value_preview":"45.00","is_binary":true},{"tag":5,"length":4,"value_preview":"2.14","is_binary":true},{"tag":6,"length":32,"value_preview":"\u0000\u0014\u000f\u0011\u0004x0]*$\u0015/-...[2 more bytes]","is_binary":true},{"tag":7,"length":71,"value_preview":"0E\u0002!\u0000S\u0016~4b\u0004#\u0005\b...[41 more bytes]","is_binary":true},{"tag":8,"length":88,"value_preview":"0V0\u0010\u0006\u0007*H=\u0002\u0001\u0006\u0005+\u0004\u0000
\u0003B\u0000\u0004'^1...[58 more bytes]","is_binary":true},{"tag":9,"length":32,"value_preview":"z;\u0019s\u001fp`\u001fM\u0012`/t(-...[2 more bytes]","is_binary":true}]} 
[2025-10-09 13:09:39] local.DEBUG: ZATCA-compliant TLV generated {"total_length":293,"tags_present":[1,2,3,4,5,6,7,8,9]} 
[2025-10-09 13:09:39] local.DEBUG:  QR code with crypto tags generated {"length":392,"first_50_chars":"AQhOZXRwbGV4IAIPMzEyMzQ1Njc4OTMwMDAzAxQyMDI1LTA5LT..."} 
[2025-10-09 13:09:39] local.DEBUG:  Generating QR PNG image for display  
[2025-10-09 13:09:40] local.DEBUG:  QR image generated {"image_length":4520} 
[2025-10-09 13:09:40] local.INFO:  Updating final XML with actual QR code  
[2025-10-09 13:09:40] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final.xml"} 
[2025-10-09 13:09:40] local.DEBUG: QR references found {"count":1} 
[2025-10-09 13:09:40] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 13:09:40] local.DEBUG:  XML QR code update completed  
[2025-10-09 13:09:40] local.DEBUG:  Updating XML with actual QR code {"path":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final-signed-1760000979.xml"} 
[2025-10-09 13:09:40] local.DEBUG: QR references found {"count":1} 
[2025-10-09 13:09:40] local.DEBUG:  QR code updated in XML {"old_length":68,"new_length":392} 
[2025-10-09 13:09:40] local.DEBUG:  XML QR code update completed  
[2025-10-09 13:09:40] local.DEBUG:  Final XML updated with QR code  
[2025-10-09 13:09:40] local.DEBUG:  Calculating final invoice hash  
[2025-10-09 13:09:40] local.DEBUG:  Final invoice hash calculated {"hash_length":44,"hash_preview":"JQvRFvvAsaNJZ4OTcbRF..."} 
[2025-10-09 13:09:40] local.INFO:  Branch invoice state updated {"branch_id":2,"invoice_counter":"238","invoice_hash_length":44} 
[2025-10-09 13:09:40] local.INFO:  ZATCA COMPLIANT INVOICE GENERATION COMPLETED SUCCESSFULLY {"invoice_number":"001000238","uuid":"6fe97e45-cf1d-4e7e-8caa-1ec01ffdaf5e","final_signed_xml":"C:\\xampp\\htdocs\\netplex_26_7\\storage\\zatca/001000238-unsigned-final-signed-1760000979.xml","has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 13:09:40] local.INFO: ZATCA SINGLE GENERATION COMPLETED SUCCESSFULLY {"transaction_id":"PLEX35IN","invoice_counter_used":238,"has_qr_code":true,"has_invoice_hash":true,"generation_flow":"SINGLE_PASS"} 
[2025-10-09 13:09:40] local.INFO: ZATCA invoice generated and data stored successfully. {"transaction_id":"PLEX35IN","invoice_counter_used":238,"invoice_hash_stored":true,"branch_id":"2"} 
